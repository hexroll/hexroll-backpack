class Queue$$module$libs$polylabel{constructor(a=[],e=defaultCompare$$module$libs$polylabel){this.data=a;this.length=this.data.length;this.compare=e;if(0<this.length)for(a=(this.length>>1)-1;0<=a;a--)this._down(a)}push(a){this.data.push(a);this._up(this.length++)}pop(){if(0!==this.length){var a=this.data[0],e=this.data.pop();0<--this.length&&(this.data[0]=e,this._down(0));return a}}peek(){return this.data[0]}_up(a){const {data:e,compare:n}=this,t=e[a];for(;0<a;){const z=a-1>>1,D=e[z];if(0<=n(t,D))break;
e[a]=D;a=z}e[a]=t}_down(a){const {data:e,compare:n}=this,t=this.length>>1,z=e[a];for(;a<t;){let D=(a<<1)+1;const F=D+1;F<this.length&&0>n(e[F],e[D])&&(D=F);if(0<=n(e[D],z))break;e[a]=e[D];a=D}e[a]=z}}function defaultCompare$$module$libs$polylabel(a,e){return a<e?-1:a>e?1:0}
function polylabel$$module$libs$polylabel(a,e,n){e=e||1;for(var t,z,D,F,J=0;J<a[0].length;J++){var G=a[0][J];if(!J||G[0]<t)t=G[0];if(!J||G[1]<z)z=G[1];if(!J||G[0]>D)D=G[0];if(!J||G[1]>F)F=G[1]}var K=D-t,I=F-z,L=Math.min(K,I);G=L/2;if(0===L)return a=[t,z],a.distance=0,a;J=new Queue$$module$libs$polylabel(void 0,compareMax$$module$libs$polylabel);for(var Q=t;Q<D;Q+=L)for(var M=z;M<F;M+=L)J.push(new Cell$$module$libs$polylabel(Q+G,M+G,G,a));D=getCentroidCell$$module$libs$polylabel(a);t=new Cell$$module$libs$polylabel(t+
K/2,z+I/2,0,a);t.d>D.d&&(D=t);for(t=J.length;J.length;)z=J.pop(),z.d>D.d&&(D=z,n&&console.log("found best %f after %d probes",Math.round(1E4*z.d)/1E4,t)),z.max-D.d<=e||(G=z.h/2,J.push(new Cell$$module$libs$polylabel(z.x-G,z.y-G,G,a)),J.push(new Cell$$module$libs$polylabel(z.x+G,z.y-G,G,a)),J.push(new Cell$$module$libs$polylabel(z.x-G,z.y+G,G,a)),J.push(new Cell$$module$libs$polylabel(z.x+G,z.y+G,G,a)),t+=4);n&&(console.log("num probes: "+t),console.log("best distance: "+D.d));a=[D.x,D.y];a.distance=
D.d;return a}function compareMax$$module$libs$polylabel(a,e){return e.max-a.max}function Cell$$module$libs$polylabel(a,e,n,t){this.x=a;this.y=e;this.h=n;this.d=pointToPolygonDist$$module$libs$polylabel(a,e,t);this.max=this.d+this.h*Math.SQRT2}
function pointToPolygonDist$$module$libs$polylabel(a,e,n){for(var t=!1,z=Infinity,D=0;D<n.length;D++)for(var F=n[D],J=0,G=F.length,K=G-1;J<G;K=J++){var I=F[J];K=F[K];I[1]>e!==K[1]>e&&a<(K[0]-I[0])*(e-I[1])/(K[1]-I[1])+I[0]&&(t=!t);z=Math.min(z,getSegDistSq$$module$libs$polylabel(a,e,I,K))}return 0===z?0:(t?1:-1)*Math.sqrt(z)}
function getCentroidCell$$module$libs$polylabel(a){for(var e=0,n=0,t=0,z=a[0],D=0,F=z.length,J=F-1;D<F;J=D++){var G=z[D];J=z[J];var K=G[0]*J[1]-J[0]*G[1];n+=(G[0]+J[0])*K;t+=(G[1]+J[1])*K;e+=3*K}return 0===e?new Cell$$module$libs$polylabel(z[0][0],z[0][1],0,a):new Cell$$module$libs$polylabel(n/e,t/e,0,a)}
function getSegDistSq$$module$libs$polylabel(a,e,n,t){var z=n[0];n=n[1];var D=t[0]-z,F=t[1]-n;if(0!==D||0!==F){var J=((a-z)*D+(e-n)*F)/(D*D+F*F);1<J?(z=t[0],n=t[1]):0<J&&(z+=D*J,n+=F*J)}D=a-z;F=e-n;return D*D+F*F}var module$libs$polylabel={};module$libs$polylabel.polylabel=polylabel$$module$libs$polylabel;function makeHex$$module$hexpoly(a){const e=20.8*Math.cos(Math.PI/6),n=a[0]-10;a=a[1]-e/2+.16;return[[5+.1/Math.sqrt(3)+n,.1+a],[15-.1/Math.sqrt(3)+n,.1+a],[20-2/Math.sqrt(3)*.1+n,.5*e+a],[15-.1/Math.sqrt(3)+n,e-.1+a],[5+.1/Math.sqrt(3)+n,e-.1+a],[2/Math.sqrt(3)*.1+n,.5*e+a]]}function getOffset$$module$hexpoly(a,e,n=0,t=0){return[30*a+Math.abs(e)%2*15-n,10.4*e*Math.cos(Math.PI/6)-t]}function almostEquals$$module$hexpoly(a,e){return a<=e+1&&a>=e-1?!0:!1}
function doesntContain$$module$hexpoly(a,e){for(let n=0;n<a.length;n++)if(almostEquals$$module$hexpoly(a[n][0],e[0])&&almostEquals$$module$hexpoly(a[n][1],e[1]))return!1;return!0}
function findIntersections$$module$hexpoly(a,e){for(let n=0;n<a.length;n++)for(let t=0;t<a[n].length;t++){const z=a[n][t];let D=0;for(let F=0;F<a.length;F++)for(let J=0;J<a[F].length;J++)almostEquals$$module$hexpoly(a[F][J][0],z[0])&&almostEquals$$module$hexpoly(a[F][J][1],z[1])&&(D+=1);(1==D||2==D)&&doesntContain$$module$hexpoly(e,z)&&e.push(z)}}function areAdjacent$$module$hexpoly(a,e){const n=a[0]-e[0];a=a[1]-e[1];return 150>=n*n+a*a?!0:!1}
function shareOneHex$$module$hexpoly(a,e,n){let t=0;for(let z=0;z<a.length;z++)doesntContain$$module$hexpoly(a[z],n)||doesntContain$$module$hexpoly(a[z],e)||(t+=1);return 1===t?!0:!1}
function getOutlineFromArray$$module$hexpoly(a){var e=[];for(var n=0;n<a.length;n++)e.push(getOffset$$module$hexpoly(a[n][0],a[n][1]));a=[];for(n=0;n<e.length;n++)a.push(makeHex$$module$hexpoly(e[n]));e=[];findIntersections$$module$hexpoly(a,e);n=[];let t=[];const z=e.length;t.push(e[0]);e.splice(0,1);let D,F=t[0];for(let J=1;J<z;J++){D=!1;for(let G=0;G<e.length;G++)if(areAdjacent$$module$hexpoly(e[G],F)&&shareOneHex$$module$hexpoly(a,e[G],F)){t.push(e[G]);F=e[G];e.splice(G,1);D=!0;break}!1===D&&
t.length<z&&(n.push(t),t=[],t.push(e[0]),F=t[0],e.splice(0,1))}n.push(t);return n}var module$hexpoly={};module$hexpoly.getOutlineFromArray=getOutlineFromArray$$module$hexpoly;var n$$module$libs$htm=function(a,e,n,t){var z;e[0]=0;for(var D=1;D<e.length;D++){var F=e[D++],J=e[D]?(e[0]|=F?1:2,n[e[D++]]):e[++D];3===F?t[0]=J:4===F?t[1]=Object.assign(t[1]||{},J):5===F?(t[1]=t[1]||{})[e[++D]]=J:6===F?t[1][e[++D]]+=J+"":F?(z=a.apply(J,n$$module$libs$htm(a,J,n,["",null])),t.push(z),J[0]?e[0]|=2:(e[D-2]=0,e[D]=z)):t.push(J)}return t},t$$module$libs$htm=new Map,$jscompDefaultExport$$module$libs$htm=function(a){var e=t$$module$libs$htm.get(this);return e||(e=new Map,t$$module$libs$htm.set(this,
e)),1<(e=n$$module$libs$htm(this,e.get(a)||(e.set(a,e=function(n){for(var t,z,D=1,F="",J="",G=[0],K=function(Q){1===D&&(Q||(F=F.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?G.push(0,Q,F):3===D&&(Q||F)?(G.push(3,Q,F),D=2):2===D&&"..."===F&&Q?G.push(4,Q,0):2===D&&F&&!Q?G.push(5,0,!0,F):5<=D&&((F||!Q&&5===D)&&(G.push(D,0,F,z),D=6),Q&&(G.push(D,Q,0,z),D=6));F=""},I=0;I<n.length;I++){I&&(1===D&&K(),K(I));for(var L=0;L<n[I].length;L++)t=n[I][L],1===D?"<"===t?(K(),G=[G],D=3):F+=t:4===D?"--"===F&&">"===t?(D=1,F=
""):F=t+F[0]:J?t===J?J="":F+=t:'"'===t||"'"===t?J=t:">"===t?(K(),D=1):D&&("="===t?(D=5,z=F,F=""):"/"===t&&(5>D||">"===n[I][L+1])?(K(),3===D&&(G=G[0]),D=G,(G=G[0]).push(2,0,D),D=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(K(),D=2):F+=t),3===D&&"!--"===F&&(D=4,G=G[0])}return K(),G}(a)),e),arguments,[])).length?e:e[0]},module$libs$htm={};module$libs$htm.default=$jscompDefaultExport$$module$libs$htm;var n$$module$libs$preact,l$$module$libs$preact,u$$module$libs$preact,i$$module$libs$preact,t$$module$libs$preact,r$$module$libs$preact,o$$module$libs$preact,f$$module$libs$preact,e$$module$libs$preact,c$$module$libs$preact={},s$$module$libs$preact=[],a$$module$libs$preact=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function h$$module$libs$preact(a,e){for(var n in e)a[n]=e[n];return a}function v$$module$libs$preact(a){var e=a.parentNode;e&&e.removeChild(a)}
function y$$module$libs$preact(a,e,n){var t,z,D,F={};for(D in e)"key"==D?t=e[D]:"ref"==D?z=e[D]:F[D]=e[D];if(2<arguments.length&&(F.children=3<arguments.length?n$$module$libs$preact.call(arguments,2):n),"function"==typeof a&&null!=a.defaultProps)for(D in a.defaultProps)void 0===F[D]&&(F[D]=a.defaultProps[D]);return p$$module$libs$preact(a,F,t,z,null)}
function p$$module$libs$preact(a,e,n,t,z){a={type:a,props:e,key:n,ref:t,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:null==z?++u$$module$libs$preact:z};return null==z&&null!=l$$module$libs$preact.vnode&&l$$module$libs$preact.vnode(a),a}function d$$module$libs$preact(){return{current:null}}function _$$module$libs$preact(a){return a.children}function k$$module$libs$preact(a,e){this.props=a;this.context=e}
function b$$module$libs$preact(a,e){if(null==e)return a.__?b$$module$libs$preact(a.__,a.__.__k.indexOf(a)+1):null;for(var n;e<a.__k.length;e++)if(null!=(n=a.__k[e])&&null!=n.__e)return n.__e;return"function"==typeof a.type?b$$module$libs$preact(a):null}function g$$module$libs$preact(a){var e,n;if(null!=(a=a.__)&&null!=a.__c){a.__e=a.__c.base=null;for(e=0;e<a.__k.length;e++)if(null!=(n=a.__k[e])&&null!=n.__e){a.__e=a.__c.base=n.__e;break}return g$$module$libs$preact(a)}}
function m$$module$libs$preact(a){(!a.__d&&(a.__d=!0)&&t$$module$libs$preact.push(a)&&!w$$module$libs$preact.__r++||r$$module$libs$preact!==l$$module$libs$preact.debounceRendering)&&((r$$module$libs$preact=l$$module$libs$preact.debounceRendering)||o$$module$libs$preact)(w$$module$libs$preact)}
function w$$module$libs$preact(){var a,e,n,t,z,D,F,J;for(t$$module$libs$preact.sort(f$$module$libs$preact);a=t$$module$libs$preact.shift();)a.__d&&(e=t$$module$libs$preact.length,t=void 0,z=void 0,F=(D=(n=a).__v).__e,(J=n.__P)&&(t=[],(z=h$$module$libs$preact({},D)).__v=D.__v+1,L$$module$libs$preact(J,D,z,n.__n,void 0!==J.ownerSVGElement,null!=D.__h?[F]:null,t,null==F?b$$module$libs$preact(D):F,D.__h),M$$module$libs$preact(t,D),D.__e!=F&&g$$module$libs$preact(D)),t$$module$libs$preact.length>e&&t$$module$libs$preact.sort(f$$module$libs$preact));
w$$module$libs$preact.__r=0}
function x$$module$libs$preact(a,e,n,t,z,D,F,J,G,K){var I,L,Q,M,U,Z,da=t&&t.__k||s$$module$libs$preact,R=da.length;n.__k=[];for(I=0;I<e.length;I++)if(null!=(M=n.__k[I]=null==(M=e[I])||"boolean"==typeof M||"function"==typeof M?null:"string"==typeof M||"number"==typeof M||"bigint"==typeof M?p$$module$libs$preact(null,M,null,null,M):Array.isArray(M)?p$$module$libs$preact(_$$module$libs$preact,{children:M},null,null,null):0<M.__b?p$$module$libs$preact(M.type,M.props,M.key,M.ref?M.ref:null,M.__v):M)){if(M.__=
n,M.__b=n.__b+1,null===(Q=da[I])||Q&&M.key==Q.key&&M.type===Q.type)da[I]=void 0;else for(L=0;L<R;L++){if((Q=da[L])&&M.key==Q.key&&M.type===Q.type){da[L]=void 0;break}Q=null}L$$module$libs$preact(a,M,Q=Q||c$$module$libs$preact,z,D,F,J,G,K);var ba=M.__e;(L=M.ref)&&Q.ref!=L&&(Z||=[],Q.ref&&Z.push(Q.ref,null,M),Z.push(L,M.__c||ba,M));null!=ba?(null==U&&(U=ba),"function"==typeof M.type&&M.__k===Q.__k?M.__d=G=A$$module$libs$preact(M,G,a):G=C$$module$libs$preact(a,M,Q,da,ba,G),"function"==typeof n.type&&
(n.__d=G)):G&&Q.__e==G&&G.parentNode!=a&&(G=b$$module$libs$preact(Q))}n.__e=U;for(I=R;I--;)null!=da[I]&&("function"==typeof n.type&&null!=da[I].__e&&da[I].__e==n.__d&&(n.__d=$$$module$libs$preact(t).nextSibling),S$$module$libs$preact(da[I],da[I]));if(Z)for(I=0;I<Z.length;I++)O$$module$libs$preact(Z[I],Z[++I],Z[++I])}
function A$$module$libs$preact(a,e,n){for(var t,z=a.__k,D=0;z&&D<z.length;D++)(t=z[D])&&(t.__=a,e="function"==typeof t.type?A$$module$libs$preact(t,e,n):C$$module$libs$preact(n,t,t,z,t.__e,e));return e}function P$$module$libs$preact(a,e){return e=e||[],null==a||"boolean"==typeof a||(Array.isArray(a)?a.some(function(n){P$$module$libs$preact(n,e)}):e.push(a)),e}
function C$$module$libs$preact(a,e,n,t,z,D){if(void 0!==e.__d){var F=e.__d;e.__d=void 0}else if(null==n||z!=D||null==z.parentNode)a:if(null==D||D.parentNode!==a)a.appendChild(z),F=null;else{e=D;for(n=0;(e=e.nextSibling)&&n<t.length;n+=1)if(e==z)break a;a.insertBefore(z,D);F=D}return void 0!==F?F:z.nextSibling}
function $$$module$libs$preact(a){var e,n,t;if(null==a.type||"string"==typeof a.type)return a.__e;if(a.__k)for(e=a.__k.length-1;0<=e;e--)if((n=a.__k[e])&&(t=$$$module$libs$preact(n)))return t;return null}function H$$module$libs$preact(a,e,n,t,z){for(var D in n)"children"===D||"key"===D||D in e||T$$module$libs$preact(a,D,null,n[D],t);for(D in e)z&&"function"!=typeof e[D]||"children"===D||"key"===D||"value"===D||"checked"===D||n[D]===e[D]||T$$module$libs$preact(a,D,e[D],n[D],t)}
function I$$module$libs$preact(a,e,n){"-"===e[0]?a.setProperty(e,null==n?"":n):a[e]=null==n?"":"number"!=typeof n||a$$module$libs$preact.test(e)?n:n+"px"}
function T$$module$libs$preact(a,e,n,t,z){a:if("style"===e)if("string"==typeof n)a.style.cssText=n;else{if("string"==typeof t&&(a.style.cssText=t=""),t)for(e in t)n&&e in n||I$$module$libs$preact(a.style,e,"");if(n)for(e in n)t&&n[e]===t[e]||I$$module$libs$preact(a.style,e,n[e])}else if("o"===e[0]&&"n"===e[1])z=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in a?e.toLowerCase().slice(2):e.slice(2),a.l||(a.l={}),(a.l[e+z]=n)?t||a.addEventListener(e,z?z$$module$libs$preact:j$$module$libs$preact,
z):a.removeEventListener(e,z?z$$module$libs$preact:j$$module$libs$preact,z);else if("dangerouslySetInnerHTML"!==e){if(z)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==e&&"height"!==e&&"href"!==e&&"list"!==e&&"form"!==e&&"tabIndex"!==e&&"download"!==e&&e in a)try{a[e]=null==n?"":n;break a}catch(D){}"function"==typeof n||(null==n||!1===n&&-1==e.indexOf("-")?a.removeAttribute(e):a.setAttribute(e,n))}}
function j$$module$libs$preact(a){return this.l[a.type+!1](l$$module$libs$preact.event?l$$module$libs$preact.event(a):a)}function z$$module$libs$preact(a){return this.l[a.type+!0](l$$module$libs$preact.event?l$$module$libs$preact.event(a):a)}
function L$$module$libs$preact(a,e,n,t,z,D,F,J,G){var K,I,L,Q,M,U,Z,da,R,ba,ha,ma,ka,pa,la=e.type;if(void 0!==e.constructor)return null;null!=n.__h&&(G=n.__h,J=e.__e=n.__e,e.__h=null,D=[J]);(K=l$$module$libs$preact.__b)&&K(e);try{a:if("function"==typeof la){if(da=e.props,R=(K=la.contextType)&&t[K.__c],ba=K?R?R.props.value:K.__:t,n.__c?Z=(I=e.__c=n.__c).__=I.__E:("prototype"in la&&la.prototype.render?e.__c=I=new la(da,ba):(e.__c=I=new k$$module$libs$preact(da,ba),I.constructor=la,I.render=q$$module$libs$preact),
R&&R.sub(I),I.props=da,I.state||(I.state={}),I.context=ba,I.__n=t,L=I.__d=!0,I.__h=[],I._sb=[]),null==I.__s&&(I.__s=I.state),null!=la.getDerivedStateFromProps&&(I.__s==I.state&&(I.__s=h$$module$libs$preact({},I.__s)),h$$module$libs$preact(I.__s,la.getDerivedStateFromProps(da,I.__s))),Q=I.props,M=I.state,I.__v=e,L)null==la.getDerivedStateFromProps&&null!=I.componentWillMount&&I.componentWillMount(),null!=I.componentDidMount&&I.__h.push(I.componentDidMount);else{if(null==la.getDerivedStateFromProps&&
da!==Q&&null!=I.componentWillReceiveProps&&I.componentWillReceiveProps(da,ba),!I.__e&&null!=I.shouldComponentUpdate&&!1===I.shouldComponentUpdate(da,I.__s,ba)||e.__v===n.__v){e.__v!==n.__v&&(I.props=da,I.state=I.__s,I.__d=!1);I.__e=!1;e.__e=n.__e;e.__k=n.__k;e.__k.forEach(function(wa){wa&&(wa.__=e)});for(ha=0;ha<I._sb.length;ha++)I.__h.push(I._sb[ha]);I._sb=[];I.__h.length&&F.push(I);break a}null!=I.componentWillUpdate&&I.componentWillUpdate(da,I.__s,ba);null!=I.componentDidUpdate&&I.__h.push(function(){I.componentDidUpdate(Q,
M,U)})}if(I.context=ba,I.props=da,I.__P=a,ma=l$$module$libs$preact.__r,ka=0,"prototype"in la&&la.prototype.render){I.state=I.__s;I.__d=!1;ma&&ma(e);K=I.render(I.props,I.state,I.context);for(pa=0;pa<I._sb.length;pa++)I.__h.push(I._sb[pa]);I._sb=[]}else{do I.__d=!1,ma&&ma(e),K=I.render(I.props,I.state,I.context),I.state=I.__s;while(I.__d&&25>++ka)}I.state=I.__s;null!=I.getChildContext&&(t=h$$module$libs$preact(h$$module$libs$preact({},t),I.getChildContext()));L||null==I.getSnapshotBeforeUpdate||(U=
I.getSnapshotBeforeUpdate(Q,M));var ta=null!=K&&K.type===_$$module$libs$preact&&null==K.key?K.props.children:K;x$$module$libs$preact(a,Array.isArray(ta)?ta:[ta],e,n,t,z,D,F,J,G);I.base=e.__e;e.__h=null;I.__h.length&&F.push(I);Z&&(I.__E=I.__=null);I.__e=!1}else null==D&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=N$$module$libs$preact(n.__e,e,n,t,z,D,F,G);(K=l$$module$libs$preact.diffed)&&K(e)}catch(wa){e.__v=null,(G||null!=D)&&(e.__e=J,e.__h=!!G,D[D.indexOf(J)]=null),l$$module$libs$preact.__e(wa,
e,n)}}function M$$module$libs$preact(a,e){l$$module$libs$preact.__c&&l$$module$libs$preact.__c(e,a);a.some(function(n){try{a=n.__h,n.__h=[],a.some(function(t){t.call(n)})}catch(t){l$$module$libs$preact.__e(t,n.__v)}})}
function N$$module$libs$preact(a,e,n,t,z,D,F,J){var G,K,I=n.props,L=e.props,Q=e.type,M=0;if("svg"===Q&&(z=!0),null!=D)for(;M<D.length;M++)if((G=D[M])&&"setAttribute"in G==!!Q&&(Q?G.localName===Q:3===G.nodeType)){a=G;D[M]=null;break}if(null==a){if(null===Q)return document.createTextNode(L);a=z?document.createElementNS("http://www.w3.org/2000/svg",Q):document.createElement(Q,L.is&&L);D=null;J=!1}if(null===Q)I===L||J&&a.data===L||(a.data=L);else{if(D=D&&n$$module$libs$preact.call(a.childNodes),G=(I=
n.props||c$$module$libs$preact).dangerouslySetInnerHTML,K=L.dangerouslySetInnerHTML,!J){if(null!=D)for(I={},M=0;M<a.attributes.length;M++)I[a.attributes[M].name]=a.attributes[M].value;(K||G)&&(K&&(G&&K.__html==G.__html||K.__html===a.innerHTML)||(a.innerHTML=K&&K.__html||""))}if(H$$module$libs$preact(a,L,I,z,J),K)e.__k=[];else if(M=e.props.children,x$$module$libs$preact(a,Array.isArray(M)?M:[M],e,n,t,z&&"foreignObject"!==Q,D,F,D?D[0]:n.__k&&b$$module$libs$preact(n,0),J),null!=D)for(M=D.length;M--;)null!=
D[M]&&v$$module$libs$preact(D[M]);J||("value"in L&&void 0!==(M=L.value)&&(M!==a.value||"progress"===Q&&!M||"option"===Q&&M!==I.value)&&T$$module$libs$preact(a,"value",M,I.value,!1),"checked"in L&&void 0!==(M=L.checked)&&M!==a.checked&&T$$module$libs$preact(a,"checked",M,I.checked,!1))}return a}function O$$module$libs$preact(a,e,n){try{"function"==typeof a?a(e):a.current=e}catch(t){l$$module$libs$preact.__e(t,n)}}
function S$$module$libs$preact(a,e,n){var t,z;if(l$$module$libs$preact.unmount&&l$$module$libs$preact.unmount(a),(t=a.ref)&&(t.current&&t.current!==a.__e||O$$module$libs$preact(t,null,e)),null!=(t=a.__c)){if(t.componentWillUnmount)try{t.componentWillUnmount()}catch(D){l$$module$libs$preact.__e(D,e)}t.base=t.__P=null;a.__c=void 0}if(t=a.__k)for(z=0;z<t.length;z++)t[z]&&S$$module$libs$preact(t[z],e,n||"function"!=typeof a.type);n||null==a.__e||v$$module$libs$preact(a.__e);a.__=a.__e=a.__d=void 0}
function q$$module$libs$preact(a,e,n){return this.constructor(a,n)}
function B$$module$libs$preact(a,e,n){var t;l$$module$libs$preact.__&&l$$module$libs$preact.__(a,e);var z=(t="function"==typeof n)?null:n&&n.__k||e.__k;var D=[];L$$module$libs$preact(e,a=(!t&&n||e).__k=y$$module$libs$preact(_$$module$libs$preact,null,[a]),z||c$$module$libs$preact,c$$module$libs$preact,void 0!==e.ownerSVGElement,!t&&n?[n]:z?null:e.firstChild?n$$module$libs$preact.call(e.childNodes):null,D,!t&&n?n:z?z.__e:e.firstChild,t);M$$module$libs$preact(D,a)}
function D$$module$libs$preact(a,e){B$$module$libs$preact(a,e,D$$module$libs$preact)}function E$$module$libs$preact(a,e,n){var t,z,D,F=h$$module$libs$preact({},a.props);for(D in e)"key"==D?t=e[D]:"ref"==D?z=e[D]:F[D]=e[D];return 2<arguments.length&&(F.children=3<arguments.length?n$$module$libs$preact.call(arguments,2):n),p$$module$libs$preact(a.type,F,t||a.key,z||a.ref,null)}
function F$$module$libs$preact(a,e){var n={__c:e="__cC"+e$$module$libs$preact++,__:a,Consumer:function(t,z){return t.children(z)},Provider:function(t){var z,D;return this.getChildContext||(z=[],(D={})[e]=this,this.getChildContext=function(){return D},this.shouldComponentUpdate=function(F){this.props.value!==F.value&&z.some(function(J){J.__e=!0;m$$module$libs$preact(J)})},this.sub=function(F){z.push(F);var J=F.componentWillUnmount;F.componentWillUnmount=function(){z.splice(z.indexOf(F),1);J&&J.call(F)}}),
t.children}};return n.Provider.__=n.Consumer.contextType=n}n$$module$libs$preact=s$$module$libs$preact.slice;l$$module$libs$preact={__e:function(a,e,n,t){for(var z,D,F;e=e.__;)if((z=e.__c)&&!z.__)try{if((D=z.constructor)&&null!=D.getDerivedStateFromError&&(z.setState(D.getDerivedStateFromError(a)),F=z.__d),null!=z.componentDidCatch&&(z.componentDidCatch(a,t||{}),F=z.__d),F)return z.__E=z}catch(J){a=J}throw a;}};u$$module$libs$preact=0;i$$module$libs$preact=function(a){return null!=a&&void 0===a.constructor};
k$$module$libs$preact.prototype.setState=function(a,e){var n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=h$$module$libs$preact({},this.state);"function"==typeof a&&(a=a(h$$module$libs$preact({},n),this.props));a&&h$$module$libs$preact(n,a);null!=a&&this.__v&&(e&&this._sb.push(e),m$$module$libs$preact(this))};k$$module$libs$preact.prototype.forceUpdate=function(a){this.__v&&(this.__e=!0,a&&this.__h.push(a),m$$module$libs$preact(this))};k$$module$libs$preact.prototype.render=_$$module$libs$preact;
t$$module$libs$preact=[];o$$module$libs$preact="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout;f$$module$libs$preact=function(a,e){return a.__v.__b-e.__v.__b};e$$module$libs$preact=w$$module$libs$preact.__r=0;var module$libs$preact={};module$libs$preact.Component=k$$module$libs$preact;module$libs$preact.Fragment=_$$module$libs$preact;module$libs$preact.cloneElement=E$$module$libs$preact;module$libs$preact.createContext=F$$module$libs$preact;
module$libs$preact.createElement=y$$module$libs$preact;module$libs$preact.createRef=d$$module$libs$preact;module$libs$preact.h=y$$module$libs$preact;module$libs$preact.hydrate=D$$module$libs$preact;module$libs$preact.isValidElement=i$$module$libs$preact;module$libs$preact.options=l$$module$libs$preact;module$libs$preact.render=B$$module$libs$preact;module$libs$preact.toChildArray=P$$module$libs$preact;function rand$$module$utils(a,e){return Math.floor(Math.random()*(e-a+1)+a)}function dist$$module$utils(a,e){const n=a.x-e.x;a=a.y-e.y;return Math.sqrt(n*n+a*a)}function get_polygon_extents$$module$utils(a){if(3>a.length)return{w:0,h:0};let e=a[0].x,n=a[0].x,t=a[0].y,z=a[0].y;for(var D=0,F=a.length;D<F;D++){const J=a[D].x,G=a[D].y;e=e<J?e:J;n=n>J?n:J;t=t<G?e:G;z=z>G?n:G}return{w:Math.abs(e-n),h:Math.abs(t-z)}}
function get_polygon_area$$module$utils(a){for(var e=0,n=0,t=a.length;n<t;n++){var z=a[n==a.length-1?0:n+1].x,D=a[n].y;e+=a[n].x*a[n==a.length-1?0:n+1].y*.5;e-=z*D*.5}return Math.abs(e)}function clamp$$module$utils(a,e,n){return Math.min(Math.max(a,e),n)}function make_xy_polygon$$module$utils(a){let e=[];for(let n=0;n<a.length;n++)e.push({x:a[n][0],y:a[n][1]});return e}
function get_polygon_centroid$$module$utils(a){var e=a[0],n=a[a.length-1];e.x==n.x&&e.y==n.y||a.push(e);var t=n=e=0,z=a.length,D,F=0;for(D=z-1;F<z;D=F++){var J=a[F];D=a[D];var G=J.x*D.y-D.x*J.y;e+=G;n+=(J.x+D.x)*G;t+=(J.y+D.y)*G}G=3*e;return{x:n/G,y:t/G}}function get_centroidic_point$$module$utils(a){for(var e={x:0,y:0},n=0;n<a.length;n++){var t=a[n];e.x+=t.x;e.y+=t.y}e.x/=a.length;e.y/=a.length;n=1E6;t=-1;for(let z=0;z<a.length;z++){const D=dist$$module$utils(a[z],e);D<n&&(n=D,t=z)}return a[t]}
function uuidv4$$module$utils(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^crypto.getRandomValues(new Uint8Array(1))[0]&15>>a/4).toString(16))}class ModalDialog$$module$utils extends k$$module$libs$preact{componentDidMount(){window.app.inhibit_hotkeys=!0;this.props.toggleModal()}componentWillUnmount(){window.app.inhibit_hotkeys=!1;this.props.toggleModal()}}
function canonical_coords$$module$utils(a,e){return(0<a?"E":0>a?"W":"")+(a?Math.abs(a):"")+(0<e?"S":0>e?"N":"")+(e?Math.abs(e):"")}function parse_canonical_coords$$module$utils(a){a=/E?([0-9]+)?W?([0-9]+)?N?([0-9]+)?S?([0-9]+)?/.exec(a);return{x:a[1]||-1*a[2]||0,y:a[4]||-1*a[3]||0}}function make_tuple_polygon$$module$utils(a){let e=[];for(let n=0;n<a.length;n++)e.push([a[n].x,a[n].y]);return e}function capitalize$$module$utils(a){return a.charAt(0).toUpperCase()+a.slice(1)}var module$utils={};
module$utils.ModalDialog=ModalDialog$$module$utils;module$utils.canonical_coords=canonical_coords$$module$utils;module$utils.capitalize=capitalize$$module$utils;module$utils.clamp=clamp$$module$utils;module$utils.dist=dist$$module$utils;module$utils.get_centroidic_point=get_centroidic_point$$module$utils;module$utils.get_polygon_area=get_polygon_area$$module$utils;module$utils.get_polygon_centroid=get_polygon_centroid$$module$utils;module$utils.get_polygon_extents=get_polygon_extents$$module$utils;
module$utils.make_tuple_polygon=make_tuple_polygon$$module$utils;module$utils.make_xy_polygon=make_xy_polygon$$module$utils;module$utils.parse_canonical_coords=parse_canonical_coords$$module$utils;module$utils.rand=rand$$module$utils;module$utils.uuidv4=uuidv4$$module$utils;const html$$module$tokens=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact),BACKSPACE$$module$tokens=8,TAB$$module$tokens=9,ENTER$$module$tokens=13,LEFT$$module$tokens=37,RIGHT$$module$tokens=39,DELETE$$module$tokens=46,COMMA$$module$tokens=188,SEPERATOR$$module$tokens=",",COPY_PROPS$$module$tokens="vals placeholder pattern spellcheck autocomplete autocapitalize autofocus accessKey accept lang minLength maxLength required".split(" ");
function tagsInput$$module$tokens(a,e){function n(M,U,Z,da){M=document.createElement(M);U&&(M.className=U);Z&&(M.textContent=Z);for(let R in da)M.setAttribute(`data-${R}`,da[R]);return M}function t(M,U){return!0===U?Array.prototype.slice.call(L.querySelectorAll(M)):L.querySelector(M)}function z(){return t(".tag",!0).map(M=>M.textContent).concat(L.input.value||[]).join(SEPERATOR$$module$tokens)}function D(){a.value=z();a.dispatchEvent(new Event("change"))}function F(M){~M.indexOf(SEPERATOR$$module$tokens)&&
(M=M.split(SEPERATOR$$module$tokens));if(Array.isArray(M))return M.forEach(F);M=M&&M.trim();if(!M||!e.includes(M))return!1;if(!a.getAttribute("duplicates")){let U=t(`[data-tag="${M}"]`);if(U)return U.classList.add("dupe"),setTimeout(()=>U.classList.remove("dupe"),100),!1}L.insertBefore(n("span","tag",M,{tag:M}),L.input)}function J(M){let U=t(".selected");U&&U.classList.remove("selected");M&&M.classList.add("selected")}function G(){let M=t(".tag",!0).pop(),U=L.offsetWidth;U&&(L.input.style.width=Math.max(U-
(M?M.offsetLeft+M.offsetWidth:5)-5,U/4)+"px")}function K(M){"string"===typeof M||Array.isArray(M)||(M=L.input.value);!1!==F(M)&&(L.input.value="",D(),G())}function I(M){M.target.classList.contains("tag")&&J(M.target);if(M.target===L.input)return J();L.input.focus();M.preventDefault();return!1}let L=n("div","tags-input");var Q=a.nextSibling;a.parentNode[Q?"insertBefore":"appendChild"](L,Q);a.style.cssText="position:absolute;left:0;top:-99px;width:1px;height:1px;opacity:0.01;";a.tabIndex=-1;(Q=a.getAttribute("type"))&&
"tags"!==Q||(Q="text");L.input=n("input");L.input.setAttribute("type",Q);COPY_PROPS$$module$tokens.forEach(M=>{if(a[M]!==L.input[M]){L.input[M]=a[M];try{delete a[M]}catch(U){}}});L.appendChild(L.input);a.addEventListener("focus",()=>{L.input.focus()});L.input.addEventListener("focus",()=>{L.classList.add("focus");J()});L.input.addEventListener("blur",()=>{L.classList.remove("focus");J();K()});L.input.addEventListener("keydown",M=>{let U=L.input,Z=M.keyCode||M.which,da=t(".tag.selected");L.curr_pos=
0;try{var R=0===U.selectionStart&&0===U.selectionEnd}catch(ha){R=""===U.value}let ba=t(".tag",!0).pop();G();if(Z===ENTER$$module$tokens||Z===COMMA$$module$tokens||Z===TAB$$module$tokens){if(!U.value&&Z!==COMMA$$module$tokens)return;K()}else if(Z===DELETE$$module$tokens&&da)da.nextSibling!==L.input&&J(da.nextSibling),L.removeChild(da),G(),D();else if(Z===BACKSPACE$$module$tokens)if(da)J(da.previousSibling),L.removeChild(da),G(),D();else if(ba&&R)J(ba);else{L.input.selectionStart--;return}else if(Z===
LEFT$$module$tokens)if(da)da.previousSibling&&J(da.previousSibling);else if(R)J(ba);else return;else if(Z===RIGHT$$module$tokens){if(!da){L.input.selectionStart--;return}J(da.nextSibling)}else return J();M.preventDefault();return!1});L.input.addEventListener("input",()=>{const M=L.input.selectionStart;if(0<M)for(let U=0;U<e.length;U++){const Z=e[U];Z.startsWith(L.input.value)&&(L.input.value=Z,L.input.setSelectionRange(M,Z.length))}a.value=z();a.dispatchEvent(new Event("input"))});L.input.addEventListener("paste",
()=>setTimeout(K,0));L.addEventListener("mousedown",I);L.addEventListener("touchstart",I);L.setValue=function(M){t(".tag",!0).forEach(U=>L.removeChild(U));K(M)};L.getValue=z;K(a.value)}tagsInput$$module$tokens.enhance=tagsInput$$module$tokens.tagsInput=tagsInput$$module$tokens;const CLASS_NAME$$module$tokens="token-input";
class TokenInput$$module$tokens extends k$$module$libs$preact{shouldComponentUpdate(){return!1}componentDidMount(){tagsInput$$module$tokens(this.getInput(),this.props.vals);this.getInput().setValue(this.props.value||"")}getInput(){let {base:a}=this;return a&&(a.lastElementChild||a.lastChild)}setValue(a){let e=this.getInput();e&&(e.setValue?String(a)!==String(e.getValue())&&e.setValue(String(a)):e.value=a)}getValue(){var a=this.getInput();a=a?a.getValue?a.getValue():a.value:this.props.value;return"string"===
typeof a?a.split(","):a}componentWillReceiveProps({value:a}){let e=this.getValue();a!==e&&String(a)!==String(e)&&this.setValue(a)}handleEvent({type:a,target:e}){"change"===a&&this.handleEvent({type:"input",target:e});let n=this.getValue();for(let t in this.props)if(this.props.hasOwnProperty(t)&&t.toLowerCase()===`on${a}`)this.props[t]({type:a,value:n,target:e,currentTarget:this})}render(a,e){let n;e={};let t=this.handleEvent.bind(this);for(let z in a)a.hasOwnProperty(z)&&("class"===z||"className"===
z?n=a[z]:z.match(/^on(input|change)$/i)||(e[z]=a[z]));e.type="tags";n?"string"===typeof n?n+=" "+CLASS_NAME$$module$tokens:"object"===typeof n&&(n[CLASS_NAME$$module$tokens]=!0):n=CLASS_NAME$$module$tokens;return html$$module$tokens`<div class="${n}">
      <input
        ${e}
        onChange=${t}
        onInput=${t}
        placeholder=${a.placeholder}
      />
    </div> `}}
class TokenChooserDialog$$module$tokens extends ModalDialog$$module$utils{onClick(a){this.props.callback(a);this.props.onExit()}render(a,e){const n={barbarian:["barbarian","fighter","paladin","npc","pc"],thief:"thief assassin rogue ranger npc pc".split(" "),elf:["elf","ranger","npc","pc"],fighter:["fighter","barbarian","paladin","npc","pc"],cleric:["cleric","npc","pc"],magicuser:["magicuser","wizard","sorcerer","npc","pc"],ranger:["ranger","npc","pc"],miner:["miner","cleric","npc","pc"],sorcerer:["sorcerer",
"magicuser","wizard","npc","pc"],spearthrower:["spearthrower","fighter","barbarian","npc","pc"],body:["body","dead","remains","skeleton","props"],largechest:["chest","treasure","box","crate","props"],chest:["chest","treasure","box","crate","props"],coins:"gold coins treasure loot hoard props".split(" "),bag:"bad loot treasure trap sack hoard props".split(" "),barrel:["barrel","props"],altar:["altar","static","props"],pit:["pit","trap","props"],speartrap:["spears","trap","props"],fcaptive:["captive",
"hostage","npc","props"],mcaptive:["captive","hostage","npc","props"],goblin:["goblin","humanoid","monster"],cultist:["cultist","humanoid","monster"],gnoll:["gnoll","humanoid","monster"],kobold:["kobold","humanoid","monster"],orc:["orc","humanoid","monster"],skeleton_a:["skeleton","undead","monster"],skeleton_b:["skeleton","undead","monster"],zombie:["zombie","undead","humanoid","monster"],wight:["wight","undead","humanoid","monster"],vampire:["vampire","lich","undead","humanoid","monster"],shrieker:["shrieker",
"monster"],stirge:["stirge","monster"],gargoyle:["gargoyle","statue","monster"],displacer:["displacer","warp","beast","monster"],snake:["snake","monster"],spider:["spider","insect","monster"],wolf:["wolf","beast","monster"],bigcat:["tiget","leopard","lion","beast","monster"],bats:["bat","monster"],giantbat:["bat","giant","monster"],insects:["insect","swarm","monster"],tick:"tick beetle fire giant insect monster".split(" "),centepide:["centepide","giant","insect","monster"],giantrat:["giant","rat",
"monster"],cockatrice:["cockatrice","monster"],flailsnail:["flail","snail","monster"],bear:["bear","beast","monster"],slime:["slime","monster"],gcube:["cube","monster"],owlbear:["owlbear","monster"],beholder:["ball","eyes","boss","monster"],chimera:["chimera","boss","monster"],minotaur:["minotaur","monster"],gorgon:["gorgon","boss","monster"],cyclop:["cyclop","monster"],demon:["demon","boss","monster"],dragon:["dragon","boss","monster"],trex:["dino","trex","boss","monster"],purpleworm:["worm","purple",
"giant","boss","monster"],biglantern:["lantern"]};window.app.tokentags||(window.app.tokentags="");e=["torch","light"];for(const [,t]of Object.entries(n))for(const z of t)e.includes(z)||e.push(z);return html$$module$tokens` <!-- The Modal -->
      <div id="TokensChooser" class="modal">
        <!-- Modal content -->
        <div
          class="modal-content modal-content-flex"
          style="background: #e1e1e1;max-width:820px;"
        >
          <div class="modal-header">
            <div class="close">
              <a onClick="${a.onExit}"> ${"\u00d7"} </a>
            </div>
            <${TokenInput$$module$tokens}
              placeholder="Token Tags"
              vals=${e}
              value=${window.app.tokentags}
              onChange=${t=>{window.app.tokentags=t.value;this.forceUpdate()}}
            />
          </div>
          <div class="modal-body">
            <div style="display:flex;flex-wrap:wrap;background: #e1e1e1;">
              ${[{id:"barbarian",scale:7,light:30,pc:!0},{id:"thief",scale:7,light:30,pc:!0},{id:"elf",scale:7,light:60,pc:!0},{id:"fighter",scale:7,light:30,pc:!0},{id:"cleric",scale:7,light:30,pc:!0},{id:"magicuser",scale:7,light:30,pc:!0},{id:"ranger",scale:7,light:30,pc:!0},{id:"miner",scale:7,light:60,pc:!0},{id:"sorcerer",scale:7,light:30,pc:!0},{id:"spearthrower",scale:7,light:30,pc:!0},{id:"barbarian",scale:7,pc:!0},{id:"thief",scale:7,pc:!0},{id:"elf",scale:7,pc:!0},{id:"fighter",scale:7,
pc:!0},{id:"cleric",scale:7,pc:!0},{id:"magicuser",scale:7,pc:!0},{id:"ranger",scale:7,pc:!0},{id:"miner",scale:7,pc:!0},{id:"sorcerer",scale:7,pc:!0},{id:"spearthrower",scale:7,pc:!0},{id:"body",scale:7},{id:"largechest",scale:8},{id:"chest",scale:8},{id:"coins",scale:8},{id:"bag",scale:8},{id:"barrel",scale:8},{id:"altar",scale:5},{id:"pit",scale:7},{id:"speartrap",scale:6},{id:"fcaptive",scale:7},{id:"mcaptive",scale:7},{id:"goblin",scale:7},{id:"cultist",scale:7},{id:"gnoll",scale:7},{id:"kobold",
scale:7},{id:"orc",scale:5},{id:"skeleton_a",scale:7},{id:"skeleton_b",scale:7},{id:"zombie",scale:7},{id:"wight",scale:7},{id:"vampire",scale:7},{id:"shrieker",scale:5},{id:"stirge",scale:4},{id:"gargoyle",scale:5},{id:"displacer",scale:5},{id:"snake",scale:5},{id:"spider",scale:5},{id:"wolf",scale:5},{id:"bigcat",scale:3},{id:"bats",scale:4},{id:"giantbat",scale:3},{id:"insects",scale:3},{id:"tick",scale:5},{id:"centepide",scale:3},{id:"giantrat",scale:5},{id:"cockatrice",scale:5},{id:"flailsnail",
scale:3},{id:"bear",scale:4},{id:"slime",scale:8},{id:"gcube",scale:3},{id:"owlbear",scale:3},{id:"beholder",scale:3},{id:"chimera",scale:3},{id:"minotaur",scale:3},{id:"gorgon",scale:3},{id:"cyclop",scale:3},{id:"demon",scale:4},{id:"dragon",scale:2},{id:"trex",scale:1},{id:"purpleworm",scale:1},{id:"biglantern",scale:4,light:300}].map(t=>{if(n[t.id].some(z=>window.app.tokentags.includes(z))||["torch","light"].some(z=>window.app.tokentags.includes(z))&&t.light||0==window.app.tokentags.length||1==
window.app.tokentags.length&&""===window.app.tokentags[0])return html$$module$tokens`
                    <div style="width:150px">
                      <a onClick=${()=>this.onClick(t)}>
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          xmlns:xlink="http://www.w3.org/1999/xlink"
                          style="background:none; max-width:150px; height:150px;"
                        >
                          <use
                            xlink:href="${window.app.tokens_svg}#${t.id}"
                            transform="translate(75,75) scale(${1.5*t.scale})"
                          />
                          ${t.light&&30>=t.light&&html$$module$tokens`
                            <use
                              fill="#ff0000"
                              xlink:href="${window.app.tokens_svg}#torch"
                              transform="translate(120,75) scale(15)"
                            />
                          `}
                          ${t.light&&30<t.light&&html$$module$tokens`
                            <use
                              fill="#ff0000"
                              xlink:href="${window.app.tokens_svg}#lantern"
                              transform="translate(120,75) scale(15)"
                            />
                          `}
                        </svg>
                      </a>
                    </div>
                  `})}
            </div>
          </div>
        </div>
      </div>`}}var module$tokens={};module$tokens.TokenChooserDialog=TokenChooserDialog$$module$tokens;module$tokens.default=TokenInput$$module$tokens;const html$$module$readme=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);class VttDialog$$module$readme extends ModalDialog$$module$utils{render(a,e){return html$$module$readme` <!-- The Modal -->
      <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
          <div class="close">
            <a onClick="${a.onExit}"> ${"\u00d7"} </a>
          </div>
          ${window.app.provider&&window.app.provider.connected?html$$module$readme`
                <h5>Your Virtual Table Top is ready!</h5>
                <p>
                  You are now connected to the sandbox VTT room. Share the
                  following link with your players:
                </p>
                <pre>
          https://hexroll.app/join/${a.instance}
          </pre
                >
                <p>
                  To reveal or conceal hexes or dungeon areas, hold down the
                  <span class="key-button">Spacebar</span>
                  key and click any hex or area.
                </p>
                <p>
                  To indicate hexes to your players, hold down the
                  <span class="key-button">F</span> key and click any hex you
                  wish to indicate. Release the key to clear any indicated hex.
                </p>
                <p>
                  To add tokens to dungeon maps, hold down the
                  <span class="key-button">T</span> key and click the position
                  you would like the token to be added to.
                </p>
                <p>
                  To remove tokens, hold down the
                  <span class="key-button">K</span> key and click the token you
                  wish to remove.
                </p>
              `:html$$module$readme`
                <h5>VTT Disconnected</h5>
                <p>You are disconnected from the sandbox VTT room.</p>
              `}
        </div>
      </div>`}}class ReadmeDialog$$module$readme extends ModalDialog$$module$utils{render(a,e){return html$$module$readme` <!-- The Modal -->
      <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content modal-content-flex">
          <div class="modal-header">
            <div class="close">
              <a onClick="${a.onExit}"> ${"\u00d7"} </a>
            </div>
          </div>
          <div class="modal-body">
          <h5>GREETINGS BRAVE ADVENTURER</h5>
          <p>
            I'm Ithai, and I'm the dad in Pen, Dice & Paper, a family project
            dedicated to tabletop role-playing games.
          </p>
          <p>
            I'm developing HEXROLL out of passion and need, trying to capture
            the essence of gaming the way I remember and experienced it for
            almost 35 years.
          </p>
          <p>
            Working on this 2nd edition was made possible thanks to the
            incredible support of the Pen Dice & Paper
            <strong> Patreon community </strong>. Thank you for traveling side
            by side with me.
          </p>
          <p>
            The support and kind words in the forums, subreddits and online
            groups also keeps me super motivated. Thank you too! folks.
          </p>
          <p>
            My thanks also goes to HEXROLL 1E Github contributors for their help
            extending and tuning the original model.
          </p>
          <p>
            And last, but certainly not least, thank you, so much! Oleg Doyla,
            aka Watabou for your incredible city and village generators,
            powering HEXROLL's settlement generator.
          </p>
          <h5>Licenses</h5>

          <h6>Designation of Open Game Content</h6>
          This document contains Open Game Content, subject to the Open Game
          License, released under the <strong>Open Game License</strong>,
          Version 1.0a (reproduced below), as described in Section 1(d) of the
          License. Any generated sandbox content not covered by the OGL is
          licensed under the Creative Commons
          Attribution-NonCommercial-ShareAlike 4.0 International license
          (<strong>CC BY-NC-SA 4.0</strong>)

          <h6>OPEN GAME LICENSE Version 1.0a</h6>

          <p>
            The following text is the property of Wizards of the Coast, Inc. and
            is Copyright 2000 Wizards of the Coast, Inc ("Wizards"). All Rights
            Reserved.
          </p>

          <p>
            1. Definitions: (a)"Contributors" means the copyright and/or
            trademark owners who have contributed Open Game Content;
            (b)"Derivative Material" means copyrighted material including
            derivative works and translations (including into other computer
            languages), potation, modification, correction, addition, extension,
            upgrade, improvement, compilation, abridgment or other form in which
            an existing work may be recast, transformed or adapted; (c)
            "Distribute" means to reproduce, license, rent, lease, sell,
            broadcast, publicly display, transmit or otherwise distribute;
            (d)"Open Game Content" means the game mechanic and includes the
            methods, procedures, processes and routines to the extent such
            content does not embody the Product Identity and is an enhancement
            over the prior art and any additional content clearly identified as
            Open Game Content by the Contributor, and means any work covered by
            this License, including translations and derivative works under
            copyright law, but specifically excludes Product Identity. (e)
            "Product Identity" means product and product line names, logos and
            identifying marks including trade dress; artifacts; creatures
            characters; stories, storylines, plots, thematic elements, dialogue,
            incidents, language, artwork, symbols, designs, depictions,
            likenesses, formats, poses, concepts, themes and graphic,
            photographic and other visual or audio representations; names and
            descriptions of characters, spells, enchantments, personalities,
            teams, personas, likenesses and special abilities; places,
            locations, environments, creatures, equipment, magical or
            supernatural abilities or effects, logos, symbols, or graphic
            designs; and any other trademark or registered trademark clearly
            identified as Product identity by the owner of the Product Identity,
            and which specifically excludes the Open Game Content; (f)
            "Trademark" means the logos, names, mark, sign, motto, designs that
            are used by a Contributor to identify itself or its products or the
            associated products contributed to the Open Game License by the
            Contributor (g) "Use", "Used" or "Using" means to use, Distribute,
            copy, edit, format, modify, translate and otherwise create
            Derivative Material of Open Game Content. (h) "You" or "Your" means
            the licensee in terms of this agreement.
          </p>

          <p>
            2. The License: This License applies to any Open Game Content that
            contains a notice indicating that the Open Game Content may only be
            Used under and in terms of this License. You must affix such a
            notice to any Open Game Content that you Use. No terms may be added
            to or subtracted from this License except as described by the
            License itself. No other terms or conditions may be applied to any
            Open Game Content distributed using this License.
          </p>

          <p>
            3. Offer and Acceptance: By Using the Open Game Content You indicate
            Your acceptance of the terms of this License.
          </p>

          <p>
            4. Grant and Consideration: In consideration for agreeing to use
            this License, the Contributors grant You a perpetual, worldwide,
            royalty-free, non-exclusive license with the exact terms of this
            License to Use, the Open Game Content.
          </p>

          <p>
            5. Representation of Authority to Contribute: If You are
            contributing original material as Open Game Content, You represent
            that Your Contributions are Your original creation and/or You have
            sufficient rights to grant the rights conveyed by this License.
          </p>

          <p>
            6. Notice of License Copyright: You must update the COPYRIGHT NOTICE
            portion of this License to include the exact text of the COPYRIGHT
            NOTICE of any Open Game Content You are copying, modifying or
            distributing, and You must add the title, the copyright date, and
            the copyright holder's name to the COPYRIGHT NOTICE of any original
            Open Game Content you Distribute.
          </p>

          <p>
            7. Use of Product Identity: You agree not to Use any Product
            Identity, including as an indication as to compatibility, except as
            expressly licensed in another, independent Agreement with the owner
            of each element of that Product Identity. You agree not to indicate
            compatibility or co-adaptability with any Trademark or Registered
            Trademark in conjunction with a work containing Open Game Content
            except as expressly licensed in another, independent Agreement with
            the owner of such Trademark or Registered Trademark. The use of any
            Product Identity in Open Game Content does not constitute a
            challenge to the ownership of that Product Identity. The owner of
            any Product Identity used in Open Game Content shall retain all
            rights, title and interest in and to that Product Identity.
          </p>

          <p>
            8. Identification: If you distribute Open Game Content You must
            clearly indicate which portions of the work that you are
            distributing are Open Game Content.
          </p>

          <p>
            9. Updating the License: Wizards or its designated Agents may
            publish updated versions of this License. You may use any authorized
            version of this License to copy, modify and distribute any Open Game
            Content originally distributed under any version of this License.
          </p>

          <p>
            10. Copy of this License: You MUST include a copy of this License
            with every copy of the Open Game Content You Distribute.
          </p>

          <p>
            11. Use of Contributor Credits: You may not market or advertise the
            Open Game Content using the name of any Contributor unless You have
            written permission from the Contributor to do so.
          </p>

          <p>
            12. Inability to Comply: If it is impossible for You to comply with
            any of the terms of this License with respect to some or all of the
            Open Game Content due to statute, judicial order, or governmental
            regulation then You may not Use any Open Game Material so affected.
          </p>

          <p>
            13. Termination: This License will terminate automatically if You
            fail to comply with all terms herein and fail to cure such breach
            within 30 days of becoming aware of the breach. All sublicenses
            shall survive the termination of this License.
          </p>

          <p>
            14. Reformation: If any provision of this License is held to be
            unenforceable, such provision shall be reformed only to the extent
            necessary to make it enforceable.
          </p>

          <p>
            15. COPYRIGHT NOTICE Open Game License v 1.0 Copyright 2000, Wizards
            of the Coast, Inc.
          </p>

          <p>HEXROLL 2E is copyright (c) 2021-2024 pendicepaper.com.</p>
        </div>
        </div>
      </div>`}}class ExpiredDialog$$module$readme extends ModalDialog$$module$utils{render(a,e){return html$$module$readme` <div id="ExpiredModal" class="modal">
      <div class="modal-content">
        <div class="close">
          <a onClick="${a.onExit}"> ${"\u00d7"} </a>
        </div>
        <h5>SANDBOX EXPIRED</h5>
        <p>
          Your ephemeral sandbox expired. Please use this last opportunity to
          <a
            class="detectable"
            href="https://docs.hexroll.app/playing-with-hexroll/using-hexroll-offline"
            target="_blank"
          >
            download a snapshot
          </a>
          of your sandbox before it gets removed from our online storage.
        </p>
        <h6>Why is my sandbox ephemeral?</h6>
        <p>
          When you generate a sandbox, it is stored and managed online. When
          your sandbox is online, you can use all the online editing tools as
          well as the built-in VTT mode.
        </p>
        <p>
          To maintain reasonable performance, we use fast distributed storage to
          manage this data, but it can fill up pretty quickly and it is not
          free. To conserve storage, HEXROLL expires any guest-generated sandbox
          after 30 days and cleans up the data shortly after.
        </p>
        <h6>Patreon 'Brave Adventurer' subscribers</h6>
        <p>
          If you are a Patreon 'Brave Adventurer' subscriber and you want to
          keep this sandbox online, make sure you login to your account and
          visit this page again to claim your sandbox. This will remove the
          expiration and you will be able to continue using this sandbox online
          for the duration of your subscription.
        </p>
        <p>
          <small>
            If you have any questions or concerns, use the feedback tab on the
            right-hand side of the map to contact me. Make sure you specify your
            e-mail if you want me to contact you back.</small
          >
        </p>
      </div>
    </div>`}}var module$readme={};module$readme.ExpiredDialog=ExpiredDialog$$module$readme;module$readme.ReadmeDialog=ReadmeDialog$$module$readme;module$readme.VttDialog=VttDialog$$module$readme;const is_electron$$module$api_shim=!0;function api_call_html$$module$api_shim(a,e,n){return new Promise(async t=>{let z=await window.api.get(n);t(z)})}function api_call_map$$module$api_shim(a){return new Promise(async e=>{let n=JSON.parse(await window.api.map());e(n)})}function api_call_dungeon$$module$api_shim(a,e){return new Promise(async n=>{let t=JSON.parse(await window.api.dungeon(e));n(t)})}
function api_call_hazards$$module$api_shim(a,e){return new Promise(async n=>{let t=JSON.parse(await window.api.hazards(e));n(t)})}function api_call_city$$module$api_shim(a,e){return new Promise(async n=>{let t=JSON.parse(await window.api.city(e));n(t)})}function api_call_version$$module$api_shim(a){return new Promise(async e=>{e({})})}function api_call_search$$module$api_shim(a,e){return new Promise(async n=>{let t={};t.results=await window.api.search(e);n(t)})}var module$api_shim={};
module$api_shim.api_call_city=api_call_city$$module$api_shim;module$api_shim.api_call_dungeon=api_call_dungeon$$module$api_shim;module$api_shim.api_call_hazards=api_call_hazards$$module$api_shim;module$api_shim.api_call_html=api_call_html$$module$api_shim;module$api_shim.api_call_map=api_call_map$$module$api_shim;module$api_shim.api_call_search=api_call_search$$module$api_shim;module$api_shim.api_call_version=api_call_version$$module$api_shim;module$api_shim.is_electron=is_electron$$module$api_shim;const BUILD_ID$$module$version="2401101748";var module$version={};module$version.BUILD_ID=BUILD_ID$$module$version;var t$$module$libs$hooks_module,r$$module$libs$hooks_module,u$$module$libs$hooks_module,i$$module$libs$hooks_module,o$$module$libs$hooks_module=0,f$$module$libs$hooks_module=[],c$$module$libs$hooks_module=[],e$$module$libs$hooks_module=l$$module$libs$preact.__b,a$$module$libs$hooks_module=l$$module$libs$preact.__r,v$$module$libs$hooks_module=l$$module$libs$preact.diffed,l$$module$libs$hooks_module=l$$module$libs$preact.__c,m$$module$libs$hooks_module=l$$module$libs$preact.unmount;
function d$$module$libs$hooks_module(a,e){l$$module$libs$preact.__h&&l$$module$libs$preact.__h(r$$module$libs$hooks_module,a,o$$module$libs$hooks_module||e);o$$module$libs$hooks_module=0;e=r$$module$libs$hooks_module.__H||(r$$module$libs$hooks_module.__H={__:[],__h:[]});return a>=e.__.length&&e.__.push({__V:c$$module$libs$hooks_module}),e.__[a]}function h$$module$libs$hooks_module(a){return o$$module$libs$hooks_module=1,s$$module$libs$hooks_module(B$$module$libs$hooks_module,a)}
function s$$module$libs$hooks_module(a,e,n){var t=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,2);if(t.t=a,!t.__c&&(t.__=[n?n(e):B$$module$libs$hooks_module(void 0,e),function(J){var G=t.__N?t.__N[0]:t.__[0];J=t.t(G,J);G!==J&&(t.__N=[J,t.__[1]],t.__c.setState({}))}],t.__c=r$$module$libs$hooks_module,!r$$module$libs$hooks_module.u)){var z=function(J,G,K){if(!t.__c.__H)return!0;var I=t.__c.__H.__.filter(function(Q){return Q.__c});if(I.every(function(Q){return!Q.__N}))return!D||D.call(this,
J,G,K);var L=!1;return I.forEach(function(Q){if(Q.__N){var M=Q.__[0];Q.__=Q.__N;Q.__N=void 0;M!==Q.__[0]&&(L=!0)}}),!(!L&&t.__c.props===J)&&(!D||D.call(this,J,G,K))};r$$module$libs$hooks_module.u=!0;var D=r$$module$libs$hooks_module.shouldComponentUpdate,F=r$$module$libs$hooks_module.componentWillUpdate;r$$module$libs$hooks_module.componentWillUpdate=function(J,G,K){if(this.__e){var I=D;D=void 0;z(J,G,K);D=I}F&&F.call(this,J,G,K)};r$$module$libs$hooks_module.shouldComponentUpdate=z}return t.__N||
t.__}function p$$module$libs$hooks_module(a,e){var n=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,3);!l$$module$libs$preact.__s&&z$$module$libs$hooks_module(n.__H,e)&&(n.__=a,n.i=e,r$$module$libs$hooks_module.__H.__h.push(n))}function y$$module$libs$hooks_module(a,e){var n=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,4);!l$$module$libs$preact.__s&&z$$module$libs$hooks_module(n.__H,e)&&(n.__=a,n.i=e,r$$module$libs$hooks_module.__h.push(n))}
function _$$module$libs$hooks_module(a){return o$$module$libs$hooks_module=5,F$$module$libs$hooks_module(function(){return{current:a}},[])}function A$$module$libs$hooks_module(a,e,n){o$$module$libs$hooks_module=6;y$$module$libs$hooks_module(function(){return"function"==typeof a?(a(e()),function(){return a(null)}):a?(a.current=e(),function(){return a.current=null}):void 0},null==n?n:n.concat(a))}
function F$$module$libs$hooks_module(a,e){var n=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,7);return z$$module$libs$hooks_module(n.__H,e)?(n.__V=a(),n.i=e,n.__h=a,n.__V):n.__}function T$$module$libs$hooks_module(a,e){return o$$module$libs$hooks_module=8,F$$module$libs$hooks_module(function(){return a},e)}
function q$$module$libs$hooks_module(a){var e=r$$module$libs$hooks_module.context[a.__c],n=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,9);return n.c=a,e?(null==n.__&&(n.__=!0,e.sub(r$$module$libs$hooks_module)),e.props.value):a.__}function x$$module$libs$hooks_module(a,e){l$$module$libs$preact.useDebugValue&&l$$module$libs$preact.useDebugValue(e?e(a):a)}
function P$$module$libs$hooks_module(a){var e=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,10),n=h$$module$libs$hooks_module();return e.__=a,r$$module$libs$hooks_module.componentDidCatch||(r$$module$libs$hooks_module.componentDidCatch=function(t,z){e.__&&e.__(t,z);n[1](t)}),[n[0],function(){n[1](void 0)}]}
function V$$module$libs$hooks_module(){var a=d$$module$libs$hooks_module(t$$module$libs$hooks_module++,11);if(!a.__){for(var e=r$$module$libs$hooks_module.__v;null!==e&&!e.__m&&null!==e.__;)e=e.__;e=e.__m||(e.__m=[0,0]);a.__="P"+e[0]+"-"+e[1]++}return a.__}
function b$$module$libs$hooks_module(){for(var a;a=f$$module$libs$hooks_module.shift();)if(a.__P&&a.__H)try{a.__H.__h.forEach(k$$module$libs$hooks_module),a.__H.__h.forEach(w$$module$libs$hooks_module),a.__H.__h=[]}catch(e){a.__H.__h=[],l$$module$libs$preact.__e(e,a.__v)}}l$$module$libs$preact.__b=function(a){r$$module$libs$hooks_module=null;e$$module$libs$hooks_module&&e$$module$libs$hooks_module(a)};
l$$module$libs$preact.__r=function(a){a$$module$libs$hooks_module&&a$$module$libs$hooks_module(a);t$$module$libs$hooks_module=0;(a=(r$$module$libs$hooks_module=a.__c).__H)&&(u$$module$libs$hooks_module===r$$module$libs$hooks_module?(a.__h=[],r$$module$libs$hooks_module.__h=[],a.__.forEach(function(e){e.__N&&(e.__=e.__N);e.__V=c$$module$libs$hooks_module;e.__N=e.i=void 0})):(a.__h.forEach(k$$module$libs$hooks_module),a.__h.forEach(w$$module$libs$hooks_module),a.__h=[]));u$$module$libs$hooks_module=
r$$module$libs$hooks_module};
l$$module$libs$preact.diffed=function(a){v$$module$libs$hooks_module&&v$$module$libs$hooks_module(a);(a=a.__c)&&a.__H&&(a.__H.__h.length&&(1!==f$$module$libs$hooks_module.push(a)&&i$$module$libs$hooks_module===l$$module$libs$preact.requestAnimationFrame||((i$$module$libs$hooks_module=l$$module$libs$preact.requestAnimationFrame)||j$$module$libs$hooks_module)(b$$module$libs$hooks_module)),a.__H.__.forEach(function(e){e.i&&(e.__H=e.i);e.__V!==c$$module$libs$hooks_module&&(e.__=e.__V);e.i=void 0;e.__V=
c$$module$libs$hooks_module}));u$$module$libs$hooks_module=r$$module$libs$hooks_module=null};l$$module$libs$preact.__c=function(a,e){e.some(function(n){try{n.__h.forEach(k$$module$libs$hooks_module),n.__h=n.__h.filter(function(t){return!t.__||w$$module$libs$hooks_module(t)})}catch(t){e.some(function(z){z.__h&&(z.__h=[])}),e=[],l$$module$libs$preact.__e(t,n.__v)}});l$$module$libs$hooks_module&&l$$module$libs$hooks_module(a,e)};
l$$module$libs$preact.unmount=function(a){m$$module$libs$hooks_module&&m$$module$libs$hooks_module(a);var e;(a=a.__c)&&a.__H&&(a.__H.__.forEach(function(n){try{k$$module$libs$hooks_module(n)}catch(t){e=t}}),a.__H=void 0,e&&l$$module$libs$preact.__e(e,a.__v))};var g$$module$libs$hooks_module="function"==typeof requestAnimationFrame;
function j$$module$libs$hooks_module(a){var e,n=function(){clearTimeout(t);g$$module$libs$hooks_module&&cancelAnimationFrame(e);setTimeout(a)},t=setTimeout(n,100);g$$module$libs$hooks_module&&(e=requestAnimationFrame(n))}function k$$module$libs$hooks_module(a){var e=r$$module$libs$hooks_module,n=a.__c;"function"==typeof n&&(a.__c=void 0,n());r$$module$libs$hooks_module=e}function w$$module$libs$hooks_module(a){var e=r$$module$libs$hooks_module;a.__c=a.__();r$$module$libs$hooks_module=e}
function z$$module$libs$hooks_module(a,e){return!a||a.length!==e.length||e.some(function(n,t){return n!==a[t]})}function B$$module$libs$hooks_module(a,e){return"function"==typeof e?e(a):e}var module$libs$hooks_module={};module$libs$hooks_module.useCallback=T$$module$libs$hooks_module;module$libs$hooks_module.useContext=q$$module$libs$hooks_module;module$libs$hooks_module.useDebugValue=x$$module$libs$hooks_module;module$libs$hooks_module.useEffect=p$$module$libs$hooks_module;
module$libs$hooks_module.useErrorBoundary=P$$module$libs$hooks_module;module$libs$hooks_module.useId=V$$module$libs$hooks_module;module$libs$hooks_module.useImperativeHandle=A$$module$libs$hooks_module;module$libs$hooks_module.useLayoutEffect=y$$module$libs$hooks_module;module$libs$hooks_module.useMemo=F$$module$libs$hooks_module;module$libs$hooks_module.useReducer=s$$module$libs$hooks_module;module$libs$hooks_module.useRef=_$$module$libs$hooks_module;module$libs$hooks_module.useState=h$$module$libs$hooks_module;var a$$module$libs$preact_router_module={};function c$$module$libs$preact_router_module(a,e){for(var n in e)a[n]=e[n];return a}
function s$$module$libs$preact_router_module(a,e,n){var t=/(?:\?([^#]*))?(#.*)?$/,z=a.match(t),D={};if(z&&z[1]){z=z[1].split("&");for(var F=0;F<z.length;F++){var J=z[F].split("=");D[decodeURIComponent(J[0])]=decodeURIComponent(J.slice(1).join("="))}}a=d$$module$libs$preact_router_module(a.replace(t,""));e=d$$module$libs$preact_router_module(e||"");t=Math.max(a.length,e.length);for(z=0;z<t;z++)if(e[z]&&":"===e[z].charAt(0)){F=e[z].replace(/(^:|[+*?]+$)/g,"");J=(e[z].match(/[+*?]+$/)||a$$module$libs$preact_router_module)[0]||
"";var G=~J.indexOf("+"),K=~J.indexOf("*"),I=a[z]||"";if(!I&&!K&&(0>J.indexOf("?")||G)){var L=!1;break}if(D[F]=decodeURIComponent(I),G||K){D[F]=a.slice(z).map(decodeURIComponent).join("/");break}}else if(e[z]!==a[z]){L=!1;break}return(!0===n.default||!1!==L)&&D}function h$$module$libs$preact_router_module(a,e){return a.rank<e.rank?1:a.rank>e.rank?-1:a.index-e.index}
function v$$module$libs$preact_router_module(a,e){return a.index=e,a.rank=a.props.default?0:d$$module$libs$preact_router_module(a.props.path).map(l$$module$libs$preact_router_module).join(""),a.props}function d$$module$libs$preact_router_module(a){return a.replace(/(^\/+|\/+$)/g,"").split("/")}function l$$module$libs$preact_router_module(a){return":"==a.charAt(0)?1+"*+?".indexOf(a.charAt(a.length-1))||4:5}
var p$$module$libs$preact_router_module={},m$$module$libs$preact_router_module=[],y$$module$libs$preact_router_module=[],U$$module$libs$preact_router_module=null,g$$module$libs$preact_router_module={url:R$$module$libs$preact_router_module()},k$$module$libs$preact_router_module=F$$module$libs$preact(g$$module$libs$preact_router_module);
function C$$module$libs$preact_router_module(){var a=q$$module$libs$hooks_module(k$$module$libs$preact_router_module);if(a===g$$module$libs$preact_router_module){var e=h$$module$libs$hooks_module()[1];p$$module$libs$hooks_module(function(){return y$$module$libs$preact_router_module.push(e),function(){return y$$module$libs$preact_router_module.splice(y$$module$libs$preact_router_module.indexOf(e),1)}},[])}return[a,$$$module$libs$preact_router_module]}
function R$$module$libs$preact_router_module(){var a;return""+((a=U$$module$libs$preact_router_module&&U$$module$libs$preact_router_module.location?U$$module$libs$preact_router_module.location:U$$module$libs$preact_router_module&&U$$module$libs$preact_router_module.getCurrentLocation?U$$module$libs$preact_router_module.getCurrentLocation():"undefined"!=typeof location?location:p$$module$libs$preact_router_module).pathname||"")+(a.search||"")}
function $$$module$libs$preact_router_module(a,e){return void 0===e&&(e=!1),"string"!=typeof a&&a.url&&(e=a.replace,a=a.url),function(n){for(var t=m$$module$libs$preact_router_module.length;t--;)if(m$$module$libs$preact_router_module[t].canRoute(n))return!0;return!1}(a)&&function(n,t){void 0===t&&(t="push");U$$module$libs$preact_router_module&&U$$module$libs$preact_router_module[t]?U$$module$libs$preact_router_module[t](n):"undefined"!=typeof history&&history[t+"State"]&&history[t+"State"](null,null,
n)}(a,e?"replace":"push"),I$$module$libs$preact_router_module(a)}function I$$module$libs$preact_router_module(a){for(var e=!1,n=0;n<m$$module$libs$preact_router_module.length;n++)m$$module$libs$preact_router_module[n].routeTo(a)&&(e=!0);return e}function M$$module$libs$preact_router_module(a){if(a&&a.getAttribute){var e=a.getAttribute("href");a=a.getAttribute("target");if(e&&e.match(/^\//g)&&(!a||a.match(/^_?self$/i)))return $$$module$libs$preact_router_module(e)}}
function b$$module$libs$preact_router_module(a){return a.stopImmediatePropagation&&a.stopImmediatePropagation(),a.stopPropagation&&a.stopPropagation(),a.preventDefault(),!1}
function W$$module$libs$preact_router_module(a){if(!(a.ctrlKey||a.metaKey||a.altKey||a.shiftKey||a.button)){var e=a.target;do if("a"===e.localName&&e.getAttribute("href")){if(e.hasAttribute("data-native")||e.hasAttribute("native"))break;if(M$$module$libs$preact_router_module(e))return b$$module$libs$preact_router_module(a)}while(e=e.parentNode)}}var w$$module$libs$preact_router_module=!1;
function D$$module$libs$preact_router_module(a){a.history&&(U$$module$libs$preact_router_module=a.history);this.state={url:a.url||R$$module$libs$preact_router_module()}}
c$$module$libs$preact_router_module(D$$module$libs$preact_router_module.prototype=new k$$module$libs$preact,{shouldComponentUpdate:function(a){return!0!==a.static||a.url!==this.props.url||a.onChange!==this.props.onChange},canRoute:function(a){var e=P$$module$libs$preact(this.props.children);return void 0!==this.g(e,a)},routeTo:function(a){this.setState({url:a});a=this.canRoute(a);return this.p||this.forceUpdate(),a},componentWillMount:function(){this.p=!0},componentDidMount:function(){var a=this;
w$$module$libs$preact_router_module||(w$$module$libs$preact_router_module=!0,U$$module$libs$preact_router_module||addEventListener("popstate",function(){I$$module$libs$preact_router_module(R$$module$libs$preact_router_module())}),addEventListener("click",W$$module$libs$preact_router_module));m$$module$libs$preact_router_module.push(this);U$$module$libs$preact_router_module&&(this.u=U$$module$libs$preact_router_module.listen(function(e){e=e.location||e;a.routeTo(""+(e.pathname||"")+(e.search||""))}));
this.p=!1},componentWillUnmount:function(){"function"==typeof this.u&&this.u();m$$module$libs$preact_router_module.splice(m$$module$libs$preact_router_module.indexOf(this),1)},componentWillUpdate:function(){this.p=!0},componentDidUpdate:function(){this.p=!1},g:function(a,e){a=a.filter(v$$module$libs$preact_router_module).sort(h$$module$libs$preact_router_module);for(var n=0;n<a.length;n++){var t=a[n],z=s$$module$libs$preact_router_module(e,t.props.path,t.props);if(z)return[t,z]}},render:function(a,
e){var n,t,z=a.onChange,D=e.url;e=this.c;a=this.g(P$$module$libs$preact(a.children),D);if(a&&(t=E$$module$libs$preact(a[0],c$$module$libs$preact_router_module(c$$module$libs$preact_router_module({url:D,matches:n=a[1]},n),{key:void 0,ref:void 0}))),D!==(e&&e.url)){c$$module$libs$preact_router_module(g$$module$libs$preact_router_module,e=this.c={url:D,previous:e&&e.url,current:t,path:t?t.props.path:null,matches:n});e.router=this;e.active=t?[t]:[];for(n=y$$module$libs$preact_router_module.length;n--;)y$$module$libs$preact_router_module[n]({});
"function"==typeof z&&z(e)}return y$$module$libs$preact(k$$module$libs$preact_router_module.Provider,{value:e},t)}});var E$$module$libs$preact_router_module=function(a){return y$$module$libs$preact("a",c$$module$libs$preact_router_module({onClick:W$$module$libs$preact_router_module},a))},L$$module$libs$preact_router_module=function(a){return y$$module$libs$preact(a.component,a)},module$libs$preact_router_module={};module$libs$preact_router_module.Link=E$$module$libs$preact_router_module;
module$libs$preact_router_module.Route=L$$module$libs$preact_router_module;module$libs$preact_router_module.Router=D$$module$libs$preact_router_module;module$libs$preact_router_module.default=D$$module$libs$preact_router_module;module$libs$preact_router_module.exec=s$$module$libs$preact_router_module;module$libs$preact_router_module.getCurrentUrl=R$$module$libs$preact_router_module;module$libs$preact_router_module.route=$$$module$libs$preact_router_module;
module$libs$preact_router_module.useRouter=C$$module$libs$preact_router_module;/*
 ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource>  queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource>  safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource>  simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
const create$$module$libs$y_webrtc_min=()=>new Map,copy$$module$libs$y_webrtc_min=a=>{const e=create$$module$libs$y_webrtc_min();return a.forEach((n,t)=>{e.set(t,n)}),e},setIfUndefined$$module$libs$y_webrtc_min=(a,e,n)=>{let t=a.get(e);return void 0===t&&a.set(e,t=n()),t},create$1$$module$libs$y_webrtc_min=()=>new Set,last$$module$libs$y_webrtc_min=a=>a[a.length-1],appendTo$$module$libs$y_webrtc_min=(a,e)=>{for(let n=0;n<e.length;n++)a.push(e[n])},from$$module$libs$y_webrtc_min=Array.from,isArray$$module$libs$y_webrtc_min=
Array.isArray;
class Observable$$module$libs$y_webrtc_min{constructor(){this._observers=create$$module$libs$y_webrtc_min()}on(a,e){setIfUndefined$$module$libs$y_webrtc_min(this._observers,a,create$1$$module$libs$y_webrtc_min).add(e)}once(a,e){const n=(...t)=>{this.off(a,n);e(...t)};this.on(a,n)}off(a,e){const n=this._observers.get(a);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(a))}emit(a,e){return from$$module$libs$y_webrtc_min((this._observers.get(a)||create$$module$libs$y_webrtc_min()).values()).forEach(n=>n(...e))}destroy(){this._observers=
create$$module$libs$y_webrtc_min()}}
const floor$$module$libs$y_webrtc_min=Math.floor,abs$$module$libs$y_webrtc_min=Math.abs,log10$$module$libs$y_webrtc_min=Math.log10,min$$module$libs$y_webrtc_min=(a,e)=>a<e?a:e,max$$module$libs$y_webrtc_min=(a,e)=>a>e?a:e,isNegativeZero$$module$libs$y_webrtc_min=a=>0!==a?0>a:0>1/a,getUnixTime$$module$libs$y_webrtc_min=Date.now,setupWS$$module$libs$y_webrtc_min=a=>{if(a.shouldConnect&&null===a.ws){const e=new WebSocket(a.url),n=a.binaryType;let t=null;n&&(e.binaryType=n);a.ws=e;a.connecting=!0;a.connected=
!1;e.onmessage=F=>{a.lastMessageReceived=getUnixTime$$module$libs$y_webrtc_min();F=F.data;(F="string"==typeof F?JSON.parse(F):F)&&"pong"===F.type&&(clearTimeout(t),t=setTimeout(D,15E3));a.emit("message",[F,a])};const z=F=>{null!==a.ws&&(a.ws=null,a.connecting=!1,a.connected?(a.connected=!1,a.emit("disconnect",[{type:"disconnect",error:F},a])):a.unsuccessfulReconnects++,setTimeout(setupWS$$module$libs$y_webrtc_min,min$$module$libs$y_webrtc_min(1200*log10$$module$libs$y_webrtc_min(a.unsuccessfulReconnects+
1),2500),a));clearTimeout(t)},D=()=>{a.ws===e&&a.send({type:"ping"})};e.onclose=()=>z(null);e.onerror=F=>z(F);e.onopen=()=>{a.lastMessageReceived=getUnixTime$$module$libs$y_webrtc_min();a.connecting=!1;a.connected=!0;a.unsuccessfulReconnects=0;a.emit("connect",[{type:"connect"},a]);t=setTimeout(D,15E3)}}};
class WebsocketClient$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor(a,{binaryType:e}={}){super();this.url=a;this.ws=null;this.binaryType=e||null;this.connecting=this.connected=!1;this.lastMessageReceived=this.unsuccessfulReconnects=0;this.shouldConnect=!0;this._checkInterval=setInterval(()=>{this.connected&&3E4<getUnixTime$$module$libs$y_webrtc_min()-this.lastMessageReceived&&this.ws.close()},15E3);setupWS$$module$libs$y_webrtc_min(this)}send(a){this.ws&&this.ws.send(JSON.stringify(a))}destroy(){clearInterval(this._checkInterval);
this.disconnect();super.destroy()}disconnect(){this.shouldConnect=!1;null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0;this.connected||null!==this.ws||setupWS$$module$libs$y_webrtc_min(this)}}
const create$2$$module$libs$y_webrtc_min=a=>Error(a),methodUnimplemented$$module$libs$y_webrtc_min=()=>{throw create$2$$module$libs$y_webrtc_min("Method unimplemented");},unexpectedCase$$module$libs$y_webrtc_min=()=>{throw create$2$$module$libs$y_webrtc_min("Unexpected case");},getRandomValues$$module$libs$y_webrtc_min=crypto.getRandomValues.bind(crypto),rand$$module$libs$y_webrtc_min=Math.random,uint32$$module$libs$y_webrtc_min=()=>getRandomValues$$module$libs$y_webrtc_min(new Uint32Array(1))[0],
uuidv4Template$$module$libs$y_webrtc_min="10000000-1000-4000-8000-100000000000",uuidv4$$module$libs$y_webrtc_min=()=>uuidv4Template$$module$libs$y_webrtc_min.replace(/[018]/g,a=>(a^uint32$$module$libs$y_webrtc_min()&15>>a/4).toString(16)),fromCharCode$$module$libs$y_webrtc_min=String.fromCharCode,trimLeftRegex$$module$libs$y_webrtc_min=/^\s*/g,fromCamelCaseRegex$$module$libs$y_webrtc_min=/([A-Z])/g,fromCamelCase$$module$libs$y_webrtc_min=(a,e)=>a.replace(fromCamelCaseRegex$$module$libs$y_webrtc_min,
n=>`${e}${n.toLowerCase()}`).replace(trimLeftRegex$$module$libs$y_webrtc_min,""),utf8TextEncoder$$module$libs$y_webrtc_min="undefined"!=typeof TextEncoder?new TextEncoder:null,encodeUtf8$$module$libs$y_webrtc_min=utf8TextEncoder$$module$libs$y_webrtc_min?a=>utf8TextEncoder$$module$libs$y_webrtc_min.encode(a):a=>{a=unescape(encodeURIComponent(a));const e=a.length,n=new Uint8Array(e);for(let t=0;t<e;t++)n[t]=a.codePointAt(t);return n};
let utf8TextDecoder$$module$libs$y_webrtc_min="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});utf8TextDecoder$$module$libs$y_webrtc_min&&1===utf8TextDecoder$$module$libs$y_webrtc_min.decode(new Uint8Array).length&&(utf8TextDecoder$$module$libs$y_webrtc_min=null);const repeat$$module$libs$y_webrtc_min=(a,e)=>((n,t)=>{const z=Array(n);for(let D=0;D<n;D++)z[D]=t(D,z);return z})(e,()=>a).join(""),undefinedToNull$$module$libs$y_webrtc_min=a=>void 0===a?null:a;
let _localStorage$$module$libs$y_webrtc_min=new class{constructor(){this.map=new Map}setItem(a,e){this.map.set(a,e)}getItem(a){return this.map.get(a)}},usePolyfill$$module$libs$y_webrtc_min=!0;try{"undefined"!=typeof localStorage&&(_localStorage$$module$libs$y_webrtc_min=localStorage,usePolyfill$$module$libs$y_webrtc_min=!1)}catch(a){}
const varStorage$$module$libs$y_webrtc_min=_localStorage$$module$libs$y_webrtc_min,assign$$module$libs$y_webrtc_min=Object.assign,keys$$module$libs$y_webrtc_min=Object.keys,length$$module$libs$y_webrtc_min=a=>keys$$module$libs$y_webrtc_min(a).length,hasProperty$$module$libs$y_webrtc_min=(a,e)=>Object.prototype.hasOwnProperty.call(a,e),callAll$$module$libs$y_webrtc_min=(a,e,n=0)=>{try{for(;n<a.length;n++)a[n](...e)}finally{n<a.length&&callAll$$module$libs$y_webrtc_min(a,e,n+1)}},nop$$module$libs$y_webrtc_min=
()=>{},id$$module$libs$y_webrtc_min=a=>a,equalityDeep$$module$libs$y_webrtc_min=(a,e)=>{if(null==a||null==e)return a===e;if(a.constructor!==e.constructor)return!1;if(a===e)return!0;switch(a.constructor){case ArrayBuffer:a=new Uint8Array(a),e=new Uint8Array(e);case Uint8Array:if(a.byteLength!==e.byteLength)return!1;for(var n=0;n<a.length;n++)if(a[n]!==e[n])return!1;break;case Set:if(a.size!==e.size)return!1;for(n of a)if(!e.has(n))return!1;break;case Map:if(a.size!==e.size)return!1;for(const t of a.keys())if(!e.has(t)||
!equalityDeep$$module$libs$y_webrtc_min(a.get(t),e.get(t)))return!1;break;case Object:if(length$$module$libs$y_webrtc_min(a)!==length$$module$libs$y_webrtc_min(e))return!1;for(const t in a)if(!hasProperty$$module$libs$y_webrtc_min(a,t)||!equalityDeep$$module$libs$y_webrtc_min(a[t],e[t]))return!1;break;case Array:if(a.length!==e.length)return!1;for(n=0;n<a.length;n++)if(!equalityDeep$$module$libs$y_webrtc_min(a[n],e[n]))return!1;break;default:return!1}return!0},isNode$$module$libs$y_webrtc_min="undefined"!=
typeof process&&process.release&&/node|io\.js/.test(process.release.name),isBrowser$$module$libs$y_webrtc_min="undefined"!=typeof window&&"undefined"!=typeof document&&!isNode$$module$libs$y_webrtc_min;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let params$$module$libs$y_webrtc_min;
const hasParam$$module$libs$y_webrtc_min=a=>(()=>{if(void 0===params$$module$libs$y_webrtc_min)if(isNode$$module$libs$y_webrtc_min){params$$module$libs$y_webrtc_min=create$$module$libs$y_webrtc_min();const e=process.argv;let n=null;for(let t=0;t<e.length;t++){const z=e[t];"-"===z[0]?(null!==n&&params$$module$libs$y_webrtc_min.set(n,""),n=z):null!==n&&(params$$module$libs$y_webrtc_min.set(n,z),n=null)}null!==n&&params$$module$libs$y_webrtc_min.set(n,"")}else"object"==typeof location?(params$$module$libs$y_webrtc_min=
create$$module$libs$y_webrtc_min(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){const [n,t]=e.split("=");params$$module$libs$y_webrtc_min.set("--"+fromCamelCase$$module$libs$y_webrtc_min(n,"-"),t);params$$module$libs$y_webrtc_min.set("-"+fromCamelCase$$module$libs$y_webrtc_min(n,"-"),t)}})):params$$module$libs$y_webrtc_min=create$$module$libs$y_webrtc_min();return params$$module$libs$y_webrtc_min})().has(a),getVariable$$module$libs$y_webrtc_min=a=>undefinedToNull$$module$libs$y_webrtc_min(isNode$$module$libs$y_webrtc_min?
process.env[a.toUpperCase()]:varStorage$$module$libs$y_webrtc_min.getItem(a));hasParam$$module$libs$y_webrtc_min("--"+(name$$module$libs$y_webrtc_min="production"))||getVariable$$module$libs$y_webrtc_min(name$$module$libs$y_webrtc_min);var name$$module$libs$y_webrtc_min;const forceColor$$module$libs$y_webrtc_min=isNode$$module$libs$y_webrtc_min&&(value$$module$libs$y_webrtc_min=process.env.FORCE_COLOR,["true","1","2"].includes(value$$module$libs$y_webrtc_min));var value$$module$libs$y_webrtc_min;
const supportsColor$$module$libs$y_webrtc_min=!hasParam$$module$libs$y_webrtc_min("no-colors")&&(!isNode$$module$libs$y_webrtc_min||process.stdout.isTTY||forceColor$$module$libs$y_webrtc_min)&&(!isNode$$module$libs$y_webrtc_min||hasParam$$module$libs$y_webrtc_min("color")||forceColor$$module$libs$y_webrtc_min||null!==getVariable$$module$libs$y_webrtc_min("COLORTERM")||(getVariable$$module$libs$y_webrtc_min("TERM")||"").includes("color")),MAX_SAFE_INTEGER$$module$libs$y_webrtc_min=Number.MAX_SAFE_INTEGER,
isInteger$$module$libs$y_webrtc_min=Number.isInteger||(a=>"number"==typeof a&&isFinite(a)&&floor$$module$libs$y_webrtc_min(a)===a),errorUnexpectedEndOfArray$$module$libs$y_webrtc_min=create$2$$module$libs$y_webrtc_min("Unexpected end of array"),errorIntegerOutOfRange$$module$libs$y_webrtc_min=create$2$$module$libs$y_webrtc_min("Integer out of Range");class Decoder$$module$libs$y_webrtc_min{constructor(a){this.arr=a;this.pos=0}}
const createDecoder$$module$libs$y_webrtc_min=a=>new Decoder$$module$libs$y_webrtc_min(a),hasContent$$module$libs$y_webrtc_min=a=>a.pos!==a.arr.length,readVarUint8Array$$module$libs$y_webrtc_min=a=>{var e=readVarUint$$module$libs$y_webrtc_min(a);const n=createUint8ArrayViewFromArrayBuffer$$module$libs$y_webrtc_min(a.arr.buffer,a.pos+a.arr.byteOffset,e);return a.pos+=e,n},readUint8$$module$libs$y_webrtc_min=a=>a.arr[a.pos++],readVarUint$$module$libs$y_webrtc_min=a=>{let e=0,n=1;const t=a.arr.length;
for(;a.pos<t;){const z=a.arr[a.pos++];if(e+=(127&z)*n,n*=128,128>z)return e;if(e>MAX_SAFE_INTEGER$$module$libs$y_webrtc_min)throw errorIntegerOutOfRange$$module$libs$y_webrtc_min;}throw errorUnexpectedEndOfArray$$module$libs$y_webrtc_min;},readVarInt$$module$libs$y_webrtc_min=a=>{let e=a.arr[a.pos++],n=63&e,t=64;const z=0<(64&e)?-1:1;if(0==(128&e))return z*n;const D=a.arr.length;for(;a.pos<D;){if(e=a.arr[a.pos++],n+=(127&e)*t,t*=128,128>e)return z*n;if(n>MAX_SAFE_INTEGER$$module$libs$y_webrtc_min)throw errorIntegerOutOfRange$$module$libs$y_webrtc_min;
}throw errorUnexpectedEndOfArray$$module$libs$y_webrtc_min;},readVarString$$module$libs$y_webrtc_min=utf8TextDecoder$$module$libs$y_webrtc_min?a=>utf8TextDecoder$$module$libs$y_webrtc_min.decode(readVarUint8Array$$module$libs$y_webrtc_min(a)):a=>{let e=readVarUint$$module$libs$y_webrtc_min(a);if(0===e)return"";let n=String.fromCodePoint(readUint8$$module$libs$y_webrtc_min(a));if(100>--e)for(;e--;)n+=String.fromCodePoint(readUint8$$module$libs$y_webrtc_min(a));else for(;0<e;){const t=1E4>e?e:1E4,z=
a.arr.subarray(a.pos,a.pos+t);a.pos+=t;n+=String.fromCodePoint.apply(null,z);e-=t}return decodeURIComponent(escape(n))},readFromDataView$$module$libs$y_webrtc_min=(a,e)=>{const n=new DataView(a.arr.buffer,a.arr.byteOffset+a.pos,e);return a.pos+=e,n},readAnyLookupTable$$module$libs$y_webrtc_min=[a=>{},a=>null,readVarInt$$module$libs$y_webrtc_min,a=>readFromDataView$$module$libs$y_webrtc_min(a,4).getFloat32(0,!1),a=>readFromDataView$$module$libs$y_webrtc_min(a,8).getFloat64(0,!1),a=>readFromDataView$$module$libs$y_webrtc_min(a,
8).getBigInt64(0,!1),a=>!1,a=>!0,readVarString$$module$libs$y_webrtc_min,a=>{const e=readVarUint$$module$libs$y_webrtc_min(a),n={};for(let t=0;t<e;t++)n[readVarString$$module$libs$y_webrtc_min(a)]=readAny$$module$libs$y_webrtc_min(a);return n},a=>{const e=readVarUint$$module$libs$y_webrtc_min(a),n=[];for(let t=0;t<e;t++)n.push(readAny$$module$libs$y_webrtc_min(a));return n},readVarUint8Array$$module$libs$y_webrtc_min],readAny$$module$libs$y_webrtc_min=a=>readAnyLookupTable$$module$libs$y_webrtc_min[127-
readUint8$$module$libs$y_webrtc_min(a)](a);class RleDecoder$$module$libs$y_webrtc_min extends Decoder$$module$libs$y_webrtc_min{constructor(a,e){super(a);this.reader=e;this.s=null;this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),hasContent$$module$libs$y_webrtc_min(this)?this.count=readVarUint$$module$libs$y_webrtc_min(this)+1:this.count=-1),this.count--,this.s}}
class UintOptRleDecoder$$module$libs$y_webrtc_min extends Decoder$$module$libs$y_webrtc_min{constructor(a){super(a);this.count=this.s=0}read(){if(0===this.count){this.s=readVarInt$$module$libs$y_webrtc_min(this);const a=isNegativeZero$$module$libs$y_webrtc_min(this.s);this.count=1;a&&(this.s=-this.s,this.count=readVarUint$$module$libs$y_webrtc_min(this)+2)}return this.count--,this.s}}
class IntDiffOptRleDecoder$$module$libs$y_webrtc_min extends Decoder$$module$libs$y_webrtc_min{constructor(a){super(a);this.diff=this.count=this.s=0}read(){if(0===this.count){const a=readVarInt$$module$libs$y_webrtc_min(this),e=1&a;this.diff=floor$$module$libs$y_webrtc_min(a/2);this.count=1;e&&(this.count=readVarUint$$module$libs$y_webrtc_min(this)+2)}return this.s+=this.diff,this.count--,this.s}}
class StringDecoder$$module$libs$y_webrtc_min{constructor(a){this.decoder=new UintOptRleDecoder$$module$libs$y_webrtc_min(a);this.str=readVarString$$module$libs$y_webrtc_min(this.decoder);this.spos=0}read(){const a=this.spos+this.decoder.read(),e=this.str.slice(this.spos,a);return this.spos=a,e}}
const createUint8ArrayFromLen$$module$libs$y_webrtc_min=a=>new Uint8Array(a),createUint8ArrayViewFromArrayBuffer$$module$libs$y_webrtc_min=(a,e,n)=>new Uint8Array(a,e,n),toBase64$$module$libs$y_webrtc_min=isBrowser$$module$libs$y_webrtc_min?a=>{let e="";for(let n=0;n<a.byteLength;n++)e+=fromCharCode$$module$libs$y_webrtc_min(a[n]);return btoa(e)}:a=>Buffer.from(a.buffer,a.byteOffset,a.byteLength).toString("base64"),fromBase64$$module$libs$y_webrtc_min=isBrowser$$module$libs$y_webrtc_min?a=>{a=atob(a);
const e=createUint8ArrayFromLen$$module$libs$y_webrtc_min(a.length);for(let n=0;n<a.length;n++)e[n]=a.charCodeAt(n);return e}:a=>{a=Buffer.from(a,"base64");return new Uint8Array(a.buffer,a.byteOffset,a.byteLength)};class Encoder$$module$libs$y_webrtc_min{constructor(){this.cpos=0;this.cbuf=new Uint8Array(100);this.bufs=[]}}
const createEncoder$$module$libs$y_webrtc_min=()=>new Encoder$$module$libs$y_webrtc_min,toUint8Array$$module$libs$y_webrtc_min=a=>{var e=Uint8Array,n=a.cpos;for(var t=0;t<a.bufs.length;t++)n+=a.bufs[t].length;e=new e(n);n=0;for(t=0;t<a.bufs.length;t++){const z=a.bufs[t];e.set(z,n);n+=z.length}return e.set(createUint8ArrayViewFromArrayBuffer$$module$libs$y_webrtc_min(a.cbuf.buffer,0,a.cpos),n),e},write$$module$libs$y_webrtc_min=(a,e)=>{const n=a.cbuf.length;a.cpos===n&&(a.bufs.push(a.cbuf),a.cbuf=
new Uint8Array(2*n),a.cpos=0);a.cbuf[a.cpos++]=e},writeUint8$$module$libs$y_webrtc_min=write$$module$libs$y_webrtc_min,writeVarUint$$module$libs$y_webrtc_min=(a,e)=>{for(;127<e;)write$$module$libs$y_webrtc_min(a,128|127&e),e=floor$$module$libs$y_webrtc_min(e/128);write$$module$libs$y_webrtc_min(a,127&e)},writeVarInt$$module$libs$y_webrtc_min=(a,e)=>{const n=isNegativeZero$$module$libs$y_webrtc_min(e);n&&(e=-e);write$$module$libs$y_webrtc_min(a,(63<e?128:0)|(n?64:0)|63&e);for(e=floor$$module$libs$y_webrtc_min(e/
64);0<e;)write$$module$libs$y_webrtc_min(a,(127<e?128:0)|127&e),e=floor$$module$libs$y_webrtc_min(e/128)},_strBuffer$$module$libs$y_webrtc_min=new Uint8Array(3E4),_maxStrBSize$$module$libs$y_webrtc_min=_strBuffer$$module$libs$y_webrtc_min.length/3,writeVarString$$module$libs$y_webrtc_min=utf8TextEncoder$$module$libs$y_webrtc_min&&utf8TextEncoder$$module$libs$y_webrtc_min.encodeInto?(a,e)=>{if(e.length<_maxStrBSize$$module$libs$y_webrtc_min){e=utf8TextEncoder$$module$libs$y_webrtc_min.encodeInto(e,
_strBuffer$$module$libs$y_webrtc_min).written||0;writeVarUint$$module$libs$y_webrtc_min(a,e);for(let n=0;n<e;n++)write$$module$libs$y_webrtc_min(a,_strBuffer$$module$libs$y_webrtc_min[n])}else writeVarUint8Array$$module$libs$y_webrtc_min(a,encodeUtf8$$module$libs$y_webrtc_min(e))}:(a,e)=>{e=unescape(encodeURIComponent(e));const n=e.length;writeVarUint$$module$libs$y_webrtc_min(a,n);for(let t=0;t<n;t++)write$$module$libs$y_webrtc_min(a,e.codePointAt(t))},writeUint8Array$$module$libs$y_webrtc_min=(a,
e)=>{const n=a.cbuf.length,t=a.cpos,z=min$$module$libs$y_webrtc_min(n-t,e.length),D=e.length-z;a.cbuf.set(e.subarray(0,z),t);a.cpos+=z;0<D&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(max$$module$libs$y_webrtc_min(2*n,D)),a.cbuf.set(e.subarray(z)),a.cpos=D)},writeVarUint8Array$$module$libs$y_webrtc_min=(a,e)=>{writeVarUint$$module$libs$y_webrtc_min(a,e.byteLength);writeUint8Array$$module$libs$y_webrtc_min(a,e)},writeOnDataView$$module$libs$y_webrtc_min=(a,e)=>{var n=a.cbuf.length;n-a.cpos<e&&(a.bufs.push(createUint8ArrayViewFromArrayBuffer$$module$libs$y_webrtc_min(a.cbuf.buffer,
0,a.cpos)),a.cbuf=new Uint8Array(2*max$$module$libs$y_webrtc_min(n,e)),a.cpos=0);n=new DataView(a.cbuf.buffer,a.cpos,e);return a.cpos+=e,n},floatTestBed$$module$libs$y_webrtc_min=new DataView(new ArrayBuffer(4)),writeAny$$module$libs$y_webrtc_min=(a,e)=>{switch(typeof e){case "string":write$$module$libs$y_webrtc_min(a,119);writeVarString$$module$libs$y_webrtc_min(a,e);break;case "number":isInteger$$module$libs$y_webrtc_min(e)&&2147483647>=abs$$module$libs$y_webrtc_min(e)?(write$$module$libs$y_webrtc_min(a,
125),writeVarInt$$module$libs$y_webrtc_min(a,e)):(n=e,floatTestBed$$module$libs$y_webrtc_min.setFloat32(0,n),floatTestBed$$module$libs$y_webrtc_min.getFloat32(0)===n?(write$$module$libs$y_webrtc_min(a,124),((t,z)=>{writeOnDataView$$module$libs$y_webrtc_min(t,4).setFloat32(0,z,!1)})(a,e)):(write$$module$libs$y_webrtc_min(a,123),((t,z)=>{writeOnDataView$$module$libs$y_webrtc_min(t,8).setFloat64(0,z,!1)})(a,e)));break;case "bigint":write$$module$libs$y_webrtc_min(a,122);((t,z)=>{writeOnDataView$$module$libs$y_webrtc_min(t,
8).setBigInt64(0,z,!1)})(a,e);break;case "object":if(null===e)write$$module$libs$y_webrtc_min(a,126);else if(isArray$$module$libs$y_webrtc_min(e))for(write$$module$libs$y_webrtc_min(a,117),writeVarUint$$module$libs$y_webrtc_min(a,e.length),n=0;n<e.length;n++)writeAny$$module$libs$y_webrtc_min(a,e[n]);else if(e instanceof Uint8Array)write$$module$libs$y_webrtc_min(a,116),writeVarUint8Array$$module$libs$y_webrtc_min(a,e);else{write$$module$libs$y_webrtc_min(a,118);n=Object.keys(e);writeVarUint$$module$libs$y_webrtc_min(a,
n.length);for(let t=0;t<n.length;t++){const z=n[t];writeVarString$$module$libs$y_webrtc_min(a,z);writeAny$$module$libs$y_webrtc_min(a,e[z])}}break;case "boolean":write$$module$libs$y_webrtc_min(a,e?120:121);break;default:write$$module$libs$y_webrtc_min(a,127)}var n};
class RleEncoder$$module$libs$y_webrtc_min extends Encoder$$module$libs$y_webrtc_min{constructor(a){super();this.w=a;this.s=null;this.count=0}write(a){this.s===a?this.count++:(0<this.count&&writeVarUint$$module$libs$y_webrtc_min(this,this.count-1),this.count=1,this.w(this,a),this.s=a)}}const flushUintOptRleEncoder$$module$libs$y_webrtc_min=a=>{0<a.count&&(writeVarInt$$module$libs$y_webrtc_min(a.encoder,1===a.count?a.s:-a.s),1<a.count&&writeVarUint$$module$libs$y_webrtc_min(a.encoder,a.count-2))};
class UintOptRleEncoder$$module$libs$y_webrtc_min{constructor(){this.encoder=new Encoder$$module$libs$y_webrtc_min;this.count=this.s=0}write(a){this.s===a?this.count++:(flushUintOptRleEncoder$$module$libs$y_webrtc_min(this),this.count=1,this.s=a)}toUint8Array(){return flushUintOptRleEncoder$$module$libs$y_webrtc_min(this),toUint8Array$$module$libs$y_webrtc_min(this.encoder)}}
const flushIntDiffOptRleEncoder$$module$libs$y_webrtc_min=a=>{0<a.count&&(writeVarInt$$module$libs$y_webrtc_min(a.encoder,2*a.diff+(1===a.count?0:1)),1<a.count&&writeVarUint$$module$libs$y_webrtc_min(a.encoder,a.count-2))};
class IntDiffOptRleEncoder$$module$libs$y_webrtc_min{constructor(){this.encoder=new Encoder$$module$libs$y_webrtc_min;this.diff=this.count=this.s=0}write(a){this.diff===a-this.s?(this.s=a,this.count++):(flushIntDiffOptRleEncoder$$module$libs$y_webrtc_min(this),this.count=1,this.diff=a-this.s,this.s=a)}toUint8Array(){return flushIntDiffOptRleEncoder$$module$libs$y_webrtc_min(this),toUint8Array$$module$libs$y_webrtc_min(this.encoder)}}
class StringEncoder$$module$libs$y_webrtc_min{constructor(){this.sarr=[];this.s="";this.lensE=new UintOptRleEncoder$$module$libs$y_webrtc_min}write(a){this.s+=a;19<this.s.length&&(this.sarr.push(this.s),this.s="");this.lensE.write(a.length)}toUint8Array(){const a=new Encoder$$module$libs$y_webrtc_min;return this.sarr.push(this.s),this.s="",writeVarString$$module$libs$y_webrtc_min(a,this.sarr.join("")),writeUint8Array$$module$libs$y_webrtc_min(a,this.lensE.toUint8Array()),toUint8Array$$module$libs$y_webrtc_min(a)}}
class Pair$$module$libs$y_webrtc_min{constructor(a,e){this.left=a;this.right=e}}
const create$3$$module$libs$y_webrtc_min=(a,e)=>new Pair$$module$libs$y_webrtc_min(a,e),create$4$$module$libs$y_webrtc_min=("undefined"!=typeof DOMParser&&new DOMParser,Symbol),BOLD$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),UNBOLD$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),BLUE$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),GREY$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),GREEN$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),
RED$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),PURPLE$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),ORANGE$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),UNCOLOR$$module$libs$y_webrtc_min=create$4$$module$libs$y_webrtc_min(),loggingColors$$module$libs$y_webrtc_min=[GREEN$$module$libs$y_webrtc_min,PURPLE$$module$libs$y_webrtc_min,ORANGE$$module$libs$y_webrtc_min,BLUE$$module$libs$y_webrtc_min];
let nextColor$$module$libs$y_webrtc_min=0,lastLoggingTime$$module$libs$y_webrtc_min=getUnixTime$$module$libs$y_webrtc_min();
const _browserStyleMap$$module$libs$y_webrtc_min={[BOLD$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("font-weight","bold"),[UNBOLD$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("font-weight","normal"),[BLUE$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","blue"),[GREEN$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","green"),[GREY$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","grey"),[RED$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color",
"red"),[PURPLE$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","purple"),[ORANGE$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","orange"),[UNCOLOR$$module$libs$y_webrtc_min]:create$3$$module$libs$y_webrtc_min("color","black")},computeLoggingArgs$$module$libs$y_webrtc_min=supportsColor$$module$libs$y_webrtc_min?a=>{var e=[];const n=[],t=create$$module$libs$y_webrtc_min();let z=[],D=0;for(;D<a.length;D++){const J=a[D];var F=_browserStyleMap$$module$libs$y_webrtc_min[J];
if(void 0!==F)t.set(F.left,F.right);else{if(J.constructor!==String&&J.constructor!==Number)break;F=((G,K)=>{const I=[];for(const [L,Q]of G)I.push(K(Q,L));return I})(t,(G,K)=>`${K}:${G};`).join("");0<D||0<F.length?(e.push("%c"+J),n.push(F)):e.push(J)}}for(0<D&&(z=n,z.unshift(e.join("")));D<a.length;D++)e=a[D],e instanceof Symbol||z.push(e);return z}:a=>{const e=[];let n=0;for(;n<a.length;n++){const t=a[n];t.constructor===String||t.constructor===Number||t.constructor===Object&&e.push(JSON.stringify(t))}return e},
print$$module$libs$y_webrtc_min=(...a)=>{console.log(...computeLoggingArgs$$module$libs$y_webrtc_min(a));vconsoles$$module$libs$y_webrtc_min.forEach(e=>e.print(a))},vconsoles$$module$libs$y_webrtc_min=create$1$$module$libs$y_webrtc_min(),create$5$$module$libs$y_webrtc_min=a=>new Promise(a),resolve$$module$libs$y_webrtc_min=a=>Promise.resolve(a),channels$$module$libs$y_webrtc_min=new Map,BC$$module$libs$y_webrtc_min="undefined"==typeof BroadcastChannel?class{constructor(a){this.room=a;this.onmessage=
null;var e=this._onChange=n=>n.key===a&&null!==this.onmessage&&this.onmessage({data:fromBase64$$module$libs$y_webrtc_min(n.newValue||"")});usePolyfill$$module$libs$y_webrtc_min||addEventListener("storage",e)}postMessage(a){varStorage$$module$libs$y_webrtc_min.setItem(this.room,toBase64$$module$libs$y_webrtc_min(new Uint8Array(a)))}close(){var a=this._onChange;usePolyfill$$module$libs$y_webrtc_min||removeEventListener("storage",a)}}:BroadcastChannel,getChannel$$module$libs$y_webrtc_min=a=>setIfUndefined$$module$libs$y_webrtc_min(channels$$module$libs$y_webrtc_min,
a,()=>{const e=create$1$$module$libs$y_webrtc_min(),n=new BC$$module$libs$y_webrtc_min(a);return n.onmessage=t=>e.forEach(z=>z(t.data,"broadcastchannel")),{bc:n,subs:e}}),createIterator$$module$libs$y_webrtc_min=a=>({[Symbol.iterator](){return this},next:a}),iteratorMap$$module$libs$y_webrtc_min=(a,e)=>createIterator$$module$libs$y_webrtc_min(()=>{const {done:n,value:t}=a.next();return{done:n,value:n?void 0:e(t)}});
class AbstractConnector$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor(a,e){super();this.doc=a;this.awareness=e}}class DeleteItem$$module$libs$y_webrtc_min{constructor(a,e){this.clock=a;this.len=e}}class DeleteSet$$module$libs$y_webrtc_min{constructor(){this.clients=new Map}}
const iterateDeletedStructs$$module$libs$y_webrtc_min=(a,e,n)=>e.clients.forEach((t,z)=>{z=a.doc.store.clients.get(z);for(let D=0;D<t.length;D++){const F=t[D];iterateStructs$$module$libs$y_webrtc_min(a,z,F.clock,F.len,n)}}),isDeleted$$module$libs$y_webrtc_min=(a,e)=>{a=a.clients.get(e.client);var n;if(n=void 0!==a){a:{e=e.clock;n=0;let t=a.length-1;for(;n<=t;){const z=floor$$module$libs$y_webrtc_min((n+t)/2),D=a[z],F=D.clock;if(F<=e){if(e<F+D.len){a=z;break a}n=z+1}else t=z-1}a=null}n=null!==a}return n},
sortAndMergeDeleteSet$$module$libs$y_webrtc_min=a=>{a.clients.forEach(e=>{let n,t;e.sort((z,D)=>z.clock-D.clock);for(t=n=1;n<e.length;n++){const z=e[t-1],D=e[n];z.clock+z.len>=D.clock?z.len=max$$module$libs$y_webrtc_min(z.len,D.clock+D.len-z.clock):(t<n&&(e[t]=D),t++)}e.length=t})},mergeDeleteSets$$module$libs$y_webrtc_min=a=>{const e=new DeleteSet$$module$libs$y_webrtc_min;for(let n=0;n<a.length;n++)a[n].clients.forEach((t,z)=>{if(!e.clients.has(z)){t=t.slice();for(let D=n+1;D<a.length;D++)appendTo$$module$libs$y_webrtc_min(t,
a[D].clients.get(z)||[]);e.clients.set(z,t)}});return sortAndMergeDeleteSet$$module$libs$y_webrtc_min(e),e},addToDeleteSet$$module$libs$y_webrtc_min=(a,e,n,t)=>{setIfUndefined$$module$libs$y_webrtc_min(a.clients,e,()=>[]).push(new DeleteItem$$module$libs$y_webrtc_min(n,t))},createDeleteSet$$module$libs$y_webrtc_min=()=>new DeleteSet$$module$libs$y_webrtc_min,createDeleteSetFromStructStore$$module$libs$y_webrtc_min=a=>{const e=createDeleteSet$$module$libs$y_webrtc_min();return a.clients.forEach((n,
t)=>{const z=[];for(let F=0;F<n.length;F++){var D=n[F];if(D.deleted){const J=D.id.clock;D=D.length;if(F+1<n.length)for(let G=n[F+1];F+1<n.length&&G.deleted;G=n[1+ ++F])D+=G.length;z.push(new DeleteItem$$module$libs$y_webrtc_min(J,D))}}0<z.length&&e.clients.set(t,z)}),e},writeDeleteSet$$module$libs$y_webrtc_min=(a,e)=>{writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,e.clients.size);from$$module$libs$y_webrtc_min(e.clients.entries()).sort((n,t)=>t[0]-n[0]).forEach(([n,t])=>{a.resetDsCurVal();writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,
n);n=t.length;writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,n);for(let z=0;z<n;z++){const D=t[z];a.writeDsClock(D.clock);a.writeDsLen(D.len)}})},readDeleteSet$$module$libs$y_webrtc_min=a=>{const e=new DeleteSet$$module$libs$y_webrtc_min,n=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);for(let z=0;z<n;z++){a.resetDsCurVal();var t=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);const D=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);if(0<D){t=setIfUndefined$$module$libs$y_webrtc_min(e.clients,
t,()=>[]);for(let F=0;F<D;F++)t.push(new DeleteItem$$module$libs$y_webrtc_min(a.readDsClock(),a.readDsLen()))}}return e},readAndApplyDeleteSet$$module$libs$y_webrtc_min=(a,e,n)=>{const t=new DeleteSet$$module$libs$y_webrtc_min,z=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);for(let D=0;D<z;D++){a.resetDsCurVal();const F=readVarUint$$module$libs$y_webrtc_min(a.restDecoder),J=readVarUint$$module$libs$y_webrtc_min(a.restDecoder),G=n.clients.get(F)||[],K=getState$$module$libs$y_webrtc_min(n,F);
for(let I=0;I<J;I++){const L=a.readDsClock(),Q=L+a.readDsLen();if(L<K){K<Q&&addToDeleteSet$$module$libs$y_webrtc_min(t,F,K,Q-K);let M=findIndexSS$$module$libs$y_webrtc_min(G,L),U=G[M];for(!U.deleted&&U.id.clock<L&&(G.splice(M+1,0,splitItem$$module$libs$y_webrtc_min(e,U,L-U.id.clock)),M++);M<G.length&&(U=G[M++],U.id.clock<Q);)U.deleted||(Q<U.id.clock+U.length&&G.splice(M,0,splitItem$$module$libs$y_webrtc_min(e,U,Q-U.id.clock)),U.delete(e))}else addToDeleteSet$$module$libs$y_webrtc_min(t,F,L,Q-L)}}return 0<
t.clients.size?(a=new UpdateEncoderV2$$module$libs$y_webrtc_min,writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,0),writeDeleteSet$$module$libs$y_webrtc_min(a,t),a.toUint8Array()):null},generateNewClientId$$module$libs$y_webrtc_min=uint32$$module$libs$y_webrtc_min;
class Doc$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor({guid:a=uuidv4$$module$libs$y_webrtc_min(),collectionid:e=null,gc:n=!0,gcFilter:t=()=>!0,meta:z=null,autoLoad:D=!1,shouldLoad:F=!0}={}){super();this.gc=n;this.gcFilter=t;this.clientID=uint32$$module$libs$y_webrtc_min();this.guid=a;this.collectionid=e;this.share=new Map;this.store=new StructStore$$module$libs$y_webrtc_min;this._transaction=null;this._transactionCleanups=[];this.subdocs=new Set;this._item=null;
this.shouldLoad=F;this.autoLoad=D;this.meta=z;this.isSynced=this.isLoaded=!1;this.whenLoaded=create$5$$module$libs$y_webrtc_min(G=>{this.on("load",()=>{this.isLoaded=!0;G(this)})});const J=()=>create$5$$module$libs$y_webrtc_min(G=>{const K=I=>{void 0!==I&&!0!==I||(this.off("sync",K),G())};this.on("sync",K)});this.on("sync",G=>{!1===G&&this.isSynced&&(this.whenSynced=J());this.isSynced=void 0===G||!0===G;this.isLoaded||this.emit("load",[])});this.whenSynced=J()}load(){const a=this._item;null===a||
this.shouldLoad||transact$$module$libs$y_webrtc_min(a.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0);this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(from$$module$libs$y_webrtc_min(this.subdocs).map(a=>a.guid))}transact(a,e=null){return transact$$module$libs$y_webrtc_min(this,a,e)}get(a,e=AbstractType$$module$libs$y_webrtc_min){const n=setIfUndefined$$module$libs$y_webrtc_min(this.share,a,()=>{const z=new e;return z._integrate(this,null),z});var t=n.constructor;
if(e!==AbstractType$$module$libs$y_webrtc_min&&t!==e){if(t===AbstractType$$module$libs$y_webrtc_min){const z=new e;z._map=n._map;n._map.forEach(D=>{for(;null!==D;D=D.left)D.parent=z});z._start=n._start;for(t=z._start;null!==t;t=t.right)t.parent=z;return z._length=n._length,this.share.set(a,z),z._integrate(this,null),z}throw Error(`Type with the name ${a} has already been defined with a different constructor`);}return n}getArray(a=""){return this.get(a,YArray$$module$libs$y_webrtc_min)}getText(a=""){return this.get(a,
YText$$module$libs$y_webrtc_min)}getMap(a=""){return this.get(a,YMap$$module$libs$y_webrtc_min)}getXmlFragment(a=""){return this.get(a,YXmlFragment$$module$libs$y_webrtc_min)}toJSON(){const a={};return this.share.forEach((e,n)=>{a[n]=e.toJSON()}),a}destroy(){from$$module$libs$y_webrtc_min(this.subdocs).forEach(e=>e.destroy());const a=this._item;if(null!==a){this._item=null;const e=a.content;e.doc=new Doc$$module$libs$y_webrtc_min({guid:this.guid,...e.opts,shouldLoad:!1});e.doc._item=a;transact$$module$libs$y_webrtc_min(a.parent.doc,
n=>{const t=e.doc;a.deleted||n.subdocsAdded.add(t);n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]);this.emit("destroy",[this]);super.destroy()}on(a,e){super.on(a,e)}off(a,e){super.off(a,e)}}class DSDecoderV1$$module$libs$y_webrtc_min{constructor(a){this.restDecoder=a}resetDsCurVal(){}readDsClock(){return readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}readDsLen(){return readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}}
class UpdateDecoderV1$$module$libs$y_webrtc_min extends DSDecoderV1$$module$libs$y_webrtc_min{readLeftID(){return createID$$module$libs$y_webrtc_min(readVarUint$$module$libs$y_webrtc_min(this.restDecoder),readVarUint$$module$libs$y_webrtc_min(this.restDecoder))}readRightID(){return createID$$module$libs$y_webrtc_min(readVarUint$$module$libs$y_webrtc_min(this.restDecoder),readVarUint$$module$libs$y_webrtc_min(this.restDecoder))}readClient(){return readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}readInfo(){return readUint8$$module$libs$y_webrtc_min(this.restDecoder)}readString(){return readVarString$$module$libs$y_webrtc_min(this.restDecoder)}readParentInfo(){return 1===
readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}readTypeRef(){return readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}readLen(){return readVarUint$$module$libs$y_webrtc_min(this.restDecoder)}readAny(){return readAny$$module$libs$y_webrtc_min(this.restDecoder)}readBuf(){var a=readVarUint8Array$$module$libs$y_webrtc_min(this.restDecoder);const e=createUint8ArrayFromLen$$module$libs$y_webrtc_min(a.byteLength);return e.set(a),e}readJSON(){return JSON.parse(readVarString$$module$libs$y_webrtc_min(this.restDecoder))}readKey(){return readVarString$$module$libs$y_webrtc_min(this.restDecoder)}}
class DSDecoderV2$$module$libs$y_webrtc_min{constructor(a){this.dsCurrVal=0;this.restDecoder=a}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=readVarUint$$module$libs$y_webrtc_min(this.restDecoder),this.dsCurrVal}readDsLen(){const a=readVarUint$$module$libs$y_webrtc_min(this.restDecoder)+1;return this.dsCurrVal+=a,a}}
class UpdateDecoderV2$$module$libs$y_webrtc_min extends DSDecoderV2$$module$libs$y_webrtc_min{constructor(a){super(a);this.keys=[];readVarUint$$module$libs$y_webrtc_min(a);this.keyClockDecoder=new IntDiffOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));this.clientDecoder=new UintOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));this.leftClockDecoder=new IntDiffOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));
this.rightClockDecoder=new IntDiffOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));this.infoDecoder=new RleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a),readUint8$$module$libs$y_webrtc_min);this.stringDecoder=new StringDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));this.parentInfoDecoder=new RleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a),readUint8$$module$libs$y_webrtc_min);
this.typeRefDecoder=new UintOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a));this.lenDecoder=new UintOptRleDecoder$$module$libs$y_webrtc_min(readVarUint8Array$$module$libs$y_webrtc_min(a))}readLeftID(){return new ID$$module$libs$y_webrtc_min(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ID$$module$libs$y_webrtc_min(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===
this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return readAny$$module$libs$y_webrtc_min(this.restDecoder)}readBuf(){return readVarUint8Array$$module$libs$y_webrtc_min(this.restDecoder)}readJSON(){return readAny$$module$libs$y_webrtc_min(this.restDecoder)}readKey(){var a=this.keyClockDecoder.read();if(a<this.keys.length)return this.keys[a];a=this.stringDecoder.read();return this.keys.push(a),a}}
class DSEncoderV1$$module$libs$y_webrtc_min{constructor(){this.restEncoder=createEncoder$$module$libs$y_webrtc_min()}toUint8Array(){return toUint8Array$$module$libs$y_webrtc_min(this.restEncoder)}resetDsCurVal(){}writeDsClock(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a)}writeDsLen(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a)}}
class UpdateEncoderV1$$module$libs$y_webrtc_min extends DSEncoderV1$$module$libs$y_webrtc_min{writeLeftID(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a.client);writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a.clock)}writeRightID(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a.client);writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a.clock)}writeClient(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a)}writeInfo(a){write$$module$libs$y_webrtc_min(this.restEncoder,
a)}writeString(a){writeVarString$$module$libs$y_webrtc_min(this.restEncoder,a)}writeParentInfo(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a?1:0)}writeTypeRef(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a)}writeLen(a){writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a)}writeAny(a){writeAny$$module$libs$y_webrtc_min(this.restEncoder,a)}writeBuf(a){writeVarUint8Array$$module$libs$y_webrtc_min(this.restEncoder,a)}writeJSON(a){writeVarString$$module$libs$y_webrtc_min(this.restEncoder,
JSON.stringify(a))}writeKey(a){writeVarString$$module$libs$y_webrtc_min(this.restEncoder,a)}}
class DSEncoderV2$$module$libs$y_webrtc_min{constructor(){this.restEncoder=createEncoder$$module$libs$y_webrtc_min();this.dsCurrVal=0}toUint8Array(){return toUint8Array$$module$libs$y_webrtc_min(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(a){const e=a-this.dsCurrVal;this.dsCurrVal=a;writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,e)}writeDsLen(a){0===a&&unexpectedCase$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(this.restEncoder,a-1);this.dsCurrVal+=
a}}
class UpdateEncoderV2$$module$libs$y_webrtc_min extends DSEncoderV2$$module$libs$y_webrtc_min{constructor(){super();this.keyMap=new Map;this.keyClock=0;this.keyClockEncoder=new IntDiffOptRleEncoder$$module$libs$y_webrtc_min;this.clientEncoder=new UintOptRleEncoder$$module$libs$y_webrtc_min;this.leftClockEncoder=new IntDiffOptRleEncoder$$module$libs$y_webrtc_min;this.rightClockEncoder=new IntDiffOptRleEncoder$$module$libs$y_webrtc_min;this.infoEncoder=new RleEncoder$$module$libs$y_webrtc_min(write$$module$libs$y_webrtc_min);this.stringEncoder=
new StringEncoder$$module$libs$y_webrtc_min;this.parentInfoEncoder=new RleEncoder$$module$libs$y_webrtc_min(write$$module$libs$y_webrtc_min);this.typeRefEncoder=new UintOptRleEncoder$$module$libs$y_webrtc_min;this.lenEncoder=new UintOptRleEncoder$$module$libs$y_webrtc_min}toUint8Array(){const a=createEncoder$$module$libs$y_webrtc_min();return writeVarUint$$module$libs$y_webrtc_min(a,0),writeVarUint8Array$$module$libs$y_webrtc_min(a,this.keyClockEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,
this.clientEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,this.leftClockEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,this.rightClockEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,toUint8Array$$module$libs$y_webrtc_min(this.infoEncoder)),writeVarUint8Array$$module$libs$y_webrtc_min(a,this.stringEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,toUint8Array$$module$libs$y_webrtc_min(this.parentInfoEncoder)),
writeVarUint8Array$$module$libs$y_webrtc_min(a,this.typeRefEncoder.toUint8Array()),writeVarUint8Array$$module$libs$y_webrtc_min(a,this.lenEncoder.toUint8Array()),writeUint8Array$$module$libs$y_webrtc_min(a,toUint8Array$$module$libs$y_webrtc_min(this.restEncoder)),toUint8Array$$module$libs$y_webrtc_min(a)}writeLeftID(a){this.clientEncoder.write(a.client);this.leftClockEncoder.write(a.clock)}writeRightID(a){this.clientEncoder.write(a.client);this.rightClockEncoder.write(a.clock)}writeClient(a){this.clientEncoder.write(a)}writeInfo(a){this.infoEncoder.write(a)}writeString(a){this.stringEncoder.write(a)}writeParentInfo(a){this.parentInfoEncoder.write(a?
1:0)}writeTypeRef(a){this.typeRefEncoder.write(a)}writeLen(a){this.lenEncoder.write(a)}writeAny(a){writeAny$$module$libs$y_webrtc_min(this.restEncoder,a)}writeBuf(a){writeVarUint8Array$$module$libs$y_webrtc_min(this.restEncoder,a)}writeJSON(a){writeAny$$module$libs$y_webrtc_min(this.restEncoder,a)}writeKey(a){const e=this.keyMap.get(a);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(a)):this.keyClockEncoder.write(e)}}
const writeClientsStructs$$module$libs$y_webrtc_min=(a,e,n)=>{const t=new Map;n.forEach((z,D)=>{getState$$module$libs$y_webrtc_min(e,D)>z&&t.set(D,z)});getStateVector$$module$libs$y_webrtc_min(e).forEach((z,D)=>{n.has(D)||t.set(D,0)});writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,t.size);from$$module$libs$y_webrtc_min(t.entries()).sort((z,D)=>D[0]-z[0]).forEach(([z,D])=>{var F=e.clients.get(z);D=max$$module$libs$y_webrtc_min(D,F[0].id.clock);const J=findIndexSS$$module$libs$y_webrtc_min(F,
D);writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,F.length-J);a.writeClient(z);writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,D);z=F[J];z.write(a,D-z.id.clock);for(z=J+1;z<F.length;z++)F[z].write(a,0)})},readUpdateV2$$module$libs$y_webrtc_min=(a,e,n,t=new UpdateDecoderV2$$module$libs$y_webrtc_min(a))=>transact$$module$libs$y_webrtc_min(e,z=>{var D=z.local=!1,F=z.doc;const J=F.store;F=((K,I,L)=>{const Q=[];let M=from$$module$libs$y_webrtc_min(L.keys()).sort((la,ta)=>la-ta);if(0===M.length)return null;
const U=()=>{if(0===M.length)return null;let la=L.get(M[M.length-1]);for(;la.refs.length===la.i;){if(M.pop(),!(0<M.length))return null;la=L.get(M[M.length-1])}return la};let Z=U();if(null===Z&&0===Q.length)return null;const da=new StructStore$$module$libs$y_webrtc_min,R=new Map,ba=(la,ta)=>{const wa=R.get(la);(null==wa||wa>ta)&&R.set(la,ta)};let ha=Z.refs[Z.i++];const ma=new Map,ka=()=>{for(const la of Q){const ta=la.id.client,wa=L.get(ta);wa?(wa.i--,da.clients.set(ta,wa.refs.slice(wa.i)),L.delete(ta),
wa.i=0,wa.refs=[]):da.clients.set(ta,[la]);M=M.filter(za=>za!==ta)}Q.length=0};for(;;){if(ha.constructor!==Skip$$module$libs$y_webrtc_min){var pa=setIfUndefined$$module$libs$y_webrtc_min(ma,ha.id.client,()=>getState$$module$libs$y_webrtc_min(I,ha.id.client))-ha.id.clock;if(0>pa)Q.push(ha),ba(ha.id.client,ha.id.clock-1),ka();else{const la=ha.getMissing(K,I);if(null!==la){Q.push(ha);pa=L.get(la)||{refs:[],i:0};if(pa.refs.length!==pa.i){ha=pa.refs[pa.i++];continue}ba(la,getState$$module$libs$y_webrtc_min(I,
la));ka()}else(0===pa||pa<ha.length)&&(ha.integrate(K,pa),ma.set(ha.id.client,ha.id.clock+ha.length))}}if(0<Q.length)ha=Q.pop();else{if(!(null!==Z&&Z.i<Z.refs.length)&&(Z=U(),null===Z))break;ha=Z.refs[Z.i++]}}return 0<da.clients.size?(K=new UpdateEncoderV2$$module$libs$y_webrtc_min,writeClientsStructs$$module$libs$y_webrtc_min(K,da,new Map),writeVarUint$$module$libs$y_webrtc_min(K.restEncoder,0),{missing:R,update:K.toUint8Array()}):null})(z,J,((K,I)=>{const L=create$$module$libs$y_webrtc_min(),Q=
readVarUint$$module$libs$y_webrtc_min(K.restDecoder);for(let U=0;U<Q;U++){const Z=readVarUint$$module$libs$y_webrtc_min(K.restDecoder),da=Array(Z),R=K.readClient();let ba=readVarUint$$module$libs$y_webrtc_min(K.restDecoder);L.set(R,{i:0,refs:da});for(let ha=0;ha<Z;ha++){var M=K.readInfo();switch(31&M){case 0:M=K.readLen();da[ha]=new GC$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(R,ba),M);ba+=M;break;case 10:M=readVarUint$$module$libs$y_webrtc_min(K.restDecoder);da[ha]=new Skip$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(R,
ba),M);ba+=M;break;default:const ma=0==(192&M);M=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(R,ba),null,128==(128&M)?K.readLeftID():null,null,64==(64&M)?K.readRightID():null,ma?K.readParentInfo()?I.get(K.readString()):K.readLeftID():null,ma&&32==(32&M)?K.readString():null,readItemContent$$module$libs$y_webrtc_min(K,M));da[ha]=M;ba+=M.length}}}return L})(t,F));var G=J.pendingStructs;if(G){for(const [K,I]of G.missing)if(I<getState$$module$libs$y_webrtc_min(J,K)){D=!0;break}if(F){for(const [K,
I]of F.missing){const L=G.missing.get(K);(null==L||L>I)&&G.missing.set(K,I)}G.update=mergeUpdatesV2$$module$libs$y_webrtc_min([G.update,F.update])}}else J.pendingStructs=F;F=readAndApplyDeleteSet$$module$libs$y_webrtc_min(t,z,J);J.pendingDs?(G=new UpdateDecoderV2$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(J.pendingDs)),readVarUint$$module$libs$y_webrtc_min(G.restDecoder),G=readAndApplyDeleteSet$$module$libs$y_webrtc_min(G,z,J),J.pendingDs=F&&G?mergeUpdatesV2$$module$libs$y_webrtc_min([F,
G]):F||G):J.pendingDs=F;D&&(D=J.pendingStructs.update,J.pendingStructs=null,applyUpdateV2$$module$libs$y_webrtc_min(z.doc,D))},n,!1),readUpdate$$module$libs$y_webrtc_min=(a,e,n)=>readUpdateV2$$module$libs$y_webrtc_min(a,e,n,new UpdateDecoderV1$$module$libs$y_webrtc_min(a)),applyUpdateV2$$module$libs$y_webrtc_min=(a,e,n,t=UpdateDecoderV2$$module$libs$y_webrtc_min)=>{e=createDecoder$$module$libs$y_webrtc_min(e);readUpdateV2$$module$libs$y_webrtc_min(e,a,n,new t(e))},applyUpdate$$module$libs$y_webrtc_min=
(a,e,n)=>applyUpdateV2$$module$libs$y_webrtc_min(a,e,n,UpdateDecoderV1$$module$libs$y_webrtc_min),encodeStateAsUpdateV2$$module$libs$y_webrtc_min=(a,e=new Uint8Array([0]),n=new UpdateEncoderV2$$module$libs$y_webrtc_min)=>{((z,D,F=new Map)=>{writeClientsStructs$$module$libs$y_webrtc_min(z,D.store,F);writeDeleteSet$$module$libs$y_webrtc_min(z,createDeleteSetFromStructStore$$module$libs$y_webrtc_min(D.store))})(n,a,decodeStateVector$$module$libs$y_webrtc_min(e));const t=[n.toUint8Array()];if(a.store.pendingDs&&
t.push(a.store.pendingDs),a.store.pendingStructs&&t.push(diffUpdateV2$$module$libs$y_webrtc_min(a.store.pendingStructs.update,e)),1<t.length){if(n.constructor===UpdateEncoderV1$$module$libs$y_webrtc_min)return mergeUpdates$$module$libs$y_webrtc_min(t.map((z,D)=>0===D?z:convertUpdateFormatV2ToV1$$module$libs$y_webrtc_min(z)));if(n.constructor===UpdateEncoderV2$$module$libs$y_webrtc_min)return mergeUpdatesV2$$module$libs$y_webrtc_min(t)}return t[0]},encodeStateAsUpdate$$module$libs$y_webrtc_min=(a,
e)=>encodeStateAsUpdateV2$$module$libs$y_webrtc_min(a,e,new UpdateEncoderV1$$module$libs$y_webrtc_min),readStateVector$$module$libs$y_webrtc_min=a=>{const e=new Map,n=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);for(let t=0;t<n;t++){const z=readVarUint$$module$libs$y_webrtc_min(a.restDecoder),D=readVarUint$$module$libs$y_webrtc_min(a.restDecoder);e.set(z,D)}return e},decodeStateVector$$module$libs$y_webrtc_min=a=>readStateVector$$module$libs$y_webrtc_min(new DSDecoderV1$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(a))),
writeStateVector$$module$libs$y_webrtc_min=(a,e)=>(writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,e.size),from$$module$libs$y_webrtc_min(e.entries()).sort((n,t)=>t[0]-n[0]).forEach(([n,t])=>{writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,n);writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,t)}),a),encodeStateVectorV2$$module$libs$y_webrtc_min=(a,e=new DSEncoderV2$$module$libs$y_webrtc_min)=>{a instanceof Map?writeStateVector$$module$libs$y_webrtc_min(e,a):writeStateVector$$module$libs$y_webrtc_min(e,
getStateVector$$module$libs$y_webrtc_min(a.store));return e.toUint8Array()},encodeStateVector$$module$libs$y_webrtc_min=a=>encodeStateVectorV2$$module$libs$y_webrtc_min(a,new DSEncoderV1$$module$libs$y_webrtc_min);class EventHandler$$module$libs$y_webrtc_min{constructor(){this.l=[]}}
const createEventHandler$$module$libs$y_webrtc_min=()=>new EventHandler$$module$libs$y_webrtc_min,addEventHandlerListener$$module$libs$y_webrtc_min=(a,e)=>a.l.push(e),removeEventHandlerListener$$module$libs$y_webrtc_min=(a,e)=>{const n=a.l,t=n.length;a.l=n.filter(z=>e!==z);t===a.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},callEventHandlerListeners$$module$libs$y_webrtc_min=(a,e,n)=>callAll$$module$libs$y_webrtc_min(a.l,[e,n]);
class ID$$module$libs$y_webrtc_min{constructor(a,e){this.client=a;this.clock=e}}
const compareIDs$$module$libs$y_webrtc_min=(a,e)=>a===e||null!==a&&null!==e&&a.client===e.client&&a.clock===e.clock,createID$$module$libs$y_webrtc_min=(a,e)=>new ID$$module$libs$y_webrtc_min(a,e),writeID$$module$libs$y_webrtc_min=(a,e)=>{writeVarUint$$module$libs$y_webrtc_min(a,e.client);writeVarUint$$module$libs$y_webrtc_min(a,e.clock)},readID$$module$libs$y_webrtc_min=a=>createID$$module$libs$y_webrtc_min(readVarUint$$module$libs$y_webrtc_min(a),readVarUint$$module$libs$y_webrtc_min(a)),findRootTypeKey$$module$libs$y_webrtc_min=
a=>{for(const [e,n]of a.doc.share.entries())if(n===a)return e;throw unexpectedCase$$module$libs$y_webrtc_min();},isParentOf$$module$libs$y_webrtc_min=(a,e)=>{for(;null!==e;){if(e.parent===a)return!0;e=e.parent._item}return!1},logType$$module$libs$y_webrtc_min=a=>{const e=[];for(a=a._start;a;)e.push(a),a=a.right;console.log("Children: ",e);console.log("Children content: ",e.filter(n=>!n.deleted).map(n=>n.content))};
class PermanentUserData$$module$libs$y_webrtc_min{constructor(a,e=a.getMap("users")){const n=new Map;this.yusers=e;this.doc=a;this.clients=new Map;this.dss=n;const t=(z,D)=>{const F=z.get("ds");z=z.get("ids");const J=G=>this.clients.set(G,D);F.observe(G=>{G.changes.added.forEach(K=>{K.content.getContent().forEach(I=>{I instanceof Uint8Array&&this.dss.set(D,mergeDeleteSets$$module$libs$y_webrtc_min([this.dss.get(D)||createDeleteSet$$module$libs$y_webrtc_min(),readDeleteSet$$module$libs$y_webrtc_min(new DSDecoderV1$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(I)))]))})})});
this.dss.set(D,mergeDeleteSets$$module$libs$y_webrtc_min(F.map(G=>readDeleteSet$$module$libs$y_webrtc_min(new DSDecoderV1$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(G))))));z.observe(G=>G.changes.added.forEach(K=>K.content.getContent().forEach(J)));z.forEach(J)};e.observe(z=>{z.keysChanged.forEach(D=>t(e.get(D),D))});e.forEach(t)}setUserMapping(a,e,n,{filter:t=()=>!0}={}){const z=this.yusers;let D=z.get(n);D||(D=new YMap$$module$libs$y_webrtc_min,D.set("ids",new YArray$$module$libs$y_webrtc_min),
D.set("ds",new YArray$$module$libs$y_webrtc_min),z.set(n,D));D.get("ids").push([e]);z.observe(F=>{setTimeout(()=>{var J=z.get(n);if(J!==D){D=J;this.clients.forEach((K,I)=>{n===K&&D.get("ids").push([I])});J=new DSEncoderV1$$module$libs$y_webrtc_min;const G=this.dss.get(n);G&&(writeDeleteSet$$module$libs$y_webrtc_min(J,G),D.get("ds").push([J.toUint8Array()]))}},0)});a.on("afterTransaction",F=>{setTimeout(()=>{const J=D.get("ds"),G=F.deleteSet;if(F.local&&0<G.clients.size&&t(F,G)){const K=new DSEncoderV1$$module$libs$y_webrtc_min;
writeDeleteSet$$module$libs$y_webrtc_min(K,G);J.push([K.toUint8Array()])}})})}getUserByClientId(a){return this.clients.get(a)||null}getUserByDeletedId(a){for(const [e,n]of this.dss.entries())if(isDeleted$$module$libs$y_webrtc_min(n,a))return e;return null}}class RelativePosition$$module$libs$y_webrtc_min{constructor(a,e,n,t=0){this.type=a;this.tname=e;this.item=n;this.assoc=t}}
const relativePositionToJSON$$module$libs$y_webrtc_min=a=>{const e={};return a.type&&(e.type=a.type),a.tname&&(e.tname=a.tname),a.item&&(e.item=a.item),null!=a.assoc&&(e.assoc=a.assoc),e},createRelativePositionFromJSON$$module$libs$y_webrtc_min=a=>new RelativePosition$$module$libs$y_webrtc_min(null==a.type?null:createID$$module$libs$y_webrtc_min(a.type.client,a.type.clock),a.tname||null,null==a.item?null:createID$$module$libs$y_webrtc_min(a.item.client,a.item.clock),null==a.assoc?0:a.assoc);
class AbsolutePosition$$module$libs$y_webrtc_min{constructor(a,e,n=0){this.type=a;this.index=e;this.assoc=n}}
const createRelativePosition$$module$libs$y_webrtc_min=(a,e,n)=>{let t=null,z=null;return null===a._item?z=findRootTypeKey$$module$libs$y_webrtc_min(a):t=createID$$module$libs$y_webrtc_min(a._item.id.client,a._item.id.clock),new RelativePosition$$module$libs$y_webrtc_min(t,z,e,n)},createRelativePositionFromTypeIndex$$module$libs$y_webrtc_min=(a,e,n=0)=>{let t=a._start;if(0>n){if(0===e)return createRelativePosition$$module$libs$y_webrtc_min(a,null,n);e--}for(;null!==t;){if(!t.deleted&&t.countable){if(t.length>
e)return createRelativePosition$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(t.id.client,t.id.clock+e),n);e-=t.length}if(null===t.right&&0>n)return createRelativePosition$$module$libs$y_webrtc_min(a,t.lastId,n);t=t.right}return createRelativePosition$$module$libs$y_webrtc_min(a,null,n)},encodeRelativePosition$$module$libs$y_webrtc_min=a=>{const e=createEncoder$$module$libs$y_webrtc_min(),{type:n,tname:t,item:z,assoc:D}=a;if(null!==z)writeVarUint$$module$libs$y_webrtc_min(e,0),writeID$$module$libs$y_webrtc_min(e,
z);else if(null!==t)write$$module$libs$y_webrtc_min(e,1),writeVarString$$module$libs$y_webrtc_min(e,t);else{if(null===n)throw unexpectedCase$$module$libs$y_webrtc_min();write$$module$libs$y_webrtc_min(e,2);writeID$$module$libs$y_webrtc_min(e,n)}writeVarInt$$module$libs$y_webrtc_min(e,D);return toUint8Array$$module$libs$y_webrtc_min(e)},decodeRelativePosition$$module$libs$y_webrtc_min=a=>{var e=createDecoder$$module$libs$y_webrtc_min(a);let n=a=null,t=null;switch(readVarUint$$module$libs$y_webrtc_min(e)){case 0:t=
readID$$module$libs$y_webrtc_min(e);break;case 1:n=readVarString$$module$libs$y_webrtc_min(e);break;case 2:a=readID$$module$libs$y_webrtc_min(e)}e=hasContent$$module$libs$y_webrtc_min(e)?readVarInt$$module$libs$y_webrtc_min(e):0;return new RelativePosition$$module$libs$y_webrtc_min(a,n,t,e)},createAbsolutePositionFromRelativePosition$$module$libs$y_webrtc_min=(a,e)=>{var n=e.store;const t=a.item,z=a.type,D=a.tname;var F=a.assoc,J=null;let G=0;if(null!==t){if(getState$$module$libs$y_webrtc_min(n,t.client)<=
t.clock)return null;e=followRedone$$module$libs$y_webrtc_min(n,t);n=e.item;if(!(n instanceof Item$$module$libs$y_webrtc_min))return null;if(J=n.parent,null===J._item||!J._item.deleted)for(G=n.deleted||!n.countable?0:e.diff+(0<=F?0:1),F=n.left;null!==F;)!F.deleted&&F.countable&&(G+=F.length),F=F.left}else{if(null!==D)J=e.get(D);else{if(null===z)throw unexpectedCase$$module$libs$y_webrtc_min();if(getState$$module$libs$y_webrtc_min(n,z.client)<=z.clock)return null;({item:J}=followRedone$$module$libs$y_webrtc_min(n,
z));if(!(J instanceof Item$$module$libs$y_webrtc_min&&J.content instanceof ContentType$$module$libs$y_webrtc_min))return null;J=J.content.type}G=0<=F?J._length:0}return((K,I,L=0)=>new AbsolutePosition$$module$libs$y_webrtc_min(K,I,L))(J,G,a.assoc)},compareRelativePositions$$module$libs$y_webrtc_min=(a,e)=>a===e||null!==a&&null!==e&&a.tname===e.tname&&compareIDs$$module$libs$y_webrtc_min(a.item,e.item)&&compareIDs$$module$libs$y_webrtc_min(a.type,e.type)&&a.assoc===e.assoc;
class Snapshot$$module$libs$y_webrtc_min{constructor(a,e){this.ds=a;this.sv=e}}
const equalSnapshots$$module$libs$y_webrtc_min=(a,e)=>{var n=a.ds.clients;const t=e.ds.clients;a=a.sv;e=e.sv;if(a.size!==e.size||n.size!==t.size)return!1;for(const [z,D]of a.entries())if(e.get(z)!==D)return!1;for(const [z,D]of n.entries()){n=t.get(z)||[];if(D.length!==n.length)return!1;for(e=0;e<D.length;e++){a=D[e];const F=n[e];if(a.clock!==F.clock||a.len!==F.len)return!1}}return!0},encodeSnapshotV2$$module$libs$y_webrtc_min=(a,e=new DSEncoderV2$$module$libs$y_webrtc_min)=>(writeDeleteSet$$module$libs$y_webrtc_min(e,
a.ds),writeStateVector$$module$libs$y_webrtc_min(e,a.sv),e.toUint8Array()),encodeSnapshot$$module$libs$y_webrtc_min=a=>encodeSnapshotV2$$module$libs$y_webrtc_min(a,new DSEncoderV1$$module$libs$y_webrtc_min),decodeSnapshotV2$$module$libs$y_webrtc_min=(a,e=new DSDecoderV2$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(a)))=>new Snapshot$$module$libs$y_webrtc_min(readDeleteSet$$module$libs$y_webrtc_min(e),readStateVector$$module$libs$y_webrtc_min(e)),decodeSnapshot$$module$libs$y_webrtc_min=
a=>decodeSnapshotV2$$module$libs$y_webrtc_min(a,new DSDecoderV1$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(a))),createSnapshot$$module$libs$y_webrtc_min=(a,e)=>new Snapshot$$module$libs$y_webrtc_min(a,e),emptySnapshot$$module$libs$y_webrtc_min=createSnapshot$$module$libs$y_webrtc_min(createDeleteSet$$module$libs$y_webrtc_min(),new Map),snapshot$$module$libs$y_webrtc_min=a=>createSnapshot$$module$libs$y_webrtc_min(createDeleteSetFromStructStore$$module$libs$y_webrtc_min(a.store),
getStateVector$$module$libs$y_webrtc_min(a.store)),isVisible$$module$libs$y_webrtc_min=(a,e)=>void 0===e?!a.deleted:e.sv.has(a.id.client)&&(e.sv.get(a.id.client)||0)>a.id.clock&&!isDeleted$$module$libs$y_webrtc_min(e.ds,a.id),splitSnapshotAffectedStructs$$module$libs$y_webrtc_min=(a,e)=>{const n=setIfUndefined$$module$libs$y_webrtc_min(a.meta,splitSnapshotAffectedStructs$$module$libs$y_webrtc_min,create$1$$module$libs$y_webrtc_min),t=a.doc.store;n.has(e)||(e.sv.forEach((z,D)=>{z<getState$$module$libs$y_webrtc_min(t,
D)&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(D,z))}),iterateDeletedStructs$$module$libs$y_webrtc_min(a,e.ds,z=>{}),n.add(e))},createDocFromSnapshot$$module$libs$y_webrtc_min=(a,e,n=new Doc$$module$libs$y_webrtc_min)=>{if(a.gc)throw Error("Garbage-collection must be disabled in `originDoc`!");const {sv:t,ds:z}=e,D=new UpdateEncoderV2$$module$libs$y_webrtc_min;return a.transact(F=>{let J=0;t.forEach(G=>{0<G&&J++});writeVarUint$$module$libs$y_webrtc_min(D.restEncoder,
J);for(const [G,K]of t){if(0===K)continue;K<getState$$module$libs$y_webrtc_min(a.store,G)&&getItemCleanStart$$module$libs$y_webrtc_min(F,createID$$module$libs$y_webrtc_min(G,K));const I=a.store.clients.get(G)||[],L=findIndexSS$$module$libs$y_webrtc_min(I,K-1);writeVarUint$$module$libs$y_webrtc_min(D.restEncoder,L+1);D.writeClient(G);writeVarUint$$module$libs$y_webrtc_min(D.restEncoder,0);for(let Q=0;Q<=L;Q++)I[Q].write(D,0)}writeDeleteSet$$module$libs$y_webrtc_min(D,z)}),applyUpdateV2$$module$libs$y_webrtc_min(n,
D.toUint8Array(),"snapshot"),n};class StructStore$$module$libs$y_webrtc_min{constructor(){this.clients=new Map;this.pendingDs=this.pendingStructs=null}}
const getStateVector$$module$libs$y_webrtc_min=a=>{const e=new Map;return a.clients.forEach((n,t)=>{n=n[n.length-1];e.set(t,n.id.clock+n.length)}),e},getState$$module$libs$y_webrtc_min=(a,e)=>{a=a.clients.get(e);if(void 0===a)return 0;a=a[a.length-1];return a.id.clock+a.length},addStruct$$module$libs$y_webrtc_min=(a,e)=>{let n=a.clients.get(e.id.client);if(void 0===n)n=[],a.clients.set(e.id.client,n);else if(a=n[n.length-1],a.id.clock+a.length!==e.id.clock)throw unexpectedCase$$module$libs$y_webrtc_min();
n.push(e)},findIndexSS$$module$libs$y_webrtc_min=(a,e)=>{let n=0,t=a.length-1,z=a[t],D=z.id.clock;if(D===e)return t;let F=floor$$module$libs$y_webrtc_min(e/(D+z.length-1)*t);for(;n<=t;){if(z=a[F],D=z.id.clock,D<=e){if(e<D+z.length)return F;n=F+1}else t=F-1;F=floor$$module$libs$y_webrtc_min((n+t)/2)}throw unexpectedCase$$module$libs$y_webrtc_min();},getItem$$module$libs$y_webrtc_min=(a,e)=>{a=a.clients.get(e.client);return a[findIndexSS$$module$libs$y_webrtc_min(a,e.clock)]},findIndexCleanStart$$module$libs$y_webrtc_min=
(a,e,n)=>{const t=findIndexSS$$module$libs$y_webrtc_min(e,n),z=e[t];return z.id.clock<n&&z instanceof Item$$module$libs$y_webrtc_min?(e.splice(t+1,0,splitItem$$module$libs$y_webrtc_min(a,z,n-z.id.clock)),t+1):t},getItemCleanStart$$module$libs$y_webrtc_min=(a,e)=>{const n=a.doc.store.clients.get(e.client);return n[findIndexCleanStart$$module$libs$y_webrtc_min(a,n,e.clock)]},getItemCleanEnd$$module$libs$y_webrtc_min=(a,e,n)=>{e=e.clients.get(n.client);const t=findIndexSS$$module$libs$y_webrtc_min(e,
n.clock),z=e[t];return n.clock!==z.id.clock+z.length-1&&z.constructor!==GC$$module$libs$y_webrtc_min&&e.splice(t+1,0,splitItem$$module$libs$y_webrtc_min(a,z,n.clock-z.id.clock+1)),z},iterateStructs$$module$libs$y_webrtc_min=(a,e,n,t,z)=>{if(0!==t){t=n+t;var D=findIndexCleanStart$$module$libs$y_webrtc_min(a,e,n);do n=e[D++],t<n.id.clock+n.length&&findIndexCleanStart$$module$libs$y_webrtc_min(a,e,t),z(n);while(D<e.length&&e[D].id.clock<t)}};
class Transaction$$module$libs$y_webrtc_min{constructor(a,e,n){this.doc=a;this.deleteSet=new DeleteSet$$module$libs$y_webrtc_min;this.beforeState=getStateVector$$module$libs$y_webrtc_min(a.store);this.afterState=new Map;this.changed=new Map;this.changedParentTypes=new Map;this._mergeStructs=[];this.origin=e;this.meta=new Map;this.local=n;this.subdocsAdded=new Set;this.subdocsRemoved=new Set;this.subdocsLoaded=new Set}}
const writeUpdateMessageFromTransaction$$module$libs$y_webrtc_min=(a,e)=>{var n;if(n=!(0===e.deleteSet.clients.size&&!((t,z)=>{for(const [D,F]of t)if(z(F,D))return!0;return!1})(e.afterState,(t,z)=>e.beforeState.get(z)!==t)))sortAndMergeDeleteSet$$module$libs$y_webrtc_min(e.deleteSet),writeClientsStructs$$module$libs$y_webrtc_min(a,e.doc.store,e.beforeState),n=(writeDeleteSet$$module$libs$y_webrtc_min(a,e.deleteSet),!0);return n},addChangedTypeToTransaction$$module$libs$y_webrtc_min=(a,e,n)=>{const t=
e._item;(null===t||t.id.clock<(a.beforeState.get(t.id.client)||0)&&!t.deleted)&&setIfUndefined$$module$libs$y_webrtc_min(a.changed,e,create$1$$module$libs$y_webrtc_min).add(n)},tryToMergeWithLeft$$module$libs$y_webrtc_min=(a,e)=>{const n=a[e-1],t=a[e];n.deleted===t.deleted&&n.constructor===t.constructor&&n.mergeWith(t)&&(a.splice(e,1),t instanceof Item$$module$libs$y_webrtc_min&&null!==t.parentSub&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,n))},tryGcDeleteSet$$module$libs$y_webrtc_min=
(a,e,n)=>{for(const [t,z]of a.clients.entries()){a=e.clients.get(t);for(let D=z.length-1;0<=D;D--){const F=z[D],J=F.clock+F.len;for(let G=findIndexSS$$module$libs$y_webrtc_min(a,F.clock),K=a[G];G<a.length&&K.id.clock<J;K=a[++G]){const I=a[G];if(F.clock+F.len<=I.id.clock)break;I instanceof Item$$module$libs$y_webrtc_min&&I.deleted&&!I.keep&&n(I)&&I.gc(e,!1)}}}},tryMergeDeleteSet$$module$libs$y_webrtc_min=(a,e)=>{a.clients.forEach((n,t)=>{t=e.clients.get(t);for(let z=n.length-1;0<=z;z--){const D=n[z];
for(let F=min$$module$libs$y_webrtc_min(t.length-1,1+findIndexSS$$module$libs$y_webrtc_min(t,D.clock+D.len-1)),J=t[F];0<F&&J.id.clock>=D.clock;J=t[--F])tryToMergeWithLeft$$module$libs$y_webrtc_min(t,F)}})},tryGc$$module$libs$y_webrtc_min=(a,e,n)=>{tryGcDeleteSet$$module$libs$y_webrtc_min(a,e,n);tryMergeDeleteSet$$module$libs$y_webrtc_min(a,e)},cleanupTransactions$$module$libs$y_webrtc_min=(a,e)=>{if(e<a.length){const z=a[e],D=z.doc,F=D.store;var n=z.deleteSet,t=z._mergeStructs;try{sortAndMergeDeleteSet$$module$libs$y_webrtc_min(n);
z.afterState=getStateVector$$module$libs$y_webrtc_min(z.doc.store);D.emit("beforeObserverCalls",[z,D]);const J=[];z.changed.forEach((G,K)=>J.push(()=>{null!==K._item&&K._item.deleted||K._callObserver(z,G)}));J.push(()=>{z.changedParentTypes.forEach((G,K)=>J.push(()=>{null!==K._item&&K._item.deleted||((G=G.filter(I=>null===I.target._item||!I.target._item.deleted)).forEach(I=>{I.currentTarget=K}),G.sort((I,L)=>I.path.length-L.path.length),callEventHandlerListeners$$module$libs$y_webrtc_min(K._dEH,G,
z))}));J.push(()=>D.emit("afterTransaction",[z,D]))});callAll$$module$libs$y_webrtc_min(J,[])}finally{D.gc&&tryGcDeleteSet$$module$libs$y_webrtc_min(n,F,D.gcFilter);tryMergeDeleteSet$$module$libs$y_webrtc_min(n,F);z.afterState.forEach((I,L)=>{var Q=z.beforeState.get(L)||0;if(Q!==I)for(I=F.clients.get(L),Q=max$$module$libs$y_webrtc_min(findIndexSS$$module$libs$y_webrtc_min(I,Q),1),L=I.length-1;L>=Q;L--)tryToMergeWithLeft$$module$libs$y_webrtc_min(I,L)});for(n=0;n<t.length;n++){const {client:I,clock:L}=
t[n].id,Q=F.clients.get(I),M=findIndexSS$$module$libs$y_webrtc_min(Q,L);M+1<Q.length&&tryToMergeWithLeft$$module$libs$y_webrtc_min(Q,M+1);0<M&&tryToMergeWithLeft$$module$libs$y_webrtc_min(Q,M)}if(z.local||z.afterState.get(D.clientID)===z.beforeState.get(D.clientID)||(print$$module$libs$y_webrtc_min(ORANGE$$module$libs$y_webrtc_min,BOLD$$module$libs$y_webrtc_min,"[yjs] ",UNBOLD$$module$libs$y_webrtc_min,RED$$module$libs$y_webrtc_min,"Changed the client-id because another client seems to be using it."),
D.clientID=uint32$$module$libs$y_webrtc_min()),D.emit("afterTransactionCleanup",[z,D]),D._observers.has("update"))t=new UpdateEncoderV1$$module$libs$y_webrtc_min,writeUpdateMessageFromTransaction$$module$libs$y_webrtc_min(t,z)&&D.emit("update",[t.toUint8Array(),z.origin,D,z]);D._observers.has("updateV2")&&(t=new UpdateEncoderV2$$module$libs$y_webrtc_min,writeUpdateMessageFromTransaction$$module$libs$y_webrtc_min(t,z)&&D.emit("updateV2",[t.toUint8Array(),z.origin,D,z]));const {subdocsAdded:J,subdocsLoaded:G,
subdocsRemoved:K}=z;(0<J.size||0<K.size||0<G.size)&&(J.forEach(I=>{I.clientID=D.clientID;null==I.collectionid&&(I.collectionid=D.collectionid);D.subdocs.add(I)}),K.forEach(I=>D.subdocs.delete(I)),D.emit("subdocs",[{loaded:G,added:J,removed:K},D,z]),K.forEach(I=>I.destroy()));a.length<=e+1?(D._transactionCleanups=[],D.emit("afterAllTransactions",[D,a])):cleanupTransactions$$module$libs$y_webrtc_min(a,e+1)}}},transact$$module$libs$y_webrtc_min=(a,e,n=null,t=!0)=>{const z=a._transactionCleanups;let D=
!1,F=null;null===a._transaction&&(D=!0,a._transaction=new Transaction$$module$libs$y_webrtc_min(a,n,t),z.push(a._transaction),1===z.length&&a.emit("beforeAllTransactions",[a]),a.emit("beforeTransaction",[a._transaction,a]));try{F=e(a._transaction)}finally{D&&(e=a._transaction===z[0],a._transaction=null,e&&cleanupTransactions$$module$libs$y_webrtc_min(z,0))}return F};class StackItem$$module$libs$y_webrtc_min{constructor(a,e){this.insertions=e;this.deletions=a;this.meta=new Map}}
const clearUndoManagerStackItem$$module$libs$y_webrtc_min=(a,e,n)=>{iterateDeletedStructs$$module$libs$y_webrtc_min(a,n.deletions,t=>{t instanceof Item$$module$libs$y_webrtc_min&&e.scope.some(z=>isParentOf$$module$libs$y_webrtc_min(z,t))&&keepItem$$module$libs$y_webrtc_min(t,!1)})},popStackItem$$module$libs$y_webrtc_min=(a,e,n)=>{let t=null,z=null;const D=a.doc,F=a.scope;(transact$$module$libs$y_webrtc_min(D,J=>{for(;0<e.length&&null===t;){const G=D.store,K=e.pop(),I=new Set,L=[];let Q=!1;iterateDeletedStructs$$module$libs$y_webrtc_min(J,
K.insertions,M=>{if(M instanceof Item$$module$libs$y_webrtc_min){if(null!==M.redone){let {item:U,diff:Z}=followRedone$$module$libs$y_webrtc_min(G,M.id);0<Z&&(U=getItemCleanStart$$module$libs$y_webrtc_min(J,createID$$module$libs$y_webrtc_min(U.id.client,U.id.clock+Z)));M=U}!M.deleted&&F.some(U=>isParentOf$$module$libs$y_webrtc_min(U,M))&&L.push(M)}});iterateDeletedStructs$$module$libs$y_webrtc_min(J,K.deletions,M=>{M instanceof Item$$module$libs$y_webrtc_min&&F.some(U=>isParentOf$$module$libs$y_webrtc_min(U,
M))&&!isDeleted$$module$libs$y_webrtc_min(K.insertions,M.id)&&I.add(M)});I.forEach(M=>{Q=null!==redoItem$$module$libs$y_webrtc_min(J,M,I,K.insertions,a.ignoreRemoteMapChanges,a)||Q});for(let M=L.length-1;0<=M;M--){const U=L[M];a.deleteFilter(U)&&(U.delete(J),Q=!0)}t=Q?K:null}J.changed.forEach((G,K)=>{G.has(null)&&K._searchMarker&&(K._searchMarker.length=0)});z=J},a),null!=t)&&a.emit("stack-item-popped",[{stackItem:t,type:n,changedParentTypes:z.changedParentTypes},a]);return t};
class UndoManager$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor(a,{captureTimeout:e=500,captureTransaction:n=J=>!0,deleteFilter:t=()=>!0,trackedOrigins:z=new Set([null]),ignoreRemoteMapChanges:D=!1,doc:F=isArray$$module$libs$y_webrtc_min(a)?a[0].doc:a.doc}={}){super();this.scope=[];this.addToScope(a);this.deleteFilter=t;z.add(this);this.trackedOrigins=z;this.captureTransaction=n;this.undoStack=[];this.redoStack=[];this.redoing=this.undoing=!1;this.doc=F;this.lastChange=
0;this.ignoreRemoteMapChanges=D;this.captureTimeout=e;this.afterTransactionHandler=J=>{if(this.captureTransaction(J)&&this.scope.some(U=>J.changedParentTypes.has(U))&&(this.trackedOrigins.has(J.origin)||J.origin&&this.trackedOrigins.has(J.origin.constructor))){var G=this.undoing,K=this.redoing,I=G?this.redoStack:this.undoStack;G?this.stopCapturing():K||this.clear(!1,!0);var L=new DeleteSet$$module$libs$y_webrtc_min;J.afterState.forEach((U,Z)=>{const da=J.beforeState.get(Z)||0;U-=da;0<U&&addToDeleteSet$$module$libs$y_webrtc_min(L,
Z,da,U)});var Q=getUnixTime$$module$libs$y_webrtc_min(),M=!1;if(0<this.lastChange&&Q-this.lastChange<this.captureTimeout&&0<I.length&&!G&&!K){const U=I[I.length-1];U.deletions=mergeDeleteSets$$module$libs$y_webrtc_min([U.deletions,J.deleteSet]);U.insertions=mergeDeleteSets$$module$libs$y_webrtc_min([U.insertions,L])}else I.push(new StackItem$$module$libs$y_webrtc_min(J.deleteSet,L)),M=!0;G||K||(this.lastChange=Q);iterateDeletedStructs$$module$libs$y_webrtc_min(J,J.deleteSet,U=>{U instanceof Item$$module$libs$y_webrtc_min&&
this.scope.some(Z=>isParentOf$$module$libs$y_webrtc_min(Z,U))&&keepItem$$module$libs$y_webrtc_min(U,!0)});G=[{stackItem:I[I.length-1],origin:J.origin,type:G?"redo":"undo",changedParentTypes:J.changedParentTypes},this];M?this.emit("stack-item-added",G):this.emit("stack-item-updated",G)}};this.doc.on("afterTransaction",this.afterTransactionHandler);this.doc.on("destroy",()=>{this.destroy()})}addToScope(a){(a=isArray$$module$libs$y_webrtc_min(a)?a:[a]).forEach(e=>{this.scope.every(n=>n!==e)&&this.scope.push(e)})}addTrackedOrigin(a){this.trackedOrigins.add(a)}removeTrackedOrigin(a){this.trackedOrigins.delete(a)}clear(a=
!0,e=!0){(a&&this.canUndo()||e&&this.canRedo())&&this.doc.transact(n=>{a&&(this.undoStack.forEach(t=>clearUndoManagerStackItem$$module$libs$y_webrtc_min(n,this,t)),this.undoStack=[]);e&&(this.redoStack.forEach(t=>clearUndoManagerStackItem$$module$libs$y_webrtc_min(n,this,t)),this.redoStack=[]);this.emit("stack-cleared",[{undoStackCleared:a,redoStackCleared:e}])})}stopCapturing(){this.lastChange=0}undo(){let a;this.undoing=!0;try{a=popStackItem$$module$libs$y_webrtc_min(this,this.undoStack,"undo")}finally{this.undoing=
!1}return a}redo(){let a;this.redoing=!0;try{a=popStackItem$$module$libs$y_webrtc_min(this,this.redoStack,"redo")}finally{this.redoing=!1}return a}canUndo(){return 0<this.undoStack.length}canRedo(){return 0<this.redoStack.length}destroy(){this.trackedOrigins.delete(this);this.doc.off("afterTransaction",this.afterTransactionHandler);super.destroy()}}
class LazyStructReader$$module$libs$y_webrtc_min{constructor(a,e){this.gen=function*(n){const t=readVarUint$$module$libs$y_webrtc_min(n.restDecoder);for(let D=0;D<t;D++){const F=readVarUint$$module$libs$y_webrtc_min(n.restDecoder),J=n.readClient();let G=readVarUint$$module$libs$y_webrtc_min(n.restDecoder);for(let K=0;K<F;K++){var z=n.readInfo();if(10===z)z=readVarUint$$module$libs$y_webrtc_min(n.restDecoder),yield new Skip$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(J,G),z),G+=z;
else if(0!=(31&z)){const I=0==(192&z);z=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(J,G),null,128==(128&z)?n.readLeftID():null,null,64==(64&z)?n.readRightID():null,I?n.readParentInfo()?n.readString():n.readLeftID():null,I&&32==(32&z)?n.readString():null,readItemContent$$module$libs$y_webrtc_min(n,z));yield z;G+=z.length}else z=n.readLen(),yield new GC$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(J,G),z),G+=z}}}(a);this.curr=null;this.done=!1;this.filterSkips=
e;this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Skip$$module$libs$y_webrtc_min);return this.curr}}
const logUpdate$$module$libs$y_webrtc_min=a=>logUpdateV2$$module$libs$y_webrtc_min(a,UpdateDecoderV1$$module$libs$y_webrtc_min),logUpdateV2$$module$libs$y_webrtc_min=(a,e=UpdateDecoderV2$$module$libs$y_webrtc_min)=>{var n=[];a=new e(createDecoder$$module$libs$y_webrtc_min(a));e=new LazyStructReader$$module$libs$y_webrtc_min(a,!1);for(let t=e.curr;null!==t;t=e.next())n.push(t);print$$module$libs$y_webrtc_min("Structs: ",n);n=readDeleteSet$$module$libs$y_webrtc_min(a);print$$module$libs$y_webrtc_min("DeleteSet: ",
n)},decodeUpdate$$module$libs$y_webrtc_min=a=>decodeUpdateV2$$module$libs$y_webrtc_min(a,UpdateDecoderV1$$module$libs$y_webrtc_min),decodeUpdateV2$$module$libs$y_webrtc_min=(a,e=UpdateDecoderV2$$module$libs$y_webrtc_min)=>{const n=[];a=new e(createDecoder$$module$libs$y_webrtc_min(a));e=new LazyStructReader$$module$libs$y_webrtc_min(a,!1);for(let t=e.curr;null!==t;t=e.next())n.push(t);return{structs:n,ds:readDeleteSet$$module$libs$y_webrtc_min(a)}};
class LazyStructWriter$$module$libs$y_webrtc_min{constructor(a){this.written=this.startClock=this.currClient=0;this.encoder=a;this.clientStructs=[]}}
const mergeUpdates$$module$libs$y_webrtc_min=a=>mergeUpdatesV2$$module$libs$y_webrtc_min(a,UpdateDecoderV1$$module$libs$y_webrtc_min,UpdateEncoderV1$$module$libs$y_webrtc_min),encodeStateVectorFromUpdateV2$$module$libs$y_webrtc_min=(a,e=DSEncoderV2$$module$libs$y_webrtc_min,n=UpdateDecoderV2$$module$libs$y_webrtc_min)=>{e=new e;n=new LazyStructReader$$module$libs$y_webrtc_min(new n(createDecoder$$module$libs$y_webrtc_min(a)),!1);let t=n.curr;if(null!==t){a=0;let z=t.id.client,D=0!==t.id.clock,F=D?
0:t.id.clock+t.length;for(;null!==t;t=n.next())z!==t.id.client&&(0!==F&&(a++,writeVarUint$$module$libs$y_webrtc_min(e.restEncoder,z),writeVarUint$$module$libs$y_webrtc_min(e.restEncoder,F)),z=t.id.client,F=0,D=0!==t.id.clock),t.constructor===Skip$$module$libs$y_webrtc_min&&(D=!0),D||(F=t.id.clock+t.length);0!==F&&(a++,writeVarUint$$module$libs$y_webrtc_min(e.restEncoder,z),writeVarUint$$module$libs$y_webrtc_min(e.restEncoder,F));n=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(n,
a);writeUint8Array$$module$libs$y_webrtc_min(n,toUint8Array$$module$libs$y_webrtc_min(e.restEncoder));return e.restEncoder=n,e.toUint8Array()}return writeVarUint$$module$libs$y_webrtc_min(e.restEncoder,0),e.toUint8Array()},encodeStateVectorFromUpdate$$module$libs$y_webrtc_min=a=>encodeStateVectorFromUpdateV2$$module$libs$y_webrtc_min(a,DSEncoderV1$$module$libs$y_webrtc_min,UpdateDecoderV1$$module$libs$y_webrtc_min),parseUpdateMetaV2$$module$libs$y_webrtc_min=(a,e=UpdateDecoderV2$$module$libs$y_webrtc_min)=>
{const n=new Map,t=new Map;a=new LazyStructReader$$module$libs$y_webrtc_min(new e(createDecoder$$module$libs$y_webrtc_min(a)),!1);e=a.curr;if(null!==e){let z=e.id.client,D=e.id.clock;for(n.set(z,D);null!==e;e=a.next())z!==e.id.client&&(t.set(z,D),n.set(e.id.client,e.id.clock),z=e.id.client),D=e.id.clock+e.length;t.set(z,D)}return{from:n,to:t}},parseUpdateMeta$$module$libs$y_webrtc_min=a=>parseUpdateMetaV2$$module$libs$y_webrtc_min(a,UpdateDecoderV1$$module$libs$y_webrtc_min),sliceStruct$$module$libs$y_webrtc_min=
(a,e)=>{if(a.constructor===GC$$module$libs$y_webrtc_min){const {client:z,clock:D}=a.id;return new GC$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(z,D+e),a.length-e)}if(a.constructor===Skip$$module$libs$y_webrtc_min){const {client:z,clock:D}=a.id;return new Skip$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(z,D+e),a.length-e)}const {client:n,clock:t}=a.id;return new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(n,t+e),null,createID$$module$libs$y_webrtc_min(n,
t+e-1),null,a.rightOrigin,a.parent,a.parentSub,a.content.splice(e))},mergeUpdatesV2$$module$libs$y_webrtc_min=(a,e=UpdateDecoderV2$$module$libs$y_webrtc_min,n=UpdateEncoderV2$$module$libs$y_webrtc_min)=>{if(1===a.length)return a[0];a=a.map(G=>new e(createDecoder$$module$libs$y_webrtc_min(G)));let t=a.map(G=>new LazyStructReader$$module$libs$y_webrtc_min(G,!0)),z=null;n=new n;const D=new LazyStructWriter$$module$libs$y_webrtc_min(n);for(;t=t.filter(G=>null!==G.curr),t.sort((G,K)=>{if(G.curr.id.client===
K.curr.id.client){const I=G.curr.id.clock-K.curr.id.clock;return 0===I?G.curr.constructor===K.curr.constructor?0:G.curr.constructor===Skip$$module$libs$y_webrtc_min?1:-1:I}return K.curr.id.client-G.curr.id.client}),0!==t.length;){const G=t[0],K=G.curr.id.client;if(null!==z){for(var F=G.curr,J=!1;null!==F&&F.id.clock+F.length<=z.struct.id.clock+z.struct.length&&F.id.client>=z.struct.id.client;)F=G.next(),J=!0;if(null===F||F.id.client!==K||J&&F.id.clock>z.struct.id.clock+z.struct.length)continue;K!==
z.struct.id.client?(writeStructToLazyStructWriter$$module$libs$y_webrtc_min(D,z.struct,z.offset),z={struct:F,offset:0},G.next()):z.struct.id.clock+z.struct.length<F.id.clock?z.struct.constructor===Skip$$module$libs$y_webrtc_min?z.struct.length=F.id.clock+F.length-z.struct.id.clock:(writeStructToLazyStructWriter$$module$libs$y_webrtc_min(D,z.struct,z.offset),F=F.id.clock-z.struct.id.clock-z.struct.length,z={struct:new Skip$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(K,z.struct.id.clock+
z.struct.length),F),offset:0}):(J=z.struct.id.clock+z.struct.length-F.id.clock,0<J&&(z.struct.constructor===Skip$$module$libs$y_webrtc_min?z.struct.length-=J:F=sliceStruct$$module$libs$y_webrtc_min(F,J)),z.struct.mergeWith(F)||(writeStructToLazyStructWriter$$module$libs$y_webrtc_min(D,z.struct,z.offset),z={struct:F,offset:0},G.next()))}else z={struct:G.curr,offset:0},G.next();for(F=G.curr;null!==F&&F.id.client===K&&F.id.clock===z.struct.id.clock+z.struct.length&&F.constructor!==Skip$$module$libs$y_webrtc_min;F=
G.next())writeStructToLazyStructWriter$$module$libs$y_webrtc_min(D,z.struct,z.offset),z={struct:F,offset:0}}null!==z&&(writeStructToLazyStructWriter$$module$libs$y_webrtc_min(D,z.struct,z.offset),z=null);finishLazyStructWriting$$module$libs$y_webrtc_min(D);a=a.map(G=>readDeleteSet$$module$libs$y_webrtc_min(G));a=mergeDeleteSets$$module$libs$y_webrtc_min(a);return writeDeleteSet$$module$libs$y_webrtc_min(n,a),n.toUint8Array()},diffUpdateV2$$module$libs$y_webrtc_min=(a,e,n=UpdateDecoderV2$$module$libs$y_webrtc_min,
t=UpdateEncoderV2$$module$libs$y_webrtc_min)=>{e=decodeStateVector$$module$libs$y_webrtc_min(e);t=new t;const z=new LazyStructWriter$$module$libs$y_webrtc_min(t);a=new n(createDecoder$$module$libs$y_webrtc_min(a));for(n=new LazyStructReader$$module$libs$y_webrtc_min(a,!1);n.curr;){const D=n.curr,F=D.id.client,J=e.get(F)||0;if(n.curr.constructor!==Skip$$module$libs$y_webrtc_min)if(D.id.clock+D.length>J)for(writeStructToLazyStructWriter$$module$libs$y_webrtc_min(z,D,max$$module$libs$y_webrtc_min(J-
D.id.clock,0)),n.next();n.curr&&n.curr.id.client===F;)writeStructToLazyStructWriter$$module$libs$y_webrtc_min(z,n.curr,0),n.next();else for(;n.curr&&n.curr.id.client===F&&n.curr.id.clock+n.curr.length<=J;)n.next();else n.next()}finishLazyStructWriting$$module$libs$y_webrtc_min(z);e=readDeleteSet$$module$libs$y_webrtc_min(a);return writeDeleteSet$$module$libs$y_webrtc_min(t,e),t.toUint8Array()},diffUpdate$$module$libs$y_webrtc_min=(a,e)=>diffUpdateV2$$module$libs$y_webrtc_min(a,e,UpdateDecoderV1$$module$libs$y_webrtc_min,
UpdateEncoderV1$$module$libs$y_webrtc_min),flushLazyStructWriter$$module$libs$y_webrtc_min=a=>{0<a.written&&(a.clientStructs.push({written:a.written,restEncoder:toUint8Array$$module$libs$y_webrtc_min(a.encoder.restEncoder)}),a.encoder.restEncoder=createEncoder$$module$libs$y_webrtc_min(),a.written=0)},writeStructToLazyStructWriter$$module$libs$y_webrtc_min=(a,e,n)=>{0<a.written&&a.currClient!==e.id.client&&flushLazyStructWriter$$module$libs$y_webrtc_min(a);0===a.written&&(a.currClient=e.id.client,
a.encoder.writeClient(e.id.client),writeVarUint$$module$libs$y_webrtc_min(a.encoder.restEncoder,e.id.clock+n));e.write(a.encoder,n);a.written++},finishLazyStructWriting$$module$libs$y_webrtc_min=a=>{flushLazyStructWriter$$module$libs$y_webrtc_min(a);const e=a.encoder.restEncoder;writeVarUint$$module$libs$y_webrtc_min(e,a.clientStructs.length);for(let n=0;n<a.clientStructs.length;n++){const t=a.clientStructs[n];writeVarUint$$module$libs$y_webrtc_min(e,t.written);writeUint8Array$$module$libs$y_webrtc_min(e,
t.restEncoder)}},convertUpdateFormat$$module$libs$y_webrtc_min=(a,e,n,t)=>{a=new n(createDecoder$$module$libs$y_webrtc_min(a));n=new LazyStructReader$$module$libs$y_webrtc_min(a,!1);t=new t;const z=new LazyStructWriter$$module$libs$y_webrtc_min(t);for(let D=n.curr;null!==D;D=n.next())writeStructToLazyStructWriter$$module$libs$y_webrtc_min(z,e(D),0);finishLazyStructWriting$$module$libs$y_webrtc_min(z);e=readDeleteSet$$module$libs$y_webrtc_min(a);return writeDeleteSet$$module$libs$y_webrtc_min(t,e),
t.toUint8Array()},createObfuscator$$module$libs$y_webrtc_min=({formatting:a=!0,subdocs:e=!0,yxml:n=!0}={})=>{let t=0;const z=create$$module$libs$y_webrtc_min(),D=create$$module$libs$y_webrtc_min(),F=create$$module$libs$y_webrtc_min(),J=create$$module$libs$y_webrtc_min();return J.set(null,null),G=>{switch(G.constructor){case GC$$module$libs$y_webrtc_min:case Skip$$module$libs$y_webrtc_min:return G;case Item$$module$libs$y_webrtc_min:var K=G.content;switch(K.constructor){case ContentDeleted$$module$libs$y_webrtc_min:break;
case ContentType$$module$libs$y_webrtc_min:n&&(K=K.type,K instanceof YXmlElement$$module$libs$y_webrtc_min&&(K.nodeName=setIfUndefined$$module$libs$y_webrtc_min(D,K.nodeName,()=>"node-"+t)),K instanceof YXmlHook$$module$libs$y_webrtc_min&&(K.hookName=setIfUndefined$$module$libs$y_webrtc_min(D,K.hookName,()=>"hook-"+t)));break;case ContentAny$$module$libs$y_webrtc_min:K.arr=K.arr.map(()=>t);break;case ContentBinary$$module$libs$y_webrtc_min:K.content=new Uint8Array([t]);break;case ContentDoc$$module$libs$y_webrtc_min:e&&
(K.opts={},K.doc.guid=t+"");break;case ContentEmbed$$module$libs$y_webrtc_min:K.embed={};break;case ContentFormat$$module$libs$y_webrtc_min:a&&(K.key=setIfUndefined$$module$libs$y_webrtc_min(F,K.key,()=>t+""),K.value=setIfUndefined$$module$libs$y_webrtc_min(J,K.value,()=>({i:t})));break;case ContentJSON$$module$libs$y_webrtc_min:K.arr=K.arr.map(()=>t);break;case ContentString$$module$libs$y_webrtc_min:K.str=repeat$$module$libs$y_webrtc_min(t%10+"",K.str.length);break;default:unexpectedCase$$module$libs$y_webrtc_min()}return G.parentSub&&
(G.parentSub=setIfUndefined$$module$libs$y_webrtc_min(z,G.parentSub,()=>t+"")),t++,G;default:unexpectedCase$$module$libs$y_webrtc_min()}}},obfuscateUpdate$$module$libs$y_webrtc_min=(a,e)=>convertUpdateFormat$$module$libs$y_webrtc_min(a,createObfuscator$$module$libs$y_webrtc_min(e),UpdateDecoderV1$$module$libs$y_webrtc_min,UpdateEncoderV1$$module$libs$y_webrtc_min),obfuscateUpdateV2$$module$libs$y_webrtc_min=(a,e)=>convertUpdateFormat$$module$libs$y_webrtc_min(a,createObfuscator$$module$libs$y_webrtc_min(e),
UpdateDecoderV2$$module$libs$y_webrtc_min,UpdateEncoderV2$$module$libs$y_webrtc_min),convertUpdateFormatV1ToV2$$module$libs$y_webrtc_min=a=>convertUpdateFormat$$module$libs$y_webrtc_min(a,id$$module$libs$y_webrtc_min,UpdateDecoderV1$$module$libs$y_webrtc_min,UpdateEncoderV2$$module$libs$y_webrtc_min),convertUpdateFormatV2ToV1$$module$libs$y_webrtc_min=a=>convertUpdateFormat$$module$libs$y_webrtc_min(a,id$$module$libs$y_webrtc_min,UpdateDecoderV2$$module$libs$y_webrtc_min,UpdateEncoderV1$$module$libs$y_webrtc_min);
class YEvent$$module$libs$y_webrtc_min{constructor(a,e){this.currentTarget=this.target=a;this.transaction=e;this._delta=this._keys=this._changes=null}get path(){return getPathTo$$module$libs$y_webrtc_min(this.currentTarget,this.target)}deletes(a){return isDeleted$$module$libs$y_webrtc_min(this.transaction.deleteSet,a.id)}get keys(){if(null===this._keys){const a=new Map,e=this.target;this.transaction.changed.get(e).forEach(n=>{if(null!==n){const t=e._map.get(n);let z,D;if(this.adds(t)){let F=t.left;
for(;null!==F&&this.adds(F);)F=F.left;if(this.deletes(t)){if(null===F||!this.deletes(F))return;z="delete";D=last$$module$libs$y_webrtc_min(F.content.getContent())}else null!==F&&this.deletes(F)?(z="update",D=last$$module$libs$y_webrtc_min(F.content.getContent())):(z="add",D=void 0)}else{if(!this.deletes(t))return;z="delete";D=last$$module$libs$y_webrtc_min(t.content.getContent())}a.set(n,{action:z,oldValue:D})}});this._keys=a}return this._keys}get delta(){return this.changes.delta}adds(a){return a.id.clock>=
(this.transaction.beforeState.get(a.id.client)||0)}get changes(){let a=this._changes;if(null===a){var e=this.target;const n=create$1$$module$libs$y_webrtc_min(),t=create$1$$module$libs$y_webrtc_min(),z=[];a={added:n,deleted:t,delta:z,keys:this.keys};if(this.transaction.changed.get(e).has(null)){let D=null;for(e=e._start;null!==e;e=e.right)if(e.deleted){if(this.deletes(e)&&!this.adds(e)){if(null===D||void 0===D.delete)D&&z.push(D),D={delete:0};D.delete+=e.length;t.add(e)}}else if(this.adds(e)){if(null===
D||void 0===D.insert)D&&z.push(D),D={insert:[]};D.insert=D.insert.concat(e.content.getContent());n.add(e)}else{if(null===D||void 0===D.retain)D&&z.push(D),D={retain:0};D.retain+=e.length}null!==D&&void 0===D.retain&&D&&z.push(D)}this._changes=a}return a}}
const getPathTo$$module$libs$y_webrtc_min=(a,e)=>{const n=[];for(;null!==e._item&&e!==a;){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,z=e._item.parent._start;for(;z!==e._item&&null!==z;)z.deleted||t++,z=z.right;n.unshift(t)}e=e._item.parent}return n};let globalSearchMarkerTimestamp$$module$libs$y_webrtc_min=0;
class ArraySearchMarker$$module$libs$y_webrtc_min{constructor(a,e){a.marker=!0;this.p=a;this.index=e;this.timestamp=globalSearchMarkerTimestamp$$module$libs$y_webrtc_min++}}
const overwriteMarker$$module$libs$y_webrtc_min=(a,e,n)=>{a.p.marker=!1;a.p=e;e.marker=!0;a.index=n;a.timestamp=globalSearchMarkerTimestamp$$module$libs$y_webrtc_min++},findMarker$$module$libs$y_webrtc_min=(a,e)=>{if(null===a._start||0===e||null===a._searchMarker)return null;const n=0===a._searchMarker.length?null:a._searchMarker.reduce((D,F)=>abs$$module$libs$y_webrtc_min(e-D.index)<abs$$module$libs$y_webrtc_min(e-F.index)?D:F);let t=a._start,z=0;null!==n&&(t=n.p,z=n.index,n.timestamp=globalSearchMarkerTimestamp$$module$libs$y_webrtc_min++);
for(;null!==t.right&&z<e;){if(!t.deleted&&t.countable){if(e<z+t.length)break;z+=t.length}t=t.right}for(;null!==t.left&&z>e;)t=t.left,!t.deleted&&t.countable&&(z-=t.length);for(;null!==t.left&&t.left.id.client===t.id.client&&t.left.id.clock+t.left.length===t.id.clock;)t=t.left,!t.deleted&&t.countable&&(z-=t.length);return null!==n&&abs$$module$libs$y_webrtc_min(n.index-z)<t.parent.length/80?(overwriteMarker$$module$libs$y_webrtc_min(n,t,z),n):((D,F,J)=>{if(80<=D.length)return D=D.reduce((G,K)=>G.timestamp<
K.timestamp?G:K),overwriteMarker$$module$libs$y_webrtc_min(D,F,J),D;F=new ArraySearchMarker$$module$libs$y_webrtc_min(F,J);return D.push(F),F})(a._searchMarker,t,z)},updateMarkerChanges$$module$libs$y_webrtc_min=(a,e,n)=>{for(let t=a.length-1;0<=t;t--){const z=a[t];if(0<n){let D=z.p;for(D.marker=!1;D&&(D.deleted||!D.countable);)(D=D.left)&&!D.deleted&&D.countable&&(z.index-=D.length);if(null===D||!0===D.marker){a.splice(t,1);continue}z.p=D;D.marker=!0}(e<z.index||0<n&&e===z.index)&&(z.index=max$$module$libs$y_webrtc_min(e,
z.index+n))}},getTypeChildren$$module$libs$y_webrtc_min=a=>{a=a._start;const e=[];for(;a;)e.push(a),a=a.right;return e},callTypeObservers$$module$libs$y_webrtc_min=(a,e,n)=>{const t=a,z=e.changedParentTypes;for(;setIfUndefined$$module$libs$y_webrtc_min(z,a,()=>[]).push(n),null!==a._item;)a=a._item.parent;callEventHandlerListeners$$module$libs$y_webrtc_min(t._eH,n,e)};
class AbstractType$$module$libs$y_webrtc_min{constructor(){this._item=null;this._map=new Map;this.doc=this._start=null;this._length=0;this._eH=createEventHandler$$module$libs$y_webrtc_min();this._dEH=createEventHandler$$module$libs$y_webrtc_min();this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(a,e){this.doc=a;this._item=e}_copy(){throw methodUnimplemented$$module$libs$y_webrtc_min();}clone(){throw methodUnimplemented$$module$libs$y_webrtc_min();}_write(a){}get _first(){let a=
this._start;for(;null!==a&&a.deleted;)a=a.right;return a}_callObserver(a,e){!a.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(a){addEventHandlerListener$$module$libs$y_webrtc_min(this._eH,a)}observeDeep(a){addEventHandlerListener$$module$libs$y_webrtc_min(this._dEH,a)}unobserve(a){removeEventHandlerListener$$module$libs$y_webrtc_min(this._eH,a)}unobserveDeep(a){removeEventHandlerListener$$module$libs$y_webrtc_min(this._dEH,a)}toJSON(){}}
const typeListSlice$$module$libs$y_webrtc_min=(a,e,n)=>{0>e&&(e=a._length+e);0>n&&(n=a._length+n);n-=e;const t=[];for(a=a._start;null!==a&&0<n;){if(a.countable&&!a.deleted){const z=a.content.getContent();if(z.length<=e)e-=z.length;else{for(;e<z.length&&0<n;e++)t.push(z[e]),n--;e=0}}a=a.right}return t},typeListToArray$$module$libs$y_webrtc_min=a=>{const e=[];for(a=a._start;null!==a;){if(a.countable&&!a.deleted){const n=a.content.getContent();for(let t=0;t<n.length;t++)e.push(n[t])}a=a.right}return e},
typeListToArraySnapshot$$module$libs$y_webrtc_min=(a,e)=>{const n=[];for(a=a._start;null!==a;){if(a.countable&&isVisible$$module$libs$y_webrtc_min(a,e)){const t=a.content.getContent();for(let z=0;z<t.length;z++)n.push(t[z])}a=a.right}return n},typeListForEach$$module$libs$y_webrtc_min=(a,e)=>{let n=0,t=a._start;for(;null!==t;){if(t.countable&&!t.deleted){const z=t.content.getContent();for(let D=0;D<z.length;D++)e(z[D],n++,a)}t=t.right}},typeListMap$$module$libs$y_webrtc_min=(a,e)=>{const n=[];return typeListForEach$$module$libs$y_webrtc_min(a,
(t,z)=>{n.push(e(t,z,a))}),n},typeListCreateIterator$$module$libs$y_webrtc_min=a=>{let e=a._start,n=null,t=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent();t=0;e=e.right}const z=n[t++];return n.length<=t&&(n=null),{done:!1,value:z}}}},typeListGet$$module$libs$y_webrtc_min=(a,e)=>{const n=findMarker$$module$libs$y_webrtc_min(a,e);a=a._start;for(null!==n&&(a=n.p,e-=n.index);null!==a;a=
a.right)if(!a.deleted&&a.countable){if(e<a.length)return a.content.getContent()[e];e-=a.length}},typeListInsertGenericsAfter$$module$libs$y_webrtc_min=(a,e,n,t)=>{let z=n;const D=a.doc,F=D.clientID,J=D.store,G=null===n?e._start:n.right;let K=[];const I=()=>{0<K.length&&(z=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(J,F)),z,z&&z.lastId,G,G&&G.id,e,null,new ContentAny$$module$libs$y_webrtc_min(K)),z.integrate(a,0),K=[])};t.forEach(L=>{if(null===
L)K.push(L);else switch(L.constructor){case Number:case Object:case Boolean:case Array:case String:K.push(L);break;default:switch(I(),L.constructor){case Uint8Array:case ArrayBuffer:z=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(J,F)),z,z&&z.lastId,G,G&&G.id,e,null,new ContentBinary$$module$libs$y_webrtc_min(new Uint8Array(L)));z.integrate(a,0);break;case Doc$$module$libs$y_webrtc_min:z=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,
getState$$module$libs$y_webrtc_min(J,F)),z,z&&z.lastId,G,G&&G.id,e,null,new ContentDoc$$module$libs$y_webrtc_min(L));z.integrate(a,0);break;default:if(!(L instanceof AbstractType$$module$libs$y_webrtc_min))throw Error("Unexpected content type in insert operation");z=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(J,F)),z,z&&z.lastId,G,G&&G.id,e,null,new ContentType$$module$libs$y_webrtc_min(L));z.integrate(a,0)}}});I()},lengthExceeded$$module$libs$y_webrtc_min=
create$2$$module$libs$y_webrtc_min("Length exceeded!"),typeListInsertGenerics$$module$libs$y_webrtc_min=(a,e,n,t)=>{if(n>e._length)throw lengthExceeded$$module$libs$y_webrtc_min;if(0===n)return e._searchMarker&&updateMarkerChanges$$module$libs$y_webrtc_min(e._searchMarker,n,t.length),typeListInsertGenericsAfter$$module$libs$y_webrtc_min(a,e,null,t);const z=n,D=findMarker$$module$libs$y_webrtc_min(e,n);let F=e._start;for(null!==D&&(F=D.p,0===(n-=D.index)&&(F=F.prev,n+=F&&F.countable&&!F.deleted?F.length:
0));null!==F;F=F.right)if(!F.deleted&&F.countable){if(n<=F.length){n<F.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(F.id.client,F.id.clock+n));break}n-=F.length}return e._searchMarker&&updateMarkerChanges$$module$libs$y_webrtc_min(e._searchMarker,z,t.length),typeListInsertGenericsAfter$$module$libs$y_webrtc_min(a,e,F,t)},typeListDelete$$module$libs$y_webrtc_min=(a,e,n,t)=>{if(0!==t){var z=n,D=t,F=findMarker$$module$libs$y_webrtc_min(e,n),J=e._start;for(null!==
F&&(J=F.p,n-=F.index);null!==J&&0<n;J=J.right)!J.deleted&&J.countable&&(n<J.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(J.id.client,J.id.clock+n)),n-=J.length);for(;0<t&&null!==J;)J.deleted||(t<J.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(J.id.client,J.id.clock+t)),J.delete(a),t-=J.length),J=J.right;if(0<t)throw lengthExceeded$$module$libs$y_webrtc_min;e._searchMarker&&updateMarkerChanges$$module$libs$y_webrtc_min(e._searchMarker,
z,-D+t)}},typeMapDelete$$module$libs$y_webrtc_min=(a,e,n)=>{e=e._map.get(n);void 0!==e&&e.delete(a)},typeMapSet$$module$libs$y_webrtc_min=(a,e,n,t)=>{const z=e._map.get(n)||null,D=a.doc,F=D.clientID;if(null==t)t=new ContentAny$$module$libs$y_webrtc_min([t]);else switch(t.constructor){case Number:case Object:case Boolean:case Array:case String:t=new ContentAny$$module$libs$y_webrtc_min([t]);break;case Uint8Array:t=new ContentBinary$$module$libs$y_webrtc_min(t);break;case Doc$$module$libs$y_webrtc_min:t=
new ContentDoc$$module$libs$y_webrtc_min(t);break;default:if(!(t instanceof AbstractType$$module$libs$y_webrtc_min))throw Error("Unexpected content type");t=new ContentType$$module$libs$y_webrtc_min(t)}(new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(D.store,F)),z,z&&z.lastId,null,null,e,n,t)).integrate(a,0)},typeMapGet$$module$libs$y_webrtc_min=(a,e)=>{a=a._map.get(e);return void 0===a||a.deleted?void 0:a.content.getContent()[a.length-1]},
typeMapGetAll$$module$libs$y_webrtc_min=a=>{const e={};return a._map.forEach((n,t)=>{n.deleted||(e[t]=n.content.getContent()[n.length-1])}),e},typeMapHas$$module$libs$y_webrtc_min=(a,e)=>{a=a._map.get(e);return void 0!==a&&!a.deleted},typeMapGetSnapshot$$module$libs$y_webrtc_min=(a,e,n)=>{for(a=a._map.get(e)||null;null!==a&&(!n.sv.has(a.id.client)||a.id.clock>=(n.sv.get(a.id.client)||0));)a=a.left;return null!==a&&isVisible$$module$libs$y_webrtc_min(a,n)?a.content.getContent()[a.length-1]:void 0},
createMapIterator$$module$libs$y_webrtc_min=a=>{return e=a.entries(),n=t=>!t[1].deleted,createIterator$$module$libs$y_webrtc_min(()=>{let t;do t=e.next();while(!t.done&&!n(t.value));return t});var e,n};class YArrayEvent$$module$libs$y_webrtc_min extends YEvent$$module$libs$y_webrtc_min{constructor(a,e){super(a,e);this._transaction=e}}
class YArray$$module$libs$y_webrtc_min extends AbstractType$$module$libs$y_webrtc_min{constructor(){super();this._prelimContent=[];this._searchMarker=[]}static from(a){const e=new YArray$$module$libs$y_webrtc_min;return e.push(a),e}_integrate(a,e){super._integrate(a,e);this.insert(0,this._prelimContent);this._prelimContent=null}_copy(){return new YArray$$module$libs$y_webrtc_min}clone(){const a=new YArray$$module$libs$y_webrtc_min;return a.insert(0,this.toArray().map(e=>e instanceof AbstractType$$module$libs$y_webrtc_min?
e.clone():e)),a}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(a,e){super._callObserver(a,e);callTypeObservers$$module$libs$y_webrtc_min(this,a,new YArrayEvent$$module$libs$y_webrtc_min(this,a))}insert(a,e){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{typeListInsertGenerics$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimContent.splice(a,0,...e)}push(a){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,e=>{((n,
t,z)=>{let D=(t._searchMarker||[]).reduce((F,J)=>J.index>F.index?J:F,{index:0,p:t._start}).p;if(D)for(;D.right;)D=D.right;typeListInsertGenericsAfter$$module$libs$y_webrtc_min(n,t,D,z)})(e,this,a)}):this._prelimContent.push(...a)}unshift(a){this.insert(0,a)}delete(a,e=1){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{typeListDelete$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimContent.splice(a,e)}get(a){return typeListGet$$module$libs$y_webrtc_min(this,a)}toArray(){return typeListToArray$$module$libs$y_webrtc_min(this)}slice(a=
0,e=this.length){return typeListSlice$$module$libs$y_webrtc_min(this,a,e)}toJSON(){return this.map(a=>a instanceof AbstractType$$module$libs$y_webrtc_min?a.toJSON():a)}map(a){return typeListMap$$module$libs$y_webrtc_min(this,a)}forEach(a){typeListForEach$$module$libs$y_webrtc_min(this,a)}[Symbol.iterator](){return typeListCreateIterator$$module$libs$y_webrtc_min(this)}_write(a){a.writeTypeRef(YArrayRefID$$module$libs$y_webrtc_min)}}
class YMapEvent$$module$libs$y_webrtc_min extends YEvent$$module$libs$y_webrtc_min{constructor(a,e,n){super(a,e);this.keysChanged=n}}
class YMap$$module$libs$y_webrtc_min extends AbstractType$$module$libs$y_webrtc_min{constructor(a){super();this._prelimContent=null;this._prelimContent=void 0===a?new Map:new Map(a)}_integrate(a,e){super._integrate(a,e);this._prelimContent.forEach((n,t)=>{this.set(t,n)});this._prelimContent=null}_copy(){return new YMap$$module$libs$y_webrtc_min}clone(){const a=new YMap$$module$libs$y_webrtc_min;return this.forEach((e,n)=>{a.set(n,e instanceof AbstractType$$module$libs$y_webrtc_min?e.clone():e)}),
a}_callObserver(a,e){callTypeObservers$$module$libs$y_webrtc_min(this,a,new YMapEvent$$module$libs$y_webrtc_min(this,a,e))}toJSON(){const a={};return this._map.forEach((e,n)=>{e.deleted||(e=e.content.getContent()[e.length-1],a[n]=e instanceof AbstractType$$module$libs$y_webrtc_min?e.toJSON():e)}),a}get size(){return[...createMapIterator$$module$libs$y_webrtc_min(this._map)].length}keys(){return iteratorMap$$module$libs$y_webrtc_min(createMapIterator$$module$libs$y_webrtc_min(this._map),a=>a[0])}values(){return iteratorMap$$module$libs$y_webrtc_min(createMapIterator$$module$libs$y_webrtc_min(this._map),
a=>a[1].content.getContent()[a[1].length-1])}entries(){return iteratorMap$$module$libs$y_webrtc_min(createMapIterator$$module$libs$y_webrtc_min(this._map),a=>[a[0],a[1].content.getContent()[a[1].length-1]])}forEach(a){this._map.forEach((e,n)=>{e.deleted||a(e.content.getContent()[e.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(a){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,e=>{typeMapDelete$$module$libs$y_webrtc_min(e,this,a)}):this._prelimContent.delete(a)}set(a,
e){return null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{typeMapSet$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimContent.set(a,e),e}get(a){return typeMapGet$$module$libs$y_webrtc_min(this,a)}has(a){return typeMapHas$$module$libs$y_webrtc_min(this,a)}clear(){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,a=>{this.forEach(function(e,n,t){typeMapDelete$$module$libs$y_webrtc_min(a,t,n)})}):this._prelimContent.clear()}_write(a){a.writeTypeRef(YMapRefID$$module$libs$y_webrtc_min)}}
const equalAttrs$$module$libs$y_webrtc_min=(a,e)=>a===e||"object"==typeof a&&"object"==typeof e&&a&&e&&((n,t)=>n===t||length$$module$libs$y_webrtc_min(n)===length$$module$libs$y_webrtc_min(t)&&((z,D)=>{for(const F in z)if(!D(z[F],F))return!1;return!0})(n,(z,D)=>(void 0!==z||hasProperty$$module$libs$y_webrtc_min(t,D))&&t[D]===z))(a,e);
class ItemTextListPosition$$module$libs$y_webrtc_min{constructor(a,e,n,t){this.left=a;this.right=e;this.index=n;this.currentAttributes=t}forward(){switch(null===this.right&&unexpectedCase$$module$libs$y_webrtc_min(),this.right.content.constructor){case ContentFormat$$module$libs$y_webrtc_min:this.right.deleted||updateCurrentAttributes$$module$libs$y_webrtc_min(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length)}this.left=this.right;this.right=
this.right.right}}
const findNextPosition$$module$libs$y_webrtc_min=(a,e,n)=>{for(;null!==e.right&&0<n;){switch(e.right.content.constructor){case ContentFormat$$module$libs$y_webrtc_min:e.right.deleted||updateCurrentAttributes$$module$libs$y_webrtc_min(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length)}e.left=e.right;e.right=
e.right.right}return e},findPosition$$module$libs$y_webrtc_min=(a,e,n)=>{const t=new Map;var z=findMarker$$module$libs$y_webrtc_min(e,n);if(z)return e=new ItemTextListPosition$$module$libs$y_webrtc_min(z.p.left,z.p,z.index,t),findNextPosition$$module$libs$y_webrtc_min(a,e,n-z.index);z=new ItemTextListPosition$$module$libs$y_webrtc_min(null,e._start,0,t);return findNextPosition$$module$libs$y_webrtc_min(a,z,n)},insertNegatedAttributes$$module$libs$y_webrtc_min=(a,e,n,t)=>{for(;null!==n.right&&(!0===
n.right.deleted||n.right.content.constructor===ContentFormat$$module$libs$y_webrtc_min&&equalAttrs$$module$libs$y_webrtc_min(t.get(n.right.content.key),n.right.content.value));)n.right.deleted||t.delete(n.right.content.key),n.forward();const z=a.doc,D=z.clientID;t.forEach((F,J)=>{const G=n.left,K=n.right;F=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(D,getState$$module$libs$y_webrtc_min(z.store,D)),G,G&&G.lastId,K,K&&K.id,e,null,new ContentFormat$$module$libs$y_webrtc_min(J,
F));F.integrate(a,0);n.right=F;n.forward()})},updateCurrentAttributes$$module$libs$y_webrtc_min=(a,e)=>{const {key:n,value:t}=e;null===t?a.delete(n):a.set(n,t)},minimizeAttributeChanges$$module$libs$y_webrtc_min=(a,e)=>{for(;null!==a.right&&(a.right.deleted||a.right.content.constructor===ContentFormat$$module$libs$y_webrtc_min&&equalAttrs$$module$libs$y_webrtc_min(e[a.right.content.key]||null,a.right.content.value));)a.forward()},insertAttributes$$module$libs$y_webrtc_min=(a,e,n,t)=>{const z=a.doc,
D=z.clientID,F=new Map;for(const J in t){const G=t[J],K=n.currentAttributes.get(J)||null;if(!equalAttrs$$module$libs$y_webrtc_min(K,G)){F.set(J,K);const {left:I,right:L}=n;n.right=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(D,getState$$module$libs$y_webrtc_min(z.store,D)),I,I&&I.lastId,L,L&&L.id,e,null,new ContentFormat$$module$libs$y_webrtc_min(J,G));n.right.integrate(a,0);n.forward()}}return F},insertText$$module$libs$y_webrtc_min=(a,e,n,t,z)=>{n.currentAttributes.forEach((L,
Q)=>{void 0===z[Q]&&(z[Q]=null)});const D=a.doc,F=D.clientID;minimizeAttributeChanges$$module$libs$y_webrtc_min(n,z);const J=insertAttributes$$module$libs$y_webrtc_min(a,e,n,z);t=t.constructor===String?new ContentString$$module$libs$y_webrtc_min(t):t instanceof AbstractType$$module$libs$y_webrtc_min?new ContentType$$module$libs$y_webrtc_min(t):new ContentEmbed$$module$libs$y_webrtc_min(t);let {left:G,right:K,index:I}=n;e._searchMarker&&updateMarkerChanges$$module$libs$y_webrtc_min(e._searchMarker,
n.index,t.getLength());K=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(D.store,F)),G,G&&G.lastId,K,K&&K.id,e,null,t);K.integrate(a,0);n.right=K;n.index=I;n.forward();insertNegatedAttributes$$module$libs$y_webrtc_min(a,e,n,J)},formatText$$module$libs$y_webrtc_min=(a,e,n,t,z)=>{const D=a.doc,F=D.clientID;minimizeAttributeChanges$$module$libs$y_webrtc_min(n,z);const J=insertAttributes$$module$libs$y_webrtc_min(a,e,n,z);a:for(;null!==n.right&&
(0<t||0<J.size&&(n.right.deleted||n.right.content.constructor===ContentFormat$$module$libs$y_webrtc_min));){if(!n.right.deleted)switch(n.right.content.constructor){case ContentFormat$$module$libs$y_webrtc_min:const {key:G,value:K}=n.right.content,I=z[G];if(void 0!==I){if(equalAttrs$$module$libs$y_webrtc_min(I,K))J.delete(G);else{if(0===t)break a;J.set(G,K)}n.right.delete(a)}else n.currentAttributes.set(G,K);break;default:t<n.right.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(n.right.id.client,
n.right.id.clock+t)),t-=n.right.length}n.forward()}if(0<t){for(z="";0<t;t--)z+="\n";n.right=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(F,getState$$module$libs$y_webrtc_min(D.store,F)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new ContentString$$module$libs$y_webrtc_min(z));n.right.integrate(a,0);n.forward()}insertNegatedAttributes$$module$libs$y_webrtc_min(a,e,n,J)},cleanupFormattingGap$$module$libs$y_webrtc_min=(a,e,n,t,z)=>{let D=e;const F=create$$module$libs$y_webrtc_min();
for(;D&&(!D.countable||D.deleted);){if(!D.deleted&&D.content.constructor===ContentFormat$$module$libs$y_webrtc_min){var J=D.content;F.set(J.key,J)}D=D.right}J=0;let G=!1;for(;e!==D;){if(n===e&&(G=!0),!e.deleted){const K=e.content;switch(K.constructor){case ContentFormat$$module$libs$y_webrtc_min:const {key:I,value:L}=K,Q=t.get(I)||null;F.get(I)===K&&Q!==L||(e.delete(a),J++,G||(z.get(I)||null)!==L||Q===L||(null===Q?z.delete(I):z.set(I,Q)));G||e.deleted||updateCurrentAttributes$$module$libs$y_webrtc_min(z,
K)}}e=e.right}return J},cleanupYTextFormatting$$module$libs$y_webrtc_min=a=>{let e=0;return transact$$module$libs$y_webrtc_min(a.doc,n=>{let t=a._start,z=a._start,D=create$$module$libs$y_webrtc_min();const F=copy$$module$libs$y_webrtc_min(D);for(;z;){if(!1===z.deleted)switch(z.content.constructor){case ContentFormat$$module$libs$y_webrtc_min:updateCurrentAttributes$$module$libs$y_webrtc_min(F,z.content);break;default:e+=cleanupFormattingGap$$module$libs$y_webrtc_min(n,t,z,D,F),D=copy$$module$libs$y_webrtc_min(F),
t=z}z=z.right}}),e},deleteText$$module$libs$y_webrtc_min=(a,e,n)=>{const t=n,z=copy$$module$libs$y_webrtc_min(e.currentAttributes),D=e.right;for(;0<n&&null!==e.right;){if(!1===e.right.deleted)switch(e.right.content.constructor){case ContentType$$module$libs$y_webrtc_min:case ContentEmbed$$module$libs$y_webrtc_min:case ContentString$$module$libs$y_webrtc_min:n<e.right.length&&getItemCleanStart$$module$libs$y_webrtc_min(a,createID$$module$libs$y_webrtc_min(e.right.id.client,e.right.id.clock+n)),n-=
e.right.length,e.right.delete(a)}e.forward()}D&&cleanupFormattingGap$$module$libs$y_webrtc_min(a,D,e.right,z,e.currentAttributes);a=(e.left||e.right).parent;return a._searchMarker&&updateMarkerChanges$$module$libs$y_webrtc_min(a._searchMarker,e.index,-t+n),e};
class YTextEvent$$module$libs$y_webrtc_min extends YEvent$$module$libs$y_webrtc_min{constructor(a,e,n){super(a,e);this.childListChanged=!1;this.keysChanged=new Set;n.forEach(t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)})}get changes(){null===this._changes&&(this._changes={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set});return this._changes}get delta(){if(null===this._delta){const a=[];transact$$module$libs$y_webrtc_min(this.target.doc,e=>{const n=new Map,t=new Map;
let z=this.target._start,D=null;const F={};let J="",G=0,K=0;const I=()=>{if(null!==D){let Q=null;switch(D){case "delete":0<K&&(Q={delete:K});K=0;break;case "insert":("object"==typeof J||0<J.length)&&(Q={insert:J},0<n.size&&(Q.attributes={},n.forEach((M,U)=>{null!==M&&(Q.attributes[U]=M)})));J="";break;case "retain":0<G&&(Q={retain:G},(M=>{for(const U in M)return!1;return!0})(F)||(Q.attributes=assign$$module$libs$y_webrtc_min({},F))),G=0}Q&&a.push(Q);D=null}};for(;null!==z;){switch(z.content.constructor){case ContentType$$module$libs$y_webrtc_min:case ContentEmbed$$module$libs$y_webrtc_min:this.adds(z)?
this.deletes(z)||(I(),D="insert",J=z.content.getContent()[0],I()):this.deletes(z)?("delete"!==D&&(I(),D="delete"),K+=1):z.deleted||("retain"!==D&&(I(),D="retain"),G+=1);break;case ContentString$$module$libs$y_webrtc_min:this.adds(z)?this.deletes(z)||("insert"!==D&&(I(),D="insert"),J+=z.content.str):this.deletes(z)?("delete"!==D&&(I(),D="delete"),K+=z.length):z.deleted||("retain"!==D&&(I(),D="retain"),G+=z.length);break;case ContentFormat$$module$libs$y_webrtc_min:const {key:Q,value:M}=z.content;if(this.adds(z)){if(!this.deletes(z)){var L=
n.get(Q)||null;equalAttrs$$module$libs$y_webrtc_min(L,M)?null!==M&&z.delete(e):("retain"===D&&I(),equalAttrs$$module$libs$y_webrtc_min(M,t.get(Q)||null)?delete F[Q]:F[Q]=M)}}else this.deletes(z)?(t.set(Q,M),L=n.get(Q)||null,equalAttrs$$module$libs$y_webrtc_min(L,M)||("retain"===D&&I(),F[Q]=L)):z.deleted||(t.set(Q,M),L=F[Q],void 0!==L&&(equalAttrs$$module$libs$y_webrtc_min(L,M)?null!==L&&z.delete(e):("retain"===D&&I(),null===M?delete F[Q]:F[Q]=M)));z.deleted||("insert"===D&&I(),updateCurrentAttributes$$module$libs$y_webrtc_min(n,
z.content))}z=z.right}for(I();0<a.length;){e=a[a.length-1];if(void 0===e.retain||void 0!==e.attributes)break;a.pop()}});this._delta=a}return this._delta}}
class YText$$module$libs$y_webrtc_min extends AbstractType$$module$libs$y_webrtc_min{constructor(a){super();this._pending=void 0!==a?[()=>this.insert(0,a)]:[];this._searchMarker=[]}get length(){return this._length}_integrate(a,e){super._integrate(a,e);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new YText$$module$libs$y_webrtc_min}clone(){const a=new YText$$module$libs$y_webrtc_min;return a.applyDelta(this.toDelta()),a}_callObserver(a,e){super._callObserver(a,
e);var n=new YTextEvent$$module$libs$y_webrtc_min(this,a,e);e=a.doc;if(callTypeObservers$$module$libs$y_webrtc_min(this,a,n),!a.local){let t=!1;for(const [z,D]of a.afterState.entries())if(n=a.beforeState.get(z)||0,D!==n&&(iterateStructs$$module$libs$y_webrtc_min(a,e.store.clients.get(z),n,D,F=>{F.deleted||F.content.constructor!==ContentFormat$$module$libs$y_webrtc_min||(t=!0)}),t))break;t||iterateDeletedStructs$$module$libs$y_webrtc_min(a,a.deleteSet,z=>{z instanceof GC$$module$libs$y_webrtc_min||
t||z.parent===this&&z.content.constructor===ContentFormat$$module$libs$y_webrtc_min&&(t=!0)});transact$$module$libs$y_webrtc_min(e,z=>{t?cleanupYTextFormatting$$module$libs$y_webrtc_min(this):iterateDeletedStructs$$module$libs$y_webrtc_min(z,z.deleteSet,D=>{if(!(D instanceof GC$$module$libs$y_webrtc_min)&&D.parent===this){for(;D&&D.right&&(D.right.deleted||!D.right.countable);)D=D.right;const F=new Set;for(;D&&(D.deleted||!D.countable);){if(!D.deleted&&D.content.constructor===ContentFormat$$module$libs$y_webrtc_min){const J=
D.content.key;F.has(J)?D.delete(z):F.add(J)}D=D.left}}})})}}toString(){let a="",e=this._start;for(;null!==e;)!e.deleted&&e.countable&&e.content.constructor===ContentString$$module$libs$y_webrtc_min&&(a+=e.content.str),e=e.right;return a}toJSON(){return this.toString()}applyDelta(a,{sanitize:e=!0}={}){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{const t=new ItemTextListPosition$$module$libs$y_webrtc_min(null,this._start,0,new Map);for(let z=0;z<a.length;z++){const D=a[z];if(void 0!==
D.insert){const F=e||"string"!=typeof D.insert||z!==a.length-1||null!==t.right||"\n"!==D.insert.slice(-1)?D.insert:D.insert.slice(0,-1);("string"!=typeof F||0<F.length)&&insertText$$module$libs$y_webrtc_min(n,this,t,F,D.attributes||{})}else void 0!==D.retain?formatText$$module$libs$y_webrtc_min(n,this,t,D.retain,D.attributes||{}):void 0!==D.delete&&deleteText$$module$libs$y_webrtc_min(n,t,D.delete)}}):this._pending.push(()=>this.applyDelta(a))}toDelta(a,e,n){function t(){if(0<J.length){const I={};
let L=!1;D.forEach((M,U)=>{L=!0;I[U]=M});const Q={insert:J};L&&(Q.attributes=I);z.push(Q);J=""}}const z=[],D=new Map,F=this.doc;let J="",G=this._start;const K=()=>{for(;null!==G;){if(isVisible$$module$libs$y_webrtc_min(G,a)||void 0!==e&&isVisible$$module$libs$y_webrtc_min(G,e))switch(G.content.constructor){case ContentString$$module$libs$y_webrtc_min:var I=D.get("ychange");void 0===a||isVisible$$module$libs$y_webrtc_min(G,a)?void 0===e||isVisible$$module$libs$y_webrtc_min(G,e)?void 0!==I&&(t(),D.delete("ychange")):
void 0!==I&&I.user===G.id.client&&"added"===I.type||(t(),D.set("ychange",n?n("added",G.id):{type:"added"})):void 0!==I&&I.user===G.id.client&&"removed"===I.type||(t(),D.set("ychange",n?n("removed",G.id):{type:"removed"}));J+=G.content.str;break;case ContentType$$module$libs$y_webrtc_min:case ContentEmbed$$module$libs$y_webrtc_min:t();I={insert:G.content.getContent()[0]};if(0<D.size){const L={};I.attributes=L;D.forEach((Q,M)=>{L[M]=Q})}z.push(I);break;case ContentFormat$$module$libs$y_webrtc_min:isVisible$$module$libs$y_webrtc_min(G,
a)&&(t(),updateCurrentAttributes$$module$libs$y_webrtc_min(D,G.content))}G=G.right}t()};return a||e?transact$$module$libs$y_webrtc_min(F,I=>{a&&splitSnapshotAffectedStructs$$module$libs$y_webrtc_min(I,a);e&&splitSnapshotAffectedStructs$$module$libs$y_webrtc_min(I,e);K()},"cleanup"):K(),z}insert(a,e,n){if(!(0>=e.length)){var t=this.doc;null!==t?transact$$module$libs$y_webrtc_min(t,z=>{const D=findPosition$$module$libs$y_webrtc_min(z,this,a);n||(n={},D.currentAttributes.forEach((F,J)=>{n[J]=F}));insertText$$module$libs$y_webrtc_min(z,
this,D,e,n)}):this._pending.push(()=>this.insert(a,e,n))}}insertEmbed(a,e,n={}){const t=this.doc;null!==t?transact$$module$libs$y_webrtc_min(t,z=>{const D=findPosition$$module$libs$y_webrtc_min(z,this,a);insertText$$module$libs$y_webrtc_min(z,this,D,e,n)}):this._pending.push(()=>this.insertEmbed(a,e,n))}delete(a,e){if(0!==e){var n=this.doc;null!==n?transact$$module$libs$y_webrtc_min(n,t=>{deleteText$$module$libs$y_webrtc_min(t,findPosition$$module$libs$y_webrtc_min(t,this,a),e)}):this._pending.push(()=>
this.delete(a,e))}}format(a,e,n){if(0!==e){var t=this.doc;null!==t?transact$$module$libs$y_webrtc_min(t,z=>{const D=findPosition$$module$libs$y_webrtc_min(z,this,a);null!==D.right&&formatText$$module$libs$y_webrtc_min(z,this,D,e,n)}):this._pending.push(()=>this.format(a,e,n))}}removeAttribute(a){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,e=>{typeMapDelete$$module$libs$y_webrtc_min(e,this,a)}):this._pending.push(()=>this.removeAttribute(a))}setAttribute(a,e){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,
n=>{typeMapSet$$module$libs$y_webrtc_min(n,this,a,e)}):this._pending.push(()=>this.setAttribute(a,e))}getAttribute(a){return typeMapGet$$module$libs$y_webrtc_min(this,a)}getAttributes(){return typeMapGetAll$$module$libs$y_webrtc_min(this)}_write(a){a.writeTypeRef(YTextRefID$$module$libs$y_webrtc_min)}}
class YXmlTreeWalker$$module$libs$y_webrtc_min{constructor(a,e=()=>!0){this._filter=e;this._root=a;this._currentNode=a._start;this._firstCall=!0}[Symbol.iterator](){return this}next(){let a=this._currentNode,e=a&&a.content&&a.content.type;if(null!==a&&(!this._firstCall||a.deleted||!this._filter(e))){do if(e=a.content.type,a.deleted||e.constructor!==YXmlElement$$module$libs$y_webrtc_min&&e.constructor!==YXmlFragment$$module$libs$y_webrtc_min||null===e._start)for(;null!==a;){if(null!==a.right){a=a.right;
break}a=a.parent===this._root?null:a.parent._item}else a=e._start;while(null!==a&&(a.deleted||!this._filter(a.content.type)))}return this._firstCall=!1,null===a?{value:void 0,done:!0}:(this._currentNode=a,{value:a.content.type,done:!1})}}
class YXmlFragment$$module$libs$y_webrtc_min extends AbstractType$$module$libs$y_webrtc_min{constructor(){super();this._prelimContent=[]}get firstChild(){const a=this._first;return a?a.content.getContent()[0]:null}_integrate(a,e){super._integrate(a,e);this.insert(0,this._prelimContent);this._prelimContent=null}_copy(){return new YXmlFragment$$module$libs$y_webrtc_min}clone(){const a=new YXmlFragment$$module$libs$y_webrtc_min;return a.insert(0,this.toArray().map(e=>e instanceof AbstractType$$module$libs$y_webrtc_min?
e.clone():e)),a}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(a){return new YXmlTreeWalker$$module$libs$y_webrtc_min(this,a)}querySelector(a){a=a.toUpperCase();const e=(new YXmlTreeWalker$$module$libs$y_webrtc_min(this,n=>n.nodeName&&n.nodeName.toUpperCase()===a)).next();return e.done?null:e.value}querySelectorAll(a){return a=a.toUpperCase(),from$$module$libs$y_webrtc_min(new YXmlTreeWalker$$module$libs$y_webrtc_min(this,e=>e.nodeName&&e.nodeName.toUpperCase()===
a))}_callObserver(a,e){callTypeObservers$$module$libs$y_webrtc_min(this,a,new YXmlEvent$$module$libs$y_webrtc_min(this,e,a))}toString(){return typeListMap$$module$libs$y_webrtc_min(this,a=>a.toString()).join("")}toJSON(){return this.toString()}toDOM(a=document,e={},n){const t=a.createDocumentFragment();return void 0!==n&&n._createAssociation(t,this),typeListForEach$$module$libs$y_webrtc_min(this,z=>{t.insertBefore(z.toDOM(a,e,n),null)}),t}insert(a,e){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,
n=>{typeListInsertGenerics$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimContent.splice(a,0,...e)}insertAfter(a,e){if(null!==this.doc)transact$$module$libs$y_webrtc_min(this.doc,n=>{typeListInsertGenericsAfter$$module$libs$y_webrtc_min(n,this,a&&a instanceof AbstractType$$module$libs$y_webrtc_min?a._item:a,e)});else{const n=this._prelimContent,t=null===a?0:n.findIndex(z=>z===a)+1;if(0===t&&null!==a)throw create$2$$module$libs$y_webrtc_min("Reference item not found");n.splice(t,0,...e)}}delete(a,
e=1){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{typeListDelete$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimContent.splice(a,e)}toArray(){return typeListToArray$$module$libs$y_webrtc_min(this)}push(a){this.insert(this.length,a)}unshift(a){this.insert(0,a)}get(a){return typeListGet$$module$libs$y_webrtc_min(this,a)}slice(a=0,e=this.length){return typeListSlice$$module$libs$y_webrtc_min(this,a,e)}forEach(a){typeListForEach$$module$libs$y_webrtc_min(this,a)}_write(a){a.writeTypeRef(YXmlFragmentRefID$$module$libs$y_webrtc_min)}}
class YXmlElement$$module$libs$y_webrtc_min extends YXmlFragment$$module$libs$y_webrtc_min{constructor(a="UNDEFINED"){super();this.nodeName=a;this._prelimAttrs=new Map}get nextSibling(){const a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){const a=this._item?this._item.prev:null;return a?a.content.type:null}_integrate(a,e){super._integrate(a,e);this._prelimAttrs.forEach((n,t)=>{this.setAttribute(t,n)});this._prelimAttrs=null}_copy(){return new YXmlElement$$module$libs$y_webrtc_min(this.nodeName)}clone(){const a=
new YXmlElement$$module$libs$y_webrtc_min(this.nodeName);return((e,n)=>{for(const t in e)n(e[t],t)})(this.getAttributes(),(e,n)=>{"string"==typeof e&&a.setAttribute(n,e)}),a.insert(0,this.toArray().map(e=>e instanceof AbstractType$$module$libs$y_webrtc_min?e.clone():e)),a}toString(){var a=this.getAttributes();const e=[],n=[];for(var t in a)n.push(t);n.sort();t=n.length;for(let z=0;z<t;z++){const D=n[z];e.push(D+'="'+a[D]+'"')}a=this.nodeName.toLocaleLowerCase();return`<${a}${0<e.length?" "+e.join(" "):
""}>${super.toString()}</${a}>`}removeAttribute(a){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,e=>{typeMapDelete$$module$libs$y_webrtc_min(e,this,a)}):this._prelimAttrs.delete(a)}setAttribute(a,e){null!==this.doc?transact$$module$libs$y_webrtc_min(this.doc,n=>{typeMapSet$$module$libs$y_webrtc_min(n,this,a,e)}):this._prelimAttrs.set(a,e)}getAttribute(a){return typeMapGet$$module$libs$y_webrtc_min(this,a)}hasAttribute(a){return typeMapHas$$module$libs$y_webrtc_min(this,a)}getAttributes(){return typeMapGetAll$$module$libs$y_webrtc_min(this)}toDOM(a=
document,e={},n){const t=a.createElement(this.nodeName),z=this.getAttributes();for(const D in z){const F=z[D];"string"==typeof F&&t.setAttribute(D,F)}return typeListForEach$$module$libs$y_webrtc_min(this,D=>{t.appendChild(D.toDOM(a,e,n))}),void 0!==n&&n._createAssociation(t,this),t}_write(a){a.writeTypeRef(YXmlElementRefID$$module$libs$y_webrtc_min);a.writeKey(this.nodeName)}}
class YXmlEvent$$module$libs$y_webrtc_min extends YEvent$$module$libs$y_webrtc_min{constructor(a,e,n){super(a,n);this.childListChanged=!1;this.attributesChanged=new Set;e.forEach(t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)})}}
class YXmlHook$$module$libs$y_webrtc_min extends YMap$$module$libs$y_webrtc_min{constructor(a){super();this.hookName=a}_copy(){return new YXmlHook$$module$libs$y_webrtc_min(this.hookName)}clone(){const a=new YXmlHook$$module$libs$y_webrtc_min(this.hookName);return this.forEach((e,n)=>{a.set(n,e)}),a}toDOM(a,e={},n){a=e[this.hookName];let t;return t=void 0!==a?a.createDom(this):document.createElement(this.hookName),t.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(t,this),
t}_write(a){a.writeTypeRef(YXmlHookRefID$$module$libs$y_webrtc_min);a.writeKey(this.hookName)}}
class YXmlText$$module$libs$y_webrtc_min extends YText$$module$libs$y_webrtc_min{get nextSibling(){const a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){const a=this._item?this._item.prev:null;return a?a.content.type:null}_copy(){return new YXmlText$$module$libs$y_webrtc_min}clone(){const a=new YXmlText$$module$libs$y_webrtc_min;return a.applyDelta(this.toDelta()),a}toDOM(a=document,e,n){a=a.createTextNode(this.toString());return void 0!==n&&n._createAssociation(a,
this),a}toString(){return this.toDelta().map(a=>{const e=[];for(var n in a.attributes){var t=[];for(var z in a.attributes[n])t.push({key:z,value:a.attributes[n][z]});t.sort((D,F)=>D.key<F.key?-1:1);e.push({nodeName:n,attrs:t})}e.sort((D,F)=>D.nodeName<F.nodeName?-1:1);n="";for(t=0;t<e.length;t++){z=e[t];n+="<"+z.nodeName;for(let D=0;D<z.attrs.length;D++){const F=z.attrs[D];n+=` ${F.key}="${F.value}"`}n+=">"}n+=a.insert;for(a=e.length-1;0<=a;a--)n+=`</${e[a].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(a){a.writeTypeRef(YXmlTextRefID$$module$libs$y_webrtc_min)}}
class AbstractStruct$$module$libs$y_webrtc_min{constructor(a,e){this.id=a;this.length=e}get deleted(){throw methodUnimplemented$$module$libs$y_webrtc_min();}mergeWith(a){return!1}write(a,e,n){throw methodUnimplemented$$module$libs$y_webrtc_min();}integrate(a,e){throw methodUnimplemented$$module$libs$y_webrtc_min();}}
class GC$$module$libs$y_webrtc_min extends AbstractStruct$$module$libs$y_webrtc_min{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,e){0<e&&(this.id.clock+=e,this.length-=e);addStruct$$module$libs$y_webrtc_min(a.doc.store,this)}write(a,e){a.writeInfo(0);a.writeLen(this.length-e)}getMissing(a,e){return null}}
class ContentBinary$$module$libs$y_webrtc_min{constructor(a){this.content=a}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ContentBinary$$module$libs$y_webrtc_min(this.content)}splice(a){throw methodUnimplemented$$module$libs$y_webrtc_min();}mergeWith(a){return!1}integrate(a,e){}delete(a){}gc(a){}write(a,e){a.writeBuf(this.content)}getRef(){return 3}}
class ContentDeleted$$module$libs$y_webrtc_min{constructor(a){this.len=a}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ContentDeleted$$module$libs$y_webrtc_min(this.len)}splice(a){const e=new ContentDeleted$$module$libs$y_webrtc_min(this.len-a);return this.len=a,e}mergeWith(a){return this.len+=a.len,!0}integrate(a,e){addToDeleteSet$$module$libs$y_webrtc_min(a.deleteSet,e.id.client,e.id.clock,this.len);e.markDeleted()}delete(a){}gc(a){}write(a,e){a.writeLen(this.len-
e)}getRef(){return 1}}const createDocFromOpts$$module$libs$y_webrtc_min=(a,e)=>new Doc$$module$libs$y_webrtc_min({guid:a,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});
class ContentDoc$$module$libs$y_webrtc_min{constructor(a){a._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid.");this.doc=a;const e={};this.opts=e;a.gc||(e.gc=!1);a.autoLoad&&(e.autoLoad=!0);null!==a.meta&&(e.meta=a.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ContentDoc$$module$libs$y_webrtc_min(createDocFromOpts$$module$libs$y_webrtc_min(this.doc.guid,this.opts))}splice(a){throw methodUnimplemented$$module$libs$y_webrtc_min();
}mergeWith(a){return!1}integrate(a,e){this.doc._item=e;a.subdocsAdded.add(this.doc);this.doc.shouldLoad&&a.subdocsLoaded.add(this.doc)}delete(a){a.subdocsAdded.has(this.doc)?a.subdocsAdded.delete(this.doc):a.subdocsRemoved.add(this.doc)}gc(a){}write(a,e){a.writeString(this.doc.guid);a.writeAny(this.opts)}getRef(){return 9}}
class ContentEmbed$$module$libs$y_webrtc_min{constructor(a){this.embed=a}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ContentEmbed$$module$libs$y_webrtc_min(this.embed)}splice(a){throw methodUnimplemented$$module$libs$y_webrtc_min();}mergeWith(a){return!1}integrate(a,e){}delete(a){}gc(a){}write(a,e){a.writeJSON(this.embed)}getRef(){return 5}}
class ContentFormat$$module$libs$y_webrtc_min{constructor(a,e){this.key=a;this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new ContentFormat$$module$libs$y_webrtc_min(this.key,this.value)}splice(a){throw methodUnimplemented$$module$libs$y_webrtc_min();}mergeWith(a){return!1}integrate(a,e){e.parent._searchMarker=null}delete(a){}gc(a){}write(a,e){a.writeKey(this.key);a.writeJSON(this.value)}getRef(){return 6}}
class ContentJSON$$module$libs$y_webrtc_min{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentJSON$$module$libs$y_webrtc_min(this.arr)}splice(a){const e=new ContentJSON$$module$libs$y_webrtc_min(this.arr.slice(a));return this.arr=this.arr.slice(0,a),e}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,e){}delete(a){}gc(a){}write(a,e){const n=this.arr.length;for(a.writeLen(n-e);e<n;e++){const t=
this.arr[e];a.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}
class ContentAny$$module$libs$y_webrtc_min{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ContentAny$$module$libs$y_webrtc_min(this.arr)}splice(a){const e=new ContentAny$$module$libs$y_webrtc_min(this.arr.slice(a));return this.arr=this.arr.slice(0,a),e}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,e){}delete(a){}gc(a){}write(a,e){const n=this.arr.length;for(a.writeLen(n-e);e<n;e++)a.writeAny(this.arr[e])}getRef(){return 8}}
class ContentString$$module$libs$y_webrtc_min{constructor(a){this.str=a}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ContentString$$module$libs$y_webrtc_min(this.str)}splice(a){const e=new ContentString$$module$libs$y_webrtc_min(this.str.slice(a));this.str=this.str.slice(0,a);const n=this.str.charCodeAt(a-1);return 55296<=n&&56319>=n&&(this.str=this.str.slice(0,a-1)+"\ufffd",e.str="\ufffd"+e.str.slice(1)),e}mergeWith(a){return this.str+=
a.str,!0}integrate(a,e){}delete(a){}gc(a){}write(a,e){a.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}
const typeRefs$$module$libs$y_webrtc_min=[a=>new YArray$$module$libs$y_webrtc_min,a=>new YMap$$module$libs$y_webrtc_min,a=>new YText$$module$libs$y_webrtc_min,a=>new YXmlElement$$module$libs$y_webrtc_min(a.readKey()),a=>new YXmlFragment$$module$libs$y_webrtc_min,a=>new YXmlHook$$module$libs$y_webrtc_min(a.readKey()),a=>new YXmlText$$module$libs$y_webrtc_min],YArrayRefID$$module$libs$y_webrtc_min=0,YMapRefID$$module$libs$y_webrtc_min=1,YTextRefID$$module$libs$y_webrtc_min=2,YXmlElementRefID$$module$libs$y_webrtc_min=
3,YXmlFragmentRefID$$module$libs$y_webrtc_min=4,YXmlHookRefID$$module$libs$y_webrtc_min=5,YXmlTextRefID$$module$libs$y_webrtc_min=6;
class ContentType$$module$libs$y_webrtc_min{constructor(a){this.type=a}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new ContentType$$module$libs$y_webrtc_min(this.type._copy())}splice(a){throw methodUnimplemented$$module$libs$y_webrtc_min();}mergeWith(a){return!1}integrate(a,e){this.type._integrate(a.doc,e)}delete(a){let e=this.type._start;for(;null!==e;)e.deleted?a._mergeStructs.push(e):e.delete(a),e=e.right;this.type._map.forEach(n=>{n.deleted?a._mergeStructs.push(n):
n.delete(a)});a.changed.delete(this.type)}gc(a){let e=this.type._start;for(;null!==e;)e.gc(a,!0),e=e.right;this.type._start=null;this.type._map.forEach(n=>{for(;null!==n;)n.gc(a,!0),n=n.left});this.type._map=new Map}write(a,e){this.type._write(a)}getRef(){return 7}}
const followRedone$$module$libs$y_webrtc_min=(a,e)=>{let n=e,t=0;do 0<t&&(n=createID$$module$libs$y_webrtc_min(n.client,n.clock+t)),e=getItem$$module$libs$y_webrtc_min(a,n),t=n.clock-e.id.clock,n=e.redone;while(null!==n&&e instanceof Item$$module$libs$y_webrtc_min);return{item:e,diff:t}},keepItem$$module$libs$y_webrtc_min=(a,e)=>{for(;null!==a&&a.keep!==e;)a.keep=e,a=a.parent._item},splitItem$$module$libs$y_webrtc_min=(a,e,n)=>{const {client:t,clock:z}=e.id,D=new Item$$module$libs$y_webrtc_min(createID$$module$libs$y_webrtc_min(t,
z+n),e,createID$$module$libs$y_webrtc_min(t,z+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&D.markDeleted(),e.keep&&(D.keep=!0),null!==e.redone&&(D.redone=createID$$module$libs$y_webrtc_min(e.redone.client,e.redone.clock+n)),e.right=D,null!==D.right&&(D.right.left=D),a._mergeStructs.push(D),null!==D.parentSub&&null===D.right&&D.parent._map.set(D.parentSub,D),e.length=n,D},isDeletedByUndoStack$$module$libs$y_webrtc_min=(a,e)=>((n,t)=>{for(let z=0;z<n.length;z++)if(t(n[z],
z,n))return!0;return!1})(a,n=>isDeleted$$module$libs$y_webrtc_min(n.deletions,e)),redoItem$$module$libs$y_webrtc_min=(a,e,n,t,z,D)=>{var F=a.doc,J=F.store;F=F.clientID;var G=e.redone;if(null!==G)return getItemCleanStart$$module$libs$y_webrtc_min(a,G);let K=e.parent._item;if(null!==K&&!0===K.deleted){if(null===K.redone&&(!n.has(K)||null===redoItem$$module$libs$y_webrtc_min(a,K,n,t,z,D)))return null;for(;null!==K.redone;)K=getItemCleanStart$$module$libs$y_webrtc_min(a,K.redone)}G=null===K?e.parent:
K.content.type;if(null===e.parentSub){z=e.left;for(n=e;null!==z;){for(t=z;null!==t&&t.parent._item!==K;)t=null===t.redone?null:getItemCleanStart$$module$libs$y_webrtc_min(a,t.redone);if(null!==t&&t.parent._item===K){z=t;break}z=z.left}for(;null!==n;){for(t=n;null!==t&&t.parent._item!==K;)t=null===t.redone?null:getItemCleanStart$$module$libs$y_webrtc_min(a,t.redone);if(null!==t&&t.parent._item===K){n=t;break}n=n.right}}else if(n=null,e.right&&!z){for(z=e;null!==z&&null!==z.right&&(z.right.redone||
isDeleted$$module$libs$y_webrtc_min(t,z.right.id)||isDeletedByUndoStack$$module$libs$y_webrtc_min(D.undoStack,z.right.id)||isDeletedByUndoStack$$module$libs$y_webrtc_min(D.redoStack,z.right.id));)for(z=z.right;z.redone;)z=getItemCleanStart$$module$libs$y_webrtc_min(a,z.redone);if(z&&null!==z.right)return null}else z=G._map.get(e.parentSub)||null;J=getState$$module$libs$y_webrtc_min(J,F);J=createID$$module$libs$y_webrtc_min(F,J);F=new Item$$module$libs$y_webrtc_min(J,z,z&&z.lastId,n,n&&n.id,G,e.parentSub,
e.content.copy());return e.redone=J,keepItem$$module$libs$y_webrtc_min(F,!0),F.integrate(a,0),F};
class Item$$module$libs$y_webrtc_min extends AbstractStruct$$module$libs$y_webrtc_min{constructor(a,e,n,t,z,D,F,J){super(a,J.getLength());this.origin=n;this.left=e;this.right=t;this.rightOrigin=z;this.parent=D;this.parentSub=F;this.redone=null;this.content=J;this.info=this.content.isCountable()?2:0}set marker(a){0<(8&this.info)!==a&&(this.info^=8)}get marker(){return 0<(8&this.info)}get keep(){return 0<(1&this.info)}set keep(a){this.keep!==a&&(this.info^=1)}get countable(){return 0<(2&this.info)}get deleted(){return 0<
(4&this.info)}set deleted(a){this.deleted!==a&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(a,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=getState$$module$libs$y_webrtc_min(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=getState$$module$libs$y_webrtc_min(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ID$$module$libs$y_webrtc_min&&
this.id.client!==this.parent.client&&this.parent.clock>=getState$$module$libs$y_webrtc_min(e,this.parent.client))return this.parent.client;(this.origin&&(this.left=getItemCleanEnd$$module$libs$y_webrtc_min(a,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=getItemCleanStart$$module$libs$y_webrtc_min(a,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===GC$$module$libs$y_webrtc_min||this.right&&this.right.constructor===GC$$module$libs$y_webrtc_min)&&
(this.parent=null),this.parent)?this.parent.constructor===ID$$module$libs$y_webrtc_min&&(a=getItem$$module$libs$y_webrtc_min(e,this.parent),a.constructor===GC$$module$libs$y_webrtc_min?this.parent=null:this.parent=a.content.type):(this.left&&this.left.constructor===Item$$module$libs$y_webrtc_min&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===Item$$module$libs$y_webrtc_min&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub));
return null}integrate(a,e){if(0<e&&(this.id.clock+=e,this.left=getItemCleanEnd$$module$libs$y_webrtc_min(a,a.doc.store,createID$$module$libs$y_webrtc_min(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!(this.left||this.right&&null===this.right.left)||this.left&&this.left.right!==this.right){let n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&
null!==e.left;)e=e.left;else e=this.parent._start;const t=new Set,z=new Set;for(;null!==e&&e!==this.right;){if(z.add(e),t.add(e),compareIDs$$module$libs$y_webrtc_min(this.origin,e.origin))if(e.id.client<this.id.client)n=e,t.clear();else{if(compareIDs$$module$libs$y_webrtc_min(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!z.has(getItem$$module$libs$y_webrtc_min(a.doc.store,e.origin)))break;t.has(getItem$$module$libs$y_webrtc_min(a.doc.store,e.origin))||(n=e,t.clear())}e=e.right}this.left=
n}if(null!==this.left)this.right=this.left.right,this.left.right=this;else{if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(a));null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length);addStruct$$module$libs$y_webrtc_min(a.doc.store,
this);this.content.integrate(a,this);addChangedTypeToTransaction$$module$libs$y_webrtc_min(a,this.parent,this.parentSub);(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(a)}else(new GC$$module$libs$y_webrtc_min(this.id,this.length)).integrate(a,0)}get next(){let a=this.right;for(;null!==a&&a.deleted;)a=a.right;return a}get prev(){let a=this.left;for(;null!==a&&a.deleted;)a=a.left;return a}get lastId(){return 1===this.length?this.id:createID$$module$libs$y_webrtc_min(this.id.client,
this.id.clock+this.length-1)}mergeWith(a){if(this.constructor===a.constructor&&compareIDs$$module$libs$y_webrtc_min(a.origin,this.lastId)&&this.right===a&&compareIDs$$module$libs$y_webrtc_min(this.rightOrigin,a.rightOrigin)&&this.id.client===a.id.client&&this.id.clock+this.length===a.id.clock&&this.deleted===a.deleted&&null===this.redone&&null===a.redone&&this.content.constructor===a.content.constructor&&this.content.mergeWith(a.content)){const e=this.parent._searchMarker;return e&&e.forEach(n=>{n.p===
a&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),a.keep&&(this.keep=!0),this.right=a.right,null!==this.right&&(this.right.left=this),this.length+=a.length,!0}return!1}delete(a){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length);this.markDeleted();addToDeleteSet$$module$libs$y_webrtc_min(a.deleteSet,this.id.client,this.id.clock,this.length);addChangedTypeToTransaction$$module$libs$y_webrtc_min(a,e,this.parentSub);this.content.delete(a)}}gc(a,
e){if(!this.deleted)throw unexpectedCase$$module$libs$y_webrtc_min();this.content.gc(a);e?(e=new GC$$module$libs$y_webrtc_min(this.id,this.length),a=a.clients.get(this.id.client),a[findIndexSS$$module$libs$y_webrtc_min(a,this.id.clock)]=e):this.content=new ContentDeleted$$module$libs$y_webrtc_min(this.length)}write(a,e){var n=0<e?createID$$module$libs$y_webrtc_min(this.id.client,this.id.clock+e-1):this.origin,t=this.rightOrigin;const z=this.parentSub,D=31&this.content.getRef()|(null===n?0:128)|(null===
t?0:64)|(null===z?0:32);if(a.writeInfo(D),null!==n&&a.writeLeftID(n),null!==t&&a.writeRightID(t),null===n&&null===t)n=this.parent,void 0!==n._item?(t=n._item,null===t?(n=findRootTypeKey$$module$libs$y_webrtc_min(n),a.writeParentInfo(!0),a.writeString(n)):(a.writeParentInfo(!1),a.writeLeftID(t.id))):n.constructor===String?(a.writeParentInfo(!0),a.writeString(n)):n.constructor===ID$$module$libs$y_webrtc_min?(a.writeParentInfo(!1),a.writeLeftID(n)):unexpectedCase$$module$libs$y_webrtc_min(),null!==z&&
a.writeString(z);this.content.write(a,e)}}
const readItemContent$$module$libs$y_webrtc_min=(a,e)=>contentRefs$$module$libs$y_webrtc_min[31&e](a),contentRefs$$module$libs$y_webrtc_min=[()=>{unexpectedCase$$module$libs$y_webrtc_min()},a=>new ContentDeleted$$module$libs$y_webrtc_min(a.readLen()),a=>{const e=a.readLen(),n=[];for(let t=0;t<e;t++){const z=a.readString();"undefined"===z?n.push(void 0):n.push(JSON.parse(z))}return new ContentJSON$$module$libs$y_webrtc_min(n)},a=>new ContentBinary$$module$libs$y_webrtc_min(a.readBuf()),a=>new ContentString$$module$libs$y_webrtc_min(a.readString()),
a=>new ContentEmbed$$module$libs$y_webrtc_min(a.readJSON()),a=>new ContentFormat$$module$libs$y_webrtc_min(a.readKey(),a.readJSON()),a=>new ContentType$$module$libs$y_webrtc_min(typeRefs$$module$libs$y_webrtc_min[a.readTypeRef()](a)),a=>{const e=a.readLen(),n=[];for(let t=0;t<e;t++)n.push(a.readAny());return new ContentAny$$module$libs$y_webrtc_min(n)},a=>new ContentDoc$$module$libs$y_webrtc_min(createDocFromOpts$$module$libs$y_webrtc_min(a.readString(),a.readAny())),()=>{unexpectedCase$$module$libs$y_webrtc_min()}];
class Skip$$module$libs$y_webrtc_min extends AbstractStruct$$module$libs$y_webrtc_min{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,e){unexpectedCase$$module$libs$y_webrtc_min()}write(a,e){a.writeInfo(10);writeVarUint$$module$libs$y_webrtc_min(a.restEncoder,this.length-e)}getMissing(a,e){return null}}
const glo$$module$libs$y_webrtc_min="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};!0===glo$$module$libs$y_webrtc_min["__ $YJS$ __"]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");glo$$module$libs$y_webrtc_min["__ $YJS$ __"]=!0;
var commonjsGlobal$$module$libs$y_webrtc_min="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function commonjsRequire$$module$libs$y_webrtc_min(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs");}
var simplepeer_min$$module$libs$y_webrtc_min=function(a,e){return a(e={exports:{}},e.exports),e.exports}(function(a,e){var n,t,z;a.exports=(n=Math.floor,t=Math.abs,z=Math.pow,function K(F,J,G){function I(M,U){if(!J[M]){if(!F[M]){if(!U&&commonjsRequire$$module$libs$y_webrtc_min)return commonjsRequire$$module$libs$y_webrtc_min();if(L)return L(M,!0);U=Error("Cannot find module '"+M+"'");throw U.code="MODULE_NOT_FOUND",U;}U=J[M]={exports:{}};F[M][0].call(U.exports,function(Z){return I(F[M][1][Z]||Z)},
U,U.exports,K,F,J,G)}return J[M].exports}for(var L=commonjsRequire$$module$libs$y_webrtc_min,Q=0;Q<G.length;Q++)I(G[Q]);return I}({1:[function(F,J,G){function K(M){var U=M.length;if(0<U%4)throw Error("Invalid string. Length must be a multiple of 4");M=M.indexOf("=");return-1===M&&(M=U),[M,M===U?0:4-M%4]}G.byteLength=function(M){M=K(M);var U=M[1];return 3*(M[0]+U)/4-U};G.toByteArray=function(M){var U=K(M);var Z=U[0];U=U[1];var da=new Q(3*(Z+U)/4-U),R=0,ba=0<U?Z-4:Z;for(Z=0;Z<ba;Z+=4){var ha=L[M.charCodeAt(Z)]<<
18|L[M.charCodeAt(Z+1)]<<12|L[M.charCodeAt(Z+2)]<<6|L[M.charCodeAt(Z+3)];da[R++]=255&ha>>16;da[R++]=255&ha>>8;da[R++]=255&ha}return 2===U&&(ha=L[M.charCodeAt(Z)]<<2|L[M.charCodeAt(Z+1)]>>4,da[R++]=255&ha),1===U&&(ha=L[M.charCodeAt(Z)]<<10|L[M.charCodeAt(Z+1)]<<4|L[M.charCodeAt(Z+2)]>>2,da[R++]=255&ha>>8,da[R++]=255&ha),da};G.fromByteArray=function(M){for(var U,Z=M.length,da=Z%3,R=[],ba=0,ha=Z-da;ba<ha;ba+=16383){for(var ma=R,ka=ma.push,pa,la=M,ta=ba+16383>ha?ha:ba+16383,wa=[],za=ba;za<ta;za+=3)pa=
(16711680&la[za]<<16)+(65280&la[za+1]<<8)+(255&la[za+2]),wa.push(I[63&pa>>18]+I[63&pa>>12]+I[63&pa>>6]+I[63&pa]);pa=wa.join("");ka.call(ma,pa)}return 1===da?(U=M[Z-1],R.push(I[U>>2]+I[63&U<<4]+"==")):2===da&&(U=(M[Z-2]<<8)+M[Z-1],R.push(I[U>>10]+I[63&U>>4]+I[63&U<<2]+"=")),R.join("")};var I=[],L=[],Q="undefined"==typeof Uint8Array?Array:Uint8Array;for(F=0;64>F;++F)I[F]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[F],L["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(F)]=
F;L[45]=62;L[95]=63},{}],2:[function(){},{}],3:[function(F,J,G){(function(){(function(){function K(N){if(2147483647<N)throw new RangeError('The value "'+N+'" is invalid for option "size"');N=new Uint8Array(N);return N.__proto__=I.prototype,N}function I(N,O,S){if("number"==typeof N){if("string"==typeof O)throw new TypeError('The "string" argument must be of type string. Received type number');return M(N)}return L(N,O,S)}function L(N,O,S){if("string"==typeof N)return function(oa,Ba){if(("string"!=typeof Ba||
""===Ba)&&(Ba="utf8"),!I.isEncoding(Ba))throw new TypeError("Unknown encoding: "+Ba);var ya=0|da(oa,Ba),ca=K(ya);oa=ca.write(oa,Ba);return oa!==ya&&(ca=ca.slice(0,oa)),ca}(N,O);if(ArrayBuffer.isView(N))return U(N);if(null==N)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof N);if(Sa(N,ArrayBuffer)||N&&Sa(N.buffer,ArrayBuffer))return function(oa,Ba,ya){if(0>Ba||oa.byteLength<Ba)throw new RangeError('"offset" is outside of buffer bounds');
if(oa.byteLength<Ba+(ya||0))throw new RangeError('"length" is outside of buffer bounds');var ca;return(ca=void 0===Ba&&void 0===ya?new Uint8Array(oa):void 0===ya?new Uint8Array(oa,Ba):new Uint8Array(oa,Ba,ya)).__proto__=I.prototype,ca}(N,O,S);if("number"==typeof N)throw new TypeError('The "value" argument must not be of type number. Received type number');var ea=N.valueOf&&N.valueOf();if(null!=ea&&ea!==N)return I.from(ea,O,S);if(ea=function(oa){if(I.isBuffer(oa)){var Ba=0|Z(oa.length),ya=K(Ba);return 0===
ya.length||oa.copy(ya,0,0,Ba),ya}return void 0===oa.length?"Buffer"===oa.type&&Array.isArray(oa.data)?U(oa.data):void 0:"number"!=typeof oa.length||Ya(oa.length)?K(0):U(oa)}(N))return ea;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof N[Symbol.toPrimitive])return I.from(N[Symbol.toPrimitive]("string"),O,S);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof N);}function Q(N){if("number"!=
typeof N)throw new TypeError('"size" argument must be of type number');if(0>N)throw new RangeError('The value "'+N+'" is invalid for option "size"');}function M(N){return Q(N),K(0>N?0:0|Z(N))}function U(N){for(var O=0>N.length?0:0|Z(N.length),S=K(O),ea=0;ea<O;ea+=1)S[ea]=255&N[ea];return S}function Z(N){if(2147483647<=N)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+(2147483647).toString(16)+" bytes");return 0|N}function da(N,O){if(I.isBuffer(N))return N.length;if(ArrayBuffer.isView(N)||
Sa(N,ArrayBuffer))return N.byteLength;if("string"!=typeof N)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof N);var S=N.length,ea=2<arguments.length&&!0===arguments[2];if(!ea&&0===S)return 0;for(var oa=!1;;)switch(O){case "ascii":case "latin1":case "binary":return S;case "utf8":case "utf-8":return Vb(N).length;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return 2*S;case "hex":return S>>>1;case "base64":return Kb(N).length;
default:if(oa)return ea?-1:Vb(N).length;O=(""+O).toLowerCase();oa=!0}}function R(N,O,S){var ea=!1;if(((void 0===O||0>O)&&(O=0),O>this.length)||((void 0===S||S>this.length)&&(S=this.length),0>=S)||(S>>>=0)<=(O>>>=0))return"";for(N||="utf8";;)switch(N){case "hex":N=O;O=this.length;(!N||0>N)&&(N=0);(!S||0>S||S>O)&&(S=O);for(O="";N<S;++N)ea=this[N],ea=16>ea?"0"+ea.toString(16):ea.toString(16),O+=ea;return O;case "utf8":case "utf-8":return pa(this,O,S);case "ascii":N=O;O="";for(S=Zb(this.length,S);N<S;++N)O+=
uc(127&this[N]);return O;case "latin1":case "binary":N=O;O="";for(S=Zb(this.length,S);N<S;++N)O+=uc(this[N]);return O;case "base64":return N=O,0===N&&S===this.length?pd.fromByteArray(this):pd.fromByteArray(this.slice(N,S));case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":S=this.slice(O,S);N="";for(O=0;O<S.length;O+=2)N+=uc(S[O]+256*S[O+1]);return N;default:if(ea)throw new TypeError("Unknown encoding: "+N);N=(N+"").toLowerCase();ea=!0}}function ba(N,O,S){var ea=N[O];N[O]=N[S];N[S]=ea}function ha(N,
O,S,ea,oa){if(0===N.length)return-1;if("string"==typeof S?(ea=S,S=0):2147483647<S?S=2147483647:-2147483648>S&&(S=-2147483648),Ya(S=+S)&&(S=oa?0:N.length-1),0>S&&(S=N.length+S),S>=N.length){if(oa)return-1;S=N.length-1}else if(0>S){if(!oa)return-1;S=0}if("string"==typeof O&&(O=I.from(O,ea)),I.isBuffer(O))return 0===O.length?-1:ma(N,O,S,ea,oa);if("number"==typeof O)return O&=255,"function"==typeof Uint8Array.prototype.indexOf?oa?Uint8Array.prototype.indexOf.call(N,O,S):Uint8Array.prototype.lastIndexOf.call(N,
O,S):ma(N,[O],S,ea,oa);throw new TypeError("val must be string, number or Buffer");}function ma(N,O,S,ea,oa){function Ba(xa,Oa){return 1===ya?xa[Oa]:xa.readUInt16BE(Oa*ya)}var ya=1,ca=N.length,Y=O.length;if(void 0!==ea&&("ucs2"===(ea=(ea+"").toLowerCase())||"ucs-2"===ea||"utf16le"===ea||"utf-16le"===ea)){if(2>N.length||2>O.length)return-1;ya=2;ca/=2;Y/=2;S/=2}if(oa)for(ea=-1;S<ca;S++)if(Ba(N,S)!==Ba(O,-1===ea?0:S-ea))-1!==ea&&(S-=S-ea),ea=-1;else{if(-1===ea&&(ea=S),S-ea+1===Y)return ea*ya}else for(S+
Y>ca&&(S=ca-Y);0<=S;S--){ca=!0;for(ea=0;ea<Y;ea++)if(Ba(N,S+ea)!==Ba(O,ea)){ca=!1;break}if(ca)return S}return-1}function ka(N,O,S,ea){for(var oa=[],Ba=0;Ba<O.length;++Ba)oa.push(255&O.charCodeAt(Ba));return Qd(oa,N,S,ea)}function pa(N,O,S){S=Zb(N.length,S);for(var ea=[];O<S;){var oa,Ba,ya,ca,Y=N[O],xa=null,Oa=239<Y?4:223<Y?3:191<Y?2:1;O+Oa<=S&&(1===Oa?128>Y&&(xa=Y):2===Oa?128==(192&(oa=N[O+1]))&&127<(ca=(31&Y)<<6|63&oa)&&(xa=ca):3===Oa?(oa=N[O+1],Ba=N[O+2],128==(192&oa)&&128==(192&Ba)&&2047<(ca=(15&
Y)<<12|(63&oa)<<6|63&Ba)&&(55296>ca||57343<ca)&&(xa=ca)):4===Oa&&(oa=N[O+1],Ba=N[O+2],ya=N[O+3],128==(192&oa)&&128==(192&Ba)&&128==(192&ya)&&65535<(ca=(15&Y)<<18|(63&oa)<<12|(63&Ba)<<6|63&ya)&&1114112>ca&&(xa=ca)));null===xa?(xa=65533,Oa=1):65535<xa&&(xa-=65536,ea.push(55296|1023&xa>>>10),xa=56320|1023&xa);ea.push(xa);O+=Oa}N=ea.length;if(4096>=N)ea=uc.apply(String,ea);else{S="";for(oa=0;oa<N;)S+=uc.apply(String,ea.slice(oa,oa+=4096));ea=S}return ea}function la(N,O,S){if(0!=N%1||0>N)throw new RangeError("offset is not uint");
if(N+O>S)throw new RangeError("Trying to access beyond buffer length");}function ta(N,O,S,ea,oa,Ba){if(!I.isBuffer(N))throw new TypeError('"buffer" argument must be a Buffer instance');if(O>oa||O<Ba)throw new RangeError('"value" argument is out of bounds');if(S+ea>N.length)throw new RangeError("Index out of range");}function wa(N,O,S,ea){if(S+ea>N.length)throw new RangeError("Index out of range");if(0>S)throw new RangeError("Index out of range");}function za(N,O,S,ea,oa){return O=+O,S>>>=0,oa||wa(N,
0,S,4),Rb.write(N,O,S,ea,23,4),S+4}function Ca(N,O,S,ea,oa){return O=+O,S>>>=0,oa||wa(N,0,S,8),Rb.write(N,O,S,ea,52,8),S+8}function Vb(N,O){O=O||1/0;for(var S,ea=N.length,oa=null,Ba=[],ya=0;ya<ea;++ya){if(55295<(S=N.charCodeAt(ya))&&57344>S){if(!oa){if(56319<S){-1<(O-=3)&&Ba.push(239,191,189);continue}if(ya+1===ea){-1<(O-=3)&&Ba.push(239,191,189);continue}oa=S;continue}if(56320>S){-1<(O-=3)&&Ba.push(239,191,189);oa=S;continue}S=65536+(oa-55296<<10|S-56320)}else oa&&-1<(O-=3)&&Ba.push(239,191,189);
if(oa=null,128>S){if(0>--O)break;Ba.push(S)}else if(2048>S){if(0>(O-=2))break;Ba.push(192|S>>6,128|63&S)}else if(65536>S){if(0>(O-=3))break;Ba.push(224|S>>12,128|63&S>>6,128|63&S)}else{if(!(1114112>S))throw Error("Invalid code point");if(0>(O-=4))break;Ba.push(240|S>>18,128|63&S>>12,128|63&S>>6,128|63&S)}}return Ba}function Kb(N){var O=pd,S=O.toByteArray;if(2>(N=(N=N.split("=")[0]).trim().replace(Me,"")).length)N="";else for(;0!=N.length%4;)N+="=";return S.call(O,N)}function Qd(N,O,S,ea){for(var oa=
0;oa<ea&&!(oa+S>=O.length||oa>=N.length);++oa)O[oa+S]=N[oa];return oa}function Sa(N,O){return N instanceof O||null!=N&&null!=N.constructor&&null!=N.constructor.name&&N.constructor.name===O.name}function Ya(N){return N!=N}var uc=String.fromCharCode,Zb=Math.min,pd=F("base64-js"),Rb=F("ieee754");G.Buffer=I;G.SlowBuffer=function(N){return+N!=N&&(N=0),I.alloc(+N)};G.INSPECT_MAX_BYTES=50;G.kMaxLength=2147483647;I.TYPED_ARRAY_SUPPORT=function(){try{var N=new Uint8Array(1);return N.__proto__={__proto__:Uint8Array.prototype,
foo:function(){return 42}},42===N.foo()}catch(O){return!1}}();I.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");Object.defineProperty(I.prototype,"parent",{enumerable:!0,get:function(){return I.isBuffer(this)?this.buffer:void 0}});Object.defineProperty(I.prototype,"offset",{enumerable:!0,get:function(){return I.isBuffer(this)?
this.byteOffset:void 0}});"undefined"!=typeof Symbol&&null!=Symbol.species&&I[Symbol.species]===I&&Object.defineProperty(I,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1});I.poolSize=8192;I.from=function(N,O,S){return L(N,O,S)};I.prototype.__proto__=Uint8Array.prototype;I.__proto__=Uint8Array;I.alloc=function(N,O,S){return Q(N),0>=N||void 0===O?K(N):"string"==typeof S?K(N).fill(O,S):K(N).fill(O)};I.allocUnsafe=function(N){return M(N)};I.allocUnsafeSlow=function(N){return M(N)};
I.isBuffer=function(N){return null!=N&&!0===N._isBuffer&&N!==I.prototype};I.compare=function(N,O){if(Sa(N,Uint8Array)&&(N=I.from(N,N.offset,N.byteLength)),Sa(O,Uint8Array)&&(O=I.from(O,O.offset,O.byteLength)),!I.isBuffer(N)||!I.isBuffer(O))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(N===O)return 0;for(var S=N.length,ea=O.length,oa=0,Ba=Zb(S,ea);oa<Ba;++oa)if(N[oa]!==O[oa]){S=N[oa];ea=O[oa];break}return S<ea?-1:ea<S?1:0};I.isEncoding=function(N){switch((N+
"").toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "latin1":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;default:return!1}};I.concat=function(N,O){if(!Array.isArray(N))throw new TypeError('"list" argument must be an Array of Buffers');if(0===N.length)return I.alloc(0);var S;if(void 0===O)for(S=O=0;S<N.length;++S)O+=N[S].length;O=I.allocUnsafe(O);var ea=0;for(S=0;S<N.length;++S){var oa=N[S];if(Sa(oa,Uint8Array)&&(oa=I.from(oa)),
!I.isBuffer(oa))throw new TypeError('"list" argument must be an Array of Buffers');oa.copy(O,ea);ea+=oa.length}return O};I.byteLength=da;I.prototype._isBuffer=!0;I.prototype.swap16=function(){var N=this.length;if(0!=N%2)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var O=0;O<N;O+=2)ba(this,O,O+1);return this};I.prototype.swap32=function(){var N=this.length;if(0!=N%4)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var O=0;O<N;O+=4)ba(this,O,O+3),ba(this,
O+1,O+2);return this};I.prototype.swap64=function(){var N=this.length;if(0!=N%8)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var O=0;O<N;O+=8)ba(this,O,O+7),ba(this,O+1,O+6),ba(this,O+2,O+5),ba(this,O+3,O+4);return this};I.prototype.toString=function(){var N=this.length;return 0===N?"":0===arguments.length?pa(this,0,N):R.apply(this,arguments)};I.prototype.toLocaleString=I.prototype.toString;I.prototype.equals=function(N){if(!I.isBuffer(N))throw new TypeError("Argument must be a Buffer");
return this===N||0===I.compare(this,N)};I.prototype.inspect=function(){var N="",O=G.INSPECT_MAX_BYTES;return N=this.toString("hex",0,O).replace(/(.{2})/g,"$1 ").trim(),this.length>O&&(N+=" ... "),"<Buffer "+N+">"};I.prototype.compare=function(N,O,S,ea,oa){if(Sa(N,Uint8Array)&&(N=I.from(N,N.offset,N.byteLength)),!I.isBuffer(N))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof N);if(void 0===O&&(O=0),void 0===S&&(S=N?N.length:0),void 0===ea&&
(ea=0),void 0===oa&&(oa=this.length),0>O||S>N.length||0>ea||oa>this.length)throw new RangeError("out of range index");if(ea>=oa&&O>=S)return 0;if(ea>=oa)return-1;if(O>=S)return 1;if(this===N)return 0;var Ba=(oa>>>=0)-(ea>>>=0),ya=(S>>>=0)-(O>>>=0),ca=Zb(Ba,ya);ea=this.slice(ea,oa);N=N.slice(O,S);for(O=0;O<ca;++O)if(ea[O]!==N[O]){Ba=ea[O];ya=N[O];break}return Ba<ya?-1:ya<Ba?1:0};I.prototype.includes=function(N,O,S){return-1!==this.indexOf(N,O,S)};I.prototype.indexOf=function(N,O,S){return ha(this,
N,O,S,!0)};I.prototype.lastIndexOf=function(N,O,S){return ha(this,N,O,S,!1)};I.prototype.write=function(N,O,S,ea){if(void 0===O)ea="utf8",S=this.length,O=0;else if(void 0===S&&"string"==typeof O)ea=O,S=this.length,O=0;else{if(!isFinite(O))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");O>>>=0;isFinite(S)?(S>>>=0,void 0===ea&&(ea="utf8")):(ea=S,S=void 0)}var oa=this.length-O;if((void 0===S||S>oa)&&(S=oa),0<N.length&&(0>S||0>O)||O>this.length)throw new RangeError("Attempt to write outside buffer bounds");
ea||="utf8";for(oa=!1;;)switch(ea){case "hex":a:{O=+O||0;ea=this.length-O;S?(S=+S)>ea&&(S=ea):S=ea;ea=N.length;S>ea/2&&(S=ea/2);for(oa=0;oa<S;++oa){if(Ya(ea=parseInt(N.substr(2*oa,2),16))){S=oa;break a}this[O+oa]=ea}S=oa}return S;case "utf8":case "utf-8":return Qd(Vb(N,this.length-O),this,O,S);case "ascii":return ka(this,N,O,S);case "latin1":case "binary":return ka(this,N,O,S);case "base64":return Qd(Kb(N),this,O,S);case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":ea=S;oa=this.length-O;for(var Ba=
[],ya=0;ya<N.length&&!(0>(oa-=2));++ya){var ca=N.charCodeAt(ya);S=ca>>8;ca%=256;Ba.push(ca);Ba.push(S)}return Qd(Ba,this,O,ea);default:if(oa)throw new TypeError("Unknown encoding: "+ea);ea=(""+ea).toLowerCase();oa=!0}};I.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};I.prototype.slice=function(N,O){var S=this.length;0>(N=~~N)?0>(N+=S)&&(N=0):N>S&&(N=S);0>(O=void 0===O?S:~~O)?0>(O+=S)&&(O=0):O>S&&(O=S);O<N&&(O=N);N=this.subarray(N,O);return N.__proto__=
I.prototype,N};I.prototype.readUIntLE=function(N,O,S){N>>>=0;O>>>=0;S||la(N,O,this.length);S=this[N];for(var ea=1,oa=0;++oa<O&&(ea*=256);)S+=this[N+oa]*ea;return S};I.prototype.readUIntBE=function(N,O,S){N>>>=0;O>>>=0;S||la(N,O,this.length);S=this[N+--O];for(var ea=1;0<O&&(ea*=256);)S+=this[N+--O]*ea;return S};I.prototype.readUInt8=function(N,O){return N>>>=0,O||la(N,1,this.length),this[N]};I.prototype.readUInt16LE=function(N,O){return N>>>=0,O||la(N,2,this.length),this[N]|this[N+1]<<8};I.prototype.readUInt16BE=
function(N,O){return N>>>=0,O||la(N,2,this.length),this[N]<<8|this[N+1]};I.prototype.readUInt32LE=function(N,O){return N>>>=0,O||la(N,4,this.length),(this[N]|this[N+1]<<8|this[N+2]<<16)+16777216*this[N+3]};I.prototype.readUInt32BE=function(N,O){return N>>>=0,O||la(N,4,this.length),16777216*this[N]+(this[N+1]<<16|this[N+2]<<8|this[N+3])};I.prototype.readIntLE=function(N,O,S){N>>>=0;O>>>=0;S||la(N,O,this.length);S=this[N];for(var ea=1,oa=0;++oa<O&&(ea*=256);)S+=this[N+oa]*ea;return S>=128*ea&&(S-=z(2,
8*O)),S};I.prototype.readIntBE=function(N,O,S){N>>>=0;O>>>=0;S||la(N,O,this.length);S=O;for(var ea=1,oa=this[N+--S];0<S&&(ea*=256);)oa+=this[N+--S]*ea;return oa>=128*ea&&(oa-=z(2,8*O)),oa};I.prototype.readInt8=function(N,O){return N>>>=0,O||la(N,1,this.length),128&this[N]?-1*(255-this[N]+1):this[N]};I.prototype.readInt16LE=function(N,O){N>>>=0;O||la(N,2,this.length);N=this[N]|this[N+1]<<8;return 32768&N?4294901760|N:N};I.prototype.readInt16BE=function(N,O){N>>>=0;O||la(N,2,this.length);N=this[N+1]|
this[N]<<8;return 32768&N?4294901760|N:N};I.prototype.readInt32LE=function(N,O){return N>>>=0,O||la(N,4,this.length),this[N]|this[N+1]<<8|this[N+2]<<16|this[N+3]<<24};I.prototype.readInt32BE=function(N,O){return N>>>=0,O||la(N,4,this.length),this[N]<<24|this[N+1]<<16|this[N+2]<<8|this[N+3]};I.prototype.readFloatLE=function(N,O){return N>>>=0,O||la(N,4,this.length),Rb.read(this,N,!0,23,4)};I.prototype.readFloatBE=function(N,O){return N>>>=0,O||la(N,4,this.length),Rb.read(this,N,!1,23,4)};I.prototype.readDoubleLE=
function(N,O){return N>>>=0,O||la(N,8,this.length),Rb.read(this,N,!0,52,8)};I.prototype.readDoubleBE=function(N,O){return N>>>=0,O||la(N,8,this.length),Rb.read(this,N,!1,52,8)};I.prototype.writeUIntLE=function(N,O,S,ea){N=+N;O>>>=0;S>>>=0;ea||ta(this,N,O,S,z(2,8*S)-1,0);ea=1;var oa=0;for(this[O]=255&N;++oa<S&&(ea*=256);)this[O+oa]=255&N/ea;return O+S};I.prototype.writeUIntBE=function(N,O,S,ea){N=+N;O>>>=0;S>>>=0;ea||ta(this,N,O,S,z(2,8*S)-1,0);ea=S-1;var oa=1;for(this[O+ea]=255&N;0<=--ea&&(oa*=256);)this[O+
ea]=255&N/oa;return O+S};I.prototype.writeUInt8=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,1,255,0),this[O]=255&N,O+1};I.prototype.writeUInt16LE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,2,65535,0),this[O]=255&N,this[O+1]=N>>>8,O+2};I.prototype.writeUInt16BE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,2,65535,0),this[O]=N>>>8,this[O+1]=255&N,O+2};I.prototype.writeUInt32LE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,4,4294967295,0),this[O+3]=N>>>24,this[O+2]=N>>>16,this[O+
1]=N>>>8,this[O]=255&N,O+4};I.prototype.writeUInt32BE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,4,4294967295,0),this[O]=N>>>24,this[O+1]=N>>>16,this[O+2]=N>>>8,this[O+3]=255&N,O+4};I.prototype.writeIntLE=function(N,O,S,ea){(N=+N,O>>>=0,ea)||(ea=z(2,8*S-1),ta(this,N,O,S,ea-1,-ea));ea=0;var oa=1,Ba=0;for(this[O]=255&N;++ea<S&&(oa*=256);)0>N&&0===Ba&&0!==this[O+ea-1]&&(Ba=1),this[O+ea]=255&(N/oa>>0)-Ba;return O+S};I.prototype.writeIntBE=function(N,O,S,ea){(N=+N,O>>>=0,ea)||(ea=z(2,8*S-1),ta(this,
N,O,S,ea-1,-ea));ea=S-1;var oa=1,Ba=0;for(this[O+ea]=255&N;0<=--ea&&(oa*=256);)0>N&&0===Ba&&0!==this[O+ea+1]&&(Ba=1),this[O+ea]=255&(N/oa>>0)-Ba;return O+S};I.prototype.writeInt8=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,1,127,-128),0>N&&(N=255+N+1),this[O]=255&N,O+1};I.prototype.writeInt16LE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,2,32767,-32768),this[O]=255&N,this[O+1]=N>>>8,O+2};I.prototype.writeInt16BE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,2,32767,-32768),this[O]=
N>>>8,this[O+1]=255&N,O+2};I.prototype.writeInt32LE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,4,2147483647,-2147483648),this[O]=255&N,this[O+1]=N>>>8,this[O+2]=N>>>16,this[O+3]=N>>>24,O+4};I.prototype.writeInt32BE=function(N,O,S){return N=+N,O>>>=0,S||ta(this,N,O,4,2147483647,-2147483648),0>N&&(N=4294967295+N+1),this[O]=N>>>24,this[O+1]=N>>>16,this[O+2]=N>>>8,this[O+3]=255&N,O+4};I.prototype.writeFloatLE=function(N,O,S){return za(this,N,O,!0,S)};I.prototype.writeFloatBE=function(N,O,S){return za(this,
N,O,!1,S)};I.prototype.writeDoubleLE=function(N,O,S){return Ca(this,N,O,!0,S)};I.prototype.writeDoubleBE=function(N,O,S){return Ca(this,N,O,!1,S)};I.prototype.copy=function(N,O,S,ea){if(!I.isBuffer(N))throw new TypeError("argument should be a Buffer");if((S||=0,ea||0===ea||(ea=this.length),O>=N.length&&(O=N.length),O||=0,0<ea&&ea<S&&(ea=S),ea===S)||0===N.length||0===this.length)return 0;if(0>O)throw new RangeError("targetStart out of bounds");if(0>S||S>=this.length)throw new RangeError("Index out of range");
if(0>ea)throw new RangeError("sourceEnd out of bounds");ea>this.length&&(ea=this.length);N.length-O<ea-S&&(ea=N.length-O+S);var oa=ea-S;if(this===N&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(O,S,ea);else if(this===N&&S<O&&O<ea)for(ea=oa-1;0<=ea;--ea)N[ea+O]=this[ea+S];else Uint8Array.prototype.set.call(N,this.subarray(S,ea),O);return oa};I.prototype.fill=function(N,O,S,ea){if("string"==typeof N){if("string"==typeof O?(ea=O,O=0,S=this.length):"string"==typeof S&&(ea=S,S=this.length),
void 0!==ea&&"string"!=typeof ea)throw new TypeError("encoding must be a string");if("string"==typeof ea&&!I.isEncoding(ea))throw new TypeError("Unknown encoding: "+ea);if(1===N.length){var oa=N.charCodeAt(0);("utf8"===ea&&128>oa||"latin1"===ea)&&(N=oa)}}else"number"==typeof N&&(N&=255);if(0>O||this.length<O||this.length<S)throw new RangeError("Out of range index");if(S<=O)return this;if(O>>>=0,S=void 0===S?this.length:S>>>0,N||=0,"number"==typeof N)for(ea=O;ea<S;++ea)this[ea]=N;else{oa=I.isBuffer(N)?
N:I.from(N,ea);var Ba=oa.length;if(0===Ba)throw new TypeError('The value "'+N+'" is invalid for argument "value"');for(ea=0;ea<S-O;++ea)this[ea+O]=oa[ea%Ba]}return this};var Me=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,F("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(F,J,G){(function(K){(function(){G.formatArgs=function(L){if(L[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+L[0]+(this.useColors?"%c ":" ")+"+"+J.exports.humanize(this.diff),this.useColors){var Q=
"color: "+this.color;L.splice(1,0,Q,"color: inherit");var M=0,U=0;L[0].replace(/%[a-zA-Z%]/g,Z=>{"%%"===Z||(M++,"%c"===Z&&(U=M))});L.splice(U,0,Q)}};G.save=function(L){try{L?G.storage.setItem("debug",L):G.storage.removeItem("debug")}catch(Q){}};G.load=function(){let L;try{L=G.storage.getItem("debug")}catch(Q){}return!L&&void 0!==K&&"env"in K&&(L=K.env.DEBUG),L};G.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||!("undefined"!=
typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||
"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};a:{try{var I=localStorage;break a}catch(L){}I=void 0}G.storage=I;G.destroy=(()=>{let L=!1;return()=>{L||(L=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();G.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" ");
G.log=console.debug||console.log||(()=>{});J.exports=F("./common")(G);({formatters:I}=J.exports);I.j=function(L){try{return JSON.stringify(L)}catch(Q){return"[UnexpectedJSONParseError]: "+Q.message}}}).call(this)}).call(this,F("_process"))},{"./common":5,_process:12}],5:[function(F,J){J.exports=function(G){function K(Q){function M(...da){if(M.enabled){var R=+new Date;M.diff=R-(U||R);M.prev=U;U=M.curr=R;da[0]=K.coerce(da[0]);"string"!=typeof da[0]&&da.unshift("%O");var ba=0;da[0]=da[0].replace(/%([a-zA-Z%])/g,
(ha,ma)=>{if("%%"===ha)return"%";ba++;ma=K.formatters[ma];"function"==typeof ma&&(ha=ma.call(M,da[ba]),da.splice(ba,1),ba--);return ha});K.formatArgs.call(M,da);(M.log||K.log).apply(M,da)}}let U,Z=null;return M.namespace=Q,M.useColors=K.useColors(),M.color=K.selectColor(Q),M.extend=I,M.destroy=K.destroy,Object.defineProperty(M,"enabled",{enumerable:!0,configurable:!1,get:()=>null===Z?K.enabled(Q):Z,set:da=>{Z=da}}),"function"==typeof K.init&&K.init(M),M}function I(Q,M){Q=K(this.namespace+(void 0===
M?":":M)+Q);return Q.log=this.log,Q}function L(Q){return Q.toString().substring(2,Q.toString().length-2).replace(/\.\*\?$/,"*")}return K.debug=K,K.default=K,K.coerce=function(Q){return Q instanceof Error?Q.stack||Q.message:Q},K.disable=function(){const Q=[...K.names.map(L),...K.skips.map(L).map(M=>"-"+M)].join();return K.enable(""),Q},K.enable=function(Q){let M;K.save(Q);K.names=[];K.skips=[];const U=("string"==typeof Q?Q:"").split(/[\s,]+/),Z=U.length;for(M=0;M<Z;M++)U[M]&&("-"===(Q=U[M].replace(/\*/g,
".*?"))[0]?K.skips.push(new RegExp("^"+Q.substr(1)+"$")):K.names.push(new RegExp("^"+Q+"$")))},K.enabled=function(Q){if("*"===Q[Q.length-1])return!0;let M,U;M=0;for(U=K.skips.length;M<U;M++)if(K.skips[M].test(Q))return!1;M=0;for(U=K.names.length;M<U;M++)if(K.names[M].test(Q))return!0;return!1},K.humanize=F("ms"),K.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(G).forEach(Q=>
{K[Q]=G[Q]}),K.names=[],K.skips=[],K.formatters={},K.selectColor=function(Q){let M=0;for(let U=0;U<Q.length;U++)M=(M<<5)-M+Q.charCodeAt(U),M|=0;return K.colors[t(M)%K.colors.length]},K.enable(K.load()),K}},{ms:11}],6:[function(F,J){function G(K,I){for(const L in I)Object.defineProperty(K,L,{value:I[L],enumerable:!0,configurable:!0});return K}J.exports=function(K,I,L){if(!K||"string"==typeof K)throw new TypeError("Please pass an Error to err-code");L||={};"object"==typeof I&&(L=I,I="");I&&(L.code=
I);try{return G(K,L)}catch(Q){return L.message=K.message,L.stack=K.stack,I=function(){},I.prototype=Object.create(Object.getPrototypeOf(K)),G(new I,L)}}},{}],7:[function(F,J){function G(){G.init.call(this)}function K(ka){if("function"!=typeof ka)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ka);}function I(ka,pa,la,ta){var wa,za,Ca;if(K(la),void 0===(za=ka._events)?(za=ka._events=Object.create(null),ka._eventsCount=0):(void 0!==za.newListener&&(ka.emit("newListener",
pa,la.listener?la.listener:la),za=ka._events),Ca=za[pa]),void 0===Ca)za[pa]=la,++ka._eventsCount;else if("function"==typeof Ca?Ca=za[pa]=ta?[la,Ca]:[Ca,la]:ta?Ca.unshift(la):Ca.push(la),0<(wa=void 0===ka._maxListeners?G.defaultMaxListeners:ka._maxListeners)&&Ca.length>wa&&!Ca.warned)Ca.warned=!0,la=Error("Possible EventEmitter memory leak detected. "+Ca.length+" "+pa+" listeners added. Use emitter.setMaxListeners() to increase limit"),la.name="MaxListenersExceededWarning",la.emitter=ka,la.type=pa,
la.count=Ca.length,console&&console.warn&&console.warn(la);return ka}function L(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Q(ka,pa,la){ka={fired:!1,wrapFn:void 0,target:ka,type:pa,listener:la};pa=L.bind(ka);return pa.listener=la,ka.wrapFn=pa,pa}function M(ka,pa,la){ka=ka._events;if(void 0===ka)return[];pa=ka[pa];if(void 0===pa)la=[];else if("function"==
typeof pa)la=la?[pa.listener||pa]:[pa];else if(la)for(la=Array(pa.length),ka=0;ka<la.length;++ka)la[ka]=pa[ka].listener||pa[ka];else la=Z(pa,pa.length);return la}function U(ka){var pa=this._events;if(void 0!==pa){ka=pa[ka];if("function"==typeof ka)return 1;if(void 0!==ka)return ka.length}return 0}function Z(ka,pa){for(var la=Array(pa),ta=0;ta<pa;++ta)la[ta]=ka[ta];return la}function da(ka,pa,la,ta){if("function"==typeof ka.on)ta.once?ka.once(pa,la):ka.on(pa,la);else{if("function"!=typeof ka.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+
typeof ka);ka.addEventListener(pa,function Ca(za){ta.once&&ka.removeEventListener(pa,Ca);la(za)})}}var R=(F="object"==typeof Reflect?Reflect:null)&&"function"==typeof F.apply?F.apply:function(ka,pa,la){return Function.prototype.apply.call(ka,pa,la)};var ba=F&&"function"==typeof F.ownKeys?F.ownKeys:Object.getOwnPropertySymbols?function(ka){return Object.getOwnPropertyNames(ka).concat(Object.getOwnPropertySymbols(ka))}:function(ka){return Object.getOwnPropertyNames(ka)};var ha=Number.isNaN||function(ka){return ka!=
ka};J.exports=G;J.exports.once=function(ka,pa){return new Promise(function(la,ta){function wa(Ca){ka.removeListener(pa,za);ta(Ca)}function za(){"function"==typeof ka.removeListener&&ka.removeListener("error",wa);la([].slice.call(arguments))}da(ka,pa,za,{once:!0});"error"!==pa&&function(Ca,Vb,Kb){"function"==typeof Ca.on&&da(Ca,"error",Vb,Kb)}(ka,wa,{once:!0})})};G.EventEmitter=G;G.prototype._events=void 0;G.prototype._eventsCount=0;G.prototype._maxListeners=void 0;var ma=10;Object.defineProperty(G,
"defaultMaxListeners",{enumerable:!0,get:function(){return ma},set:function(ka){if("number"!=typeof ka||0>ka||ha(ka))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ka+".");ma=ka}});G.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0);this._maxListeners=this._maxListeners||void 0};G.prototype.setMaxListeners=function(ka){if("number"!=
typeof ka||0>ka||ha(ka))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ka+".");return this._maxListeners=ka,this};G.prototype.getMaxListeners=function(){return void 0===this._maxListeners?G.defaultMaxListeners:this._maxListeners};G.prototype.emit=function(ka){for(var pa=[],la=1;la<arguments.length;la++)pa.push(arguments[la]);la="error"===ka;var ta=this._events;if(void 0!==ta)la=la&&void 0===ta.error;else if(!la)return!1;if(la){var wa;if(0<pa.length&&
(wa=pa[0]),wa instanceof Error)throw wa;pa=Error("Unhandled error."+(wa?" ("+wa.message+")":""));throw pa.context=wa,pa;}la=ta[ka];if(void 0===la)return!1;if("function"==typeof la)R(la,this,pa);else for(wa=la.length,ta=Z(la,wa),la=0;la<wa;++la)R(ta[la],this,pa);return!0};G.prototype.addListener=function(ka,pa){return I(this,ka,pa,!1)};G.prototype.on=G.prototype.addListener;G.prototype.prependListener=function(ka,pa){return I(this,ka,pa,!0)};G.prototype.once=function(ka,pa){return K(pa),this.on(ka,
Q(this,ka,pa)),this};G.prototype.prependOnceListener=function(ka,pa){return K(pa),this.prependListener(ka,Q(this,ka,pa)),this};G.prototype.removeListener=function(ka,pa){var la,ta,wa;if((K(pa),void 0===(ta=this._events))||void 0===(la=ta[ka]))return this;if(la===pa||la.listener===pa)0==--this._eventsCount?this._events=Object.create(null):(delete ta[ka],ta.removeListener&&this.emit("removeListener",ka,la.listener||pa));else if("function"!=typeof la){var za=-1;for(wa=la.length-1;0<=wa;wa--)if(la[wa]===
pa||la[wa].listener===pa){var Ca=la[wa].listener;za=wa;break}if(0>za)return this;if(0===za)la.shift();else{for(;za+1<la.length;za++)la[za]=la[za+1];la.pop()}1===la.length&&(ta[ka]=la[0]);void 0!==ta.removeListener&&this.emit("removeListener",ka,Ca||pa)}return this};G.prototype.off=G.prototype.removeListener;G.prototype.removeAllListeners=function(ka){var pa,la;if(void 0===(la=this._events))return this;if(void 0===la.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=
0):void 0!==la[ka]&&(0==--this._eventsCount?this._events=Object.create(null):delete la[ka]),this;if(0===arguments.length){var ta=Object.keys(la);for(la=0;la<ta.length;++la)"removeListener"!==(pa=ta[la])&&this.removeAllListeners(pa);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(pa=la[ka]))this.removeListener(ka,pa);else if(void 0!==pa)for(la=pa.length-1;0<=la;la--)this.removeListener(ka,pa[la]);return this};G.prototype.listeners=
function(ka){return M(this,ka,!0)};G.prototype.rawListeners=function(ka){return M(this,ka,!1)};G.listenerCount=function(ka,pa){return"function"==typeof ka.listenerCount?ka.listenerCount(pa):U.call(ka,pa)};G.prototype.listenerCount=U;G.prototype.eventNames=function(){return 0<this._eventsCount?ba(this._events):[]}},{}],8:[function(F,J){J.exports=function(){if("undefined"==typeof globalThis)return null;var G={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,
RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return G.RTCPeerConnection?G:null}},{}],9:[function(F,J,G){G.read=function(K,I,L,Q,M){var U=8*M-Q-1;var Z=(1<<U)-1,da=Z>>1,R=-7;M=L?M-1:0;var ba=L?-1:1,ha=K[I+M];M+=ba;L=ha&(1<<-R)-1;ha>>=-R;for(R+=U;0<R;L=256*L+K[I+M],M+=ba,R-=8);U=L&(1<<-R)-1;L>>=-R;for(R+=Q;0<
R;U=256*U+K[I+M],M+=ba,R-=8);if(0===L)L=1-da;else{if(L===Z)return U?NaN:1/0*(ha?-1:1);U+=z(2,Q);L-=da}return(ha?-1:1)*U*z(2,L-Q)};G.write=function(K,I,L,Q,M,U){var Z,da,R,ba=Math.LN2,ha=Math.log,ma=8*U-M-1,ka=(1<<ma)-1,pa=ka>>1,la=23===M?z(2,-24)-z(2,-77):0;U=Q?0:U-1;Q=Q?1:-1;var ta=0>I||0===I&&0>1/I?1:0;I=t(I);for(isNaN(I)||I===1/0?(da=isNaN(I)?1:0,Z=ka):(Z=n(ha(I)/ba),1>I*(R=z(2,-Z))&&(Z--,R*=2),2<=(I+=1<=Z+pa?la/R:la*z(2,1-pa))*R&&(Z++,R/=2),Z+pa>=ka?(da=0,Z=ka):1<=Z+pa?(da=(I*R-1)*z(2,M),Z+=pa):
(da=I*z(2,pa-1)*z(2,M),Z=0));8<=M;K[L+U]=255&da,U+=Q,da/=256,M-=8);Z=Z<<M|da;for(ma+=M;0<ma;K[L+U]=255&Z,U+=Q,Z/=256,ma-=8);K[L+U-Q]|=128*ta}},{}],10:[function(F,J){J.exports="function"==typeof Object.create?function(G,K){K&&(G.super_=K,G.prototype=Object.create(K.prototype,{constructor:{value:G,enumerable:!1,writable:!0,configurable:!0}}))}:function(G,K){if(K){G.super_=K;var I=function(){};I.prototype=K.prototype;G.prototype=new I;G.prototype.constructor=G}}},{}],11:[function(F,J){function G(I,L,
Q,M){return K(I/Q)+" "+M+(L>=1.5*Q?"s":"")}var K=Math.round;J.exports=function(I,L){L=L||{};var Q=typeof I;if("string"==Q&&0<I.length){a:{if(!(100<(I+="").length)&&(L=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(I))){I=parseFloat(L[1]);L=(L[2]||"ms").toLowerCase();I="years"===L||"year"===L||"yrs"===L||"yr"===L||"y"===L?315576E5*I:"weeks"===L||"week"===L||"w"===L?6048E5*I:"days"===L||"day"===L||"d"===L?864E5*
I:"hours"===L||"hour"===L||"hrs"===L||"hr"===L||"h"===L?36E5*I:"minutes"===L||"minute"===L||"mins"===L||"min"===L||"m"===L?6E4*I:"seconds"===L||"second"===L||"secs"===L||"sec"===L||"s"===L?1E3*I:"milliseconds"===L||"millisecond"===L||"msecs"===L||"msec"===L||"ms"===L?I:void 0;break a}I=void 0}return I}if("number"===Q&&isFinite(I))return L.long?(L=t(I),I=864E5<=L?G(I,L,864E5,"day"):36E5<=L?G(I,L,36E5,"hour"):6E4<=L?G(I,L,6E4,"minute"):1E3<=L?G(I,L,1E3,"second"):I+" ms"):(L=t(I),I=864E5<=L?K(I/864E5)+
"d":36E5<=L?K(I/36E5)+"h":6E4<=L?K(I/6E4)+"m":1E3<=L?K(I/1E3)+"s":I+"ms"),I;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(I));}},{}],12:[function(F,J){function G(){throw Error("setTimeout has not been defined");}function K(){throw Error("clearTimeout has not been defined");}function I(ka){if(Z===setTimeout)return setTimeout(ka,0);if((Z===G||!Z)&&setTimeout)return Z=setTimeout,setTimeout(ka,0);try{return Z(ka,0)}catch(pa){try{return Z.call(null,ka,0)}catch(la){return Z.call(this,
ka,0)}}}function L(){ha&&R&&(ha=!1,R.length?ba=R.concat(ba):ma=-1,ba.length&&Q())}function Q(){if(!ha){var ka=I(L);ha=!0;for(var pa=ba.length;pa;){R=ba;for(ba=[];++ma<pa;)R&&R[ma].run();ma=-1;pa=ba.length}R=null;ha=!1;(function(la){if(da===clearTimeout)return clearTimeout(la);if((da===K||!da)&&clearTimeout)return da=clearTimeout,clearTimeout(la);try{da(la)}catch(ta){try{return da.call(null,la)}catch(wa){return da.call(this,la)}}})(ka)}}function M(ka,pa){this.fun=ka;this.array=pa}function U(){}F=J.exports=
{};try{var Z="function"==typeof setTimeout?setTimeout:G}catch(ka){Z=G}try{var da="function"==typeof clearTimeout?clearTimeout:K}catch(ka){da=K}!0;var R,ba=[],ha=!1,ma=-1;F.nextTick=function(ka){var pa=Array(arguments.length-1);if(1<arguments.length)for(var la=1;la<arguments.length;la++)pa[la-1]=arguments[la];ba.push(new M(ka,pa));1!==ba.length||ha||I(Q)};M.prototype.run=function(){this.fun.apply(null,this.array)};F.title="browser";F.browser=!0;F.env={};F.argv=[];F.version="";F.versions={};F.on=U;
F.addListener=U;F.once=U;F.off=U;F.removeListener=U;F.removeAllListeners=U;F.emit=U;F.prependListener=U;F.prependOnceListener=U;F.listeners=function(){return[]};F.binding=function(){throw Error("process.binding is not supported");};F.cwd=function(){return"/"};F.chdir=function(){throw Error("process.chdir is not supported");};F.umask=function(){return 0}},{}],13:[function(F,J){(function(G){(function(){let K;J.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"==typeof window?
G:window):I=>(K||=Promise.resolve()).then(I).catch(L=>setTimeout(()=>{throw L;},0))}).call(this)}).call(this,void 0===commonjsGlobal$$module$libs$y_webrtc_min?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:commonjsGlobal$$module$libs$y_webrtc_min)},{}],14:[function(F,J){(function(G,K){(function(){var I=F("safe-buffer").Buffer,L=K.crypto||K.msCrypto;J.exports=L&&L.getRandomValues?function(Q,M){if(4294967295<Q)throw new RangeError("requested too many random bytes");var U=I.allocUnsafe(Q);
if(0<Q)if(65536<Q)for(var Z=0;Z<Q;Z+=65536)L.getRandomValues(U.slice(Z,Z+65536));else L.getRandomValues(U);return"function"==typeof M?G.nextTick(function(){M(null,U)}):U}:function(){throw Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11");}}).call(this)}).call(this,F("_process"),void 0===commonjsGlobal$$module$libs$y_webrtc_min?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:commonjsGlobal$$module$libs$y_webrtc_min)},
{_process:12,"safe-buffer":30}],15:[function(F,J){function G(L,Q,M){M||=Error;var U=function(Z){function da(R,ba,ha){return Z.call(this,"string"==typeof Q?Q:Q(R,ba,ha))||this}return function(R,ba){R.prototype=Object.create(ba.prototype);R.prototype.constructor=R;R.__proto__=ba}(da,Z),da}(M);U.prototype.name=M.name;U.prototype.code=L;I[L]=U}function K(L,Q){if(Array.isArray(L)){var M=L.length;return L=L.map(function(U){return U+""}),2<M?"one of ".concat(Q," ").concat(L.slice(0,M-1).join(", "),", or ")+
L[M-1]:2===M?"one of ".concat(Q," ").concat(L[0]," or ").concat(L[1]):"of ".concat(Q," ").concat(L[0])}return"of ".concat(Q," ").concat(L+"")}var I={};G("ERR_INVALID_OPT_VALUE",function(L,Q){return'The value "'+Q+'" is invalid for option "'+L+'"'},TypeError);G("ERR_INVALID_ARG_TYPE",function(L,Q,M){var U;if("string"==typeof Q&&function(da,R,ba){return da.substr(!ba||0>ba?0:+ba,R.length)===R}(Q,"not ")?(U="must not be",Q=Q.replace(/^not /,"")):U="must be",function(da,R,ba){return(void 0===ba||ba>da.length)&&
(ba=da.length),da.substring(ba-R.length,ba)===R}(L," argument"))L="The ".concat(L," ").concat(U," ").concat(K(Q,"type"));else{var Z=function(da,R,ba){return"number"!=typeof ba&&(ba=0),!(ba+R.length>da.length)&&-1!==da.indexOf(R,ba)}(L,".")?"property":"argument";L='The "'.concat(L,'" ').concat(Z," ").concat(U," ").concat(K(Q,"type"))}return L+=". Received type ".concat(typeof M)},TypeError);G("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF");G("ERR_METHOD_NOT_IMPLEMENTED",function(L){return"The "+
L+" method is not implemented"});G("ERR_STREAM_PREMATURE_CLOSE","Premature close");G("ERR_STREAM_DESTROYED",function(L){return"Cannot call "+L+" after a stream was destroyed"});G("ERR_MULTIPLE_CALLBACK","Callback called multiple times");G("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable");G("ERR_STREAM_WRITE_AFTER_END","write after end");G("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError);G("ERR_UNKNOWN_ENCODING",function(L){return"Unknown encoding: "+L},TypeError);G("ERR_STREAM_UNSHIFT_AFTER_END_EVENT",
"stream.unshift() after end event");J.exports.codes=I},{}],16:[function(F,J){(function(G){(function(){function K(R){return this instanceof K?(M.call(this,R),U.call(this,R),this.allowHalfOpen=!0,void(R&&(!1===R.readable&&(this.readable=!1),!1===R.writable&&(this.writable=!1),!1===R.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",I))))):new K(R)}function I(){this._writableState.ended||G.nextTick(L,this)}function L(R){R.end()}var Q=Object.keys||function(R){var ba=[],ha;for(ha in R)ba.push(ha);
return ba};J.exports=K;var M=F("./_stream_readable"),U=F("./_stream_writable");F("inherits")(K,M);for(var Z=Q(U.prototype),da=0;da<Z.length;da++)Q=Z[da],K.prototype[Q]||(K.prototype[Q]=U.prototype[Q]);Object.defineProperty(K.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});Object.defineProperty(K.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(K.prototype,
"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});Object.defineProperty(K.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(R){void 0===this._readableState||void 0===this._writableState||(this._readableState.destroyed=R,this._writableState.destroyed=R)}})}).call(this)}).call(this,F("_process"))},{"./_stream_readable":18,"./_stream_writable":20,
_process:12,inherits:10}],17:[function(F,J){function G(I){return this instanceof G?void K.call(this,I):new G(I)}J.exports=G;var K=F("./_stream_transform");F("inherits")(G,K);G.prototype._transform=function(I,L,Q){Q(null,I)}},{"./_stream_transform":19,inherits:10}],18:[function(F,J){(function(G,K){(function(){function I(ca,Y,xa){Ca=Ca||F("./_stream_duplex");ca=ca||{};"boolean"!=typeof xa&&(xa=Y instanceof Ca);this.objectMode=!!ca.objectMode;xa&&(this.objectMode=this.objectMode||!!ca.readableObjectMode);
this.highWaterMark=Me(this,ca,"readableHighWaterMark",xa);this.buffer=new Rb;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.reading=this.endEmitted=this.ended=!1;this.sync=!0;this.resumeScheduled=this.readableListening=this.emittedReadable=this.needReadable=!1;this.paused=!0;this.emitClose=!1!==ca.emitClose;this.autoDestroy=!!ca.autoDestroy;this.destroyed=!1;this.defaultEncoding=ca.defaultEncoding||"utf8";this.awaitDrain=0;this.readingMore=!1;this.encoding=this.decoder=null;
ca.encoding&&(!uc&&(uc=F("string_decoder/").StringDecoder),this.decoder=new uc(ca.encoding),this.encoding=ca.encoding)}function L(ca){if(Ca=Ca||F("./_stream_duplex"),!(this instanceof L))return new L(ca);this._readableState=new I(ca,this,this instanceof Ca);this.readable=!0;ca&&("function"==typeof ca.read&&(this._read=ca.read),"function"==typeof ca.destroy&&(this._destroy=ca.destroy));Vb.call(this)}function Q(ca,Y,xa,Oa,Ob){Ya("readableAddChunk",Y);var Ka=ca._readableState;if(null===Y)Ka.reading=
!1,(Ya("onEofChunk"),Ka.ended)||(Ka.decoder&&(Y=Ka.decoder.end())&&Y.length&&(Ka.buffer.push(Y),Ka.length+=Ka.objectMode?1:Y.length),Ka.ended=!0,Ka.sync?Z(ca):(Ka.needReadable=!1,!Ka.emittedReadable&&(Ka.emittedReadable=!0,da(ca))));else{if(!Ob){Ob=Y;var Ib;var qc=(Kb.isBuffer(Ob)||Ob instanceof Qd||"string"==typeof Ob||void 0===Ob||Ka.objectMode||(Ib=new O("chunk",["string","Buffer","Uint8Array"],Ob)),Ib)}if(qc)Ba(ca,qc);else if(Ka.objectMode||Y&&0<Y.length)if("string"==typeof Y||Ka.objectMode||
Object.getPrototypeOf(Y)===Kb.prototype||(Y=Kb.from(Y)),Oa)Ka.endEmitted?Ba(ca,new oa):M(ca,Ka,Y,!0);else if(Ka.ended)Ba(ca,new S);else{if(Ka.destroyed)return!1;Ka.reading=!1;Ka.decoder&&!xa?(Y=Ka.decoder.write(Y),Ka.objectMode||0!==Y.length?M(ca,Ka,Y,!1):R(ca,Ka)):M(ca,Ka,Y,!1)}else Oa||(Ka.reading=!1,R(ca,Ka))}return!Ka.ended&&(Ka.length<Ka.highWaterMark||0===Ka.length)}function M(ca,Y,xa,Oa){Y.flowing&&0===Y.length&&!Y.sync?(Y.awaitDrain=0,ca.emit("data",xa)):(Y.length+=Y.objectMode?1:xa.length,
Oa?Y.buffer.unshift(xa):Y.buffer.push(xa),Y.needReadable&&Z(ca));R(ca,Y)}function U(ca,Y){if(0>=ca||0===Y.length&&Y.ended)ca=0;else if(Y.objectMode)ca=1;else if(ca==ca){if(ca>Y.highWaterMark){var xa=ca;var Oa=(1073741824<=xa?xa=1073741824:(xa--,xa|=xa>>>1,xa|=xa>>>2,xa|=xa>>>4,xa|=xa>>>8,xa|=xa>>>16,xa++),xa);Y.highWaterMark=Oa}ca=ca<=Y.length?ca:Y.ended?Y.length:(Y.needReadable=!0,0)}else ca=Y.flowing&&Y.length?Y.buffer.head.data.length:Y.length;return ca}function Z(ca){var Y=ca._readableState;Ya("emitReadable",
Y.needReadable,Y.emittedReadable);Y.needReadable=!1;Y.emittedReadable||(Ya("emitReadable",Y.flowing),Y.emittedReadable=!0,G.nextTick(da,ca))}function da(ca){var Y=ca._readableState;Ya("emitReadable_",Y.destroyed,Y.length,Y.ended);!Y.destroyed&&(Y.length||Y.ended)&&(ca.emit("readable"),Y.emittedReadable=!1);Y.needReadable=!Y.flowing&&!Y.ended&&Y.length<=Y.highWaterMark;pa(ca)}function R(ca,Y){Y.readingMore||(Y.readingMore=!0,G.nextTick(ba,ca,Y))}function ba(ca,Y){for(;!Y.reading&&!Y.ended&&(Y.length<
Y.highWaterMark||Y.flowing&&0===Y.length);){var xa=Y.length;if(Ya("maybeReadMore read 0"),ca.read(0),xa===Y.length)break}Y.readingMore=!1}function ha(ca){var Y=ca._readableState;Y.readableListening=0<ca.listenerCount("readable");Y.resumeScheduled&&!Y.paused?Y.flowing=!0:0<ca.listenerCount("data")&&ca.resume()}function ma(ca){Ya("readable nexttick read 0");ca.read(0)}function ka(ca,Y){Ya("resume",Y.reading);Y.reading||ca.read(0);Y.resumeScheduled=!1;ca.emit("resume");pa(ca);Y.flowing&&!Y.reading&&
ca.read(0)}function pa(ca){var Y=ca._readableState;for(Ya("flow",Y.flowing);Y.flowing&&null!==ca.read(););}function la(ca,Y){return 0===Y.length?null:(Y.objectMode?xa=Y.buffer.shift():!ca||ca>=Y.length?(xa=Y.decoder?Y.buffer.join(""):1===Y.buffer.length?Y.buffer.first():Y.buffer.concat(Y.length),Y.buffer.clear()):xa=Y.buffer.consume(ca,Y.decoder),xa);var xa}function ta(ca){var Y=ca._readableState;Ya("endReadable",Y.endEmitted);Y.endEmitted||(Y.ended=!0,G.nextTick(wa,Y,ca))}function wa(ca,Y){if(Ya("endReadableNT",
ca.endEmitted,ca.length),!ca.endEmitted&&0===ca.length&&(ca.endEmitted=!0,Y.readable=!1,Y.emit("end"),ca.autoDestroy))ca=Y._writableState,(!ca||ca.autoDestroy&&ca.finished)&&Y.destroy()}function za(ca,Y){for(var xa=0,Oa=ca.length;xa<Oa;xa++)if(ca[xa]===Y)return xa;return-1}var Ca;J.exports=L;L.ReadableState=I;F("events").EventEmitter;var Vb=F("./internal/streams/stream"),Kb=F("buffer").Buffer,Qd=K.Uint8Array||function(){},Sa=F("util");var Ya=Sa&&Sa.debuglog?Sa.debuglog("stream"):function(){};var uc,
Zb,pd,Rb=F("./internal/streams/buffer_list");Sa=F("./internal/streams/destroy");var Me=F("./internal/streams/state").getHighWaterMark,N=F("../errors").codes,O=N.ERR_INVALID_ARG_TYPE,S=N.ERR_STREAM_PUSH_AFTER_EOF,ea=N.ERR_METHOD_NOT_IMPLEMENTED,oa=N.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;F("inherits")(L,Vb);var Ba=Sa.errorOrDestroy,ya=["error","close","destroy","pause","resume"];Object.defineProperty(L.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},
set:function(ca){this._readableState&&(this._readableState.destroyed=ca)}});L.prototype.destroy=Sa.destroy;L.prototype._undestroy=Sa.undestroy;L.prototype._destroy=function(ca,Y){Y(ca)};L.prototype.push=function(ca,Y){var xa,Oa=this._readableState;return Oa.objectMode?xa=!0:"string"==typeof ca&&((Y=Y||Oa.defaultEncoding)!==Oa.encoding&&(ca=Kb.from(ca,Y),Y=""),xa=!0),Q(this,ca,Y,!1,xa)};L.prototype.unshift=function(ca){return Q(this,ca,null,!0,!1)};L.prototype.isPaused=function(){return!1===this._readableState.flowing};
L.prototype.setEncoding=function(ca){uc||=F("string_decoder/").StringDecoder;ca=new uc(ca);this._readableState.decoder=ca;this._readableState.encoding=this._readableState.decoder.encoding;for(var Y=this._readableState.buffer.head,xa="";null!==Y;)xa+=ca.write(Y.data),Y=Y.next;return this._readableState.buffer.clear(),""!==xa&&this._readableState.buffer.push(xa),this._readableState.length=xa.length,this};L.prototype.read=function(ca){Ya("read",ca);ca=parseInt(ca,10);var Y=this._readableState,xa=ca;
if(0!==ca&&(Y.emittedReadable=!1),0===ca&&Y.needReadable&&((0===Y.highWaterMark?0<Y.length:Y.length>=Y.highWaterMark)||Y.ended))return Ya("read: emitReadable",Y.length,Y.ended),0===Y.length&&Y.ended?ta(this):Z(this),null;if(0===(ca=U(ca,Y))&&Y.ended)return 0===Y.length&&ta(this),null;var Oa,Ob=Y.needReadable;return Ya("need readable",Ob),(0===Y.length||Y.length-ca<Y.highWaterMark)&&Ya("length less than watermark",Ob=!0),Y.ended||Y.reading?Ya("reading or ended",!1):Ob&&(Ya("do read"),Y.reading=!0,
Y.sync=!0,0===Y.length&&(Y.needReadable=!0),this._read(Y.highWaterMark),Y.sync=!1,!Y.reading&&(ca=U(xa,Y))),null===(Oa=0<ca?la(ca,Y):null)?(Y.needReadable=Y.length<=Y.highWaterMark,ca=0):(Y.length-=ca,Y.awaitDrain=0),0===Y.length&&(!Y.ended&&(Y.needReadable=!0),xa!==ca&&Y.ended&&ta(this)),null!==Oa&&this.emit("data",Oa),Oa};L.prototype._read=function(){Ba(this,new ea("_read()"))};L.prototype.pipe=function(ca,Y){function xa($b,vc){Ya("onunpipe");$b===$a&&vc&&!1===vc.hasUnpiped&&(vc.hasUnpiped=!0,Ya("cleanup"),
ca.removeListener("close",Ib),ca.removeListener("finish",qc),ca.removeListener("drain",ef),ca.removeListener("error",Ka),ca.removeListener("unpipe",xa),$a.removeListener("end",Oa),$a.removeListener("end",ff),$a.removeListener("data",Ob),lh=!0,wc.awaitDrain&&(!ca._writableState||ca._writableState.needDrain)&&ef())}function Oa(){Ya("onend");ca.end()}function Ob($b){Ya("ondata");$b=ca.write($b);Ya("dest.write",$b);!1===$b&&((1===wc.pipesCount&&wc.pipes===ca||1<wc.pipesCount&&-1!==za(wc.pipes,ca))&&!lh&&
(Ya("false write response, pause",wc.awaitDrain),wc.awaitDrain++),$a.pause())}function Ka($b){Ya("onerror",$b);ff();ca.removeListener("error",Ka);0===ca.listeners("error").length&&Ba(ca,$b)}function Ib(){ca.removeListener("finish",qc);ff()}function qc(){Ya("onfinish");ca.removeListener("close",Ib);ff()}function ff(){Ya("unpipe");$a.unpipe(ca)}var $a=this,wc=this._readableState;switch(wc.pipesCount){case 0:wc.pipes=ca;break;case 1:wc.pipes=[wc.pipes,ca];break;default:wc.pipes.push(ca)}wc.pipesCount+=
1;Ya("pipe count=%d opts=%j",wc.pipesCount,Y);Y=Y&&!1===Y.end||ca===G.stdout||ca===G.stderr?ff:Oa;wc.endEmitted?G.nextTick(Y):$a.once("end",Y);ca.on("unpipe",xa);var ef=function($b){return function(){var vc=$b._readableState;Ya("pipeOnDrain",vc.awaitDrain);vc.awaitDrain&&vc.awaitDrain--;0===vc.awaitDrain&&$b.listeners("data").length&&(vc.flowing=!0,pa($b))}}($a);ca.on("drain",ef);var lh=!1;return $a.on("data",Ob),function($b,vc,he){"function"==typeof $b.prependListener?$b.prependListener(vc,he):$b._events&&
$b._events[vc]?Array.isArray($b._events[vc])?$b._events[vc].unshift(he):$b._events[vc]=[he,$b._events[vc]]:$b.on(vc,he)}(ca,"error",Ka),ca.once("close",Ib),ca.once("finish",qc),ca.emit("pipe",$a),wc.flowing||(Ya("pipe resume"),$a.resume()),ca};L.prototype.unpipe=function(ca){var Y=this._readableState,xa={hasUnpiped:!1};if(0===Y.pipesCount)return this;if(1===Y.pipesCount)return ca&&ca!==Y.pipes||(ca||=Y.pipes,Y.pipes=null,Y.pipesCount=0,Y.flowing=!1,ca&&ca.emit("unpipe",this,xa)),this;if(!ca){ca=Y.pipes;
xa=Y.pipesCount;Y.pipes=null;Y.pipesCount=0;Y.flowing=!1;for(Y=0;Y<xa;Y++)ca[Y].emit("unpipe",this,{hasUnpiped:!1});return this}var Oa=za(Y.pipes,ca);return-1===Oa||(Y.pipes.splice(Oa,1),--Y.pipesCount,1===Y.pipesCount&&(Y.pipes=Y.pipes[0]),ca.emit("unpipe",this,xa)),this};L.prototype.on=function(ca,Y){Y=Vb.prototype.on.call(this,ca,Y);var xa=this._readableState;return"data"===ca?(xa.readableListening=0<this.listenerCount("readable"),!1!==xa.flowing&&this.resume()):"readable"==ca&&!xa.endEmitted&&
!xa.readableListening&&(xa.readableListening=xa.needReadable=!0,xa.flowing=!1,xa.emittedReadable=!1,Ya("on readable",xa.length,xa.reading),xa.length?Z(this):!xa.reading&&G.nextTick(ma,this)),Y};L.prototype.addListener=L.prototype.on;L.prototype.removeListener=function(ca,Y){Y=Vb.prototype.removeListener.call(this,ca,Y);return"readable"===ca&&G.nextTick(ha,this),Y};L.prototype.removeAllListeners=function(ca){var Y=Vb.prototype.removeAllListeners.apply(this,arguments);return("readable"===ca||void 0===
ca)&&G.nextTick(ha,this),Y};L.prototype.resume=function(){var ca=this._readableState;ca.flowing||(Ya("resume"),ca.flowing=!ca.readableListening,ca.resumeScheduled||(ca.resumeScheduled=!0,G.nextTick(ka,this,ca)));return ca.paused=!1,this};L.prototype.pause=function(){return Ya("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(Ya("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};L.prototype.wrap=function(ca){var Y=this,
xa=this._readableState,Oa=!1,Ob;for(Ob in ca.on("end",function(){if(Ya("wrapped end"),xa.decoder&&!xa.ended){var Ka=xa.decoder.end();Ka&&Ka.length&&Y.push(Ka)}Y.push(null)}),ca.on("data",function(Ka){Ya("wrapped data");xa.decoder&&(Ka=xa.decoder.write(Ka));xa.objectMode&&null==Ka||!(xa.objectMode||Ka&&Ka.length)||Y.push(Ka)||(Oa=!0,ca.pause())}),ca)void 0===this[Ob]&&"function"==typeof ca[Ob]&&(this[Ob]=function(Ka){return function(){return ca[Ka].apply(ca,arguments)}}(Ob));for(Ob=0;Ob<ya.length;Ob++)ca.on(ya[Ob],
this.emit.bind(this,ya[Ob]));return this._read=function(Ka){Ya("wrapped _read",Ka);Oa&&(Oa=!1,ca.resume())},this};"function"==typeof Symbol&&(L.prototype[Symbol.asyncIterator]=function(){return void 0===Zb&&(Zb=F("./internal/streams/async_iterator")),Zb(this)});Object.defineProperty(L.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}});Object.defineProperty(L.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&
this._readableState.buffer}});Object.defineProperty(L.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(ca){this._readableState&&(this._readableState.flowing=ca)}});L._fromList=la;Object.defineProperty(L.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});"function"==typeof Symbol&&(L.from=function(ca,Y){return void 0===pd&&(pd=F("./internal/streams/from")),pd(L,ca,Y)})}).call(this)}).call(this,F("_process"),
void 0===commonjsGlobal$$module$libs$y_webrtc_min?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:commonjsGlobal$$module$libs$y_webrtc_min)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(F,J){function G(R,ba){var ha=
this._transformState;ha.transforming=!1;var ma=ha.writecb;if(null===ma)return this.emit("error",new M);ha.writechunk=null;ha.writecb=null;null!=ba&&this.push(ba);ma(R);R=this._readableState;R.reading=!1;(R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark)}function K(R){return this instanceof K?(da.call(this,R),this._transformState={afterTransform:G.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=
!1,R&&("function"==typeof R.transform&&(this._transform=R.transform),"function"==typeof R.flush&&(this._flush=R.flush)),void this.on("prefinish",I)):new K(R)}function I(){var R=this;"function"!=typeof this._flush||this._readableState.destroyed?L(this,null,null):this._flush(function(ba,ha){L(R,ba,ha)})}function L(R,ba,ha){if(ba)return R.emit("error",ba);if(null!=ha&&R.push(ha),R._writableState.length)throw new Z;if(R._transformState.transforming)throw new U;return R.push(null)}J.exports=K;J=F("../errors").codes;
var Q=J.ERR_METHOD_NOT_IMPLEMENTED,M=J.ERR_MULTIPLE_CALLBACK,U=J.ERR_TRANSFORM_ALREADY_TRANSFORMING,Z=J.ERR_TRANSFORM_WITH_LENGTH_0,da=F("./_stream_duplex");F("inherits")(K,da);K.prototype.push=function(R,ba){return this._transformState.needTransform=!1,da.prototype.push.call(this,R,ba)};K.prototype._transform=function(R,ba,ha){ha(new Q("_transform()"))};K.prototype._write=function(R,ba,ha){var ma=this._transformState;(ma.writecb=ha,ma.writechunk=R,ma.writeencoding=ba,ma.transforming)||(R=this._readableState,
(ma.needTransform||R.needReadable||R.length<R.highWaterMark)&&this._read(R.highWaterMark))};K.prototype._read=function(){var R=this._transformState;null===R.writechunk||R.transforming?R.needTransform=!0:(R.transforming=!0,this._transform(R.writechunk,R.writeencoding,R.afterTransform))};K.prototype._destroy=function(R,ba){da.prototype._destroy.call(this,R,function(ha){ba(ha)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(F,J){(function(G,K){(function(){function I(O){var S=this;
this.entry=this.next=null;this.finish=function(){var ea=S.entry;for(S.entry=null;ea;){var oa=ea.callback;O.pendingcb--;oa(void 0);ea=ea.next}O.corkedRequestsFree.next=S;!0}}function L(){}function Q(O,S,ea){ka=ka||F("./_stream_duplex");O=O||{};"boolean"!=typeof ea&&(ea=S instanceof ka);this.objectMode=!!O.objectMode;ea&&(this.objectMode=this.objectMode||!!O.writableObjectMode);this.highWaterMark=Vb(this,O,"writableHighWaterMark",ea);this.destroyed=this.finished=this.ended=this.ending=this.needDrain=
this.finalCalled=!1;this.decodeStrings=!1!==O.decodeStrings;this.defaultEncoding=O.defaultEncoding||"utf8";this.length=0;this.writing=!1;this.corked=0;this.sync=!0;this.bufferProcessing=!1;this.onwrite=function(oa){Z(S,oa)};this.writecb=null;this.writelen=0;this.lastBufferedRequest=this.bufferedRequest=null;this.pendingcb=0;this.errorEmitted=this.prefinished=!1;this.emitClose=!1!==O.emitClose;this.autoDestroy=!!O.autoDestroy;this.bufferedRequestCount=0;this.corkedRequestsFree=new I(this)}function M(O){var S=
this instanceof(ka=ka||F("./_stream_duplex"));return S||pa.call(M,this)?(this._writableState=new Q(O,this,S),this.writable=!0,O&&("function"==typeof O.write&&(this._write=O.write),"function"==typeof O.writev&&(this._writev=O.writev),"function"==typeof O.destroy&&(this._destroy=O.destroy),"function"==typeof O.final&&(this._final=O.final)),void ta.call(this)):new M(O)}function U(O,S,ea,oa,Ba,ya,ca){S.writelen=oa;S.writecb=ca;S.writing=!0;S.sync=!0;S.destroyed?S.onwrite(new Zb("write")):ea?O._writev(Ba,
S.onwrite):O._write(Ba,ya,S.onwrite);S.sync=!1}function Z(O,S){var ea=O._writableState,oa=ea.sync,Ba=ea.writecb;if("function"!=typeof Ba)throw new Ya;(function(ya){ya.writing=!1;ya.writecb=null;ya.length-=ya.writelen;ya.writelen=0}(ea),S)?!function(ya,ca,Y,xa,Oa){--ca.pendingcb;Y?(G.nextTick(Oa,xa),G.nextTick(ma,ya,ca),ya._writableState.errorEmitted=!0,N(ya,xa)):(Oa(xa),ya._writableState.errorEmitted=!0,N(ya,xa),ma(ya,ca))}(O,ea,oa,S,Ba):((S=ba(ea)||O.destroyed)||ea.corked||ea.bufferProcessing||!ea.bufferedRequest||
R(O,ea),oa?G.nextTick(da,O,ea,S,Ba):da(O,ea,S,Ba))}function da(O,S,ea,oa){ea||0===S.length&&S.needDrain&&(S.needDrain=!1,O.emit("drain"));S.pendingcb--;oa();ma(O,S)}function R(O,S){S.bufferProcessing=!0;var ea=S.bufferedRequest;if(O._writev&&ea&&ea.next){var oa=Array(S.bufferedRequestCount),Ba=S.corkedRequestsFree;Ba.entry=ea;for(var ya=0,ca=!0;ea;)oa[ya]=ea,ea.isBuf||(ca=!1),ea=ea.next,ya+=1;oa.allBuffers=ca;U(O,S,!0,S.length,oa,"",Ba.finish);S.pendingcb++;S.lastBufferedRequest=null;Ba.next?(S.corkedRequestsFree=
Ba.next,Ba.next=null):S.corkedRequestsFree=new I(S);S.bufferedRequestCount=0}else{for(;ea&&(oa=ea.chunk,U(O,S,!1,S.objectMode?1:oa.length,oa,ea.encoding,ea.callback),ea=ea.next,S.bufferedRequestCount--,!S.writing););null===ea&&(S.lastBufferedRequest=null)}S.bufferedRequest=ea;S.bufferProcessing=!1}function ba(O){return O.ending&&0===O.length&&null===O.bufferedRequest&&!O.finished&&!O.writing}function ha(O,S){O._final(function(ea){S.pendingcb--;ea&&N(O,ea);S.prefinished=!0;O.emit("prefinish");ma(O,
S)})}function ma(O,S){var ea=ba(S),oa;if(oa=ea)S.prefinished||S.finalCalled||("function"!=typeof O._final||S.destroyed?(S.prefinished=!0,O.emit("prefinish")):(S.pendingcb++,S.finalCalled=!0,G.nextTick(ha,O,S))),oa=0===S.pendingcb&&(S.finished=!0,O.emit("finish"),S.autoDestroy);oa&&(S=O._readableState,(!S||S.autoDestroy&&S.endEmitted)&&O.destroy());return ea}var ka;J.exports=M;M.WritableState=Q;var pa,la={deprecate:F("util-deprecate")},ta=F("./internal/streams/stream"),wa=F("buffer").Buffer,za=K.Uint8Array||
function(){},Ca=F("./internal/streams/destroy"),Vb=F("./internal/streams/state").getHighWaterMark,Kb=F("../errors").codes,Qd=Kb.ERR_INVALID_ARG_TYPE,Sa=Kb.ERR_METHOD_NOT_IMPLEMENTED,Ya=Kb.ERR_MULTIPLE_CALLBACK,uc=Kb.ERR_STREAM_CANNOT_PIPE,Zb=Kb.ERR_STREAM_DESTROYED,pd=Kb.ERR_STREAM_NULL_VALUES,Rb=Kb.ERR_STREAM_WRITE_AFTER_END,Me=Kb.ERR_UNKNOWN_ENCODING,N=Ca.errorOrDestroy;F("inherits")(M,ta);Q.prototype.getBuffer=function(){for(var O=this.bufferedRequest,S=[];O;)S.push(O),O=O.next;return S};(function(){try{Object.defineProperty(Q.prototype,
"buffer",{get:la.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(O){}})();"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(pa=Function.prototype[Symbol.hasInstance],Object.defineProperty(M,Symbol.hasInstance,{value:function(O){return!!pa.call(this,O)||this===M&&O&&O._writableState instanceof Q}})):pa=function(O){return O instanceof this};M.prototype.pipe=
function(){N(this,new uc)};M.prototype.write=function(O,S,ea){var oa=this._writableState,Ba=!1,ya;if(ya=!oa.objectMode)ya=O,ya=wa.isBuffer(ya)||ya instanceof za;ya&&!wa.isBuffer(O)&&(O=wa.from(O));"function"==typeof S&&(ea=S,S=null);ya?S="buffer":!S&&(S=oa.defaultEncoding);"function"!=typeof ea&&(ea=L);if(oa.ending)oa=ea,ea=new Rb,N(this,ea),G.nextTick(oa,ea);else{var ca;if(!(ca=ya)){var Y=O,xa=ea,Oa;ca=(null===Y?Oa=new pd:"string"!=typeof Y&&!oa.objectMode&&(Oa=new Qd("chunk",["string","Buffer"],
Y)),!Oa||(N(this,Oa),G.nextTick(xa,Oa),!1))}ca&&(oa.pendingcb++,Ba=ya,Ba||(ya=O,Oa=(oa.objectMode||!1===oa.decodeStrings||"string"!=typeof ya||(ya=wa.from(ya,S)),ya),O!==Oa&&(Ba=!0,S="buffer",O=Oa)),ya=oa.objectMode?1:O.length,oa.length+=ya,Oa=oa.length<oa.highWaterMark,(Oa||(oa.needDrain=!0),oa.writing||oa.corked)?(ya=oa.lastBufferedRequest,oa.lastBufferedRequest={chunk:O,encoding:S,isBuf:Ba,callback:ea,next:null},ya?ya.next=oa.lastBufferedRequest:oa.bufferedRequest=oa.lastBufferedRequest,oa.bufferedRequestCount+=
1):U(this,oa,!1,ya,O,S,ea),Ba=Oa)}return Ba};M.prototype.cork=function(){this._writableState.corked++};M.prototype.uncork=function(){var O=this._writableState;O.corked&&(O.corked--,!O.writing&&!O.corked&&!O.bufferProcessing&&O.bufferedRequest&&R(this,O))};M.prototype.setDefaultEncoding=function(O){if("string"==typeof O&&(O=O.toLowerCase()),!(-1<"hex utf8 utf-8 ascii binary base64 ucs2 ucs-2 utf16le utf-16le raw".split(" ").indexOf((O+"").toLowerCase())))throw new Me(O);return this._writableState.defaultEncoding=
O,this};Object.defineProperty(M.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});Object.defineProperty(M.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});M.prototype._write=function(O,S,ea){ea(new Sa("_write()"))};M.prototype._writev=null;M.prototype.end=function(O,S,ea){var oa=this._writableState;"function"==typeof O?(ea=O,O=null,S=null):"function"==typeof S&&(ea=S,S=
null);null!=O&&this.write(O,S);oa.corked&&(oa.corked=1,this.uncork());oa.ending||(O=ea,oa.ending=!0,ma(this,oa),O&&(oa.finished?G.nextTick(O):this.once("finish",O)),oa.ended=!0,this.writable=!1);return this};Object.defineProperty(M.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});Object.defineProperty(M.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(O){this._writableState&&
(this._writableState.destroyed=O)}});M.prototype.destroy=Ca.destroy;M.prototype._undestroy=Ca.undestroy;M.prototype._destroy=function(O,S){S(O)}}).call(this)}).call(this,F("_process"),void 0===commonjsGlobal$$module$libs$y_webrtc_min?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:commonjsGlobal$$module$libs$y_webrtc_min)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,
"util-deprecate":32}],21:[function(F,J){(function(G){(function(){function K(ta,wa,za){return wa in ta?Object.defineProperty(ta,wa,{value:za,enumerable:!0,configurable:!0,writable:!0}):ta[wa]=za,ta}function I(ta,wa){return{value:ta,done:wa}}function L(ta){var wa=ta[Z];if(null!==wa){var za=ta[ka].read();null!==za&&(ta[ha]=null,ta[Z]=null,ta[da]=null,wa(I(za,!1)))}}function Q(ta){G.nextTick(L,ta)}var M,U=F("./end-of-stream"),Z=Symbol("lastResolve"),da=Symbol("lastReject"),R=Symbol("error"),ba=Symbol("ended"),
ha=Symbol("lastPromise"),ma=Symbol("handlePromise"),ka=Symbol("stream"),pa=Object.getPrototypeOf(function(){}),la=Object.setPrototypeOf((M={get stream(){return this[ka]},next:function(){var ta=this,wa=this[R];if(null!==wa)return Promise.reject(wa);if(this[ba])return Promise.resolve(I(void 0,!0));if(this[ka].destroyed)return new Promise(function(za,Ca){G.nextTick(function(){ta[R]?Ca(ta[R]):za(I(void 0,!0))})});if(wa=this[ha])wa=new Promise(function(za,Ca){return function(Vb,Kb){za.then(function(){return Ca[ba]?
void Vb(I(void 0,!0)):void Ca[ma](Vb,Kb)},Kb)}}(wa,this));else{wa=this[ka].read();if(null!==wa)return Promise.resolve(I(wa,!1));wa=new Promise(this[ma])}return this[ha]=wa,wa}},K(M,Symbol.asyncIterator,function(){return this}),K(M,"return",function(){var ta=this;return new Promise(function(wa,za){ta[ka].destroy(null,function(Ca){return Ca?void za(Ca):void wa(I(void 0,!0))})})}),M),pa);J.exports=function(ta){var wa,za=Object.create(la,(K(wa={},ka,{value:ta,writable:!0}),K(wa,Z,{value:null,writable:!0}),
K(wa,da,{value:null,writable:!0}),K(wa,R,{value:null,writable:!0}),K(wa,ba,{value:ta._readableState.endEmitted,writable:!0}),K(wa,ma,{value:function(Ca,Vb){var Kb=za[ka].read();Kb?(za[ha]=null,za[Z]=null,za[da]=null,Ca(I(Kb,!1))):(za[Z]=Ca,za[da]=Vb)},writable:!0}),wa));return za[ha]=null,U(ta,function(Ca){if(Ca&&"ERR_STREAM_PREMATURE_CLOSE"!==Ca.code){var Vb=za[da];return null!==Vb&&(za[ha]=null,za[Z]=null,za[da]=null,Vb(Ca)),void(za[R]=Ca)}Ca=za[Z];null!==Ca&&(za[ha]=null,za[Z]=null,za[da]=null,
Ca(I(void 0,!0)));za[ba]=!0}),ta.on("readable",Q.bind(null,za)),za}}).call(this)}).call(this,F("_process"))},{"./end-of-stream":24,_process:12}],22:[function(F,J){function G(M,U){var Z=Object.keys(M);if(Object.getOwnPropertySymbols){var da=Object.getOwnPropertySymbols(M);U&&(da=da.filter(function(R){return Object.getOwnPropertyDescriptor(M,R).enumerable}));Z.push.apply(Z,da)}return Z}function K(M,U){for(var Z,da=0;da<U.length;da++)(Z=U[da]).enumerable=Z.enumerable||!1,Z.configurable=!0,"value"in Z&&
(Z.writable=!0),Object.defineProperty(M,Z.key,Z)}var I=F("buffer").Buffer,L=F("util").inspect,Q=L&&L.custom||"inspect";J.exports=function(){function M(){if(!(this instanceof M))throw new TypeError("Cannot call a class as a function");this.tail=this.head=null;this.length=0}return function(U,Z,da){Z&&K(U.prototype,Z);da&&K(U,da)}(M,[{key:"push",value:function(U){U={data:U,next:null};0<this.length?this.tail.next=U:this.head=U;this.tail=U;++this.length}},{key:"unshift",value:function(U){U={data:U,next:this.head};
0===this.length&&(this.tail=U);this.head=U;++this.length}},{key:"shift",value:function(){if(0!==this.length){var U=this.head.data;return this.head=1===this.length?this.tail=null:this.head.next,--this.length,U}}},{key:"clear",value:function(){this.head=this.tail=null;this.length=0}},{key:"join",value:function(U){if(0===this.length)return"";for(var Z=this.head,da=""+Z.data;Z=Z.next;)da+=U+Z.data;return da}},{key:"concat",value:function(U){if(0===this.length)return I.alloc(0);U=I.allocUnsafe(U>>>0);
for(var Z=this.head,da=0;Z;)I.prototype.copy.call(Z.data,U,da),da+=Z.data.length,Z=Z.next;return U}},{key:"consume",value:function(U,Z){var da;return U<this.head.data.length?(da=this.head.data.slice(0,U),this.head.data=this.head.data.slice(U)):da=U===this.head.data.length?this.shift():Z?this._getString(U):this._getBuffer(U),da}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(U){var Z=this.head,da=1,R=Z.data;for(U-=R.length;Z=Z.next;){var ba=Z.data,ha=U>ba.length?
ba.length:U;if(R+=ha===ba.length?ba:ba.slice(0,U),0==(U-=ha)){ha===ba.length?(++da,this.head=Z.next?Z.next:this.tail=null):(this.head=Z,Z.data=ba.slice(ha));break}++da}return this.length-=da,R}},{key:"_getBuffer",value:function(U){var Z=I.allocUnsafe(U),da=this.head,R=1;da.data.copy(Z);for(U-=da.data.length;da=da.next;){var ba=da.data,ha=U>ba.length?ba.length:U;if(ba.copy(Z,Z.length-U,0,ha),0==(U-=ha)){ha===ba.length?(++R,this.head=da.next?da.next:this.tail=null):(this.head=da,da.data=ba.slice(ha));
break}++R}return this.length-=R,Z}},{key:Q,value:function(U,Z){return L(this,function(da){for(var R,ba=1;ba<arguments.length;ba++)R=null==arguments[ba]?{}:arguments[ba],ba%2?G(Object(R),!0).forEach(function(ha){var ma=R[ha];ha in da?Object.defineProperty(da,ha,{value:ma,enumerable:!0,configurable:!0,writable:!0}):da[ha]=ma}):Object.getOwnPropertyDescriptors?Object.defineProperties(da,Object.getOwnPropertyDescriptors(R)):G(Object(R)).forEach(function(ha){Object.defineProperty(da,ha,Object.getOwnPropertyDescriptor(R,
ha))});return da}({},Z,{depth:0,customInspect:!1}))}}]),M}()},{buffer:3,util:2}],23:[function(F,J){(function(G){(function(){function K(Q,M){L(Q,M);I(Q)}function I(Q){Q._writableState&&!Q._writableState.emitClose||Q._readableState&&!Q._readableState.emitClose||Q.emit("close")}function L(Q,M){Q.emit("error",M)}J.exports={destroy:function(Q,M){var U=this,Z=this._writableState&&this._writableState.destroyed;return this._readableState&&this._readableState.destroyed||Z?(M?M(Q):Q&&(this._writableState?!this._writableState.errorEmitted&&
(this._writableState.errorEmitted=!0,G.nextTick(L,this,Q)):G.nextTick(L,this,Q)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(Q||null,function(da){!M&&da?U._writableState?U._writableState.errorEmitted?G.nextTick(I,U):(U._writableState.errorEmitted=!0,G.nextTick(K,U,da)):G.nextTick(K,U,da):M?(G.nextTick(I,U),M(da)):G.nextTick(I,U)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=
!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1);this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(Q,M){var U=Q._readableState,Z=Q._writableState;U&&U.autoDestroy||Z&&Z.autoDestroy?Q.destroy(M):Q.emit("error",M)}}}).call(this)}).call(this,
F("_process"))},{_process:12}],24:[function(F,J){function G(){}var K=F("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;J.exports=function U(L,Q,M){if("function"==typeof Q)return U(L,null,Q);Q||={};M=function(wa){var za=!1;return function(){if(!za){za=!0;for(var Ca=arguments.length,Vb=Array(Ca),Kb=0;Kb<Ca;Kb++)Vb[Kb]=arguments[Kb];wa.apply(this,Vb)}}}(M||G);var Z=Q.readable||!1!==Q.readable&&L.readable,da=Q.writable||!1!==Q.writable&&L.writable,R=function(){L.writable||ha()},ba=L._writableState&&
L._writableState.finished,ha=function(){da=!1;ba=!0;Z||M.call(L)},ma=L._readableState&&L._readableState.endEmitted,ka=function(){Z=!1;ma=!0;da||M.call(L)},pa=function(wa){M.call(L,wa)},la=function(){var wa;return Z&&!ma?(L._readableState&&L._readableState.ended||(wa=new K),M.call(L,wa)):da&&!ba?(L._writableState&&L._writableState.ended||(wa=new K),M.call(L,wa)):void 0},ta=function(){L.req.on("finish",ha)};return L.setHeader&&"function"==typeof L.abort?(L.on("complete",ha),L.on("abort",la),L.req?ta():
L.on("request",ta)):da&&!L._writableState&&(L.on("end",R),L.on("close",R)),L.on("end",ka),L.on("finish",ha),!1!==Q.error&&L.on("error",pa),L.on("close",la),function(){L.removeListener("complete",ha);L.removeListener("abort",la);L.removeListener("request",ta);L.req&&L.req.removeListener("finish",ha);L.removeListener("end",R);L.removeListener("close",R);L.removeListener("finish",ha);L.removeListener("end",ka);L.removeListener("error",pa);L.removeListener("close",la)}}},{"../../../errors":15}],25:[function(F,
J){J.exports=function(){throw Error("Readable.from is not available in the browser");}},{}],26:[function(F,J){function G(da){if(da)throw da;}function K(da,R,ba,ha){ha=function(pa){var la=!1;return function(){la||(la=!0,pa.apply(void 0,arguments))}}(ha);var ma=!1;da.on("close",function(){ma=!0});void 0===Q&&(Q=F("./end-of-stream"));Q(da,{readable:R,writable:ba},function(pa){return pa?ha(pa):(ma=!0,void ha())});var ka=!1;return function(pa){if(!ma)return ka?void 0:(ka=!0,da.setHeader&&"function"==typeof da.abort?
da.abort():"function"==typeof da.destroy?da.destroy():void ha(pa||new Z("pipe")))}}function I(da){da()}function L(da,R){return da.pipe(R)}var Q,M=F("../../../errors").codes,U=M.ERR_MISSING_ARGS,Z=M.ERR_STREAM_DESTROYED;J.exports=function(){for(var da=arguments.length,R=Array(da),ba=0;ba<da;ba++)R[ba]=arguments[ba];var ha=R.length&&"function"==typeof R[R.length-1]?R.pop():G;if(Array.isArray(R[0])&&(R=R[0]),2>R.length)throw new U("streams");var ma,ka=R.map(function(pa,la){var ta=la<R.length-1;return K(pa,
ta,0<la,function(wa){ma||=wa;wa&&ka.forEach(I);ta||(ka.forEach(I),ha(ma))})});return R.reduce(L)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(F,J){var G=F("../../../errors").codes.ERR_INVALID_OPT_VALUE;J.exports={getHighWaterMark:function(K,I,L,Q){I=null==I.highWaterMark?Q?I[L]:null:I.highWaterMark;if(null!=I){if(!isFinite(I)||n(I)!==I||0>I)throw new G(Q?L:"highWaterMark",I);return n(I)}return K.objectMode?16:16384}}},{"../../../errors":15}],28:[function(F,J){J.exports=F("events").EventEmitter},
{events:7}],29:[function(F,J,G){(G=J.exports=F("./lib/_stream_readable.js")).Stream=G;G.Readable=G;G.Writable=F("./lib/_stream_writable.js");G.Duplex=F("./lib/_stream_duplex.js");G.Transform=F("./lib/_stream_transform.js");G.PassThrough=F("./lib/_stream_passthrough.js");G.finished=F("./lib/internal/streams/end-of-stream.js");G.pipeline=F("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,
"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(F,J,G){function K(M,U){for(var Z in M)U[Z]=M[Z]}function I(M,U,Z){return Q(M,U,Z)}var L=F("buffer"),Q=L.Buffer;Q.from&&Q.alloc&&Q.allocUnsafe&&Q.allocUnsafeSlow?J.exports=L:(K(L,G),G.Buffer=I);I.prototype=Object.create(Q.prototype);K(Q,I);I.from=function(M,U,Z){if("number"==typeof M)throw new TypeError("Argument must not be a number");return Q(M,U,Z)};I.alloc=function(M,
U,Z){if("number"!=typeof M)throw new TypeError("Argument must be a number");M=Q(M);return void 0===U?M.fill(0):"string"==typeof Z?M.fill(U,Z):M.fill(U),M};I.allocUnsafe=function(M){if("number"!=typeof M)throw new TypeError("Argument must be a number");return Q(M)};I.allocUnsafeSlow=function(M){if("number"!=typeof M)throw new TypeError("Argument must be a number");return L.SlowBuffer(M)}},{buffer:3}],31:[function(F,J,G){function K(ma){switch(this.encoding=function(ka){var pa=function(la){if(!la)return"utf8";
for(var ta;;)switch(la){case "utf8":case "utf-8":return"utf8";case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return"utf16le";case "latin1":case "binary":return"latin1";case "base64":case "ascii":case "hex":return la;default:if(ta)return;la=(""+la).toLowerCase();ta=!0}}(ka);if("string"!=typeof pa&&(ba.isEncoding===ha||!ha(ka)))throw Error("Unknown encoding: "+ka);return pa||ka}(ma),this.encoding){case "utf16le":this.text=Q;this.end=M;ma=4;break;case "utf8":this.fillLast=L;ma=4;break;case "base64":this.text=
U;this.end=Z;ma=3;break;default:return this.write=da,void(this.end=R)}this.lastTotal=this.lastNeed=0;this.lastChar=ba.allocUnsafe(ma)}function I(ma){return 127>=ma?0:6==ma>>5?2:14==ma>>4?3:30==ma>>3?4:2==ma>>6?-1:-2}function L(ma){var ka=this.lastTotal-this.lastNeed;a:if(128!=(192&ma[0]))var pa=(this.lastNeed=0,"\ufffd");else{if(1<this.lastNeed&&1<ma.length){if(128!=(192&ma[1])){pa=(this.lastNeed=1,"\ufffd");break a}if(2<this.lastNeed&&2<ma.length&&128!=(192&ma[2])){pa=(this.lastNeed=2,"\ufffd");
break a}}pa=void 0}return void 0===pa?this.lastNeed<=ma.length?(ma.copy(this.lastChar,ka,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(ma.copy(this.lastChar,ka,0,ma.length),void(this.lastNeed-=ma.length)):pa}function Q(ma,ka){if(0==(ma.length-ka)%2){if(ka=ma.toString("utf16le",ka)){var pa=ka.charCodeAt(ka.length-1);if(55296<=pa&&56319>=pa)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=ma[ma.length-2],this.lastChar[1]=ma[ma.length-1],ka.slice(0,-1)}return ka}return this.lastNeed=
1,this.lastTotal=2,this.lastChar[0]=ma[ma.length-1],ma.toString("utf16le",ka,ma.length-1)}function M(ma){ma=ma&&ma.length?this.write(ma):"";return this.lastNeed?ma+this.lastChar.toString("utf16le",0,this.lastTotal-this.lastNeed):ma}function U(ma,ka){var pa=(ma.length-ka)%3;return 0==pa?ma.toString("base64",ka):(this.lastNeed=3-pa,this.lastTotal=3,1==pa?this.lastChar[0]=ma[ma.length-1]:(this.lastChar[0]=ma[ma.length-2],this.lastChar[1]=ma[ma.length-1]),ma.toString("base64",ka,ma.length-pa))}function Z(ma){ma=
ma&&ma.length?this.write(ma):"";return this.lastNeed?ma+this.lastChar.toString("base64",0,3-this.lastNeed):ma}function da(ma){return ma.toString(this.encoding)}function R(ma){return ma&&ma.length?this.write(ma):""}var ba=F("safe-buffer").Buffer,ha=ba.isEncoding||function(ma){switch((ma=""+ma)&&ma.toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":case "raw":return!0;default:return!1}};G.StringDecoder=
K;K.prototype.write=function(ma){if(0===ma.length)return"";var ka;if(this.lastNeed){if(void 0===(ka=this.fillLast(ma)))return"";var pa=this.lastNeed;this.lastNeed=0}else pa=0;return pa<ma.length?ka?ka+this.text(ma,pa):this.text(ma,pa):ka||""};K.prototype.end=function(ma){ma=ma&&ma.length?this.write(ma):"";return this.lastNeed?ma+"\ufffd":ma};K.prototype.text=function(ma,ka){var pa=ma.length-1;if(pa<ka)var la=0;else{var ta=I(ma[pa]);la=0<=ta?(0<ta&&(this.lastNeed=ta-1),ta):--pa<ka||-2===ta?0:0<=(ta=
I(ma[pa]))?(0<ta&&(this.lastNeed=ta-2),ta):--pa<ka||-2===ta?0:0<=(ta=I(ma[pa]))?(0<ta&&(2===ta?ta=0:this.lastNeed=ta-3),ta):0}if(!this.lastNeed)return ma.toString("utf8",ka);this.lastTotal=la;la=ma.length-(la-this.lastNeed);return ma.copy(this.lastChar,0,la),ma.toString("utf8",ka,la)};K.prototype.fillLast=function(ma){return this.lastNeed<=ma.length?(ma.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(ma.copy(this.lastChar,this.lastTotal-
this.lastNeed,0,ma.length),void(this.lastNeed-=ma.length))}},{"safe-buffer":30}],32:[function(F,J){(function(G){(function(){function K(I){try{if(!G.localStorage)return!1}catch(L){return!1}I=G.localStorage[I];return null!=I&&"true"===(I+"").toLowerCase()}J.exports=function(I,L){if(K("noDeprecation"))return I;var Q=!1;return function(){if(!Q){if(K("throwDeprecation"))throw Error(L);K("traceDeprecation")?console.trace(L):console.warn(L);Q=!0}return I.apply(this,arguments)}}}).call(this)}).call(this,
void 0===commonjsGlobal$$module$libs$y_webrtc_min?"undefined"==typeof self?"undefined"==typeof window?{}:window:self:commonjsGlobal$$module$libs$y_webrtc_min)},{}],"/":[function(F,J){function G(R){return R.replace(/a=ice-options:trickle\s\n/g,"")}const K=F("debug")("simple-peer"),I=F("get-browser-rtc"),L=F("randombytes"),Q=F("readable-stream"),M=F("queue-microtask"),U=F("err-code"),{Buffer:Z}=F("buffer");class da extends Q.Duplex{constructor(R){if(super(R=Object.assign({allowHalfOpen:!1},R)),this._id=
L(4).toString("hex").slice(0,7),this._debug("new peer %o",R),this.channelName=R.initiator?R.channelName||L(20).toString("hex"):null,this.initiator=R.initiator||!1,this.channelConfig=R.channelConfig||da.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},da.config,R.config),this.offerOptions=R.offerOptions||{},this.answerOptions=R.answerOptions||{},this.sdpTransform=R.sdpTransform||(ba=>ba),this.streams=R.streams||(R.stream?[R.stream]:[]),this.trickle=void 0===
R.trickle||R.trickle,this.allowHalfTrickle=void 0!==R.allowHalfTrickle&&R.allowHalfTrickle,this.iceCompleteTimeout=R.iceCompleteTimeout||5E3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=R.wrtc&&"object"==typeof R.wrtc?R.wrtc:I(),!this._wrtc)throw"undefined"==typeof window?U(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),
"ERR_WEBRTC_SUPPORT"):U(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._iceComplete=this._channelReady=this._pcReady=!1;this._channel=this._iceCompleteTimer=null;this._pendingCandidates=[];this._isNegotiating=!1;this._firstNegotiation=!0;this._queuedNegotiation=this._batchedNegotiation=!1;this._sendersAwaitingStable=[];this._senderMap=new Map;this._closingInterval=null;this._remoteTracks=[];this._remoteStreams=[];this._interval=this._cb=this._chunk=null;try{this._pc=
new this._wrtc.RTCPeerConnection(this.config)}catch(ba){return void this.destroy(U(ba,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId;this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()};this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()};this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()};this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()};this._pc.onicecandidate=ba=>{this._onIceCandidate(ba)};
"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch(ba=>{this.destroy(U(ba,"ERR_PC_PEER_IDENTITY"))});this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=ba=>{this._setupData(ba)};this.streams&&this.streams.forEach(ba=>{this.addStream(ba)});this._pc.ontrack=ba=>{this._onTrack(ba)};this._debug("initial negotiation");this._needsNegotiation();this._onFinishBound=()=>{this._onFinish()};
this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(R){if(!this.destroying){if(this.destroyed)throw U(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof R)try{R=JSON.parse(R)}catch(ba){R={}}this._debug("signal()");R.renegotiate&&this.initiator&&
(this._debug("got request to renegotiate"),this._needsNegotiation());R.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(R.transceiverRequest.kind,R.transceiverRequest.init));R.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(R.candidate):this._pendingCandidates.push(R.candidate));R.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(R)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(ba=>
{this._addIceCandidate(ba)}),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())}).catch(ba=>{this.destroy(U(ba,"ERR_SET_REMOTE_DESCRIPTION"))});R.sdp||R.candidate||R.renegotiate||R.transceiverRequest||this.destroy(U(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(R){const ba=new this._wrtc.RTCIceCandidate(R);this._pc.addIceCandidate(ba).catch(ha=>{!ba.address||ba.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):
this.destroy(U(ha,"ERR_ADD_ICE_CANDIDATE"))})}send(R){if(!this.destroying){if(this.destroyed)throw U(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(R)}}addTransceiver(R,ba){if(!this.destroying){if(this.destroyed)throw U(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(R,ba),this._needsNegotiation()}catch(ha){this.destroy(U(ha,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",
{type:"transceiverRequest",transceiverRequest:{kind:R,init:ba}})}}addStream(R){if(!this.destroying){if(this.destroyed)throw U(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()");R.getTracks().forEach(ba=>{this.addTrack(ba,R)})}}addTrack(R,ba){if(!this.destroying){if(this.destroyed)throw U(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");var ha=this._senderMap.get(R)||new Map,ma=ha.get(ba);if(ma)throw ma.removed?U(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),
"ERR_SENDER_REMOVED"):U(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");ma=this._pc.addTrack(R,ba);ha.set(ba,ma);this._senderMap.set(R,ha);this._needsNegotiation()}}replaceTrack(R,ba,ha){if(!this.destroying){if(this.destroyed)throw U(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");ha=(R=this._senderMap.get(R))?R.get(ha):null;if(!ha)throw U(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");
ba&&this._senderMap.set(ba,R);null==ha.replaceTrack?this.destroy(U(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):ha.replaceTrack(ba)}}removeTrack(R,ba){if(!this.destroying){if(this.destroyed)throw U(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");ba=(R=this._senderMap.get(R))?R.get(ba):null;if(!ba)throw U(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{ba.removed=!0,this._pc.removeTrack(ba)}catch(ha){"NS_ERROR_UNEXPECTED"===
ha.name?this._sendersAwaitingStable.push(ba):this.destroy(U(ha,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}}removeStream(R){if(!this.destroying){if(this.destroyed)throw U(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()");R.getTracks().forEach(ba=>{this.removeTrack(ba,R)})}}_needsNegotiation(){this._debug("_needsNegotiation");this._batchedNegotiation||(this._batchedNegotiation=!0,M(()=>{this._batchedNegotiation=!1;this.initiator||!this._firstNegotiation?
(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded");this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw U(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=
!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0}));this._isNegotiating=!0}}destroy(R){this._destroy(R,()=>{})}_destroy(R,ba){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",R&&(R.message||R)),M(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",R&&(R.message||R)),this.readable=this.writable=!1,this._readableState.ended||
this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(ha){}this._channel.onmessage=
null;this._channel.onopen=null;this._channel.onclose=null;this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(ha){}this._pc.oniceconnectionstatechange=null;this._pc.onicegatheringstatechange=null;this._pc.onsignalingstatechange=null;this._pc.onicecandidate=null;this._pc.ontrack=null;this._pc.ondatachannel=null}this._channel=this._pc=null;R&&this.emit("error",R);this.emit("close");ba()}))}_setupData(R){if(!R.channel)return this.destroy(U(Error("Data channel event is missing `channel` property"),
"ERR_DATA_CHANNEL"));this._channel=R.channel;this._channel.binaryType="arraybuffer";"number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536);this.channelName=this._channel.label;this._channel.onmessage=ha=>{this._onChannelMessage(ha)};this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()};this._channel.onopen=()=>{this._onChannelOpen()};this._channel.onclose=()=>{this._onChannelClose()};this._channel.onerror=ha=>{this.destroy(U(ha.error instanceof
Error?ha.error:Error(`Datachannel error: ${ha.message} ${ha.filename}:${ha.lineno}:${ha.colno}`),"ERR_DATA_CHANNEL"))};let ba=!1;this._closingInterval=setInterval(()=>{this._channel&&"closing"===this._channel.readyState?(ba&&this._onChannelClose(),ba=!0):ba=!1},5E3)}_read(){}_write(R,ba,ha){if(this.destroyed)return ha(U(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(R)}catch(ma){return this.destroy(U(ma,"ERR_DATA_CHANNEL"))}65536<this._channel.bufferedAmount?
(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=ha):ha(null)}else this._debug("write before connect"),this._chunk=R,this._cb=ha}_onFinish(){if(!this.destroyed){const R=()=>{setTimeout(()=>this.destroy(),1E3)};this._connected?R():this.once("connect",R)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),
this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(R=>{if(!this.destroyed){this.trickle||this.allowHalfTrickle||(R.sdp=G(R.sdp));R.sdp=this.sdpTransform(R.sdp);var ba=()=>{if(!this.destroyed){const ha=this._pc.localDescription||R;this._debug("signal");this.emit("signal",{type:ha.type,sdp:ha.sdp})}};this._pc.setLocalDescription(R).then(()=>{this._debug("createOffer success");this.destroyed||(this.trickle||
this._iceComplete?ba():this.once("_iceComplete",ba))}).catch(ha=>{this.destroy(U(ha,"ERR_SET_LOCAL_DESCRIPTION"))})}}).catch(R=>{this.destroy(U(R,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(R=>{R.mid||!R.sender.track||R.requested||(R.requested=!0,this.addTransceiver(R.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(R=>{if(!this.destroyed){this.trickle||this.allowHalfTrickle||
(R.sdp=G(R.sdp));R.sdp=this.sdpTransform(R.sdp);var ba=()=>{if(!this.destroyed){const ha=this._pc.localDescription||R;this._debug("signal");this.emit("signal",{type:ha.type,sdp:ha.sdp});this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(R).then(()=>{this.destroyed||(this.trickle||this._iceComplete?ba():this.once("_iceComplete",ba))}).catch(ha=>{this.destroy(U(ha,"ERR_SET_LOCAL_DESCRIPTION"))})}}).catch(R=>{this.destroy(U(R,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||
"failed"===this._pc.connectionState&&this.destroy(U(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(!this.destroyed){var R=this._pc.iceConnectionState,ba=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",R,ba);this.emit("iceStateChange",R,ba);"connected"!==R&&"completed"!==R||(this._pcReady=!0,this._maybeReady());"failed"===R&&this.destroy(U(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE"));"closed"===R&&this.destroy(U(Error("Ice connection closed."),
"ERR_ICE_CONNECTION_CLOSED"))}}getStats(R){const ba=ha=>("[object Array]"===Object.prototype.toString.call(ha.values)&&ha.values.forEach(ma=>{Object.assign(ha,ma)}),ha);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then(ha=>{const ma=[];ha.forEach(ka=>{ma.push(ba(ka))});R(null,ma)},ha=>R(ha)):0<this._pc.getStats.length?this._pc.getStats(ha=>{if(!this.destroyed){var ma=[];ha.result().forEach(ka=>{const pa={};ka.names().forEach(la=>{pa[la]=ka.stat(la)});pa.id=ka.id;pa.type=
ka.type;pa.timestamp=ka.timestamp;ma.push(ba(pa))});R(null,ma)}},ha=>R(ha)):R(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;var R=()=>{this.destroyed||this.getStats((ba,ha)=>{if(!this.destroyed){ba&&(ha=[]);var ma={},ka={},pa={},la=!1;ha.forEach(wa=>{"remotecandidate"!==wa.type&&"remote-candidate"!==wa.type||(ma[wa.id]=wa);"localcandidate"!==wa.type&&
"local-candidate"!==wa.type||(ka[wa.id]=wa);"candidatepair"!==wa.type&&"candidate-pair"!==wa.type||(pa[wa.id]=wa)});var ta=wa=>{la=!0;var za=ka[wa.localCandidateId];za&&(za.ip||za.address)?(this.localAddress=za.ip||za.address,this.localPort=+za.port):za&&za.ipAddress?(this.localAddress=za.ipAddress,this.localPort=+za.portNumber):"string"==typeof wa.googLocalAddress&&(za=wa.googLocalAddress.split(":"),this.localAddress=za[0],this.localPort=+za[1]);this.localAddress&&(this.localFamily=this.localAddress.includes(":")?
"IPv6":"IPv4");(za=ma[wa.remoteCandidateId])&&(za.ip||za.address)?(this.remoteAddress=za.ip||za.address,this.remotePort=+za.port):za&&za.ipAddress?(this.remoteAddress=za.ipAddress,this.remotePort=+za.portNumber):"string"==typeof wa.googRemoteAddress&&(za=wa.googRemoteAddress.split(":"),this.remoteAddress=za[0],this.remotePort=+za[1]);this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4");this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,
this.remoteAddress,this.remotePort)};if(ha.forEach(wa=>{"transport"===wa.type&&wa.selectedCandidatePairId&&ta(pa[wa.selectedCandidatePairId]);("googCandidatePair"===wa.type&&"true"===wa.googActiveConnection||("candidatepair"===wa.type||"candidate-pair"===wa.type)&&wa.selected)&&ta(wa)}),la||Object.keys(pa).length&&!Object.keys(ka).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(wa){return this.destroy(U(wa,"ERR_DATA_CHANNEL"))}this._chunk=null;this._debug('sent chunk from "write before connect"');
ba=this._cb;this._cb=null;ba(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref());this._debug("connect");this.emit("connect")}else setTimeout(R,100)}})};R()}}_onInterval(){this._cb&&this._channel&&!(65536<this._channel.bufferedAmount)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",
this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(R=>{this._pc.removeTrack(R);this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(R){this.destroyed||(R.candidate&&this.trickle?
this.emit("signal",{type:"candidate",candidate:{candidate:R.candidate.candidate,sdpMLineIndex:R.candidate.sdpMLineIndex,sdpMid:R.candidate.sdpMid}}):!R.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),R.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(R){this.destroyed||(R=R.data,R instanceof ArrayBuffer&&(R=Z.from(R)),this.push(R))}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);
const R=this._cb;this._cb=null;R(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(R){this.destroyed||R.streams.forEach(ba=>{this._debug("on track");this.emit("track",R.track,ba);this._remoteTracks.push({track:R.track,stream:ba});this._remoteStreams.some(ha=>ha.id===ba.id)||(this._remoteStreams.push(ba),M(()=>{this._debug("on stream");
this.emit("stream",ba)}))})}_debug(){const R=[].slice.call(arguments);R[0]="["+this._id+"] "+R[0];K.apply(null,R)}}da.WEBRTC_SUPPORT=!!I();da.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"};da.channelConfig={};J.exports=da},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/"))});
const writeSyncStep1$$module$libs$y_webrtc_min=(a,e)=>{writeVarUint$$module$libs$y_webrtc_min(a,0);e=encodeStateVector$$module$libs$y_webrtc_min(e);writeVarUint8Array$$module$libs$y_webrtc_min(a,e)},writeSyncStep2$$module$libs$y_webrtc_min=(a,e,n)=>{writeVarUint$$module$libs$y_webrtc_min(a,1);writeVarUint8Array$$module$libs$y_webrtc_min(a,encodeStateAsUpdate$$module$libs$y_webrtc_min(e,n))},readSyncStep2$$module$libs$y_webrtc_min=(a,e,n)=>{try{applyUpdate$$module$libs$y_webrtc_min(e,readVarUint8Array$$module$libs$y_webrtc_min(a),
n)}catch(t){console.error("Caught error while handling a Yjs update",t)}},readUpdate$1$$module$libs$y_webrtc_min=readSyncStep2$$module$libs$y_webrtc_min,readSyncMessage$$module$libs$y_webrtc_min=(a,e,n,t)=>{const z=readVarUint$$module$libs$y_webrtc_min(a);switch(z){case 0:writeSyncStep2$$module$libs$y_webrtc_min(e,n,readVarUint8Array$$module$libs$y_webrtc_min(a));break;case 1:readSyncStep2$$module$libs$y_webrtc_min(a,n,t);break;case 2:readSyncStep2$$module$libs$y_webrtc_min(a,n,t);break;default:throw Error("Unknown message type");
}return z};
class Awareness$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor(a){super();this.doc=a;this.clientID=a.clientID;this.states=new Map;this.meta=new Map;this._checkInterval=setInterval(()=>{const e=getUnixTime$$module$libs$y_webrtc_min();null!==this.getLocalState()&&15E3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const n=[];this.meta.forEach((t,z)=>{z!==this.clientID&&3E4<=e-t.lastUpdated&&this.states.has(z)&&n.push(z)});0<
n.length&&removeAwarenessStates$$module$libs$y_webrtc_min(this,n,"timeout")},floor$$module$libs$y_webrtc_min(3E3));a.on("destroy",()=>{this.destroy()});this.setLocalState({})}destroy(){this.emit("destroy",[this]);this.setLocalState(null);super.destroy();clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(a){const e=this.clientID;var n=this.meta.get(e),t=void 0===n?0:n.clock+1;n=this.states.get(e);null===a?this.states.delete(e):this.states.set(e,
a);this.meta.set(e,{clock:t,lastUpdated:getUnixTime$$module$libs$y_webrtc_min()});t=[];const z=[],D=[],F=[];null===a?F.push(e):null==n?null!=a&&t.push(e):(z.push(e),equalityDeep$$module$libs$y_webrtc_min(n,a)||D.push(e));(0<t.length||0<D.length||0<F.length)&&this.emit("change",[{added:t,updated:D,removed:F},"local"]);this.emit("update",[{added:t,updated:z,removed:F},"local"])}setLocalStateField(a,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[a]:e})}getStates(){return this.states}}
const removeAwarenessStates$$module$libs$y_webrtc_min=(a,e,n)=>{const t=[];for(let z=0;z<e.length;z++){const D=e[z];if(a.states.has(D)){if(a.states.delete(D),D===a.clientID){const F=a.meta.get(D);a.meta.set(D,{clock:F.clock+1,lastUpdated:getUnixTime$$module$libs$y_webrtc_min()})}t.push(D)}}0<t.length&&(a.emit("change",[{added:[],updated:[],removed:t},n]),a.emit("update",[{added:[],updated:[],removed:t},n]))},encodeAwarenessUpdate$$module$libs$y_webrtc_min=(a,e,n=a.states)=>{const t=e.length,z=createEncoder$$module$libs$y_webrtc_min();
writeVarUint$$module$libs$y_webrtc_min(z,t);for(let D=0;D<t;D++){const F=e[D],J=n.get(F)||null,G=a.meta.get(F).clock;writeVarUint$$module$libs$y_webrtc_min(z,F);writeVarUint$$module$libs$y_webrtc_min(z,G);writeVarString$$module$libs$y_webrtc_min(z,JSON.stringify(J))}return toUint8Array$$module$libs$y_webrtc_min(z)},encrypt$$module$libs$y_webrtc_min=(a,e)=>{if(!e)return resolve$$module$libs$y_webrtc_min(a);const n=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",
iv:n},e,a).then(t=>{const z=createEncoder$$module$libs$y_webrtc_min();return writeVarString$$module$libs$y_webrtc_min(z,"AES-GCM"),writeVarUint8Array$$module$libs$y_webrtc_min(z,n),writeVarUint8Array$$module$libs$y_webrtc_min(z,new Uint8Array(t)),toUint8Array$$module$libs$y_webrtc_min(z)})},decrypt$$module$libs$y_webrtc_min=(a,e)=>{if(!e)return resolve$$module$libs$y_webrtc_min(a);a=createDecoder$$module$libs$y_webrtc_min(a);var n;"AES-GCM"!==readVarString$$module$libs$y_webrtc_min(a)&&(n=create$2$$module$libs$y_webrtc_min("Unknown encryption algorithm"),
Promise.reject(n));n=readVarUint8Array$$module$libs$y_webrtc_min(a);a=readVarUint8Array$$module$libs$y_webrtc_min(a);return crypto.subtle.decrypt({name:"AES-GCM",iv:n},e,a).then(t=>new Uint8Array(t))},log$$module$libs$y_webrtc_min=((a,e)=>{const n=loggingColors$$module$libs$y_webrtc_min[nextColor$$module$libs$y_webrtc_min];var t=getVariable$$module$libs$y_webrtc_min("log");t=null!==t&&("*"===t||"true"===t||(new RegExp(t,"gi")).test(e));return nextColor$$module$libs$y_webrtc_min=(nextColor$$module$libs$y_webrtc_min+
1)%loggingColors$$module$libs$y_webrtc_min.length,e+=": ",t?(...z)=>{const D=getUnixTime$$module$libs$y_webrtc_min(),F=D-lastLoggingTime$$module$libs$y_webrtc_min;lastLoggingTime$$module$libs$y_webrtc_min=D;a(n,e,UNCOLOR$$module$libs$y_webrtc_min,...z.map(J=>"string"==typeof J||"symbol"==typeof J?J:JSON.stringify(J)),n," +"+F+"ms")}:nop$$module$libs$y_webrtc_min})(print$$module$libs$y_webrtc_min,"y-webrtc"),signalingConns$$module$libs$y_webrtc_min=new Map,rooms$$module$libs$y_webrtc_min=new Map,checkIsSynced$$module$libs$y_webrtc_min=
a=>{let e=!0;a.webrtcConns.forEach(n=>{n.synced||(e=!1)});(!e&&a.synced||e&&!a.synced)&&(a.synced=e,a.provider.emit("synced",[{synced:e}]),log$$module$libs$y_webrtc_min("synced ",BOLD$$module$libs$y_webrtc_min,a.name,UNBOLD$$module$libs$y_webrtc_min," with all peers"))},readMessage$$module$libs$y_webrtc_min=(a,e,n)=>{var t=createDecoder$$module$libs$y_webrtc_min(e);e=createEncoder$$module$libs$y_webrtc_min();var z=readVarUint$$module$libs$y_webrtc_min(t);if(void 0===a)return null;var D=a.awareness,
F=a.doc;let J=!1;switch(z){case 0:writeVarUint$$module$libs$y_webrtc_min(e,0);D=readSyncMessage$$module$libs$y_webrtc_min(t,e,F,a);1!==D||a.synced||n();0===D&&(J=!0);break;case 3:writeVarUint$$module$libs$y_webrtc_min(e,1);writeVarUint8Array$$module$libs$y_webrtc_min(e,encodeAwarenessUpdate$$module$libs$y_webrtc_min(D,Array.from(D.getStates().keys())));J=!0;break;case 1:n=readVarUint8Array$$module$libs$y_webrtc_min(t);n=createDecoder$$module$libs$y_webrtc_min(n);t=getUnixTime$$module$libs$y_webrtc_min();
z=[];F=[];const G=[],K=[],I=readVarUint$$module$libs$y_webrtc_min(n);for(let L=0;L<I;L++){const Q=readVarUint$$module$libs$y_webrtc_min(n);let M=readVarUint$$module$libs$y_webrtc_min(n);const U=JSON.parse(readVarString$$module$libs$y_webrtc_min(n)),Z=D.meta.get(Q),da=D.states.get(Q),R=void 0===Z?0:Z.clock;(R<M||R===M&&null===U&&D.states.has(Q))&&(null===U?Q===D.clientID&&null!=D.getLocalState()?M++:D.states.delete(Q):D.states.set(Q,U),D.meta.set(Q,{clock:M,lastUpdated:t}),void 0===Z&&null!==U?z.push(Q):
void 0!==Z&&null===U?K.push(Q):null!==U&&(equalityDeep$$module$libs$y_webrtc_min(U,da)||G.push(Q),F.push(Q)))}(0<z.length||0<G.length||0<K.length)&&D.emit("change",[{added:z,updated:G,removed:K},a]);(0<z.length||0<F.length||0<K.length)&&D.emit("update",[{added:z,updated:F,removed:K},a]);break;case 4:D=1===readUint8$$module$libs$y_webrtc_min(t);n=readVarString$$module$libs$y_webrtc_min(t);n!==a.peerId&&(a.bcConns.has(n)&&!D||!a.bcConns.has(n)&&D)&&(t=[],z=[],D?(a.bcConns.add(n),z.push(n)):(a.bcConns.delete(n),
t.push(n)),a.provider.emit("peers",[{added:z,removed:t,webrtcPeers:Array.from(a.webrtcConns.keys()),bcPeers:Array.from(a.bcConns)}]),broadcastBcPeerId$$module$libs$y_webrtc_min(a));break;default:return console.error("Unable to compute message"),e}return J?e:null},sendWebrtcConn$$module$libs$y_webrtc_min=(a,e)=>{log$$module$libs$y_webrtc_min("send message to ",BOLD$$module$libs$y_webrtc_min,a.remotePeerId,UNBOLD$$module$libs$y_webrtc_min,GREY$$module$libs$y_webrtc_min," (",a.room.name,")",UNCOLOR$$module$libs$y_webrtc_min);
try{a.peer.send(toUint8Array$$module$libs$y_webrtc_min(e))}catch(n){}};
class WebrtcConn$$module$libs$y_webrtc_min{constructor(a,e,n,t){log$$module$libs$y_webrtc_min("establishing connection to ",BOLD$$module$libs$y_webrtc_min,n);this.room=t;this.remotePeerId=n;this.synced=this.connected=this.closed=!1;this.peer=new simplepeer_min$$module$libs$y_webrtc_min({initiator:e,...t.provider.peerOpts});this.peer.on("signal",z=>{publishSignalingMessage$$module$libs$y_webrtc_min(a,t,{to:n,from:t.peerId,type:"signal",signal:z})});this.peer.on("connect",()=>{log$$module$libs$y_webrtc_min("connected to ",
BOLD$$module$libs$y_webrtc_min,n);this.connected=!0;var z=t.provider.doc;const D=t.awareness;var F=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(F,0);writeSyncStep1$$module$libs$y_webrtc_min(F,z);sendWebrtcConn$$module$libs$y_webrtc_min(this,F);z=D.getStates();0<z.size&&(F=createEncoder$$module$libs$y_webrtc_min(),writeVarUint$$module$libs$y_webrtc_min(F,1),writeVarUint8Array$$module$libs$y_webrtc_min(F,encodeAwarenessUpdate$$module$libs$y_webrtc_min(D,Array.from(z.keys()))),
sendWebrtcConn$$module$libs$y_webrtc_min(this,F))});this.peer.on("close",()=>{this.connected=!1;this.closed=!0;t.webrtcConns.has(this.remotePeerId)&&(t.webrtcConns.delete(this.remotePeerId),t.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(t.webrtcConns.keys()),bcPeers:Array.from(t.bcConns)}]));checkIsSynced$$module$libs$y_webrtc_min(t);this.peer.destroy();log$$module$libs$y_webrtc_min("closed connection to ",BOLD$$module$libs$y_webrtc_min,n);announceSignalingInfo$$module$libs$y_webrtc_min(t)});
this.peer.on("error",z=>{log$$module$libs$y_webrtc_min("Error in connection to ",BOLD$$module$libs$y_webrtc_min,n,": ",z);announceSignalingInfo$$module$libs$y_webrtc_min(t)});this.peer.on("data",z=>{z=((D,F)=>{const J=D.room;return log$$module$libs$y_webrtc_min("received message from ",BOLD$$module$libs$y_webrtc_min,D.remotePeerId,GREY$$module$libs$y_webrtc_min," (",J.name,")",UNBOLD$$module$libs$y_webrtc_min,UNCOLOR$$module$libs$y_webrtc_min),readMessage$$module$libs$y_webrtc_min(J,F,()=>{D.synced=
!0;log$$module$libs$y_webrtc_min("synced ",BOLD$$module$libs$y_webrtc_min,J.name,UNBOLD$$module$libs$y_webrtc_min," with ",BOLD$$module$libs$y_webrtc_min,D.remotePeerId);checkIsSynced$$module$libs$y_webrtc_min(J)})})(this,z);null!==z&&sendWebrtcConn$$module$libs$y_webrtc_min(this,z)})}destroy(){this.peer.destroy()}}
const broadcastBcMessage$$module$libs$y_webrtc_min=(a,e)=>encrypt$$module$libs$y_webrtc_min(e,a.key).then(n=>a.mux(()=>((t,z,D=null)=>{t=getChannel$$module$libs$y_webrtc_min(t);t.bc.postMessage(z);t.subs.forEach(F=>F(z,D))})(a.name,n))),broadcastRoomMessage$$module$libs$y_webrtc_min=(a,e)=>{a.bcconnected&&broadcastBcMessage$$module$libs$y_webrtc_min(a,e);((n,t)=>{log$$module$libs$y_webrtc_min("broadcast message in ",BOLD$$module$libs$y_webrtc_min,n.name,UNBOLD$$module$libs$y_webrtc_min);n.webrtcConns.forEach(z=>
{try{z.peer.send(t)}catch(D){}})})(a,e)},announceSignalingInfo$$module$libs$y_webrtc_min=a=>{signalingConns$$module$libs$y_webrtc_min.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[a.name]}),a.webrtcConns.size<a.provider.maxConns&&publishSignalingMessage$$module$libs$y_webrtc_min(e,a,{type:"announce",from:a.peerId}))})},broadcastBcPeerId$$module$libs$y_webrtc_min=a=>{if(a.provider.filterBcConns){const e=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(e,
4);write$$module$libs$y_webrtc_min(e,1);writeVarString$$module$libs$y_webrtc_min(e,a.peerId);broadcastBcMessage$$module$libs$y_webrtc_min(a,toUint8Array$$module$libs$y_webrtc_min(e))}};
class Room$$module$libs$y_webrtc_min{constructor(a,e,n,t){this.peerId=uuidv4$$module$libs$y_webrtc_min();this.doc=a;this.awareness=e.awareness;this.provider=e;this.synced=!1;this.name=n;this.key=t;this.webrtcConns=new Map;this.bcConns=new Set;this.mux=(()=>{let z=!0;return(D,F)=>{if(z){z=!1;try{D()}finally{z=!0}}else void 0!==F&&F()}})();this.bcconnected=!1;this._bcSubscriber=z=>decrypt$$module$libs$y_webrtc_min(new Uint8Array(z),t).then(D=>this.mux(()=>{const F=readMessage$$module$libs$y_webrtc_min(this,
D,()=>{});F&&broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(F))}));this._docUpdateHandler=(z,D)=>{D=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(D,0);writeVarUint$$module$libs$y_webrtc_min(D,2);writeVarUint8Array$$module$libs$y_webrtc_min(D,z);broadcastRoomMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(D))};this._awarenessUpdateHandler=({added:z,updated:D,removed:F},J)=>{z=z.concat(D).concat(F);
D=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(D,1);writeVarUint8Array$$module$libs$y_webrtc_min(D,encodeAwarenessUpdate$$module$libs$y_webrtc_min(this.awareness,z));broadcastRoomMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(D))};this._beforeUnloadHandler=()=>{removeAwarenessStates$$module$libs$y_webrtc_min(this.awareness,[a.clientID],"window unload");rooms$$module$libs$y_webrtc_min.forEach(z=>{z.disconnect()})};"undefined"!=typeof window?
window.addEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!=typeof process&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler);this.awareness.on("update",this._awarenessUpdateHandler);announceSignalingInfo$$module$libs$y_webrtc_min(this);var a=this.name;var e=this._bcSubscriber;getChannel$$module$libs$y_webrtc_min(a).subs.add(e);this.bcconnected=!0;broadcastBcPeerId$$module$libs$y_webrtc_min(this);a=createEncoder$$module$libs$y_webrtc_min();
writeVarUint$$module$libs$y_webrtc_min(a,0);writeSyncStep1$$module$libs$y_webrtc_min(a,this.doc);broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(a));a=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(a,0);writeSyncStep2$$module$libs$y_webrtc_min(a,this.doc);broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(a));a=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(a,
3);broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(a));a=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(a,1);writeVarUint8Array$$module$libs$y_webrtc_min(a,encodeAwarenessUpdate$$module$libs$y_webrtc_min(this.awareness,[this.doc.clientID]));broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(a))}disconnect(){signalingConns$$module$libs$y_webrtc_min.forEach(e=>{e.connected&&e.send({type:"unsubscribe",
topics:[this.name]})});removeAwarenessStates$$module$libs$y_webrtc_min(this.awareness,[this.doc.clientID],"disconnect");const a=createEncoder$$module$libs$y_webrtc_min();writeVarUint$$module$libs$y_webrtc_min(a,4);write$$module$libs$y_webrtc_min(a,0);writeVarString$$module$libs$y_webrtc_min(a,this.peerId);broadcastBcMessage$$module$libs$y_webrtc_min(this,toUint8Array$$module$libs$y_webrtc_min(a));((e,n)=>{const t=getChannel$$module$libs$y_webrtc_min(e);t.subs.delete(n)&&0===t.subs.size&&(t.bc.close(),
channels$$module$libs$y_webrtc_min.delete(e))})(this.name,this._bcSubscriber);this.bcconnected=!1;this.doc.off("update",this._docUpdateHandler);this.awareness.off("update",this._awarenessUpdateHandler);this.webrtcConns.forEach(e=>e.destroy())}destroy(){this.disconnect();"undefined"!=typeof window?window.removeEventListener("beforeunload",this._beforeUnloadHandler):"undefined"!=typeof process&&process.off("exit",this._beforeUnloadHandler)}}
const publishSignalingMessage$$module$libs$y_webrtc_min=(a,e,n)=>{e.key?((t,z)=>{const D=createEncoder$$module$libs$y_webrtc_min();return writeAny$$module$libs$y_webrtc_min(D,t),encrypt$$module$libs$y_webrtc_min(toUint8Array$$module$libs$y_webrtc_min(D),z)})(n,e.key).then(t=>{a.send({type:"publish",topic:e.name,data:toBase64$$module$libs$y_webrtc_min(t)})}):a.send({type:"publish",topic:e.name,data:n})};
class SignalingConn$$module$libs$y_webrtc_min extends WebsocketClient$$module$libs$y_webrtc_min{constructor(a){super(a);this.providers=new Set;this.on("connect",()=>{log$$module$libs$y_webrtc_min(`connected (${a})`);const e=Array.from(rooms$$module$libs$y_webrtc_min.keys());this.send({type:"subscribe",topics:e});rooms$$module$libs$y_webrtc_min.forEach(n=>publishSignalingMessage$$module$libs$y_webrtc_min(this,n,{type:"announce",from:n.peerId}))});this.on("message",e=>{switch(e.type){case "publish":var n=
e.topic;const D=rooms$$module$libs$y_webrtc_min.get(n);if(null==D||"string"!=typeof n)return;n=F=>{const J=D.webrtcConns,G=D.peerId;if(!(null==F||F.from===G||void 0!==F.to&&F.to!==G||D.bcConns.has(F.from))){var K=J.has(F.from)?()=>{}:()=>D.provider.emit("peers",[{removed:[],added:[F.from],webrtcPeers:Array.from(D.webrtcConns.keys()),bcPeers:Array.from(D.bcConns)}]);switch(F.type){case "announce":J.size<D.provider.maxConns&&(setIfUndefined$$module$libs$y_webrtc_min(J,F.from,()=>new WebrtcConn$$module$libs$y_webrtc_min(this,
!0,F.from,D)),K());break;case "signal":F.to===G&&(setIfUndefined$$module$libs$y_webrtc_min(J,F.from,()=>new WebrtcConn$$module$libs$y_webrtc_min(this,!1,F.from,D)).peer.signal(F.signal),K())}}};D.key?"string"==typeof e.data&&(t=fromBase64$$module$libs$y_webrtc_min(e.data),z=D.key,decrypt$$module$libs$y_webrtc_min(t,z).then(F=>readAny$$module$libs$y_webrtc_min(createDecoder$$module$libs$y_webrtc_min(new Uint8Array(F))))).then(n):n(e.data)}var t,z});this.on("disconnect",()=>log$$module$libs$y_webrtc_min(`disconnect (${a})`))}}
class WebrtcProvider$$module$libs$y_webrtc_min extends Observable$$module$libs$y_webrtc_min{constructor(a,e,{signaling:n=["wss://y-webrtc-eu.fly.dev"],password:t=null,awareness:z=new Awareness$$module$libs$y_webrtc_min(e),maxConns:D=20+floor$$module$libs$y_webrtc_min(15*rand$$module$libs$y_webrtc_min()),filterBcConns:F=!0,peerOpts:J={}}={}){super();this.roomName=a;this.doc=e;this.filterBcConns=F;this.awareness=z;this.shouldConnect=!1;this.signalingUrls=n;this.signalingConns=[];this.maxConns=D;this.peerOpts=
J;this.key=t?((G,K)=>{G=encodeUtf8$$module$libs$y_webrtc_min(G).buffer;const I=encodeUtf8$$module$libs$y_webrtc_min(K).buffer;return crypto.subtle.importKey("raw",G,"PBKDF2",!1,["deriveKey"]).then(L=>crypto.subtle.deriveKey({name:"PBKDF2",salt:I,iterations:1E5,hash:"SHA-256"},L,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))})(t,a):resolve$$module$libs$y_webrtc_min(null);this.room=null;this.key.then(G=>{if(rooms$$module$libs$y_webrtc_min.has(a))throw create$2$$module$libs$y_webrtc_min(`A Yjs Doc connected to room "${a}" already exists!`);
G=new Room$$module$libs$y_webrtc_min(e,this,a,G);this.room=(rooms$$module$libs$y_webrtc_min.set(a,G),G);this.shouldConnect?this.room.connect():this.room.disconnect()});this.connect();this.destroy=this.destroy.bind(this);e.on("destroy",this.destroy)}get connected(){return null!==this.room&&this.shouldConnect}connect(){this.shouldConnect=!0;this.signalingUrls.forEach(a=>{const e=setIfUndefined$$module$libs$y_webrtc_min(signalingConns$$module$libs$y_webrtc_min,a,()=>new SignalingConn$$module$libs$y_webrtc_min(a));
this.signalingConns.push(e);e.providers.add(this)});this.room&&this.room.connect()}disconnect(){this.shouldConnect=!1;this.signalingConns.forEach(a=>{a.providers.delete(this);0===a.providers.size&&(a.destroy(),signalingConns$$module$libs$y_webrtc_min.delete(a.url))});this.room&&this.room.disconnect()}destroy(){this.doc.off("destroy",this.destroy);this.key.then(()=>{this.room.destroy();rooms$$module$libs$y_webrtc_min.delete(this.roomName)});super.destroy()}}var module$libs$y_webrtc_min={};
module$libs$y_webrtc_min.AbsolutePosition=AbsolutePosition$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.AbstractConnector=AbstractConnector$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.AbstractStruct=AbstractStruct$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.AbstractType=AbstractType$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Array=YArray$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentAny=ContentAny$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.ContentBinary=ContentBinary$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentDeleted=ContentDeleted$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentEmbed=ContentEmbed$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentFormat=ContentFormat$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentJSON=ContentJSON$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ContentString=ContentString$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.ContentType=ContentType$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Doc=Doc$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.GC=GC$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.ID=ID$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Item=Item$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Map=YMap$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.PermanentUserData=PermanentUserData$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.RelativePosition=RelativePosition$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.Room=Room$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.SignalingConn=SignalingConn$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Snapshot=Snapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Text=YText$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.Transaction=Transaction$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.UndoManager=UndoManager$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.UpdateEncoderV1=UpdateEncoderV1$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.WebrtcConn=WebrtcConn$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.WebrtcProvider=WebrtcProvider$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.XmlElement=YXmlElement$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.XmlFragment=YXmlFragment$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.XmlHook=YXmlHook$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.XmlText=YXmlText$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.YArrayEvent=YArrayEvent$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.YEvent=YEvent$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.YMapEvent=YMapEvent$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.YTextEvent=YTextEvent$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.YXmlEvent=YXmlEvent$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.applyUpdate=applyUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.applyUpdateV2=applyUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.cleanupYTextFormatting=cleanupYTextFormatting$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.compareIDs=compareIDs$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.compareRelativePositions=compareRelativePositions$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.convertUpdateFormatV1ToV2=convertUpdateFormatV1ToV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.convertUpdateFormatV2ToV1=convertUpdateFormatV2ToV1$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createAbsolutePositionFromRelativePosition=createAbsolutePositionFromRelativePosition$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.createDeleteSet=createDeleteSet$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createDeleteSetFromStructStore=createDeleteSetFromStructStore$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createDocFromSnapshot=createDocFromSnapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createID=createID$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createRelativePositionFromJSON=createRelativePositionFromJSON$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.createRelativePositionFromTypeIndex=createRelativePositionFromTypeIndex$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.createSnapshot=createSnapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.decodeRelativePosition=decodeRelativePosition$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.decodeSnapshot=decodeSnapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.decodeSnapshotV2=decodeSnapshotV2$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.decodeStateVector=decodeStateVector$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.decodeUpdate=decodeUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.decodeUpdateV2=decodeUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.diffUpdate=diffUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.diffUpdateV2=diffUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.emptySnapshot=emptySnapshot$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.encodeRelativePosition=encodeRelativePosition$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeSnapshot=encodeSnapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeSnapshotV2=encodeSnapshotV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeStateAsUpdate=encodeStateAsUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeStateAsUpdateV2=encodeStateAsUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeStateVector=encodeStateVector$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.encodeStateVectorFromUpdate=encodeStateVectorFromUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.encodeStateVectorFromUpdateV2=encodeStateVectorFromUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.equalSnapshots=equalSnapshots$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.findIndexSS=findIndexSS$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.findRootTypeKey=findRootTypeKey$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.getItem=getItem$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.getState=getState$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.getTypeChildren=getTypeChildren$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.isDeleted=isDeleted$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.isParentOf=isParentOf$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.iterateDeletedStructs=iterateDeletedStructs$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.logType=logType$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.logUpdate=logUpdate$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.logUpdateV2=logUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.mergeUpdates=mergeUpdates$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.mergeUpdatesV2=mergeUpdatesV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.obfuscateUpdate=obfuscateUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.obfuscateUpdateV2=obfuscateUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.parseUpdateMeta=parseUpdateMeta$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.parseUpdateMetaV2=parseUpdateMetaV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.readUpdate=readUpdate$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.readUpdateV2=readUpdateV2$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.relativePositionToJSON=relativePositionToJSON$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.snapshot=snapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.transact=transact$$module$libs$y_webrtc_min;
module$libs$y_webrtc_min.tryGc=tryGc$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.typeListToArraySnapshot=typeListToArraySnapshot$$module$libs$y_webrtc_min;module$libs$y_webrtc_min.typeMapGetSnapshot=typeMapGetSnapshot$$module$libs$y_webrtc_min;const html$$module$radial=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);class AnimateSvg$$module$radial extends k$$module$libs$preact{constructor(a){super();this.mainId=uuidv4$$module$utils();this.mainId2=uuidv4$$module$utils();this.setState({kill:!1});this.out=!1}}
class RadialMenuButton$$module$radial extends k$$module$libs$preact{constructor(a){super();this.mainId=uuidv4$$module$utils();this.mainId2=uuidv4$$module$utils();this.setState({kill:!0});this.out=!1}componentDidUpdate(a){a.uuid!=this.props.uuid&&this.props.cond?this.inx():a.id!=this.props.id?this.inx():(this.props.cond&&this.out&&this.inx(),this.props.cond||this.out||this.outx())}componentDidMount(){const a=document.getElementById(this.mainId),e=document.getElementById(this.mainId+"z");a&&a.beginElement();
e&&e.beginElement();this.out=!1;this.setState({kill:!1})}inx(){const a=document.getElementById(this.mainId),e=document.getElementById(this.mainId+"z");this.out=!1;this.state.kill=!1;a&&a.beginElement();e&&e.beginElement()}outx(){const a=document.getElementById(this.mainId2),e=document.getElementById(this.mainId2+"z");a&&a.beginElement();e&&e.beginElement();let n=this;this.out=!0;window.setTimeout(function(){window.app.sense_mode=!1;n.setState({kill:!0})},350)}mouseover(){window.app.sense_mode=!0}mouseout(){window.app.sense_mode=
!1}render(a,e){e=e.kill&&!a.cond?html$$module$radial``:html$$module$radial`
            <g
              opacity="${this.props.enabled?1:.3}"
              transform="scale(${a.scale})"
              onmouseover="${()=>{this.mouseover()}}"
              onmouseout="${()=>{this.mouseout()}}"
            >
              <circle
                cx="-8.0776e-10"
                cy="2.1588e-9"
                r="5.538"
                fill="#000"
                fill-opacity=".28921"
                style="paint-order:fill markers stroke"
              />
              <circle
                cx="-8.0776e-10"
                cy="2.1588e-9"
                r="4.7411"
                fill="#d1d1d1"
                style="paint-order:fill markers stroke"
              />
              <use
                fill="${this.props.color||"#222222ff"}"
                xlink:href="${window.app.theme}#${this.props.icon}"
              />
              <path
                d="m0.049757-4.5469a4.5948 4.5948 0 0 0-4.5948 4.5948 4.5948 4.5948 0 0 0 2.1786 3.9046 4.5948 4.5948 0 0 1-1.9714-3.7706 4.5948 4.5948 0 0 1 4.5948-4.5948 4.5948 4.5948 0 0 1 2.3904 0.67114 4.5948 4.5948 0 0 0-2.5976-0.80512z"
                fill="#fff"
                style="paint-order:fill markers stroke"
              />
              <path
                d="m-0.057583 4.5765a4.5948 4.5948 0 0 0 4.5948-4.5948 4.5948 4.5948 0 0 0-2.1786-3.9045 4.5948 4.5948 0 0 1 1.9715 3.7706 4.5948 4.5948 0 0 1-4.5948 4.5948 4.5948 4.5948 0 0 1-2.3904-0.67114 4.5948 4.5948 0 0 0 2.5976 0.80511z"
                fill="#999"
                style="paint-order:fill markers stroke"
              />
            </g>
          `;e=this.props.enabled&&this.props.cond?html$$module$radial` <a
            class="test"
            onClick=${n=>{window.app.sense_mode=!1;n.disable=!0;this.props.onClick()}}
          >
            ${e}
          </a>`:html$$module$radial`${e}`;return html$$module$radial` <g transform="rotate(${this.props.angle}, 0,0)">
      <animate
        id="${this.mainId}z"
        attributeName="opacity"
        begin="indefinite"
        dur="0.35s"
        from="0.0"
        restart="always"
        to="1.0"
        fill="freeze"
      />
      <animateTransform
        attributeName="transform"
        type="scale"
        additive="sum"
        from="0.5 0.5"
        restart="always"
        to="1 1"
        id="${this.mainId}"
        begin="indefinite"
        dur="0.35s"
      />
      <animate
        id="${this.mainId2}z"
        attributeName="opacity"
        begin="indefinite"
        restart="always"
        dur="0.35s"
        from="1.0"
        to="0.0"
        fill="freeze"
      />
      <animateTransform
        attributeName="transform"
        type="scale"
        restart="always"
        additive="sum"
        from="1 1"
        to="0.5 0.5"
        id="${this.mainId2}"
        begin="indefinite"
        dur="0.35s"
      />
      <g transform="translate(${Math.max(12,12*this.props.scale)})">
        <g transform="rotate(-${this.props.angle}, 0,0)">
          ${e}
          <title>${a.tooltip}</title>
        </g>
      </g></g
    >`}}class RadialMenu$$module$radial extends k$$module$libs$preact{constructor(a){super()}render(a,e){}}var module$radial={};module$radial.AnimateSvg=AnimateSvg$$module$radial;module$radial.RadialMenu=RadialMenu$$module$radial;module$radial.RadialMenuButton=RadialMenuButton$$module$radial;const html$$module$hexmenu=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact),HexBitmask$$module$hexmenu={IS_HEX_AN_OCEAN:1,IS_HEX_OCCUPIED:2,IS_HEX_HAS_RIVER:4,IS_HEX_HAS_TRAIL:8,IS_HEX_COASTAL:16,IS_HEX_HAS_BORDER:32,IS_HEX_VALID_RIVER_SOURCE:64,IS_HEX_EXTENDING_REALM:128,IS_HEX_EXTENDING_REGION:256};function HiddenRadialMenuButton$$module$hexmenu(a){}function HexBiomeMenu$$module$hexmenu(a){return html$$module$hexmenu`<g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_mountains"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Mountains"+a.cls)}
      angle="0"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-mountains"
      tooltip="Roll an empty Mountains hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_forest"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Forest"+a.cls)}
      angle="51"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-forest"
      tooltip="Roll an empty Forest hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_plains"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Plains"+a.cls)}
      angle="102"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-plains"
      tooltip="Roll an empty Plains hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_desert"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Desert"+a.cls)}
      angle="153"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-desert"
      tooltip="Roll an empty Desert hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_jungle"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Jungle"+a.cls)}
      angle="204"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-jungle"
      tooltip="Roll an empty Jungle hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_swamps"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Swamps"+a.cls)}
      angle="255"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-swamps"
      tooltip="Roll an empty Swamps hex"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_tundra"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.appender("Tundra"+a.cls)}
      angle="306"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-tundra"
      tooltip="Roll an empty Tundra hex"
    />
  </g>`}function HexSettlementMenu$$module$hexmenu(a){return html$$module$hexmenu`<g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_city"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Settlement","City")}
      angle="240"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-city"
      tooltip="Roll a new City"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_town"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Settlement","Town")}
      angle="300"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-town"
      tooltip="Roll a new Town"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_village"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Settlement","Village")}
      angle="360"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-village"
      tooltip="Roll a new Village"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_inn"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Inn","Inn")}
      angle="60"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-inn"
      tooltip="Roll a new Inn"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_dwelling"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Residency","Residency")}
      angle="120"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-dwelling"
      tooltip="Roll a new Dwelling"
    />
  </g>`}function HexGeneratorMenu$$module$hexmenu(a){return html$$module$hexmenu`<g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_dungeon"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendFeature(a.menu.uuid,"Dungeon","Dungeon")}
      angle="240"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-dungeon"
      tooltip="Roll a new Dungeon"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_settlement"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRollSettlementMenu()}
      angle="300"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED)}
      icon="icon-settlement"
      tooltip="Roll a new settlement"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_draw_river"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onDrawRiver(a.menu.uuid)}
      angle="360"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_VALID_RIVER_SOURCE}
      icon="icon-river"
      tooltip="Roll a new River"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_roll_realm"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendRealm()}
      angle="60"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN}
      icon="icon-realm"
      tooltip="Roll a new Realm"
    />
    <${HiddenRadialMenuButton$$module$hexmenu}
      id="radial_button_roll_region"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRollRegionMenu()}
      angle="120"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM}
      icon="icon-region"
      tooltip="Roll a new empty Region in adjacent realm"
    />
    <${HiddenRadialMenuButton$$module$hexmenu}
      id="radial_button_roll_hex"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick2=${()=>a.handler.onRollHexMenu()}
      onClick=${()=>a.handler.onAppendHex()}
      angle="180"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION}
      icon="icon-hex"
      tooltip="Roll a new empty Hex in adjacent region"
    />
  </g>`}function HexCleanupMenu$$module$hexmenu(a){return html$$module$hexmenu`<g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_clean_river"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onClearHexRiver(a.menu.uuid)}
      angle="240"
      selected=${this.selected}
      scale=${a.scale}
      enabled="1"
      icon="icon-river"
      tooltip="Remove River"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_clean_trail"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onClearHexTrails(a.menu.uuid)}
      angle="300"
      selected=${this.selected}
      scale=${a.scale}
      enabled="1"
      icon="icon-trail"
      tooltip="Rebuild Trails"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_reroll_hex"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRerollHex(a.menu.uuid)}
      angle="360"
      selected=${this.selected}
      scale=${a.scale}
      enabled="1"
      icon="icon-feature"
      tooltip="Reroll an Empty Hex (removes everything inside!)"
    />
  </g>`}function HexDeleteMenu$$module$hexmenu(a){return html$$module$hexmenu`<g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_delete_hex"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRemoveHex(a.menu.uuid)}
      angle="240"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_HAS_BORDER||a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN&&a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_COASTAL}
      icon="icon-hex"
      tooltip="Delete Hex (coastlines or water only)"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_delete_region"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRemoveRegion(a.menu.uuid)}
      angle="300"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)}
      icon="icon-region"
      tooltip="Delete Region"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_delete_realm"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRemoveRealm(a.menu.uuid)}
      angle="360"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)}
      icon="icon-realm"
      tooltip="Delete the entire Realm!"
    />
  </g>`}function HexMainMenu$$module$hexmenu(a){return html$$module$hexmenu` <g
    transform="translate( ${a.menu.offset.x},
          ${a.menu.offset.y} )"
  >
    <${RadialMenuButton$$module$radial}
      id="radial_button_trash"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onDeleteMenu(a.menu.uuid)}
      angle="60"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN&&!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_COASTAL))}
      icon="icon-trash"
      tooltip="Destroy hex or hexes (including everything on!)"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_broom"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRerollMenu(a.menu.uuid)}
      angle="180"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)}
      icon="icon-broom"
      tooltip="Remove / Rebuild Features"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_dice"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onAppendMenu(a.menu.uuid)}
      angle="240"
      selected=${this.selected}
      scale=${a.scale}
      enabled="1"
      icon="icon-dice"
      tooltip="Roll new entities"
    />
    <${RadialMenuButton$$module$radial}
      id="radial_button_remap"
      uuid=${a.menu.uuid}
      cond=${a.cond}
      onClick=${()=>a.handler.onRemapEntity(a.menu.uuid)}
      angle="300"
      selected=${this.selected}
      scale=${a.scale}
      enabled=${!(a.bitmask&HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN)}
      icon="icon-remap"
      tooltip="Rearrange Realm Hex Map"
    />
  </g>`}class HexMenu$$module$hexmenu extends k$$module$libs$preact{constructor(){super()}componentWillUnmount(){window.app.sense_mode=!1}render(a){return 0==a.menu.type?html$$module$hexmenu` <${HexMainMenu$$module$hexmenu}
          menu=${a.menu}
          handler=${a.handler}
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:1==a.menu.type?html$$module$hexmenu` <${HexGeneratorMenu$$module$hexmenu}
          menu=${a.menu}
          handler=${a.handler}
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:4==a.menu.type?html$$module$hexmenu` <${HexSettlementMenu$$module$hexmenu}
          menu=${a.menu}
          handler=${a.handler}
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:5==a.menu.type?html$$module$hexmenu` <${HexBiomeMenu$$module$hexmenu}
          menu=${a.menu}
          appender=${e=>a.handler.onAppendRegion(e)}
          cls="Region"
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:6==a.menu.type?html$$module$hexmenu` <${HexBiomeMenu$$module$hexmenu}
          menu=${a.menu}
          appender=${e=>a.handler.onAppendHex(e)}
          cls="Hex"
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:2==a.menu.type?html$$module$hexmenu` <${HexCleanupMenu$$module$hexmenu}
          menu=${a.menu}
          handler=${a.handler}
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:3==a.menu.type?html$$module$hexmenu` <${HexDeleteMenu$$module$hexmenu}
          menu=${a.menu}
          handler=${a.handler}
          scale=${a.scale}
          cond=${a.cond}
          bitmask=${a.bitmask}
        />`:html$$module$hexmenu``}}var module$hexmenu={};module$hexmenu.HexBitmask=HexBitmask$$module$hexmenu;module$hexmenu.HexMenu=HexMenu$$module$hexmenu;const html$$module$SvgMap=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);function easeInOutSine$$module$SvgMap(a,e,n,t){return-n/2*(Math.cos(Math.PI*a/t)-1)+e}function easeInOutCubic$$module$SvgMap(a,e,n,t){return 1>(a/=t/2)?n/2*a*a*a+e:n/2*((a-=2)*a*a+2)+e}function isTouchDevice$$module$SvgMap(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints}
class SvgMap$$module$SvgMap extends k$$module$libs$preact{constructor(){super();this.state={offset:{x:10,y:10},dim:{w:1500,h:1500},drag:!1};this.predrag=this.drag=!1;this.factor=.1;this.oy=this.ox=0;this.inhibit_pointer_events=this.minimap=!1;this.sizeToFit=this.sizeToFit.bind(this)}sizeToFit(){var a=document.getElementById("canvas");if(a)if(this.width){var e=this.width;const n=this.height;this.width=a.getBoundingClientRect().width||1;this.height=a.getBoundingClientRect().height||1;a=this.state.dim.w/
e;const t=this.state.dim.h/n,z={w:this.width*a,h:this.height*t};this.setState({dim:z,offset:{x:this.state.offset.x-(this.width-e)*a/2,y:this.state.offset.y-(this.height-n)*t/2},zoom_factor:this.width*this.height/(z.w*z.h)})}else this.width=a.getBoundingClientRect().width||1,this.height=a.getBoundingClientRect().height||1,e={w:this.state.dim.w,h:this.height/this.width*this.state.dim.w},this.setState({dim:e,zoom_factor:this.width*this.height/(e.w*e.h)})}clientToCanvasCoords(a){let e=document.getElementById("canvas"),
n=e.createSVGPoint();n.x=a.clientX;n.y=a.clientY;return n.matrixTransform(e.getScreenCTM().inverse())}componentDidMount(a,e,n){let t=this;if(!this.minimap){var z=document.getElementById("canvas");if(z){(new ResizeObserver(this.sizeToFit)).observe(z);z.addEventListener("pointerdown",function(F){0!=F.button||t.touch_is_on||t.camera_moving||t.inhibit_pointer_events||(t.state.menu||(window.app.sense_mode=!1),t.predrag=!0,t.setState({drag:!0}),t.ox=F.offsetX,t.oy=F.offsetY,t.tmp=t.state.offset,window.app.tokens&&
!window.app.kill_hotkey_mode&&window.app.selected_token&&(F=t.clientToCanvasCoords(F),t.drag=!1,t.setState({drag:!1}),t.token_move={cp:F,t_uuid:window.app.selected_token.uuid,tuid:window.app.selected_token.tuid}))});z.addEventListener("pointermove",function(F){if(!window.app.sense_mode&&!t.camera_moving&&!t.inhibit_pointer_events)if(t.predrag&&(t.drag=!0),t.drag)if(window.app.inhibit_click=!0,t.token_move){var J=t.token_move.cp,G=t.clientToCanvasCoords(F);F=G.x-J.x;var K=G.y-J.y;J=window.app.tokens[t.token_move.t_uuid].get(t.token_move.tuid);
F={x:J.x+=F,y:J.y+=K,l:J.light,t:J.tid,r:J.r,pc:J.pc,u:J.tuid,d:J.uuid};window.app.zarray.set(J.tuid,F);t.setState({drag:!1});t.token_move.cp=G}else window.app.last_selected&&(window.app.last_selected.setState({class:"baseout"}),window.app.last_selected=null),G=F.offsetX-t.ox,F=F.offsetY-t.oy,J=z.getBoundingClientRect().width||1,K=z.getBoundingClientRect().height||1,t.setState({offset:{x:t.tmp.x-t.state.dim.w/J*G,y:t.tmp.y-t.state.dim.h/K*F},menu:!1});else window.app.inhibit_click=!1},{passive:!0});
document.addEventListener("mouseup",function(F){t.token_move=!1;t.drag&&(t.setState({drag:!1}),t.drag=!1);t.predrag=!1},{passive:!0});document.addEventListener("onClick",function(F){window.app.inhibit_click&&(window.app.inhibit_click=!1,F.stopPropagation())},{passive:!0});var D=Date.now();z.addEventListener("wheel",function(F){if(window.app.tokens&&(t.clientToCanvasCoords(F),window.app.selected_token)){var J=window.app.tokens[window.app.selected_token.uuid].get(window.app.selected_token.tuid);if(t.props.vtt&&
J.pc||!t.props.vtt){var G=0<F.deltaY?1:-1;F={l:J.light,t:J.tid,x:J.x,y:J.y,r:J.r+=15*G,pc:J.pc,u:J.tuid,d:J.uuid};window.app.zarray.set(J.tuid,F);t.setState({drag:!1});return}}t.stopCamera();t.props.hex_uuid&&!t.props.vtt&&$$$module$libs$preact_router_module("/sandbox/"+t.props.instance);if(!(t.inhibit_pointer_events||(J=Date.now(),F.stopPropagation(),G=0<F.deltaY?1:-1,-1==G&&1E7<t.state.zoom_factor||1==G&&.1>t.state.zoom_factor))){J=1-(J-D)/1E3*10;.7<J&&(J=.7);.2>J&&(J=.2);G=1+J*G;J=F.offsetX*G-
F.offsetX;F=F.offsetY*G-F.offsetY;var K=z.getBoundingClientRect().width||1,I=z.getBoundingClientRect().height||1,L=K*I/(I/K*G*t.state.dim.w*G*t.state.dim.w);t.setState({offset:{x:t.state.offset.x-t.state.dim.w/K*J,y:t.state.offset.y-t.state.dim.h/I*F},dim:{w:t.state.dim.w*G,h:t.state.dim.h*G},zoom_factor:L,res:t.getResPrefix(L)});return!0}},{passive:!0});a=F=>{var J;const G=K=>Math.hypot(K.touches[0].pageX-K.touches[1].pageX,K.touches[0].pageY-K.touches[1].pageY);F.addEventListener("touchstart",K=>
{t.stopCamera();t.inhibit_pointer_events=!1;1===K.touches.length&&(t.touch_is_on=!0,K.preventDefault(),t.drag=!0,t.ox=K.touches[0].pageX,t.oy=K.touches[0].pageY,t.tmp=t.state.offset);2===K.touches.length&&(K.preventDefault(),t.inhibit_pointer_events=!0,J=G(K))},{passive:!0});F.addEventListener("touchmove",K=>{if(2===K.touches.length){K.preventDefault();let M;M=K.scale?K.scale:G(K)/J;.9>M&&(M=.9);1.1<M&&(M=1.1);M=1/M;var I=[(K.touches[0].pageX+K.touches[1].pageX)/2,(K.touches[0].pageY+K.touches[1].pageY)/
2];K=I[0]*M-I[0];I=I[1]*M-I[1];var L=z.getBoundingClientRect().width||1,Q=z.getBoundingClientRect().height||1;const U=L*Q/(t.state.dim.w*M*t.state.dim.h*M);t.setState({offset:{x:t.state.offset.x-t.state.dim.w/L*K,y:t.state.offset.y-t.state.dim.h/Q*I},dim:{w:t.state.dim.w*M,h:t.state.dim.h*M},zoom_factor:U,res:t.getResPrefix(U)})}});F.addEventListener("touchend",K=>{t.touchinterval=window.setTimeout(function(){},500);F.style.transform="";F.style.WebkitTransform="";F.style.zIndex=""})};isTouchDevice$$module$SvgMap()&&
a(z)}}}getResPrefix(a){let e="";20>a&&(e="low-");2>a&&(e="empty-");return e}waypoint(a,e,n,t,z,D=null){window.clearInterval(this.interval);let F=this.state.offset.x,J=this.state.offset.y,G=this.state.dim.w,K=this.state.dim.h,I=0,L=this;const Q=10*z;this.camera_moving=!0;let M=document.getElementById("canvas");this.interval=window.setInterval(function(){const U=L.height/L.width;var Z=n*U,da=a-F-n/2,R=e-J-Z/2,ba=n-G;Z-=K;I++;let ha=easeInOutSine$$module$SvgMap;da=ha(10*I,F,da,Q);R=ha(10*I,J,R,Q);ba=
ha(10*I,G,ba,Q);Z=ha(10*I,K,Z,Q);this.width=M.getBoundingClientRect().width||1;this.height=M.getBoundingClientRect().height||1;L.setState({offset:{x:da,y:R},dim:{w:ba,h:ba*U},zoom_factor:L.width*L.height/(ba*Z),col1:"rect1",res:L.getResPrefix(L.width*L.height/(ba*Z))});I==z&&(L.stopCamera(),D&&D())},10)}stopCamera(){window.clearInterval(this.interval);this.camera_moving=!1}minimapOnLocation(a,e,n,t){const z=Math.abs(this.state.dim.w-n);if(20>Math.hypot(this.state.offset.x-a,this.state.offset.y-e)||
20<z||200>this.state.zoom_factor)this.waypoint(a,e,n,t,50);else{let D=this;this.waypoint(a,e,100*n,100*t,100,function(){D.waypoint(a,e,n,t,100)})}}}var module$SvgMap={};module$SvgMap.SvgMap=SvgMap$$module$SvgMap;/*
 GNU Affero General Public License.
 Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 v. 1.2.0
 https://github.com/RaumZeit/MarchingSquares.js

 MarchingSquaresJS is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 MarchingSquaresJS is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 As additional permission under GNU Affero General Public License version 3
 section 7, third-party projects (personal or commercial) may distribute,
 include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
 requirement that said third-party project for that reason alone becomes
 subject to any requirement of the GNU Affero General Public License version 3.
 Any modifications to MarchingSquaresJS, however, must be shared with the public
 and made available.

 In summary this:
 - allows you to use MarchingSquaresJS at no cost
 - allows you to use MarchingSquaresJS for both personal and commercial purposes
 - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
   license as long as this license notice is included
 - enables you to keep the source code of your program that uses MarchingSquaresJS
   undisclosed
 - forces you to share any modifications you have made to MarchingSquaresJS,
   e.g. bug-fixes

 You should have received a copy of the GNU Affero General Public License
 along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
 MIT
 @preserve
 @license GNU Affero General Public License.
 Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 v. 1.2.0
 https://github.com/RaumZeit/MarchingSquares.js

 MarchingSquaresJS is free software: you can redistribute it and/or modify
 it under the terms of the GNU Affero General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 MarchingSquaresJS is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 As additional permission under GNU Affero General Public License version 3
 section 7, third-party projects (personal or commercial) may distribute,
 include, or link against UNMODIFIED VERSIONS of MarchingSquaresJS without the
 requirement that said third-party project for that reason alone becomes
 subject to any requirement of the GNU Affero General Public License version 3.
 Any modifications to MarchingSquaresJS, however, must be shared with the public
 and made available.

 In summary this:
 - allows you to use MarchingSquaresJS at no cost
 - allows you to use MarchingSquaresJS for both personal and commercial purposes
 - allows you to distribute UNMODIFIED VERSIONS of MarchingSquaresJS under any
   license as long as this license notice is included
 - enables you to keep the source code of your program that uses MarchingSquaresJS
   undisclosed
 - forces you to share any modifications you have made to MarchingSquaresJS,
   e.g. bug-fixes

 You should have received a copy of the GNU Affero General Public License
 along with MarchingSquaresJS.  If not, see <http://www.gnu.org/licenses/>.
*/
!function(a,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((a="undefined"!=typeof globalThis?globalThis:a||self).turf={})}(this,function(a){function e(b,c,f){void 0===f&&(f={});var k={type:"Feature"};return(0===f.id||f.id)&&(k.id=f.id),f.bbox&&(k.bbox=f.bbox),k.properties=c||{},k.geometry=b,k}function n(b,c,f){switch(b){case "Point":return t(c).geometry;case "LineString":return J(c).geometry;case "Polygon":return D(c).geometry;
case "MultiPoint":return L(c).geometry;case "MultiLineString":return I(c).geometry;case "MultiPolygon":return Q(c).geometry;default:throw Error(b+" is invalid");}}function t(b,c,f){if(void 0===f&&(f={}),!b)throw Error("coordinates is required");if(!Array.isArray(b))throw Error("coordinates must be an Array");if(2>b.length)throw Error("coordinates must be at least 2 numbers long");if(!la(b[0])||!la(b[1]))throw Error("coordinates must contain numbers");return e({type:"Point",coordinates:b},c,f)}function z(b,
c,f){return void 0===f&&(f={}),K(b.map(function(k){return t(k,c)}),f)}function D(b,c,f){void 0===f&&(f={});for(var k=0;k<b.length;k++){var d=b[k];if(4>d.length)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var g=0;g<d[d.length-1].length;g++)if(d[d.length-1][g]!==d[0][g])throw Error("First and last Position are not equivalent.");}return e({type:"Polygon",coordinates:b},c,f)}function F(b,c,f){return void 0===f&&(f={}),K(b.map(function(k){return D(k,c)}),f)}function J(b,
c,f){if(void 0===f&&(f={}),2>b.length)throw Error("coordinates must be an array of two or more positions");return e({type:"LineString",coordinates:b},c,f)}function G(b,c,f){return void 0===f&&(f={}),K(b.map(function(k){return J(k,c)}),f)}function K(b,c){void 0===c&&(c={});var f={type:"FeatureCollection"};return c.id&&(f.id=c.id),c.bbox&&(f.bbox=c.bbox),f.features=b,f}function I(b,c,f){return void 0===f&&(f={}),e({type:"MultiLineString",coordinates:b},c,f)}function L(b,c,f){return void 0===f&&(f={}),
e({type:"MultiPoint",coordinates:b},c,f)}function Q(b,c,f){return void 0===f&&(f={}),e({type:"MultiPolygon",coordinates:b},c,f)}function M(b,c,f){return void 0===f&&(f={}),e({type:"GeometryCollection",geometries:b},c,f)}function U(b,c){if(void 0===c&&(c=0),c&&!(0<=c))throw Error("precision must be a positive number");c=Math.pow(10,c||0);return Math.round(b*c)/c}function Z(b,c){void 0===c&&(c="kilometers");var f=mh[c];if(!f)throw Error(c+" units is invalid");return b*f}function da(b,c){void 0===c&&
(c="kilometers");var f=mh[c];if(!f)throw Error(c+" units is invalid");return b/f}function R(b,c){return ha(da(b,c))}function ba(b){b%=360;return 0>b&&(b+=360),b}function ha(b){return b%(2*Math.PI)*180/Math.PI}function ma(b){return b%360*Math.PI/180}function ka(b,c,f){if(void 0===c&&(c="kilometers"),void 0===f&&(f="kilometers"),!(0<=b))throw Error("length must be a positive number");return Z(da(b,c),f)}function pa(b,c,f){if(void 0===c&&(c="meters"),void 0===f&&(f="kilometers"),!(0<=b))throw Error("area must be a positive number");
c=nh[c];if(!c)throw Error("invalid original units");f=nh[f];if(!f)throw Error("invalid final units");return b/c*f}function la(b){return!isNaN(b)&&null!==b&&!Array.isArray(b)}function ta(b){return!!b&&b.constructor===Object}function wa(b){if(!b)throw Error("bbox is required");if(!Array.isArray(b))throw Error("bbox must be an Array");if(4!==b.length&&6!==b.length)throw Error("bbox must be an Array of 4 or 6 numbers");b.forEach(function(c){if(!la(c))throw Error("bbox must only contain numbers");})}function za(b){if(!b)throw Error("id is required");
if(-1===["string","number"].indexOf(typeof b))throw Error("id must be a number or a string");}function Ca(b,c,f){if(null!==b){var k,d,g,l,h=0;var m=b.type;for(var q="FeatureCollection"===m,p="Feature"===m,r=q?b.features.length:1,v=0;v<r;v++){var A=(g=!!(d=q?b.features[v].geometry:p?b.geometry:b)&&"GeometryCollection"===d.type)?d.geometries.length:1;for(var u=0;u<A;u++){var y=0,C=0;if(null!==(k=g?d.geometries[u]:d)){var w=k.coordinates;var x=k.type;switch(l=!f||"Polygon"!==x&&"MultiPolygon"!==x?0:
1,x){case null:break;case "Point":if(!1===c(w,h,v,y,C))return!1;h++;break;case "LineString":case "MultiPoint":for(m=0;m<w.length;m++){if(!1===c(w[m],h,v,y,C))return!1;h++;"MultiPoint"===x&&y++}"LineString"===x&&y++;break;case "Polygon":case "MultiLineString":for(m=0;m<w.length;m++){for(k=0;k<w[m].length-l;k++){if(!1===c(w[m][k],h,v,y,C))return!1;h++}"MultiLineString"===x&&y++;"Polygon"===x&&C++}"Polygon"===x&&y++;break;case "MultiPolygon":for(m=0;m<w.length;m++){for(k=C=0;k<w[m].length;k++){for(x=
0;x<w[m][k].length-l;x++){if(!1===c(w[m][k][x],h,v,y,C))return!1;h++}C++}y++}break;case "GeometryCollection":for(m=0;m<k.geometries.length;m++)if(!1===Ca(k.geometries[m],c,f))return!1;break;default:throw Error("Unknown Geometry Type");}}}}}}function Vb(b,c,f,k){var d=f;return Ca(b,function(g,l,h,m,q){d=0===l&&void 0===f?g:c(d,g,l,h,m,q)},k),d}function Kb(b,c){var f;switch(b.type){case "FeatureCollection":for(f=0;f<b.features.length&&!1!==c(b.features[f].properties,f);f++);break;case "Feature":c(b.properties,
0)}}function Qd(b,c,f){var k=f;return Kb(b,function(d,g){k=0===g&&void 0===f?d:c(k,d,g)}),k}function Sa(b,c){if("Feature"===b.type)c(b,0);else if("FeatureCollection"===b.type)for(var f=0;f<b.features.length&&!1!==c(b.features[f],f);f++);}function Ya(b,c,f){var k=f;return Sa(b,function(d,g){k=0===g&&void 0===f?d:c(k,d,g)}),k}function uc(b){var c=[];return Ca(b,function(f){c.push(f)}),c}function Zb(b,c){var f,k,d,g,l,h=0,m="FeatureCollection"===b.type,q="Feature"===b.type,p=m?b.features.length:1;for(f=
0;f<p;f++){var r=m?b.features[f].geometry:q?b.geometry:b;var v=m?b.features[f].properties:q?b.properties:{};var A=m?b.features[f].bbox:q?b.bbox:void 0;var u=m?b.features[f].id:q?b.id:void 0;var y=(l=!!r&&"GeometryCollection"===r.type)?r.geometries.length:1;for(d=0;d<y;d++)if(null!==(g=l?r.geometries[d]:r))switch(g.type){case "Point":case "LineString":case "MultiPoint":case "Polygon":case "MultiLineString":case "MultiPolygon":if(!1===c(g,h,v,A,u))return!1;break;case "GeometryCollection":for(k=0;k<
g.geometries.length;k++)if(!1===c(g.geometries[k],h,v,A,u))return!1;break;default:throw Error("Unknown Geometry Type");}else if(!1===c(null,h,v,A,u))return!1;h++}}function pd(b,c,f){var k=f;return Zb(b,function(d,g,l,h,m){k=0===g&&void 0===f?d:c(k,d,g,l,h,m)}),k}function Rb(b,c){Zb(b,function(f,k,d,g,l){var h=null===f?null:f.type;switch(h){case null:case "Point":case "LineString":case "Polygon":return!1!==c(e(f,d,{bbox:g,id:l}),k,0)&&void 0}switch(h){case "MultiPoint":var m="Point";break;case "MultiLineString":m=
"LineString";break;case "MultiPolygon":m="Polygon"}for(g=0;g<f.coordinates.length;g++)if(!1===c(e({type:m,coordinates:f.coordinates[g]},d),k,g))return!1})}function Me(b,c,f){var k=f;return Rb(b,function(d,g,l){k=0===g&&0===l&&void 0===f?d:c(k,d,g,l)}),k}function N(b,c){Rb(b,function(f,k,d){var g=0;if(f.geometry){var l=f.geometry.type;if("Point"!==l&&"MultiPoint"!==l){var h,m=0,q=0,p=0;return!1!==Ca(f,function(r,v,A,u,y){if(void 0===h||k>m||u>q||y>p)return h=r,m=k,q=u,p=y,void(g=0);v=J([h,r],f.properties);
if(!1===c(v,k,d,y,g))return!1;g++;h=r})&&void 0}}})}function O(b,c,f){var k=f,d=!1;return N(b,function(g,l,h,m,q){k=!1===d&&void 0===f?g:c(k,g,l,h,m,q);d=!0}),k}function S(b,c){if(!b)throw Error("geojson is required");Rb(b,function(f,k,d){if(null!==f.geometry){var g=f.geometry.coordinates;switch(f.geometry.type){case "LineString":if(!1===c(f,k,d,0,0))return!1;break;case "Polygon":for(var l=0;l<g.length;l++)if(!1===c(J(g[l],f.properties),k,d,l))return!1}}})}function ea(b,c,f){var k=f;return S(b,function(d,
g,l,h){k=0===g&&void 0===f?d:c(k,d,g,l,h)}),k}function oa(b,c){if(!ta(c=c||{}))throw Error("options is invalid");var f=c.featureIndex||0,k=c.multiFeatureIndex||0,d=c.geometryIndex||0,g=c.segmentIndex||0,l=c.properties;switch(b.type){case "FeatureCollection":0>f&&(f=b.features.length+f);l=l||b.features[f].properties;b=b.features[f].geometry;break;case "Feature":l=l||b.properties;b=b.geometry;break;case "Point":case "MultiPoint":return null;case "LineString":case "Polygon":case "MultiLineString":case "MultiPolygon":break;
default:throw Error("geojson is invalid");}if(null===b)return null;f=b.coordinates;switch(b.type){case "Point":case "MultiPoint":return null;case "LineString":return 0>g&&(g=f.length+g-1),J([f[g],f[g+1]],l,c);case "Polygon":return 0>d&&(d=f.length+d),0>g&&(g=f[d].length+g-1),J([f[d][g],f[d][g+1]],l,c);case "MultiLineString":return 0>k&&(k=f.length+k),0>g&&(g=f[k].length+g-1),J([f[k][g],f[k][g+1]],l,c);case "MultiPolygon":return 0>k&&(k=f.length+k),0>d&&(d=f[k].length+d),0>g&&(g=f[k][d].length-g-1),
J([f[k][d][g],f[k][d][g+1]],l,c)}throw Error("geojson is invalid");}function Ba(b,c){if(!ta(c=c||{}))throw Error("options is invalid");var f=c.featureIndex||0,k=c.multiFeatureIndex||0,d=c.geometryIndex||0,g=c.coordIndex||0,l=c.properties;switch(b.type){case "FeatureCollection":0>f&&(f=b.features.length+f);l=l||b.features[f].properties;b=b.features[f].geometry;break;case "Feature":l=l||b.properties;b=b.geometry;break;case "Point":case "MultiPoint":return null;case "LineString":case "Polygon":case "MultiLineString":case "MultiPolygon":break;
default:throw Error("geojson is invalid");}if(null===b)return null;f=b.coordinates;switch(b.type){case "Point":return t(f,l,c);case "MultiPoint":return 0>k&&(k=f.length+k),t(f[k],l,c);case "LineString":return 0>g&&(g=f.length+g),t(f[g],l,c);case "Polygon":return 0>d&&(d=f.length+d),0>g&&(g=f[d].length+g),t(f[d][g],l,c);case "MultiLineString":return 0>k&&(k=f.length+k),0>g&&(g=f[k].length+g),t(f[k][g],l,c);case "MultiPolygon":return 0>k&&(k=f.length+k),0>d&&(d=f[k].length+d),0>g&&(g=f[k][d].length-
g),t(f[k][d][g],l,c)}throw Error("geojson is invalid");}function ya(b){var c=[1/0,1/0,-1/0,-1/0];return Ca(b,function(f){c[0]>f[0]&&(c[0]=f[0]);c[1]>f[1]&&(c[1]=f[1]);c[2]<f[0]&&(c[2]=f[0]);c[3]<f[1]&&(c[3]=f[1])}),c}function ca(b){if(!b)throw Error("coord is required");if(!Array.isArray(b)){if("Feature"===b.type&&null!==b.geometry&&"Point"===b.geometry.type)return b.geometry.coordinates;if("Point"===b.type)return b.coordinates}if(Array.isArray(b)&&2<=b.length&&!Array.isArray(b[0])&&!Array.isArray(b[1]))return b;
throw Error("coord must be GeoJSON Point or an Array of numbers");}function Y(b){if(Array.isArray(b))return b;if("Feature"===b.type){if(null!==b.geometry)return b.geometry.coordinates}else if(b.coordinates)return b.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array");}function xa(b){if(1<b.length&&la(b[0])&&la(b[1]))return!0;if(Array.isArray(b[0])&&b[0].length)return xa(b[0]);throw Error("coordinates must only contain numbers");}function Oa(b,c,f){if(!c||!f)throw Error("type and name required");
if(!b||b.type!==c)throw Error("Invalid input to "+f+": must be a "+c+", given "+b.type);}function Ob(b,c,f){if(!b)throw Error("No feature passed");if(!f)throw Error(".featureOf() requires a name");if(!b||"Feature"!==b.type||!b.geometry)throw Error("Invalid input to "+f+", Feature with geometry required");if(!b.geometry||b.geometry.type!==c)throw Error("Invalid input to "+f+": must be a "+c+", given "+b.geometry.type);}function Ka(b,c,f){if(!b)throw Error("No featureCollection passed");if(!f)throw Error(".collectionOf() requires a name");
if(!b||"FeatureCollection"!==b.type)throw Error("Invalid input to "+f+", FeatureCollection required");var k=0;for(b=b.features;k<b.length;k++){var d=b[k];if(!d||"Feature"!==d.type||!d.geometry)throw Error("Invalid input to "+f+", Feature with geometry required");if(!d.geometry||d.geometry.type!==c)throw Error("Invalid input to "+f+": must be a "+c+", given "+d.geometry.type);}}function Ib(b){return"Feature"===b.type?b.geometry:b}function qc(b,c){return"FeatureCollection"===b.type?"FeatureCollection":
"GeometryCollection"===b.type?"GeometryCollection":"Feature"===b.type&&null!==b.geometry?b.geometry.type:b.type}function ff(b,c,f){f=f||{};for(var k=Object.keys(Rj),d=0;d<k.length;d++){var g=k[d],l=f[g];l=null!=l?l:Rj[g];oh[g]=l}oh.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+c);b=function(h){var m=[],q=0;return h.cells.forEach(function(p,r){p.forEach(function(v,A){var u;if(void 0!==v&&5!==(u=v).cval&&10!==u.cval&&0!==v.cval&&15!==v.cval){a:{v=h.cells;var y=v.length,
C=[],w=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],x=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],B="none bottom right right top top top top left bottom right right left bottom left none".split(" "),E=v[r][A],H=E.cval,P="none left bottom left right none bottom left top top none top right right bottom none".split(" ")[H];P=ef(E,P);C.push([A+P[0],r+P[1]]);P=B[H];P=ef(E,P);C.push([A+P[0],r+P[1]]);wc(E);for(var T=A+w[H],W=r+x[H],aa=H;0<=T&&0<=W&&W<y&&(T!=A||W!=r)&&void 0!==(E=v[W][T]);){if(0===(H=E.cval)||15===H){A=
C;u="mergeable";break a}P=B[H];u=w[H];var X=x[H];5!==H&&10!==H||(5===H?E.flipped?-1===x[aa]?(P="left",u=-1,X=0):(P="right",u=1,X=0):-1===w[aa]&&(P="bottom",u=0,X=-1):10===H&&(E.flipped?-1===w[aa]?(P="top",u=0,X=1):(P="bottom",u=0,X=-1):1===x[aa]&&(P="left",u=-1,X=0)));P=ef(E,P);C.push([T+P[0],W+P[1]]);wc(E);T+=u;W+=X;aa=H}A=C;u="closed"}v=!1;if("mergeable"===u)for(X=A[A.length-1][0],y=A[A.length-1][1],u=q-1;0<=u;u--)if(1E-7>=Math.abs(m[u][0][0]-X)&&1E-7>=Math.abs(m[u][0][1]-y)){for(v=A.length-2;0<=
v;--v)m[u].unshift(A[v]);v=!0;break}v||(m[q++]=A)}})}),m}(function(h,m){for(var q=h.length-1,p=h[0].length-1,r={rows:q,cols:p,cells:[]},v=0;v<q;++v){r.cells[v]=[];for(var A=0;A<p;++A){var u=0,y=h[v+1][A],C=h[v+1][A+1],w=h[v][A+1],x=h[v][A];if(!(isNaN(y)||isNaN(C)||isNaN(w)||isNaN(x))){u|=y>=m?8:0;u|=C>=m?4:0;u|=w>=m?2:0;var B,E,H,P=!1;if(5===(u|=x>=m?1:0)||10===u){var T=(y+C+w+x)/4;5===u&&T<m?(u=10,P=!0):10===u&&T<m&&(u=5,P=!0)}0!==u&&15!==u&&(T=B=E=H=.5,1===u?(E=1-$a(m,y,x),B=1-$a(m,w,x)):2===u?
(B=$a(m,x,w),H=1-$a(m,C,w)):3===u?(E=1-$a(m,y,x),H=1-$a(m,C,w)):4===u?(T=$a(m,y,C),H=$a(m,w,C)):5===u?(T=$a(m,y,C),H=$a(m,w,C),B=1-$a(m,w,x),E=1-$a(m,y,x)):6===u?(B=$a(m,x,w),T=$a(m,y,C)):7===u?(E=1-$a(m,y,x),T=$a(m,y,C)):8===u?(E=$a(m,x,y),T=1-$a(m,C,y)):9===u?(B=1-$a(m,w,x),T=1-$a(m,C,y)):10===u?(T=1-$a(m,C,y),H=1-$a(m,C,w),B=$a(m,x,w),E=$a(m,x,y)):11===u?(T=1-$a(m,C,y),H=1-$a(m,C,w)):12===u?(E=$a(m,x,y),H=$a(m,w,C)):13===u?(B=1-$a(m,w,x),H=$a(m,w,C)):14===u?(E=$a(m,x,y),B=$a(m,x,w)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+
u),r.cells[v][A]={cval:u,flipped:P,top:T,right:H,bottom:B,left:E})}}}return r}(b,c));return"function"==typeof oh.successCallback&&oh.successCallback(b),b}function $a(b,c,f){return(b-c)/(f-c)}function wc(b){0===b.cval||15===b.cval||5===b.cval||10===b.cval||(b.cval=15)}function ef(b,c){return"top"===c?[b.top,1]:"bottom"===c?[b.bottom,0]:"right"===c?[1,b.right]:"left"===c?[0,b.left]:void 0}function lh(b,c){if(!ta(c=c||{}))throw Error("options is invalid");var f=c.zProperty||"elevation",k=c.flip;c=c.flags;
Ka(b,"Point","input must contain Points");b=function(q,p){var r={};return Sa(q,function(v){var A=Y(v)[1];r[A]||(r[A]=[]);r[A].push(v)}),Object.keys(r).map(function(v){return r[v].sort(function(A,u){return Y(A)[0]-Y(u)[0]})}).sort(function(v,A){return p?Y(v[0])[1]-Y(A[0])[1]:Y(A[0])[1]-Y(v[0])[1]})}(b,k);k=[];for(var d=0;d<b.length;d++){for(var g=b[d],l=[],h=0;h<g.length;h++){var m=g[h];m.properties[f]?l.push(m.properties[f]):l.push(0);!0===c&&(m.properties.matrixPosition=[d,h])}k.push(l)}return k}
function $b(b,c,f,k,d){vc(b,c,f||0,k||b.length-1,d||Cn)}function vc(b,c,f,k,d){for(;k>f;){if(600<k-f){var g=k-f+1,l=c-f+1,h=Math.log(g),m=.5*Math.exp(2*h/3);h=.5*Math.sqrt(h*m*(g-m)/g)*(0>l-g/2?-1:1);vc(b,c,Math.max(f,Math.floor(c-l*m/g+h)),Math.min(k,Math.floor(c+(g-l)*m/g+h)),d)}g=b[c];l=f;m=k;he(b,f,c);for(0<d(b[k],g)&&he(b,f,k);l<m;){he(b,l,m);l++;for(m--;0>d(b[l],g);)l++;for(;0<d(b[m],g);)m--}0===d(b[f],g)?he(b,f,m):he(b,++m,k);m<=c&&(f=m+1);c<=m&&(k=m-1)}}function he(b,c,f){var k=b[c];b[c]=
b[f];b[f]=k}function Cn(b,c){return b<c?-1:b>c?1:0}function mg(b,c){if(!(this instanceof mg))return new mg(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&this._initFormat(c);this.clear()}function Bf(b,c){ng(b,0,b.children.length,c,b)}function ng(b,c,f,k,d){d||=Cf(null);d.minX=1/0;d.minY=1/0;d.maxX=-1/0;d.maxY=-1/0;for(var g=c;g<f;g++)c=b.children[g],og(d,b.leaf?k(c):c);return d}function og(b,c){return b.minX=Math.min(b.minX,c.minX),b.minY=Math.min(b.minY,
c.minY),b.maxX=Math.max(b.maxX,c.maxX),b.maxY=Math.max(b.maxY,c.maxY),b}function Sj(b,c){return b.minX-c.minX}function Tj(b,c){return b.minY-c.minY}function oi(b){return(b.maxX-b.minX)*(b.maxY-b.minY)}function ph(b){return b.maxX-b.minX+(b.maxY-b.minY)}function pi(b,c){return b.minX<=c.minX&&b.minY<=c.minY&&c.maxX<=b.maxX&&c.maxY<=b.maxY}function qh(b,c){return c.minX<=b.maxX&&c.minY<=b.maxY&&c.maxX>=b.minX&&c.maxY>=b.minY}function Cf(b){return{children:b,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/
0,maxY:-1/0}}function Uj(b,c,f,k,d){for(var g,l=[c,f];l.length;)(f=l.pop())-(c=l.pop())<=k||(g=c+Math.ceil((f-c)/k/2)*k,Vj(b,g,c,f,d),l.push(c,g,g,f))}function ie(b){var c={exports:{}};return b(c,c.exports),c.exports}function pg(b,c){if(!(this instanceof pg))return new pg(b,c);if(this.data=b||[],this.length=this.data.length,this.compare=c||Dn,0<this.length)for(b=(this.length>>1)-1;0<=b;b--)this._down(b)}function Dn(b,c){return b<c?-1:b>c?1:0}function Wj(b,c,f){c=Math.max(0,void 0===c?2:c);f=f||0;
for(var k,d=b[0],g=b[0],l=b[0],h=b[0],m=0;m<b.length;m++){var q=b[m];q[0]<d[0]&&(d=q);q[0]>l[0]&&(l=q);q[1]<g[1]&&(g=q);q[1]>h[1]&&(h=q)}g=[d,g,l,h];d=g.slice();for(m=0;m<b.length;m++){h=b[m];l=h[0];h=h[1];q=!1;for(var p=0,r=g.length-1;p<g.length;r=p++){var v=g[p][0],A=g[p][1],u=g[r][0];r=g[r][1];A>h!=r>h&&l<(u-v)*(h-A)/(r-A)+v&&(q=!q)}q||d.push(b[m])}l=En(d);g=[];for(m=0;m<l.length;m++)g.push(d[l[m]]);b=Uc(16,["[0]","[1]","[0]","[1]"]).load(b);m=[];for(l=0;l<g.length;l++){var y=g[l];b.remove(y);
k=Xj(y,k);m.push(k)}d=Uc(16);for(l=0;l<m.length;l++)d.insert(qi(m[l]));c*=c;for(g=f*f;m.length;)if(f=m.shift(),l=f.p,h=f.next.p,q=ri(l,h),!(q<g)){q/=c;a:{var C=b;p=f.prev.p;v=l;A=h;u=f.next.next.p;r=q;var w=d,x=new Yj(null,Fn);for(C=C.data;C;){for(var B=0;B<C.children.length;B++){var E=C.children[B],H=C.leaf?si(E,v,A):Gn(v,A,E);H>r||x.push({node:E,dist:H})}for(;x.length&&!x.peek().node.children;){B=x.pop();E=B.node;H=si(E,p,v);var P=si(E,A,u);if(B.dist<H&&B.dist<P&&Zj(v,E,w)&&Zj(A,E,w)){p=E;break a}}(C=
x.pop())&&(C=C.node)}p=null}(y=p)&&Math.min(ri(y,l),ri(y,h))<=q&&(m.push(f),m.push(Xj(y,f)),b.remove(y),d.remove(f),d.insert(qi(f)),d.insert(qi(f.next)))}f=k;y=[];do y.push(f.p),f=f.next;while(f!==k);return y.push(f.p),y}function Fn(b,c){return b.dist-c.dist}function Gn(b,c,f){if(ak(b,f)||ak(c,f))return 0;var k=rh(b[0],b[1],c[0],c[1],f.minX,f.minY,f.maxX,f.minY);if(0===k)return 0;var d=rh(b[0],b[1],c[0],c[1],f.minX,f.minY,f.minX,f.maxY);if(0===d)return 0;var g=rh(b[0],b[1],c[0],c[1],f.maxX,f.minY,
f.maxX,f.maxY);if(0===g)return 0;b=rh(b[0],b[1],c[0],c[1],f.minX,f.maxY,f.maxX,f.maxY);return 0===b?0:Math.min(k,d,g,b)}function ak(b,c){return b[0]>=c.minX&&b[0]<=c.maxX&&b[1]>=c.minY&&b[1]<=c.maxY}function Zj(b,c,f){var k,d,g,l;f=f.search({minX:Math.min(b[0],c[0]),minY:Math.min(b[1],c[1]),maxX:Math.max(b[0],c[0]),maxY:Math.max(b[1],c[1])});for(var h=0;h<f.length;h++)if(k=f[h].p,d=f[h].next.p,g=b,k!==(l=c)&&d!==g&&0<sh(k,d,g)!=0<sh(k,d,l)&&0<sh(g,l,k)!=0<sh(g,l,d))return!1;return!0}function qi(b){var c=
b.p,f=b.next.p;return b.minX=Math.min(c[0],f[0]),b.minY=Math.min(c[1],f[1]),b.maxX=Math.max(c[0],f[0]),b.maxY=Math.max(c[1],f[1]),b}function Xj(b,c){b={p:b,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return c?(b.next=c.next,b.prev=c,c.next.prev=b,c.next=b):(b.prev=b,b.next=b),b}function ri(b,c){var f=b[0]-c[0];b=b[1]-c[1];return f*f+b*b}function si(b,c,f){var k=c[0];c=c[1];var d=f[0]-k,g=f[1]-c;if(0!==d||0!==g){var l=((b[0]-k)*d+(b[1]-c)*g)/(d*d+g*g);1<l?(k=f[0],c=f[1]):0<l&&(k+=d*l,c+=g*l)}return(d=
b[0]-k)*d+(g=b[1]-c)*g}function rh(b,c,f,k,d,g,l,h){var m,q,p,r,v=f-b,A=k-c,u=l-d,y=h-g,C=b-d,w=c-g,x=v*v+A*A,B=v*u+A*y,E=u*u+y*y;v=v*C+A*w;y=u*C+y*w;w=u=C=x*E-B*B;0===C?(q=0,u=1,r=y,w=E):(r=x*y-B*v,0>(q=B*y-E*v)?(q=0,r=y,w=E):q>u&&(q=u,r=y+B,w=E));0>r?(r=0,0>-v?q=0:-v>x?q=u:(q=-v,u=x)):r>w&&(r=w,0>-v+B?q=0:-v+B>x?q=u:(q=-v+B,u=x));r=(1-(p=0===r?0:r/w))*d+p*l-((1-(m=0===q?0:q/u))*b+m*f);b=(1-p)*g+p*h-((1-m)*c+m*k);return r*r+b*b}function bk(b,c){void 0===c&&(c={});c.concavity=c.concavity||1/0;var f=
[];if(Ca(b,function(k){f.push([k[0],k[1]])}),!f.length)return null;b=ck(f,c.concavity);return 3<b.length?D([b]):null}function Tb(b,c,f){if(void 0===f&&(f={}),!b)throw Error("point is required");if(!c)throw Error("polygon is required");b=ca(b);var k=Ib(c),d=c.bbox;c=k.coordinates;if(d&&!1===(d[0]<=b[0]&&d[1]<=b[1]&&d[2]>=b[0]&&d[3]>=b[1]))return!1;"Polygon"===k.type&&(c=[c]);k=!1;for(d=0;d<c.length&&!k;d++)if(dk(b,c[d][0],f.ignoreBoundary)){for(var g=!1,l=1;l<c[d].length&&!g;)dk(b,c[d][l],!f.ignoreBoundary)&&
(g=!0),l++;g||(k=!0)}return k}function dk(b,c,f){var k=!1;c[0][0]===c[c.length-1][0]&&c[0][1]===c[c.length-1][1]&&(c=c.slice(0,c.length-1));for(var d=0,g=c.length-1;d<c.length;g=d++){var l=c[d][0],h=c[d][1],m=c[g][0];g=c[g][1];if(0==b[1]*(l-m)+h*(m-b[0])+g*(b[0]-l)&&0>=(l-b[0])*(m-b[0])&&0>=(h-b[1])*(g-b[1]))return!f;h>b[1]!=g>b[1]&&b[0]<(m-l)*(b[1]-h)/(g-h)+l&&(k=!k)}return k}function ti(b,c){var f=[];return Sa(b,function(k){var d=!1;if("Point"===k.geometry.type)Zb(c,function(l){Tb(k,l)&&(d=!0)}),
d&&f.push(k);else{if("MultiPoint"!==k.geometry.type)throw Error("Input geometry must be a Point or MultiPoint");var g=[];Zb(c,function(l){Ca(k,function(h){Tb(h,l)&&(d=!0,g.push(h))})});d&&f.push(L(g))}}),K(f)}function Lb(b,c,f){void 0===f&&(f={});var k=ca(b),d=ca(c);c=ma(d[1]-k[1]);b=ma(d[0]-k[0]);k=ma(k[1]);d=ma(d[1]);c=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(b/2),2)*Math.cos(k)*Math.cos(d);return Z(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),f.units)}function ek(b,c){var f=!1;return K(function(k){if(3>
k.length)return[];k.sort(Hn);var d,g=k.length-1,l=k[g].x;var h=k[0].x;for(var m=k[g].y,q=m;g--;)k[g].y<m&&(m=k[g].y),k[g].y>q&&(q=k[g].y);var p,r=h-l,v=q-m;g=r>v?r:v;l=.5*(h+l);m=.5*(q+m);m=[new fk({__sentinel:!0,x:l-20*g,y:m-g},{__sentinel:!0,x:l,y:m+20*g},{__sentinel:!0,x:l+20*g,y:m-g})];q=[];l=[];for(g=k.length;g--;){l.length=0;for(p=m.length;p--;)0<(r=k[g].x-m[p].x)&&r*r>m[p].r?(q.push(m[p]),m.splice(p,1)):r*r+(v=k[g].y-m[p].y)*v>m[p].r||(l.push(m[p].a,m[p].b,m[p].b,m[p].c,m[p].c,m[p].a),m.splice(p,
1));var A=h=void 0;var u=l;var y=u.length;a:for(;y;){p=u[--y];var C=u[--y];for(d=y;d;)if(h=u[--d],C===(A=u[--d])&&p===h||C===h&&p===A){u.splice(y,2);u.splice(d,2);y-=2;continue a}}for(p=l.length;p;)A=l[--p],h=l[--p],d=k[g],C=A.x-h.x,u=A.y-h.y,C=2*(C*(d.y-A.y)-u*(d.x-A.x)),1E-12<Math.abs(C)&&m.push(new fk(h,A,d))}Array.prototype.push.apply(q,m);for(g=q.length;g--;)(q[g].a.__sentinel||q[g].b.__sentinel||q[g].c.__sentinel)&&q.splice(g,1);return q}(b.features.map(function(k){var d={x:k.geometry.coordinates[0],
y:k.geometry.coordinates[1]};return c?d.z=k.properties[c]:3===k.geometry.coordinates.length&&(f=!0,d.z=k.geometry.coordinates[2]),d})).map(function(k){var d=[k.a.x,k.a.y],g=[k.b.x,k.b.y],l=[k.c.x,k.c.y],h={};return f?(d.push(k.a.z),g.push(k.b.z),l.push(k.c.z)):h={a:k.a.z,b:k.b.z,c:k.c.z},D([[d,g,l,d]],h)}))}function Hn(b,c){return c.x-b.x}function Dc(b){if(!b)throw Error("geojson is required");switch(b.type){case "Feature":return gk(b);case "FeatureCollection":return function(c){var f={type:"FeatureCollection"};
return Object.keys(c).forEach(function(k){switch(k){case "type":case "features":break;default:f[k]=c[k]}}),f.features=c.features.map(function(k){return gk(k)}),f}(b);case "Point":case "LineString":case "Polygon":case "MultiPoint":case "MultiLineString":case "MultiPolygon":case "GeometryCollection":return ui(b);default:throw Error("unknown GeoJSON type");}}function gk(b){var c={type:"Feature"};return Object.keys(b).forEach(function(f){switch(f){case "type":case "properties":case "geometry":break;default:c[f]=
b[f]}}),c.properties=hk(b.properties),c.geometry=ui(b.geometry),c}function hk(b){var c={};return b?(Object.keys(b).forEach(function(f){var k=b[f];"object"==typeof k?null===k?c[f]=null:Array.isArray(k)?c[f]=k.map(function(d){return d}):c[f]=hk(k):c[f]=k}),c):c}function ui(b){var c={type:b.type};return b.bbox&&(c.bbox=b.bbox),"GeometryCollection"===b.type?(c.geometries=b.geometries.map(function(f){return ui(f)}),c):(c.coordinates=ik(b.coordinates),c)}function ik(b){return"object"!=typeof b[0]?b.slice():
b.map(function(c){return ik(c)})}function In(b,c){if(void 0===c&&(c={}),!ta(c=c||{}))throw Error("options is invalid");c=c.mutate;if("FeatureCollection"!==qc(b))throw Error("geojson must be a FeatureCollection");if(!b.features.length)throw Error("geojson is empty");!1!==c&&void 0!==c||(b=Dc(b));var f=[];b=ea(b,function(k,d){a:{var g=k.geometry.coordinates;var l=d.geometry.coordinates,h=th(g[0]),m=th(g[g.length-1]),q=th(l[0]),p=th(l[l.length-1]);if(h===p)g=l.concat(g.slice(1));else if(q===m)g=g.concat(l.slice(1));
else if(h===q)g=g.slice(1).reverse().concat(l);else{if(m!==p){g=null;break a}g=g.concat(l.reverse().slice(1))}g=J(g)}return g||(f.push(k),d)});return b&&f.push(b),f.length?1===f.length?f[0]:I(f.map(function(k){return k.coordinates})):null}function th(b){return b[0].toString()+","+b[1].toString()}function Jn(b){return b}function jk(b,c){function f(m){return l(m)}function k(m){for(var q=[],p=0,r=m.length;p<r;++p){var v,A=m[p],u=q;u.length&&u.pop();var y=h[0>A?~A:A],C=0;for(v=y.length;C<v;++C)u.push(l(y[C],
C));if(0>A)for(A=u.length,y=A-v;y<--A;)v=u[y],u[y++]=u[A],u[A]=v}return 2>q.length&&q.push(q[0]),q}function d(m){for(m=k(m);4>m.length;)m.push(m[0]);return m}function g(m){return m.map(d)}var l=function(m){if(null==m)return Jn;var q,p,r=m.scale[0],v=m.scale[1],A=m.translate[0],u=m.translate[1];return function(y,C){C||(q=p=0);C=2;var w=y.length,x=Array(w);x[0]=(q+=y[0])*r+A;for(x[1]=(p+=y[1])*v+u;C<w;)x[C]=y[C],++C;return x}}(b.transform),h=b.arcs;return function p(q){var r=q.type;switch(r){case "GeometryCollection":return{type:r,
geometries:q.geometries.map(p)};case "Point":q=l(q.coordinates);break;case "MultiPoint":q=q.coordinates.map(f);break;case "LineString":q=k(q.arcs);break;case "MultiLineString":q=q.arcs.map(k);break;case "Polygon":q=g(q.arcs);break;case "MultiPolygon":q=q.arcs.map(g);break;default:return null}return{type:r,coordinates:q}}(c)}function Kn(b,c){function f(m,q){for(var p in m){var r=m[p];delete q[r.start];delete r.start;delete r.end;r.forEach(function(v){k[0>v?~v:v]=1});l.push(r)}}var k={},d={},g={},l=
[],h=-1;return c.forEach(function(m,q){var p,r=b.arcs[0>m?~m:m];3>r.length&&!r[1][0]&&!r[1][1]&&(p=c[++h],c[h]=m,c[q]=p)}),c.forEach(function(m){var q=function(v){var A,u=b.arcs[0>v?~v:v],y=u[0];b.transform?(A=[0,0],u.forEach(function(C){A[0]+=C[0];A[1]+=C[1]})):A=u[u.length-1];return 0>v?[A,y]:[y,A]}(m);var p=q[0],r=q[1];(q=g[p])?(delete g[q.end],q.push(m),q.end=r,m=d[r])?(delete d[m.start],p=m===q?q:q.concat(m),d[p.start=q.start]=g[p.end=m.end]=p):d[q.start]=g[q.end]=q:(q=d[r])?(delete d[q.start],
q.unshift(m),q.start=p,m=g[p])?(delete g[m.end],p=m===q?q:m.concat(q),d[p.start=m.start]=g[p.end=q.end]=p):d[q.start]=g[q.end]=q:d[(q=[m]).start=p]=g[q.end=r]=q}),f(g,d),f(d,g),c.forEach(function(m){k[0>m?~m:m]||l.push([m])}),l}function Ln(b,c){function f(h){h.forEach(function(m){m.forEach(function(q){(d[q=0>q?~q:q]||(d[q]=[])).push(h)})});g.push(h)}function k(h){h=jk(b,{type:"Polygon",arcs:[h]}).coordinates[0];for(var m,q=-1,p=h.length,r=h[p-1],v=0;++q<p;)m=r,r=h[q],v+=m[0]*r[1]-m[1]*r[0];return Math.abs(v)}
var d={},g=[],l=[];return c.forEach(function q(m){switch(m.type){case "GeometryCollection":m.geometries.forEach(q);break;case "Polygon":f(m.arcs);break;case "MultiPolygon":m.arcs.forEach(f)}}),g.forEach(function(m){if(!m._){var q=[],p=[m];m._=1;for(l.push(q);m=p.pop();)q.push(m),m.forEach(function(r){r.forEach(function(v){d[0>v?~v:v].forEach(function(A){A._||(A._=1,p.push(A))})})})}}),g.forEach(function(m){delete m._}),{type:"MultiPolygon",arcs:l.map(function(m){var q=[];if(m.forEach(function(u){u.forEach(function(y){y.forEach(function(C){2>
d[0>C?~C:C].length&&q.push(C)})})}),1<(m=(q=Kn(b,q)).length))for(var p,r,v=1,A=k(q[0]);v<m;++v)(p=k(q[v]))>A&&(r=q[0],q[0]=q[v],q[v]=r,A=p);return q}).filter(function(m){return 0<m.length})}}function vi(b,c,f,k,d,g){3===arguments.length&&(k=g=Array,d=null);for(var l=new k(b=1<<Math.max(4,Math.ceil(Math.log(b)/Math.LN2))),h=new g(b),m=b-1,q=0;q<b;++q)l[q]=d;return{set:function(p,r){for(var v=c(p)&m,A=l[v],u=0;A!=d;){if(f(A,p))return h[v]=r;if(++u>=b)throw Error("full hashmap");A=l[v=v+1&m]}return l[v]=
p,h[v]=r,r},maybeSet:function(p,r){for(var v=c(p)&m,A=l[v],u=0;A!=d;){if(f(A,p))return h[v];if(++u>=b)throw Error("full hashmap");A=l[v=v+1&m]}return l[v]=p,h[v]=r,r},get:function(p,r){for(var v=c(p)&m,A=l[v],u=0;A!=d;){if(f(A,p))return h[v];if(++u>=b)break;A=l[v=v+1&m]}return r},keys:function(){for(var p=[],r=0,v=l.length;r<v;++r){var A=l[r];A!=d&&p.push(A)}return p}}}function gf(b,c){return b[0]===c[0]&&b[1]===c[1]}function wi(b){kk[0]=b[0];kk[1]=b[1];b=uh[0]^uh[1];return 2147483647&(b<<5^b>>7^
uh[2]^uh[3])}function Mn(b){function c(B,E,H,P){if(q[H]!==B)if(q[H]=B,B=p[H],0<=B){var T=r[H];B===E&&T===P||B===P&&T===E||(++A,v[H]=1)}else p[H]=E,r[H]=P}function f(B){return wi(g[B])}function k(B,E){return gf(g[B],g[E])}var d,g=b.coordinates,l=b.lines,h=b.rings,m=function(){for(var B=vi(1.4*g.length,f,k,Int32Array,-1,Int32Array),E=new Int32Array(g.length),H=0,P=g.length;H<P;++H)E[H]=B.maybeSet(H,H);return E}(),q=new Int32Array(g.length),p=new Int32Array(g.length),r=new Int32Array(g.length),v=new Int8Array(g.length),
A=0;b=0;for(d=g.length;b<d;++b)q[b]=p[b]=r[b]=-1;b=0;for(d=l.length;b<d;++b){var u=l[b];var y=u[0],C=u[1];u=m[y];var w=m[++y];++A;for(v[u]=1;++y<=C;)c(b,u,u=w,w=m[y]);++A;v[w]=1}b=0;for(d=g.length;b<d;++b)q[b]=-1;b=0;for(d=h.length;b<d;++b)for(u=h[b],l=u[0]+1,y=u[1],c(b,m[y-1],u=m[l-1],w=m[l]);++l<=y;)c(b,u,u=w,w=m[l]);q=p=r=null;var x;h=function(B,E,H,P,T){3===arguments.length&&(P=Array,T=null);for(var W=new P(B=1<<Math.max(4,Math.ceil(Math.log(B)/Math.LN2))),aa=B-1,X=0;X<B;++X)W[X]=T;return{add:function(fa){for(var na=
E(fa)&aa,qa=W[na],ia=0;qa!=T;){if(H(qa,fa))return!0;if(++ia>=B)throw Error("full hashset");qa=W[na=na+1&aa]}return W[na]=fa,!0},has:function(fa){for(var na=E(fa)&aa,qa=W[na],ia=0;qa!=T;){if(H(qa,fa))return!0;if(++ia>=B)break;qa=W[na=na+1&aa]}return!1},values:function(){for(var fa=[],na=0,qa=W.length;na<qa;++na){var ia=W[na];ia!=T&&fa.push(ia)}return fa}}}(1.4*A,wi,gf);b=0;for(d=g.length;b<d;++b)v[x=m[b]]&&h.add(g[x]);return h}function xi(b,c,f){for(var k,d=c+(f-- -c>>1);c<d;++c,--f)k=b[c],b[c]=b[f],
b[f]=k}function Nn(b){var c,f,k={};for(c in b)k[c]=null==(f=b[c])?{type:null}:("FeatureCollection"===f.type?On:"Feature"===f.type?lk:yi)(f);return k}function On(b){var c={type:"GeometryCollection",geometries:b.features.map(lk)};return null!=b.bbox&&(c.bbox=b.bbox),c}function lk(b){var c,f=yi(b.geometry);for(c in null!=b.id&&(f.id=b.id),null!=b.bbox&&(f.bbox=b.bbox),b.properties){f.properties=b.properties;break}return f}function yi(b){if(null==b)return{type:null};var c="GeometryCollection"===b.type?
{type:"GeometryCollection",geometries:b.geometries.map(yi)}:"Point"===b.type||"MultiPoint"===b.type?{type:b.type,coordinates:b.coordinates}:{type:b.type,arcs:b.coordinates};return null!=b.bbox&&(c.bbox=b.bbox),c}function Pn(b,c){function f(r){r&&vh.call(q,r.type)&&q[r.type](r)}function k(r){var v=[];do{var A=m.get(r);v.push(r[0]<r[1]?A:~A)}while(r=r.next);return v}function d(r){return r.map(k)}var g=function(r){function v(P){null!=P&&vh.call(E,P.type)&&E[P.type](P)}function A(P){var T=P[0];P=P[1];
T<C&&(C=T);T>x&&(x=T);P<w&&(w=P);P>B&&(B=P)}function u(P){P.forEach(A)}function y(P){P.forEach(u)}var C=1/0,w=1/0,x=-1/0,B=-1/0,E={GeometryCollection:function(P){P.geometries.forEach(v)},Point:function(P){A(P.coordinates)},MultiPoint:function(P){P.coordinates.forEach(A)},LineString:function(P){u(P.arcs)},MultiLineString:function(P){P.arcs.forEach(u)},Polygon:function(P){P.arcs.forEach(u)},MultiPolygon:function(P){P.arcs.forEach(y)}},H;for(H in r)v(r[H]);return x>=C&&B>=w?[C,w,x,B]:void 0}(b=Nn(b));
c=0<c&&g&&function(r,v,A){function u(fa){return[Math.round((fa[0]-E)*T),Math.round((fa[1]-H)*W)]}function y(fa,na){for(var qa,ia,ra,ja,Ma=-1,Pa=0,Sb=fa.length,Qa=Array(Sb);++Ma<Sb;)qa=fa[Ma],ja=Math.round((qa[0]-E)*T),qa=Math.round((qa[1]-H)*W),ja===ia&&qa===ra||(Qa[Pa++]=[ia=ja,ra=qa]);for(Qa.length=Pa;Pa<na;)Pa=Qa.push([Qa[0][0],Qa[0][1]]);return Qa}function C(fa){return y(fa,2)}function w(fa){return y(fa,4)}function x(fa){return fa.map(w)}function B(fa){null!=fa&&vh.call(aa,fa.type)&&aa[fa.type](fa)}
var E=v[0],H=v[1],P=v[2];v=v[3];var T=P-E?(A-1)/(P-E):1,W=v-H?(A-1)/(v-H):1,aa={GeometryCollection:function(fa){fa.geometries.forEach(B)},Point:function(fa){fa.coordinates=u(fa.coordinates)},MultiPoint:function(fa){fa.coordinates=fa.coordinates.map(u)},LineString:function(fa){fa.arcs=C(fa.arcs)},MultiLineString:function(fa){fa.arcs=fa.arcs.map(C)},Polygon:function(fa){fa.arcs=x(fa.arcs)},MultiPolygon:function(fa){fa.arcs=fa.arcs.map(x)}},X;for(X in r)B(r[X]);return{scale:[1/T,1/W],translate:[E,H]}}(b,
g,c);var l=function(r){function v(X){var fa,na,qa,ia;if(qa=W.get(fa=B[X[0]])){var ra=0;for(ia=qa.length;ra<ia;++ra){a:{var ja=na=qa[ra];var Ma=ja[0];var Pa=X[0];ja=ja[1];if(Ma-ja!=Pa-X[1])Ma=!1;else{for(;Ma<=ja;++Ma,++Pa)if(!gf(B[Ma],B[Pa])){Ma=!1;break a}Ma=!0}}if(Ma)return X[0]=na[0],void(X[1]=na[1])}}if(Ma=W.get(na=B[X[1]]))for(ra=0,ia=Ma.length;ra<ia;++ra){a:{var Sb=Pa=Ma[ra];ja=Sb[0];Sb=Sb[1];var Qa=X[1];if(ja-Sb!=X[0]-Qa)ja=!1;else{for(;ja<=Sb;++ja,--Qa)if(!gf(B[ja],B[Qa])){ja=!1;break a}ja=
!0}}if(ja)return X[1]=Pa[0],void(X[0]=Pa[1])}qa?qa.push(X):W.set(fa,[X]);Ma?Ma.push(X):W.set(na,[X]);aa.push(X)}function A(X){var fa,na,qa,ia;if(na=W.get(B[X[0]])){var ra=0;for(ia=na.length;ra<ia;++ra){if(u(qa=na[ra],X))return X[0]=qa[0],void(X[1]=qa[1]);if(y(qa,X))return X[0]=qa[1],void(X[1]=qa[0])}}if(na=W.get(fa=B[X[0]+C(X)]))for(ra=0,ia=na.length;ra<ia;++ra){if(u(qa=na[ra],X))return X[0]=qa[0],void(X[1]=qa[1]);if(y(qa,X))return X[0]=qa[1],void(X[1]=qa[0])}na?na.push(X):W.set(fa,[X]);aa.push(X)}
function u(X,fa){var na=X[0],qa=fa[0],ia=X[1]-na;if(ia!==fa[1]-qa)return!1;X=C(X);fa=C(fa);for(var ra=0;ra<ia;++ra)if(!gf(B[na+(ra+X)%ia],B[qa+(ra+fa)%ia]))return!1;return!0}function y(X,fa){var na=X[0],qa=fa[1],ia=X[1]-na;if(ia!==qa-fa[0])return!1;X=C(X);fa=ia-C(fa);for(var ra=0;ra<ia;++ra)if(!gf(B[na+(ra+X)%ia],B[qa-(ra+fa)%ia]))return!1;return!0}function C(X){var fa=X[0];X=X[1];for(var na=fa,qa=na,ia=B[na];++na<X;){var ra=B[na];(ra[0]<ia[0]||ra[0]===ia[0]&&ra[1]<ia[1])&&(qa=na,ia=ra)}return qa-
fa}var w,x,B=r.coordinates,E=r.lines,H=r.rings,P=E.length+H.length;delete r.lines;delete r.rings;var T=0;for(x=E.length;T<x;++T)for(w=E[T];w=w.next;)++P;T=0;for(x=H.length;T<x;++T)for(w=H[T];w=w.next;)++P;var W=vi(2.8*P,wi,gf),aa=r.arcs=[];T=0;for(x=E.length;T<x;++T){w=E[T];do v(w);while(w=w.next)}T=0;for(x=H.length;T<x;++T)if((w=H[T]).next){do v(w);while(w=w.next)}else A(w);return r}(function(r){var v,A,u=Mn(r),y=r.coordinates,C=r.lines,w=r.rings;var x=0;for(A=C.length;x<A;++x)for(var B=C[x],E=B[0],
H=B[1];++E<H;)u.has(y[E])&&(v={0:E,1:B[1]},B[1]=E,B=B.next=v);x=0;for(A=w.length;x<A;++x){C=w[x];H=B=C[0];E=C[1];for(var P=u.has(y[B]);++H<E;)if(u.has(y[H]))if(P)v={0:H,1:C[1]},C[1]=H,C=C.next=v;else{v=y;P=B;var T=E;H=E-H;xi(v,P,T);xi(v,P,P+H);xi(v,P+H,T);y[E]=y[B];P=!0;H=B}}return r}(function(r){function v(P){P&&vh.call(E,P.type)&&E[P.type](P)}function A(P){for(var T=0,W=P.length;T<W;++T)B[++C]=P[T];P={0:C-W+1,1:C};return w.push(P),P}function u(P){for(var T=0,W=P.length;T<W;++T)B[++C]=P[T];P={0:C-
W+1,1:C};return x.push(P),P}function y(P){return P.map(u)}var C=-1,w=[],x=[],B=[],E={GeometryCollection:function(P){P.geometries.forEach(v)},LineString:function(P){P.arcs=A(P.arcs)},MultiLineString:function(P){P.arcs=P.arcs.map(A)},Polygon:function(P){P.arcs=P.arcs.map(u)},MultiPolygon:function(P){P.arcs=P.arcs.map(y)}},H;for(H in r)v(r[H]);return{type:"Topology",coordinates:B,lines:w,rings:x,objects:r}}(b))),h=l.coordinates,m=vi(1.4*l.arcs.length,Qn,Rn);b=l.objects;l.bbox=g;l.arcs=l.arcs.map(function(r,
v){return m.set(r,v),h.slice(r[0],r[1]+1)});delete l.coordinates;h=null;var q={GeometryCollection:function(r){r.geometries.forEach(f)},LineString:function(r){r.arcs=k(r.arcs)},MultiLineString:function(r){r.arcs=r.arcs.map(k)},Polygon:function(r){r.arcs=r.arcs.map(k)},MultiPolygon:function(r){r.arcs=r.arcs.map(d)}},p;for(p in b)f(b[p]);return c&&(l.transform=c,l.arcs=function(r){for(var v=-1,A=r.length;++v<A;){var u=r[v],y=0,C=1,w=u.length;var x=u[0];for(var B=x[0],E=x[1];++y<w;){var H=(x=u[y])[0];
x=x[1];H===B&&x===E||(u[C++]=[H-B,x-E],B=H,E=x)}1===C&&(u[C++]=[0,0]);u.length=C}return r}(l.arcs)),l}function Qn(b){var c,f=b[0];b=b[1];return b<f&&(c=f,f=b,b=c),f+31*b}function Rn(b,c){var f,k=b[0];b=b[1];var d=c[0];c=c[1];return b<k&&(f=k,k=b,b=f),c<d&&(f=d,d=c,c=f),k===d&&b===c}function Sn(b,c){if(void 0===c&&(c={}),"FeatureCollection"!==qc(b))throw Error("geojson must be a FeatureCollection");if(!b.features.length)throw Error("geojson is empty");!1!==c.mutate&&void 0!==c.mutate||(b=Dc(b));var f=
[];Rb(b,function(k){f.push(k.geometry)});b=Pn({geoms:M(f).geometry});return function(k){return jk(k,Ln.apply(this,arguments))}(b,b.objects.geoms.geometries)}function Tn(b,c){if(void 0===c&&(c={}),!ta(c=c||{}))throw Error("options is invalid");var f=c.mutate;if("FeatureCollection"!==qc(b))throw Error("geojson must be a FeatureCollection");if(!b.features.length)throw Error("geojson is empty");!1!==f&&void 0!==f||(b=Dc(b));f=function(k){var d={};Rb(k,function(g){d[g.geometry.type]=!0});k=Object.keys(d);
return 1===k.length?k[0]:null}(b);if(!f)throw Error("geojson must be homogenous");switch(f){case "LineString":return In(b,c);case "Polygon":return Sn(b,c);default:throw Error(f+" is not supported");}}function hf(b,c){void 0===c&&(c={});c="object"==typeof c?c.mutate:c;if(!b)throw Error("geojson is required");var f=qc(b),k=[];switch(f){case "LineString":k=zi(b);break;case "MultiLineString":case "Polygon":Y(b).forEach(function(g){k.push(zi(g))});break;case "MultiPolygon":Y(b).forEach(function(g){var l=
[];g.forEach(function(h){l.push(zi(h))});k.push(l)});break;case "Point":return b;case "MultiPoint":var d={};Y(b).forEach(function(g){var l=g.join("-");Object.prototype.hasOwnProperty.call(d,l)||(k.push(g),d[l]=!0)});break;default:throw Error(f+" geometry not supported");}return b.coordinates?!0===c?(b.coordinates=k,b):{type:f,coordinates:k}:!0===c?(b.geometry.coordinates=k,b):e({type:f,coordinates:k},b.properties,{bbox:b.bbox,id:b.id})}function zi(b){b=Y(b);if(2===b.length&&!mk(b[0],b[1]))return b;
var c=[],f=b.length-1,k=c.length;c.push(b[0]);for(var d=1;d<f;d++){var g=c[c.length-1];b[d][0]===g[0]&&b[d][1]===g[1]||(c.push(b[d]),2<(k=c.length)&&nk(c[k-3],c[k-1],c[k-2])&&c.splice(c.length-2,1))}if(c.push(b[b.length-1]),k=c.length,mk(b[0],b[b.length-1])&&4>k)throw Error("invalid polygon");return nk(c[k-3],c[k-1],c[k-2])&&c.splice(c.length-2,1),c}function mk(b,c){return b[0]===c[0]&&b[1]===c[1]}function nk(b,c,f){var k=f[0];f=f[1];var d=b[0];b=b[1];var g=c[0];c=c[1];var l=g-d,h=c-b;return 0===
(k-d)*h-(f-b)*l&&(Math.abs(l)>=Math.abs(h)?0<l?d<=k&&k<=g:g<=k&&k<=d:0<h?b<=f&&f<=c:c<=f&&f<=b)}function Ai(b,c,f,k,d){for(var g,l=k,h=c+1;h<f;h++){var m=b[h],q=b[c];var p=b[f];var r=q.x;q=q.y;var v=p.x-r,A=p.y-q;if(0!==v||0!==A){var u=((m.x-r)*v+(m.y-q)*A)/(v*v+A*A);1<u?(r=p.x,q=p.y):0<u&&(r+=v*u,q+=A*u)}p=(v=m.x-r)*v+(A=m.y-q)*A;p>l&&(g=h,l=p)}l>k&&(1<g-c&&Ai(b,c,g,k,d),d.push(b[g]),1<f-g&&Ai(b,g,f,k,d))}function Bi(b,c,f){if(2>=b.length)return b;c=void 0!==c?c*c:1;if(!f){for(var k,d,g,l=b[0],h=
[l],m=1,q=b.length;m<q;m++)k=b[m],g=l,f=(d=k).x-g.x,d=d.y-g.y,f*f+d*d>c&&(h.push(k),l=k);b=(l!==k&&h.push(k),h)}k=b.length-1;f=[b[0]];return Ai(b,0,k,c,f),f.push(b[k]),f}function ok(b,c,f){return Bi(b.map(function(k){return{x:k[0],y:k[1],z:k[2]}}),c,f).map(function(k){return k.z?[k.x,k.y,k.z]:[k.x,k.y]})}function pk(b,c,f){return b.map(function(k){k=k.map(function(g){return{x:g[0],y:g[1]}});if(4>k.length)throw Error("invalid polygon");for(var d=Bi(k,c,f).map(function(g){return[g.x,g.y]});3>d.length||
3===d.length&&d[2][0]===d[0][0]&&d[2][1]===d[0][1];)d=Bi(k,c-=.01*c,f).map(function(g){return[g.x,g.y]});return d[d.length-1][0]===d[0][0]&&d[d.length-1][1]===d[0][1]||d.push(d[0]),d})}function qk(b,c){void 0===c&&(c={});var f=c.resolution||1E4,k=c.sharpness||.85,d=[];b=Ib(b).coordinates.map(function(l){return{x:l[0],y:l[1]}});var g=new Un({duration:f,points:b,sharpness:k});f=function(l){var h=g.pos(l);0==Math.floor(l/100)%2&&d.push([h.x,h.y])};for(k=0;k<g.duration;k+=10)f(k);return f(g.duration),
J(d,c.properties)}function Ci(b,c){void 0===c&&(c={});var f=Number(b[0]),k=Number(b[1]),d=Number(b[2]),g=Number(b[3]);if(6===b.length)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");var l=[f,k];return D([[l,[d,k],[d,g],[f,g],l]],c.properties,{bbox:b,id:c.id})}function rk(b){return Ci(ya(b))}function sk(b){var c=b[0],f=b[1],k=b[2],d=b[3];if(Lb(b.slice(0,2),[k,f])>=Lb(b.slice(0,2),[c,d]))return f=(f+d)/2,[c,f-(k-c)/2,k,f+(k-c)/2];c=(c+k)/2;return[c-(d-f)/2,f,c+(d-f)/2,d]}function je(b,
c,f,k){void 0===k&&(k={});var d=ca(b);b=ma(d[0]);d=ma(d[1]);f=ma(f);c=da(c,k.units);var g=Math.asin(Math.sin(d)*Math.cos(c)+Math.cos(d)*Math.sin(c)*Math.cos(f));return t([ha(b+Math.atan2(Math.sin(f)*Math.sin(c)*Math.cos(d),Math.cos(c)-Math.sin(d)*Math.sin(g))),ha(g)],k.properties)}function Di(b,c,f){void 0===f&&(f={});for(var k=f.steps||64,d=f.properties?f.properties:!Array.isArray(b)&&"Feature"===b.type&&b.properties?b.properties:{},g=[],l=0;l<k;l++)g.push(je(b,c,-360*l/k,f).geometry.coordinates);
return g.push(g[0]),D([g],d)}function Ae(b,c,f){if(void 0===f&&(f={}),!0===f.final)return(Ae(c,b)+180)%360;f=ca(b);var k=ca(c);c=ma(f[0]);b=ma(k[0]);f=ma(f[1]);k=ma(k[1]);return ha(Math.atan2(Math.sin(b-c)*Math.cos(k),Math.cos(f)*Math.sin(k)-Math.sin(f)*Math.cos(k)*Math.cos(b-c)))}function wh(b,c){void 0===c&&(c={});b=ya(b);return t([(b[0]+b[2])/2,(b[1]+b[3])/2],c.properties,c)}function Ne(b,c){void 0===c&&(c={});var f=0,k=0,d=0;return Ca(b,function(g){f+=g[0];k+=g[1];d++},!0),t([f/d,k/d],c.properties)}
function xh(b){var c=[];return"FeatureCollection"===b.type?Sa(b,function(f){Ca(f,function(k){c.push(t(k,f.properties))})}):Ca(b,function(f){c.push(t(f,b.properties))}),K(c)}function yh(b,c,f){f=f||2;var k,d,g,l=c&&c.length,h=l?c[0]*f:b.length,m=tk(b,0,h,f,!0),q=[];if(!m)return q;if(l){l=f;var p,r=[];var v=0;for(p=c.length;v<p;v++){(k=tk(b,c[v]*l,v<p-1?c[v+1]*l:b.length,l,!1))===k.next&&(k.steiner=!0);var A=r,u=A.push,y=k,C=k;do y.x<C.x&&(C=y),y=y.next;while(y!==k);u.call(A,C)}r.sort(Vn);for(v=0;v<
r.length;v++)Wn(r[v],m),m=qg(m,m.next)}if(b.length>80*f){var w=c=b[0];var x=k=b[1];for(l=f;l<h;l+=f)(d=b[l])<w&&(w=d),(g=b[l+1])<x&&(x=g),d>c&&(c=d),g>k&&(k=g);var B=0!==(B=Math.max(c-w,k-x))?1/B:0}return rg(m,q,f,w,x,B),q}function tk(b,c,f,k,d){if(d===0<Ei(b,c,f,k))for(d=c;d<f;d+=k)var g=uk(d,b[d],b[d+1],g);else for(d=f-k;d>=c;d-=k)g=uk(d,b[d],b[d+1],g);return g&&jf(g,g.next)&&(sg(g),g=g.next),g}function qg(b,c){if(!b)return b;c||=b;var f=b;do if(b=!1,f.steiner||!jf(f,f.next)&&0!==Mc(f.prev,f,f.next))f=
f.next;else{if(sg(f),(f=c=f.prev)===f.next)break;b=!0}while(b||f!==c);return c}function rg(b,c,f,k,d,g,l){if(b){if(!l&&g){var h=b,m=h;do null===m.z&&(m.z=Fi(m.x,m.y,k,d,g)),m.prevZ=m.prev,m=m.nextZ=m.next;while(m!==h);m.prevZ.nextZ=null;m.prevZ=null;h=m;var q,p,r,v,A=1;do{m=h;var u=h=null;for(r=0;m;){r++;var y=m;for(q=v=0;q<A&&(v++,y=y.nextZ);q++);for(q=A;0<v||0<q&&y;)0!==v&&(0===q||!y||m.z<=y.z)?(p=m,m=m.nextZ,v--):(p=y,y=y.nextZ,q--),u?u.nextZ=p:h=p,p.prevZ=u,u=p;m=y}u.nextZ=null;A*=2}while(1<r)}for(m=
b;b.prev!==b.next;){p=b.prev;h=b.next;if(g)a:{y=b;A=k;q=d;var C=g;u=y.prev;r=y.next;if(0<=Mc(u,y,r))y=!1;else{var w=u.x>y.x?u.x>r.x?u.x:r.x:y.x>r.x?y.x:r.x,x=u.y>y.y?u.y>r.y?u.y:r.y:y.y>r.y?y.y:r.y;v=Fi(u.x<y.x?u.x<r.x?u.x:r.x:y.x<r.x?y.x:r.x,u.y<y.y?u.y<r.y?u.y:r.y:y.y<r.y?y.y:r.y,A,q,C);A=Fi(w,x,A,q,C);q=y.prevZ;for(C=y.nextZ;q&&q.z>=v&&C&&C.z<=A;){if(q!==y.prev&&q!==y.next&&Df(u.x,u.y,y.x,y.y,r.x,r.y,q.x,q.y)&&0<=Mc(q.prev,q,q.next)||(q=q.prevZ,C!==y.prev&&C!==y.next&&Df(u.x,u.y,y.x,y.y,r.x,r.y,
C.x,C.y)&&0<=Mc(C.prev,C,C.next))){y=!1;break a}C=C.nextZ}for(;q&&q.z>=v;){if(q!==y.prev&&q!==y.next&&Df(u.x,u.y,y.x,y.y,r.x,r.y,q.x,q.y)&&0<=Mc(q.prev,q,q.next)){y=!1;break a}q=q.prevZ}for(;C&&C.z<=A;){if(C!==y.prev&&C!==y.next&&Df(u.x,u.y,y.x,y.y,r.x,r.y,C.x,C.y)&&0<=Mc(C.prev,C,C.next)){y=!1;break a}C=C.nextZ}y=!0}}else a:if(y=b,u=y.prev,r=y.next,0<=Mc(u,y,r))y=!1;else{for(v=y.next.next;v!==y.prev;){if(Df(u.x,u.y,y.x,y.y,r.x,r.y,v.x,v.y)&&0<=Mc(v.prev,v,v.next)){y=!1;break a}v=v.next}y=!0}if(y)c.push(p.i/
f),c.push(b.i/f),c.push(h.i/f),sg(b),m=b=h.next;else if((b=h)===m){if(l)if(1===l){l=rg;p=c;h=f;m=b;do y=m.prev,u=m.next.next,!jf(y,u)&&vk(y,m,m.next,u)&&tg(y,u)&&tg(u,y)&&(p.push(y.i/h),p.push(m.i/h),p.push(u.i/h),sg(m),sg(m.next),m=b=u),m=m.next;while(m!==b);l(m,c,f,k,d,g,2)}else{if(2===l)a:{l=b;do{for(p=l.next.next;p!==l.prev;){if(l.i!==p.i&&Xn(l,p)){b=wk(l,p);l=qg(l,l.next);b=qg(b,b.next);rg(l,c,f,k,d,g);rg(b,c,f,k,d,g);break a}p=p.next}l=l.next}while(l!==b)}}else rg(qg(b),c,f,k,d,g,1);break}}}}
function Vn(b,c){return b.x-c.x}function Wn(b,c){if(c=function(f,k){var d=k,g=f.x,l=f.y,h=-1/0;do{if(l<=d.y&&l>=d.next.y&&d.next.y!==d.y){var m=d.x+(l-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(m<=g&&m>h){if(h=m,m===g){if(l===d.y)return d;if(l===d.next.y)return d.next}var q=d.x<d.next.x?d:d.next}}d=d.next}while(d!==k);if(!q)return null;if(g===h)return q.prev;var p;k=q;m=q.x;var r=q.y,v=1/0;for(d=q.next;d!==k;)g>=d.x&&d.x>=m&&g!==d.x&&Df(l<r?g:h,l,m,r,l<r?h:g,l,d.x,d.y)&&((p=Math.abs(l-d.y)/(g-d.x))<v||
p===v&&d.x>q.x)&&tg(d,f)&&(q=d,v=p),d=d.next;return q}(b,c))b=wk(c,b),qg(b,b.next)}function Fi(b,c,f,k,d){return 1431655765&((b=858993459&((b=252645135&((b=16711935&((b=32767*(b-f)*d)|b<<8))|b<<4))|b<<2))|b<<1)|(1431655765&((c=858993459&((c=252645135&((c=16711935&((c=32767*(c-k)*d)|c<<8))|c<<4))|c<<2))|c<<1))<<1}function Df(b,c,f,k,d,g,l,h){return 0<=(d-l)*(c-h)-(b-l)*(g-h)&&0<=(b-l)*(k-h)-(f-l)*(c-h)&&0<=(f-l)*(g-h)-(d-l)*(k-h)}function Xn(b,c){return b.next.i!==c.i&&b.prev.i!==c.i&&!function(f,
k){var d=f;do{if(d.i!==f.i&&d.next.i!==f.i&&d.i!==k.i&&d.next.i!==k.i&&vk(d,d.next,f,k))return!0;d=d.next}while(d!==f);return!1}(b,c)&&tg(b,c)&&tg(c,b)&&function(f,k){var d=f,g=!1,l=(f.x+k.x)/2;k=(f.y+k.y)/2;do d.y>k!=d.next.y>k&&d.next.y!==d.y&&l<(d.next.x-d.x)*(k-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==f);return g}(b,c)}function Mc(b,c,f){return(c.y-b.y)*(f.x-c.x)-(c.x-b.x)*(f.y-c.y)}function jf(b,c){return b.x===c.x&&b.y===c.y}function vk(b,c,f,k){return!!(jf(b,c)&&jf(f,k)||jf(b,k)&&
jf(f,c))||0<Mc(b,c,f)!=0<Mc(b,c,k)&&0<Mc(f,k,b)!=0<Mc(f,k,c)}function tg(b,c){return 0>Mc(b.prev,b,b.next)?0<=Mc(b,c,b.next)&&0<=Mc(b,b.prev,c):0>Mc(b,c,b.prev)||0>Mc(b,b.next,c)}function wk(b,c){var f=new Gi(b.i,b.x,b.y),k=new Gi(c.i,c.x,c.y),d=b.next,g=c.prev;return b.next=c,c.prev=b,f.next=d,d.prev=f,k.next=f,f.prev=k,g.next=k,k.prev=g,k}function uk(b,c,f,k){b=new Gi(b,c,f);return k?(b.next=k.next,b.prev=k,k.next.prev=b,k.next=b):(b.prev=b,b.next=b),b}function sg(b){b.next.prev=b.prev;b.prev.next=
b.next;b.prevZ&&(b.prevZ.nextZ=b.nextZ);b.nextZ&&(b.nextZ.prevZ=b.prevZ)}function Gi(b,c,f){this.i=b;this.x=c;this.y=f;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function Ei(b,c,f,k){for(var d=0,g=f-k;c<f;c+=k)d+=(b[g]-b[c])*(b[c+1]+b[g+1]),g=c;return d}function xk(b){var c=function(l){for(var h=l[0][0].length,m={vertices:[],holes:[],dimensions:h},q=0,p=0;p<l.length;p++){for(var r=0;r<l[p].length;r++)for(var v=0;v<h;v++)m.vertices.push(l[p][r][v]);0<p&&(q+=l[p-1].length,
m.holes.push(q))}return m}(b),f=yk(c.vertices,c.holes,2);b=[];var k=[];f.forEach(function(l,h){l=f[h];k.push([c.vertices[2*l],c.vertices[2*l+1]])});for(var d=0;d<k.length;d+=3){var g=k.slice(d,d+3);g.push(k[d]);b.push(D([g]))}return b}function zh(b,c){if(!b)throw Error("targetPoint is required");if(!c)throw Error("points is required");var f,k=1/0,d=0;return Sa(c,function(g,l){g=Lb(b,g);g<k&&(d=l,k=g)}),(f=Dc(c.features[d])).properties.featureIndex=d,f.properties.distanceToPoint=k,f}function kf(b){if(!b)throw Error("geojson is required");
var c=[];return Rb(b,function(f){!function(k,d){var g=[],l=k.geometry;if(null!==l){switch(l.type){case "Polygon":g=Y(l);break;case "LineString":g=[Y(l)]}g.forEach(function(h){(function(m,q){var p=[];return m.reduce(function(r,v){var A=J([r,v],q),u=r[0];r=r[1];var y=v[0],C=v[1];return A.bbox=[u<y?u:y,r<C?r:C,u>y?u:y,r>C?r:C],p.push(A),v}),p})(h,k.properties).forEach(function(m){m.id=d.length;d.push(m)})})}}(f,c)}),K(c)}function ug(b,c,f){if(null!==b){var k,d,g,l,h=0;var m=b.type;for(var q="FeatureCollection"===
m,p="Feature"===m,r=q?b.features.length:1,v=0;v<r;v++){var A=(g=!!(d=q?b.features[v].geometry:p?b.geometry:b)&&"GeometryCollection"===d.type)?d.geometries.length:1;for(var u=0;u<A;u++){var y=0,C=0;if(null!==(k=g?d.geometries[u]:d)){var w=k.coordinates;var x=k.type;switch(l=!f||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case "Point":if(!1===c(w,h,v,y,C))return!1;h++;break;case "LineString":case "MultiPoint":for(m=0;m<w.length;m++){if(!1===c(w[m],h,v,y,C))return!1;h++;"MultiPoint"===x&&
y++}"LineString"===x&&y++;break;case "Polygon":case "MultiLineString":for(m=0;m<w.length;m++){for(k=0;k<w[m].length-l;k++){if(!1===c(w[m][k],h,v,y,C))return!1;h++}"MultiLineString"===x&&y++;"Polygon"===x&&C++}"Polygon"===x&&y++;break;case "MultiPolygon":for(m=0;m<w.length;m++){for(k=C=0;k<w[m].length;k++){for(x=0;x<w[m][k].length-l;x++){if(!1===c(w[m][k][x],h,v,y,C))return!1;h++}C++}y++}break;case "GeometryCollection":for(m=0;m<k.geometries.length;m++)if(!1===ug(k.geometries[m],c,f))return!1;break;
default:throw Error("Unknown Geometry Type");}}}}}}function zk(b,c){var f;switch(b.type){case "FeatureCollection":for(f=0;f<b.features.length&&!1!==c(b.features[f].properties,f);f++);break;case "Feature":c(b.properties,0)}}function Ak(b,c){if("Feature"===b.type)c(b,0);else if("FeatureCollection"===b.type)for(var f=0;f<b.features.length&&!1!==c(b.features[f],f);f++);}function Hi(b,c){var f,k,d,g,l,h=0,m="FeatureCollection"===b.type,q="Feature"===b.type,p=m?b.features.length:1;for(f=0;f<p;f++){var r=
m?b.features[f].geometry:q?b.geometry:b;var v=m?b.features[f].properties:q?b.properties:{};var A=m?b.features[f].bbox:q?b.bbox:void 0;var u=m?b.features[f].id:q?b.id:void 0;var y=(l=!!r&&"GeometryCollection"===r.type)?r.geometries.length:1;for(d=0;d<y;d++)if(null!==(g=l?r.geometries[d]:r))switch(g.type){case "Point":case "LineString":case "MultiPoint":case "Polygon":case "MultiLineString":case "MultiPolygon":if(!1===c(g,h,v,A,u))return!1;break;case "GeometryCollection":for(k=0;k<g.geometries.length;k++)if(!1===
c(g.geometries[k],h,v,A,u))return!1;break;default:throw Error("Unknown Geometry Type");}else if(!1===c(null,h,v,A,u))return!1;h++}}function Ah(b,c){Hi(b,function(f,k,d,g,l){var h=null===f?null:f.type;switch(h){case null:case "Point":case "LineString":case "Polygon":return!1!==c(Ec.feature(f,d,{bbox:g,id:l}),k,0)&&void 0}switch(h){case "MultiPoint":var m="Point";break;case "MultiLineString":m="LineString";break;case "MultiPolygon":m="Polygon"}for(g=0;g<f.coordinates.length;g++)if(!1===c(Ec.feature({type:m,
coordinates:f.coordinates[g]},d),k,g))return!1})}function Bk(b,c){Ah(b,function(f,k,d){var g=0;if(f.geometry){var l=f.geometry.type;if("Point"!==l&&"MultiPoint"!==l){var h,m=0,q=0,p=0;return!1!==ug(f,function(r,v,A,u,y){if(void 0===h||k>m||u>q||y>p)return h=r,m=k,q=u,p=y,void(g=0);v=Ec.lineString([h,r],f.properties);if(!1===c(v,k,d,y,g))return!1;g++;h=r})&&void 0}}})}function Ck(b,c){if(!b)throw Error("geojson is required");Ah(b,function(f,k,d){if(null!==f.geometry){var g=f.geometry.coordinates;switch(f.geometry.type){case "LineString":if(!1===
c(f,k,d,0,0))return!1;break;case "Polygon":for(var l=0;l<g.length;l++)if(!1===c(Ec.lineString(g[l],f.properties),k,d,l))return!1}}})}function Ii(b){var c=[1/0,1/0,-1/0,-1/0];return Ji.coordEach(b,function(f){c[0]>f[0]&&(c[0]=f[0]);c[1]>f[1]&&(c[1]=f[1]);c[2]<f[0]&&(c[2]=f[0]);c[3]<f[1]&&(c[3]=f[1])}),c}function Dk(b){b=Uc(b);return b.insert=function(c){if("Feature"!==c.type)throw Error("invalid feature");return c.bbox=c.bbox?c.bbox:vg(c),Uc.prototype.insert.call(this,c)},b.load=function(c){var f=
[];return Array.isArray(c)?c.forEach(function(k){if("Feature"!==k.type)throw Error("invalid features");k.bbox=k.bbox?k.bbox:vg(k);f.push(k)}):Yn(c,function(k){if("Feature"!==k.type)throw Error("invalid features");k.bbox=k.bbox?k.bbox:vg(k);f.push(k)}),Uc.prototype.load.call(this,f)},b.remove=function(c,f){if("Feature"!==c.type)throw Error("invalid feature");return c.bbox=c.bbox?c.bbox:vg(c),Uc.prototype.remove.call(this,c,f)},b.clear=function(){return Uc.prototype.clear.call(this)},b.search=function(c){c=
Uc.prototype.search.call(this,this.toBBox(c));return Ek(c)},b.collides=function(c){return Uc.prototype.collides.call(this,this.toBBox(c))},b.all=function(){var c=Uc.prototype.all.call(this);return Ek(c)},b.toJSON=function(){return Uc.prototype.toJSON.call(this)},b.fromJSON=function(c){return Uc.prototype.fromJSON.call(this,c)},b.toBBox=function(c){if(c.bbox)c=c.bbox;else if(!Array.isArray(c)||4!==c.length)if(Array.isArray(c)&&6===c.length)c=[c[0],c[1],c[3],c[4]];else{if("Feature"!==c.type&&"FeatureCollection"!==
c.type)throw Error("invalid geojson");c=vg(c)}return{minX:c[0],minY:c[1],maxX:c[2],maxY:c[3]}},b}function ke(b,c){var f={},k=[];if("LineString"===b.type&&(b=e(b)),"LineString"===c.type&&(c=e(c)),"Feature"===b.type&&"Feature"===c.type&&null!==b.geometry&&null!==c.geometry&&"LineString"===b.geometry.type&&"LineString"===c.geometry.type&&2===b.geometry.coordinates.length&&2===c.geometry.coordinates.length)return b=Fk(b,c),b&&k.push(b),K(k);var d=wg();return d.load(kf(c)),Sa(kf(b),function(g){Sa(d.search(g),
function(l){if(l=Fk(g,l)){var h=Y(l).join(",");f[h]||(f[h]=!0,k.push(l))}})}),K(k)}function Fk(b,c){var f=Y(b),k=Y(c);if(2!==f.length)throw Error("<intersects> line1 must only contain 2 coordinates");if(2!==k.length)throw Error("<intersects> line2 must only contain 2 coordinates");c=f[0][0];b=f[0][1];var d=f[1][0];f=f[1][1];var g=k[0][0],l=k[0][1],h=k[1][0],m=k[1][1];k=(m-l)*(d-c)-(h-g)*(f-b);if(0===k)return null;h=((h-g)*(b-l)-(m-l)*(c-g))/k;g=((d-c)*(b-l)-(f-b)*(c-g))/k;return 0<=h&&1>=h&&0<=g&&
1>=g?t([c+h*(d-c),b+h*(f-b)]):null}function Be(b,c,f){void 0===f&&(f={});var k=t([1/0,1/0],{dist:1/0}),d=0;return Rb(b,function(g){g=Y(g);for(var l=0;l<g.length-1;l++){var h=t(g[l]);h.properties.dist=Lb(c,h,f);var m=t(g[l+1]);m.properties.dist=Lb(c,m,f);var q=Lb(h,m,f),p=Math.max(h.properties.dist,m.properties.dist),r=Ae(h,m),v=je(c,p,r+90,f);p=je(c,p,r-90,f);v=ke(J([v.geometry.coordinates,p.geometry.coordinates]),J([h.geometry.coordinates,m.geometry.coordinates]));p=null;0<v.features.length&&((p=
v.features[0]).properties.dist=Lb(c,p,f),p.properties.location=d+Lb(h,p,f));h.properties.dist<k.properties.dist&&((k=h).properties.index=l,k.properties.location=d);m.properties.dist<k.properties.dist&&((k=m).properties.index=l+1,k.properties.location=d+q);p&&p.properties.dist<k.properties.dist&&((k=p).properties.index=l);d+=q}}),k}function Bh(b,c,f){void 0===f&&(f={});var k=ca(b),d=ca(c);d[0]+=180<d[0]-k[0]?-360:180<k[0]-d[0]?360:0;b=k[1]*Math.PI/180;var g=d[1]*Math.PI/180;c=g-b;k=Math.abs(d[0]-k[0])*
Math.PI/180;k>Math.PI&&(k-=2*Math.PI);g=Math.log(Math.tan(g/2+Math.PI/4)/Math.tan(b/2+Math.PI/4));b=1E-11<Math.abs(g)?c/g:Math.cos(b);return ka(6371008.8*Math.sqrt(c*c+b*b*k*k),"meters",f.units)}function Gk(b,c,f){if(void 0===f&&(f={}),f.method||(f.method="geodesic"),f.units||(f.units="kilometers"),!b)throw Error("pt is required");if(Array.isArray(b)?b=t(b):"Point"===b.type?b=e(b):Ob(b,"Point","point"),!c)throw Error("line is required");Array.isArray(c)?c=J(c):"LineString"===c.type?c=e(c):Ob(c,"LineString",
"line");var k=1/0,d=b.geometry.coordinates;return N(c,function(g){var l=g.geometry.coordinates[0];var h=g.geometry.coordinates[1];g=f;var m=[h[0]-l[0],h[1]-l[1]];var q=[d[0]-l[0],d[1]-l[1]];q=q[0]*m[0]+q[1]*m[1];if(0>=q)l=Ki(d,l,{method:g.method,units:"degrees"});else{var p=m[0]*m[0]+m[1]*m[1];p<=q?l=Ki(d,h,{method:g.method,units:"degrees"}):(h=q/p,l=Ki(d,[l[0]+h*m[0],l[1]+h*m[1]],{method:g.method,units:"degrees"}))}l<k&&(k=l)}),ka(k,"degrees",f.units)}function Ki(b,c,f){return"planar"===f.method?
Bh(b,c,f):Lb(b,c,f)}function Hk(b){b="FeatureCollection"!==b.type?"Feature"!==b.type?K([e(b)]):K([b]):b;for(var c=wh(b),f=!1,k=0;!f&&k<b.features.length;){var d,g=b.features[k].geometry,l=!1;if("Point"===g.type)c.geometry.coordinates[0]===g.coordinates[0]&&c.geometry.coordinates[1]===g.coordinates[1]&&(f=!0);else if("MultiPoint"===g.type)for(l=!1,d=0;!l&&d<g.coordinates.length;)c.geometry.coordinates[0]===g.coordinates[d][0]&&c.geometry.coordinates[1]===g.coordinates[d][1]&&(f=!0,l=!0),d++;else if("LineString"===
g.type)for(d=0;!l&&d<g.coordinates.length-1;)Ik(c.geometry.coordinates[0],c.geometry.coordinates[1],g.coordinates[d][0],g.coordinates[d][1],g.coordinates[d+1][0],g.coordinates[d+1][1])&&(l=!0,f=!0),d++;else if("MultiLineString"===g.type)for(var h=0;h<g.coordinates.length;){l=!1;d=0;for(var m=g.coordinates[h];!l&&d<m.length-1;)Ik(c.geometry.coordinates[0],c.geometry.coordinates[1],m[d][0],m[d][1],m[d+1][0],m[d+1][1])&&(l=!0,f=!0),d++;h++}else"Polygon"!==g.type&&"MultiPolygon"!==g.type||Tb(c,g)&&(f=
!0);k++}if(f)return c;f=K([]);for(k=0;k<b.features.length;k++)f.features=f.features.concat(xh(b.features[k]).features);return t(zh(c,f).geometry.coordinates)}function Ik(b,c,f,k,d,g){return Math.sqrt((d-f)*(d-f)+(g-k)*(g-k))===Math.sqrt((b-f)*(b-f)+(c-k)*(c-k))+Math.sqrt((d-b)*(d-b)+(g-c)*(g-c))}function Li(b){return pd(b,function(c,f){a:{var k,d=0;switch(f.type){case "Polygon":f=Jk(f.coordinates);break a;case "MultiPolygon":for(k=0;k<f.coordinates.length;k++)d+=Jk(f.coordinates[k]);f=d;break a}f=
0}return c+f},0)}function Jk(b){var c=0;if(b&&0<b.length){c+=Math.abs(Kk(b[0]));for(var f=1;f<b.length;f++)c-=Math.abs(Kk(b[f]))}return c}function Kk(b){var c,f,k,d,g=0,l=b.length;if(2<l){for(d=0;d<l;d++){d===l-2?(c=l-2,f=l-1,k=0):d===l-1?(c=l-1,f=0,k=1):(c=d,f=d+1,k=d+2);var h=b[c];var m=b[f];g+=(b[k][0]*Math.PI/180-h[0]*Math.PI/180)*Math.sin(m[1]*Math.PI/180)}g=40680631590769*g/2}return g}function Mi(b,c){return void 0===c&&(c={}),O(b,function(f,k){k=k.geometry.coordinates;return f+Lb(k[0],k[1],
c)},0)}function Lk(b,c,f,k){if(!ta(k=k||{}))throw Error("options is invalid");var d=[];if("Feature"===b.type)b=b.geometry.coordinates;else{if("LineString"!==b.type)throw Error("input must be a LineString Feature or Geometry");b=b.coordinates}for(var g,l,h,m=b.length,q=0,p=0;p<b.length&&!(c>=q&&p===b.length-1);p++){if(q>c&&0===d.length){if(!(g=c-q))return d.push(b[p]),J(d);l=Ae(b[p],b[p-1])-180;h=je(b[p],g,l,k);d.push(h.geometry.coordinates)}if(q>=f)return(g=f-q)?(l=Ae(b[p],b[p-1])-180,h=je(b[p],g,
l,k),d.push(h.geometry.coordinates),J(d)):(d.push(b[p]),J(d));if(q>=c&&d.push(b[p]),p===b.length-1)return J(d);q+=Lb(b[p],b[p+1],k)}if(q<c&&b.length===m)throw Error("Start position is beyond line");c=b[b.length-1];return J([c,c])}function hd(b,c,f){void 0===f&&(f={});b=ca(b);c=Y(c);for(var k=0;k<c.length-1;k++){var d=!1;f.ignoreEndVertices&&(0===k&&(d="start"),k===c.length-2&&(d="end"),0===k&&k+1===c.length-1&&(d="both"));a:{var g=c[k],l=c[k+1],h=void 0===f.epsilon?null:f.epsilon,m=b[0],q=b[1],p=
g[0];g=g[1];var r=l[0];l=l[1];var v=r-p,A=l-g,u=(b[0]-p)*A-(b[1]-g)*v;if(null!==h){if(Math.abs(u)>h){d=!1;break a}}else if(0!==u){d=!1;break a}d=d?"start"===d?Math.abs(v)>=Math.abs(A)?0<v?p<m&&m<=r:r<=m&&m<p:0<A?g<q&&q<=l:l<=q&&q<g:"end"===d?Math.abs(v)>=Math.abs(A)?0<v?p<=m&&m<r:r<m&&m<=p:0<A?g<=q&&q<l:l<q&&q<=g:"both"===d&&(Math.abs(v)>=Math.abs(A)?0<v?p<m&&m<r:r<m&&m<p:0<A?g<q&&q<l:l<q&&q<g):Math.abs(v)>=Math.abs(A)?0<v?p<=m&&m<=r:r<=m&&m<=p:0<A?g<=q&&q<=l:l<=q&&q<=g}if(d)return!0}return!1}function Mk(b,
c){b=Ib(b);c=Ib(c);var f=b.type,k=c.type;switch(f){case "Point":switch(k){case "MultiPoint":return function(d,g){var l,h=!1;for(l=0;l<g.coordinates.length;l++)if(Nk(g.coordinates[l],d.coordinates)){h=!0;break}return h}(b,c);case "LineString":return hd(b,c,{ignoreEndVertices:!0});case "Polygon":case "MultiPolygon":return Tb(b,c,{ignoreBoundary:!0});default:throw Error("feature2 "+k+" geometry not supported");}case "MultiPoint":switch(k){case "MultiPoint":return function(d,g){for(var l=0;l<d.coordinates.length;l++){for(var h=
!1,m=0;m<g.coordinates.length;m++)Nk(d.coordinates[l],g.coordinates[m])&&(h=!0);if(!h)return!1}return!0}(b,c);case "LineString":return function(d,g){for(var l=!1,h=0;h<d.coordinates.length;h++){if(!hd(d.coordinates[h],g))return!1;l||=hd(d.coordinates[h],g,{ignoreEndVertices:!0})}return l}(b,c);case "Polygon":case "MultiPolygon":return function(d,g){for(var l=!0,h=!1,m=0;m<d.coordinates.length;m++){if(!(h=Tb(d.coordinates[1],g))){l=!1;break}h=Tb(d.coordinates[1],g,{ignoreBoundary:!0})}return l&&h}(b,
c);default:throw Error("feature2 "+k+" geometry not supported");}case "LineString":switch(k){case "LineString":return function(d,g){for(var l=0;l<d.coordinates.length;l++)if(!hd(d.coordinates[l],g))return!1;return!0}(b,c);case "Polygon":case "MultiPolygon":return function(d,g){var l=ya(g),h=ya(d);if(!Ok(l,h))return!1;h=!1;for(l=0;l<d.coordinates.length-1;l++){if(!Tb(d.coordinates[l],g))return!1;if(h||=Tb(d.coordinates[l],g,{ignoreBoundary:!0}),!h){h=d.coordinates[l];var m=d.coordinates[l+1];h=Tb([(h[0]+
m[0])/2,(h[1]+m[1])/2],g,{ignoreBoundary:!0})}}return h}(b,c);default:throw Error("feature2 "+k+" geometry not supported");}case "Polygon":switch(k){case "Polygon":case "MultiPolygon":return function(d,g){var l=ya(d);if(!Ok(ya(g),l))return!1;for(l=0;l<d.coordinates[0].length;l++)if(!Tb(d.coordinates[0][l],g))return!1;return!0}(b,c);default:throw Error("feature2 "+k+" geometry not supported");}default:throw Error("feature1 "+f+" geometry not supported");}}function Ok(b,c){return!(b[0]>c[0])&&!(b[2]<
c[2])&&!(b[1]>c[1])&&!(b[3]<c[3])}function Nk(b,c){return b[0]===c[0]&&b[1]===c[1]}function Pk(b,c,f){void 0===f&&(f={});f.mask&&!f.units&&(f.units="kilometers");var k=[],d=b[0],g=b[1],l=b[2];b=b[3];var h=c/Lb([d,g],[l,g],f)*(l-d);c=c/Lb([d,g],[d,b],f)*(b-g);var m=l-d,q=b-g;q=(q-Math.floor(q/c)*c)/2;for(d+=(m-Math.floor(m/h)*h)/2;d<=l;){for(m=g+q;m<=b;){var p=t([d,m],f.properties);f.mask?Mk(p,f.mask)&&k.push(p):k.push(p);m+=c}d+=h}return K(k)}function Qk(b,c){void 0===c&&(c={});var f=c.precision,
k=c.coordinates;c=c.mutate;if(f=null==f||isNaN(f)?6:f,k=null==k||isNaN(k)?3:k,!b)throw Error("<geojson> is required");if("number"!=typeof f)throw Error("<precision> must be a number");if("number"!=typeof k)throw Error("<coordinates> must be a number");!1!==c&&void 0!==c||(b=JSON.parse(JSON.stringify(b)));var d=Math.pow(10,f);return Ca(b,function(g){g.length>k&&g.splice(k,g.length);for(var l=0;l<g.length;l++)g[l]=Math.round(g[l]*d)/d;!0}),b}function Ni(b){if(!b)throw Error("geojson is required");var c=
[];return Rb(b,function(f){c.push(f)}),K(c)}function Zn(b,c,f){function k(v,A,u,y){var C,w,x=g[v][A],B=g[v][A+1],E=g[u][y],H=g[u][y+1];if(xg(x,E)||xg(x,H)||xg(B,E)||xg(H,E))var P=null;else{P=x[0];var T=x[1],W=B[0],aa=B[1],X=E[0],fa=E[1],na=H[0],qa=H[1],ia=(P-W)*(fa-qa)-(T-aa)*(X-na);P=0===ia?null:[((P*aa-T*W)*(X-na)-(P-W)*(X*qa-fa*na))/ia,((P*aa-T*W)*(fa-qa)-(T-aa)*(X*qa-fa*na))/ia]}null===P||(C=B[0]!==x[0]?(P[0]-x[0])/(B[0]-x[0]):(P[1]-x[1])/(B[1]-x[1]),w=H[0]!==E[0]?(P[0]-E[0])/(H[0]-E[0]):(P[1]-
E[1])/(H[1]-E[1]),1<=C||0>=C||1<=w||0>=w)||(T=P,(W=!h[T])&&(h[T]=!0),c?l.push(c(P,v,A,x,B,C,u,y,E,H,w,W)):l.push(P))}function d(v,A){var u,y,C,w,x=g[v][A],B=g[v][A+1];return x[0]<B[0]?(u=x[0],y=B[0]):(u=B[0],y=x[0]),x[1]<B[1]?(C=x[1],w=B[1]):(C=B[1],w=x[1]),{minX:u,minY:C,maxX:y,maxY:w,ring:v,edge:A}}if("Polygon"!==b.geometry.type)throw Error("The input feature must be a Polygon");void 0===f&&(f=1);var g=b.geometry.coordinates,l=[],h={};if(f){b=[];for(var m=0;m<g.length;m++)for(var q=0;q<g[m].length-
1;q++)b.push(d(m,q));m=Uc();m.load(b)}for(var p=0;p<g.length;p++)for(var r=0;r<g[p].length-1;r++)if(f)m.search(d(p,r)).forEach(function(v){k(p,r,v.ring,v.edge)});else for(b=0;b<g.length;b++)for(q=0;q<g[b].length-1;q++)k(p,r,b,q);return c||(l={type:"Feature",geometry:{type:"MultiPoint",coordinates:l}}),l}function xg(b,c){if(!b||!c||b.length!==c.length)return!1;for(var f=0,k=b.length;f<k;f++)if(b[f]instanceof Array&&c[f]instanceof Array){if(!xg(b[f],c[f]))return!1}else if(b[f]!==c[f])return!1;return!0}
function $n(b){function c(){for(var w=[],x=0;x<r.features.length;x++)-1==r.features[x].properties.parent&&w.push(x);if(1<w.length)for(x=0;x<w.length;x++){for(var B=-1,E=0;E<r.features.length;E++)w[x]!=E&&Tb(r.features[w[x]].geometry.coordinates[0][0],r.features[E],{ignoreBoundary:!0})&&Infinity>Li(r.features[E])&&(B=E);r.features[w[x]].properties.parent=B}}function f(){for(var w=0;w<r.features.length;w++)if(-1==r.features[w].properties.parent){var x=r.features[w].properties.winding;r.features[w].properties.netWinding=
x;k(w,x)}}function k(w,x){for(var B=0;B<r.features.length;B++)if(r.features[B].properties.parent==w){var E=x+r.features[B].properties.winding;r.features[B].properties.netWinding=E;k(B,E)}}if("Feature"!=b.type)throw Error("The input must a geojson object of type Feature");if(void 0===b.geometry||null==b.geometry)throw Error("The input must a geojson object with a non-empty geometry");if("Polygon"!=b.geometry.type)throw Error("The input must be a geojson Polygon");for(var d=b.geometry.coordinates.length,
g=[],l=0;l<d;l++){var h=b.geometry.coordinates[l];yg(h[0],h[h.length-1])||h.push(h[0]);g.push.apply(g,h.slice(0,h.length-1))}if(!function(w){for(var x={},B=1,E=0,H=w.length;E<H;++E){if(Object.prototype.hasOwnProperty.call(x,w[E])){B=0;break}x[w[E]]=1}return B}(g))throw Error("The input polygon may not have duplicate vertices (except for the first and last vertex of each ring)");g=g.length;var m=Zn(b,function(w,x,B,E,H,P,T,W,aa,X,fa,na){return[w,x,B,E,H,P,T,W,aa,X,fa,na]}),q=m.length;if(0==q){var p=
[];for(l=0;l<d;l++)p.push(D([b.geometry.coordinates[l]],{parent:-1,winding:ao(b.geometry.coordinates[l])}));var r=K(p);return c(),f(),r}var v=[],A=[];for(l=0;l<d;l++)for(v.push([]),h=0;h<b.geometry.coordinates[l].length-1;h++)v[l].push([new Rk(b.geometry.coordinates[l][Ef(h+1,b.geometry.coordinates[l].length-1)],1,[l,h],[l,Ef(h+1,b.geometry.coordinates[l].length-1)],void 0)]),A.push(new Sk(b.geometry.coordinates[l][h],[l,Ef(h-1,b.geometry.coordinates[l].length-1)],[l,h],void 0,void 0,!1,!0));for(l=
0;l<q;l++)v[m[l][1]][m[l][2]].push(new Rk(m[l][0],m[l][5],[m[l][1],m[l][2]],[m[l][6],m[l][7]],void 0)),m[l][11]&&A.push(new Sk(m[l][0],[m[l][1],m[l][2]],[m[l][6],m[l][7]],void 0,void 0,!0,!0));m=A.length;for(l=0;l<v.length;l++)for(h=0;h<v[l].length;h++)v[l][h].sort(function(w,x){return w.param<x.param?-1:1});h=[];for(l=0;l<m;l++)h.push({minX:A[l].coord[0],minY:A[l].coord[1],maxX:A[l].coord[0],maxY:A[l].coord[1],index:l});q=Uc();q.load(h);for(l=0;l<v.length;l++)for(h=0;h<v[l].length;h++)for(m=0;m<
v[l][h].length;m++)u=m==v[l][h].length-1?v[l][Ef(h+1,b.geometry.coordinates[l].length-1)][0].coord:v[l][h][m+1].coord,u=q.search({minX:u[0],minY:u[1],maxX:u[0],maxY:u[1]})[0],v[l][h][m].nxtIsectAlongEdgeIn=u.index;for(l=0;l<v.length;l++)for(h=0;h<v[l].length;h++)for(m=0;m<v[l][h].length;m++){var u=v[l][h][m].coord,y=(u=q.search({minX:u[0],minY:u[1],maxX:u[0],maxY:u[1]})[0]).index;y<g?A[y].nxtIsectAlongRingAndEdge2=v[l][h][m].nxtIsectAlongEdgeIn:yg(A[y].ringAndEdge1,v[l][h][m].ringAndEdgeIn)?A[y].nxtIsectAlongRingAndEdge1=
v[l][h][m].nxtIsectAlongEdgeIn:A[y].nxtIsectAlongRingAndEdge2=v[l][h][m].nxtIsectAlongEdgeIn}g=[];for(h=l=0;h<d;h++){v=l;for(m=0;m<b.geometry.coordinates[h].length-1;m++)A[l].coord[0]<A[v].coord[0]&&(v=l),l++;q=A[v].nxtIsectAlongRingAndEdge2;for(m=0;m<A.length;m++)if(A[m].nxtIsectAlongRingAndEdge1==v||A[m].nxtIsectAlongRingAndEdge2==v){p=m;break}m=Ch([A[p].coord,A[v].coord,A[q].coord],!0)?1:-1;g.push({isect:v,parent:-1,winding:m})}g.sort(function(w,x){return A[w.isect].coord>A[x.isect].coord?-1:1});
for(p=[];0<g.length;){l=g.pop();b=l.isect;d=l.parent;h=l.winding;v=p.length;m=[A[b].coord];q=b;A[b].ringAndEdge1Walkable?(u=A[b].ringAndEdge1,y=A[b].nxtIsectAlongRingAndEdge1):(u=A[b].ringAndEdge2,y=A[b].nxtIsectAlongRingAndEdge2);for(;!yg(A[b].coord,A[y].coord);){m.push(A[y].coord);var C=void 0;for(l=0;l<g.length;l++)if(g[l].isect==y){C=l;break}if(null!=C&&g.splice(C,1),yg(u,A[y].ringAndEdge1)){if(u=A[y].ringAndEdge2,A[y].ringAndEdge2Walkable=!1,A[y].ringAndEdge1Walkable)l={isect:y},Ch([A[q].coord,
A[y].coord,A[A[y].nxtIsectAlongRingAndEdge2].coord],1==h)?(l.parent=d,l.winding=-h):(l.parent=v,l.winding=h),g.push(l);q=y;y=A[y].nxtIsectAlongRingAndEdge2}else{if(u=A[y].ringAndEdge1,A[y].ringAndEdge1Walkable=!1,A[y].ringAndEdge2Walkable)l={isect:y},Ch([A[q].coord,A[y].coord,A[A[y].nxtIsectAlongRingAndEdge1].coord],1==h)?(l.parent=d,l.winding=-h):(l.parent=v,l.winding=h),g.push(l);q=y;y=A[y].nxtIsectAlongRingAndEdge1}}m.push(A[y].coord);p.push(D([m],{index:v,parent:d,winding:h,netWinding:void 0}))}r=
K(p);return c(),f(),r}function Ch(b,c){if(void 0===c&&(c=!0),3!=b.length)throw Error("This function requires an array of three points [x,y]");return 0<=(b[1][0]-b[0][0])*(b[2][1]-b[0][1])-(b[1][1]-b[0][1])*(b[2][0]-b[0][0])==c}function ao(b){for(var c=0,f=0;f<b.length-1;f++)b[f][0]<b[c][0]&&(c=f);return Ch([b[Ef(c-1,b.length-1)],b[c],b[Ef(c+1,b.length-1)]],!0)?1:-1}function yg(b,c){if(!b||!c||b.length!=c.length)return!1;for(var f=0,k=b.length;f<k;f++)if(b[f]instanceof Array&&c[f]instanceof Array){if(!yg(b[f],
c[f]))return!1}else if(b[f]!=c[f])return!1;return!0}function Ef(b,c){return(b%c+c)%c}function Tk(b,c){var f=[],k=wg();return Rb(c,function(d){if(f.forEach(function(h,m){h.id=m}),f.length){var g=k.search(d);if(g.features.length){var l=Uk(d,g);f=f.filter(function(h){return h.id!==l.id});k.remove(l);Sa(Oi(l,d),function(h){f.push(h);k.insert(h)})}}else(f=Oi(b,d).features).forEach(function(h){h.bbox||(h.bbox=sk(ya(h)))}),k.load(K(f))}),K(f)}function Oi(b,c){var f=[],k=Y(b)[0],d=Y(b)[b.geometry.coordinates.length-
1];if(Pi(k,ca(c))||Pi(d,ca(c)))return K([b]);var g=wg();d=kf(b);g.load(d);g=g.search(c);if(!g.features.length)return K([b]);var l=Uk(c,g);b=Ya(d,function(h,m,q){m=Y(m)[1];var p=ca(c);return q===l.id?(h.push(p),f.push(J(h)),Pi(p,m)?[p]:[p,m]):(h.push(m),h)},[k]);return 1<b.length&&f.push(J(b)),K(f)}function Uk(b,c){if(!c.features.length)throw Error("lines must contain features");if(1===c.features.length)return c.features[0];var f,k=1/0;return Sa(c,function(d){var g=Be(d,b).properties.dist;g<k&&(f=
d,k=g)}),f}function Pi(b,c){return b[0]===c[0]&&b[1]===c[1]}function Vk(b,c,f,k,d){void 0===d&&(d={});var g=d.steps||64;f=Wk(f);var l=Wk(k);k=Array.isArray(b)||"Feature"!==b.type?{}:b.properties;if(f===l)return J(Di(b,c,d).geometry.coordinates[0],k);l=f<l?l:l+360;for(var h=f,m=[],q=0;h<l;)m.push(je(b,c,h,d).geometry.coordinates),h=f+360*++q/g;return h>l&&m.push(je(b,c,l,d).geometry.coordinates),J(m,k)}function Wk(b){b%=360;return 0>b&&(b+=360),b}function zg(b,c){void 0===c&&(c={});var f=Ib(b);switch(c.properties||
"Feature"!==b.type||(c.properties=b.properties),f.type){case "Polygon":return Qi(f,c);case "MultiPolygon":return function(k,d){void 0===d&&(d={});var g=Ib(k).coordinates,l=d.properties?d.properties:"Feature"===k.type?k.properties:{},h=[];return g.forEach(function(m){h.push(Xk(m,l))}),K(h)}(f,c);default:throw Error("invalid poly");}}function Qi(b,c){return void 0===c&&(c={}),Xk(Ib(b).coordinates,c.properties?c.properties:"Feature"===b.type?b.properties:{})}function Xk(b,c){return 1<b.length?I(b,c):
J(b[0],c)}function Yk(b,c){var f,k,d;void 0===c&&(c={});var g=c.properties,l=null===(f=c.autoComplete)||void 0===f||f,h=null===(k=c.orderCoords)||void 0===k||k;switch(null!==(d=c.mutate)&&void 0!==d&&d||(b=Dc(b)),b.type){case "FeatureCollection":var m=[];return b.features.forEach(function(q){m.push(Y(Zk(q,{},l,h)))}),Q(m,g);default:return Zk(b,g,l,h)}}function Zk(b,c,f,k){c=c||("Feature"===b.type?b.properties:{});var d=Ib(b);b=d.coordinates;d=d.type;if(!b.length)throw Error("line must contain coordinates");
switch(d){case "LineString":return f&&(b=$k(b)),D([b],c);case "MultiLineString":var g=[],l=0;return b.forEach(function(h){if(f&&(h=$k(h)),k){var m=ya(J(h));m=Math.abs(m[0]-m[2])*Math.abs(m[1]-m[3]);m>l?(g.unshift(h),l=m):g.push(h)}else g.push(h)}),D(g,c);default:throw Error("geometry type "+d+" is not supported");}}function $k(b){var c=b[0],f=c[1],k=b[b.length-1],d=k[1];return c[0]===k[0]&&f===d||b.push(c),b}function Ri(b,c,f,k){return 8&f?[b[0]+(c[0]-b[0])*(k[3]-b[1])/(c[1]-b[1]),k[3]]:4&f?[b[0]+
(c[0]-b[0])*(k[1]-b[1])/(c[1]-b[1]),k[1]]:2&f?[k[2],b[1]+(c[1]-b[1])*(k[2]-b[0])/(c[0]-b[0])]:1&f?[k[0],b[1]+(c[1]-b[1])*(k[0]-b[0])/(c[0]-b[0])]:null}function Ff(b,c){var f=0;return b[0]<c[0]?f|=1:b[0]>c[2]&&(f|=2),b[1]<c[1]?f|=4:b[1]>c[3]&&(f|=8),f}function al(b,c){for(var f=[],k=0;k<b.length;k++){var d,g=void 0,l,h,m,q=void 0,p=b[k],r=c;for(m=1;8>=m;m*=2){q=[];var v=!(Ff(h=p[p.length-1],r)&m);for(l=0;l<p.length;l++)(d=!(Ff(g=p[l],r)&m))!==v&&q.push(Ri(h,g,m,r)),d&&q.push(g),h=g,v=d;if(!(p=q).length)break}d=
q;0<d.length&&(d[0][0]===d[d.length-1][0]&&d[0][1]===d[d.length-1][1]||d.push(d[0]),4<=d.length&&f.push(d))}return f}function bl(b,c,f){if(void 0===f&&(f={}),!ta(f=f||{}))throw Error("options is invalid");var k,d=f.tolerance||0,g=[],l=wg();b=kf(b);return l.load(b),N(c,function(h){var m=!1;h&&(Sa(l.search(h),function(q){if(!1===m){var p=Y(h).sort(),r=Y(q).sort();Gf(p,r)||(0===d?hd(p[0],q)&&hd(p[1],q):Be(q,p[0]).properties.dist<=d&&Be(q,p[1]).properties.dist<=d)?(m=!0,k=k?cl(k,h):h):(0===d?hd(r[0],
h)&&hd(r[1],h):Be(h,r[0]).properties.dist<=d&&Be(h,r[1]).properties.dist<=d)&&(k=k?cl(k,q):q)}}),!1===m&&k&&(g.push(k),k=void 0))}),k&&g.push(k),K(g)}function cl(b,c){c=Y(c);var f=Y(b),k=f[0];f=f[f.length-1];var d=b.geometry.coordinates;return Gf(c[0],k)?d.unshift(c[1]):Gf(c[0],f)?d.push(c[1]):Gf(c[1],k)?d.unshift(c[0]):Gf(c[1],f)&&d.push(c[0]),b}function dl(b){b%=360;return 0>b&&(b+=360),b}function lf(b,c,f){var k;return void 0===f&&(f={}),180<(k=f.final?el(ca(c),ca(b)):el(ca(b),ca(c)))?-(360-k):
k}function el(b,c){var f=ma(b[1]),k=ma(c[1]);b=ma(c[0]-b[0]);b>Math.PI&&(b-=2*Math.PI);b<-Math.PI&&(b+=2*Math.PI);return(ha(Math.atan2(b,Math.log(Math.tan(k/2+Math.PI/4)/Math.tan(f/2+Math.PI/4))))+360)%360}function Hf(b,c,f,k){void 0===k&&(k={});var d=0>c;c=ka(Math.abs(c),k.units,"meters");d&&(c=-Math.abs(c));b=ca(b);d=void 0;d=void 0===d?6371008.8:Number(d);c/=d;d=b[0]*Math.PI/180;var g=ma(b[1]);f=ma(f);var l=c*Math.cos(f),h=g+l;Math.abs(h)>Math.PI/2&&(h=0<h?Math.PI-h:-Math.PI-h);var m=Math.log(Math.tan(h/
2+Math.PI/4)/Math.tan(g/2+Math.PI/4));f=[(180*(d+c*Math.sin(f)/(1E-11<Math.abs(m)?l/m:Math.cos(g)))/Math.PI+540)%360-180,180*h/Math.PI];return f[0]+=180<f[0]-b[0]?-360:180<b[0]-f[0]?360:0,t(f,k.properties)}function fl(b,c,f,k,d,g){for(var l=0;l<b.length;l++){var h=b[l];k=b[l+1];l===b.length-1&&(k=b[0]);k=Ag(h,k,c);0>=f&&0<k?0>Ag(c,h,d)||(d=h):0<f&&0>=k&&(0<Ag(c,h,g)||(g=h));f=k}return[d,g]}function Ag(b,c,f){return(c[0]-b[0])*(f[1]-b[1])-(f[0]-b[0])*(c[1]-b[1])}function Dh(b){for(var c,f=Y(b),k=0,
d=1;d<f.length;)b=c||f[0],k+=((c=f[d])[0]-b[0])*(c[1]+b[1]),d++;return 0<k}function Eh(b,c){switch("Feature"===b.type?b.geometry.type:b.type){case "GeometryCollection":return Zb(b,function(f){Eh(f,c)}),b;case "LineString":return gl(Y(b),c),b;case "Polygon":return hl(Y(b),c),b;case "MultiLineString":return Y(b).forEach(function(f){gl(f,c)}),b;case "MultiPolygon":return Y(b).forEach(function(f){hl(f,c)}),b;case "Point":case "MultiPoint":return b}}function gl(b,c){Dh(b)===c&&b.reverse()}function hl(b,
c){Dh(b[0])!==c&&b[0].reverse();for(var f=1;f<b.length;f++)Dh(b[f])===c&&b[f].reverse()}function bo(b,c){if(!ta(c=c||{}))throw Error("options is invalid");var f=c.zProperty||"elevation",k=c.flip;c=c.flags;Ka(b,"Point","input must contain Points");b=function(q,p){var r={};return Sa(q,function(v){var A=Y(v)[1];r[A]||(r[A]=[]);r[A].push(v)}),Object.keys(r).map(function(v){return r[v].sort(function(A,u){return Y(A)[0]-Y(u)[0]})}).sort(function(v,A){return p?Y(v[0])[1]-Y(A[0])[1]:Y(A[0])[1]-Y(v[0])[1]})}(b,
k);k=[];for(var d=0;d<b.length;d++){for(var g=b[d],l=[],h=0;h<g.length;h++){var m=g[h];m.properties[f]?l.push(m.properties[f]):l.push(0);!0===c&&(m.properties.matrixPosition=[d,h])}k.push(l)}return k}function co(b,c,f,k){k=k||{};for(var d=Object.keys(il),g=0;g<d.length;g++){var l=d[g],h=k[l];h=null!=h?h:il[l];mf[l]=h}mf.verbose&&console.log("MarchingSquaresJS-isoBands: computing isobands for ["+c+":"+(c+f)+"]");var m;b=function(q,p,r){var v=q.length-1,A=q[0].length-1,u={rows:v,cols:A,cells:[]};r=
p+Math.abs(r);for(var y=0;y<v;++y){u.cells[y]=[];for(var C=0;C<A;++C){var w=0,x=q[y+1][C],B=q[y+1][C+1],E=q[y][C+1],H=q[y][C];if(!(isNaN(x)||isNaN(B)||isNaN(E)||isNaN(H))){w|=x<p?0:x>r?128:64;w|=B<p?0:B>r?32:16;w|=E<p?0:E>r?8:4;var P=+(w|=H<p?0:H>r?2:1),T=0;if(17===w||18===w||33===w||34===w||38===w||68===w||72===w||98===w||102===w||132===w||136===w||137===w||152===w||153===w)T=(x+B+E+H)/4,T=T>r?2:T<p?0:1,34===w?1===T?w=35:0===T&&(w=136):136===w?1===T?(w=35,T=4):0===T&&(w=34):17===w?1===T?(w=155,T=
4):0===T&&(w=153):68===w?1===T?(w=103,T=4):0===T&&(w=102):153===w?1===T&&(w=155):102===w?1===T&&(w=103):152===w?2>T&&(w=156,T=1):137===w?2>T&&(w=139,T=1):98===w?2>T&&(w=99,T=1):38===w?2>T&&(w=39,T=1):18===w?0<T?(w=156,T=4):w=152:33===w?0<T?(w=139,T=4):w=137:72===w?0<T?(w=99,T=4):w=98:132===w&&(0<T?(w=39,T=4):w=38);if(0!=w&&170!=w){var W,aa,X,fa,na,qa,ia;var ra=W=aa=X=fa=na=qa=ia=.5;var ja=[];1===w?(aa=1-V(p,E,H),ia=1-V(p,x,H),ja.push(Ja[w])):169===w?(aa=V(r,H,E),ia=V(r,H,x),ja.push(Ja[w])):4===w?
(na=1-V(p,B,E),X=V(p,H,E),ja.push(Ga[w])):166===w?(na=V(r,E,B),X=1-V(r,E,H),ja.push(Ga[w])):16===w?(fa=V(p,E,B),W=V(p,x,B),ja.push(Ha[w])):154===w?(fa=1-V(r,B,E),W=1-V(r,B,x),ja.push(Ha[w])):64===w?(qa=V(p,H,x),ra=1-V(p,B,x),ja.push(Ta[w])):106===w?(qa=1-V(r,x,H),ra=V(r,x,B),ja.push(Ta[w])):168===w?(X=V(r,H,E),aa=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ja.push(La[w]),ja.push(Ja[w])):2===w?(X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ja.push(La[w]),ja.push(Ja[w])):162===w?(fa=V(r,E,B),na=V(p,E,
B),X=1-V(p,E,H),aa=1-V(r,E,H),ja.push(La[w]),ja.push(Ja[w])):8===w?(fa=1-V(p,B,E),na=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ja.push(Ha[w]),ja.push(Ga[w])):138===w?(fa=1-V(p,B,E),na=1-V(r,B,E),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(Ha[w]),ja.push(Ga[w])):32===w?(fa=V(r,E,B),na=V(p,E,B),ra=V(p,x,B),W=V(r,x,B),ja.push(Ha[w]),ja.push(Ga[w])):42===w?(ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B),ja.push(Ua[w]),ja.push(Ta[w])):128===w&&(ia=V(p,H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(Ua[w]),ja.push(Ta[w]));
5===w?(na=1-V(p,B,E),ia=1-V(p,x,H),ja.push(Ga[w])):165===w?(na=V(r,E,B),ia=V(r,H,x),ja.push(Ga[w])):20===w?(X=V(p,H,E),W=V(p,x,B),ja.push(La[w])):150===w?(X=1-V(r,E,H),W=1-V(r,B,x),ja.push(La[w])):80===w?(fa=V(p,E,B),qa=V(p,H,x),ja.push(Ha[w])):90===w?(fa=1-V(r,B,E),qa=1-V(r,x,H),ja.push(Ha[w])):65===w?(aa=1-V(p,E,H),ra=1-V(p,B,x),ja.push(Ja[w])):105===w?(aa=V(r,H,E),ra=V(r,x,B),ja.push(Ja[w])):160===w?(fa=V(r,E,B),na=V(p,E,B),ia=V(p,H,x),qa=V(r,H,x),ja.push(Ha[w]),ja.push(Ga[w])):10===w?(fa=1-V(p,
B,E),na=1-V(r,B,E),ia=1-V(r,x,H),qa=1-V(p,x,H),ja.push(Ha[w]),ja.push(Ga[w])):130===w?(X=1-V(p,E,H),aa=1-V(r,E,H),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(La[w]),ja.push(Ja[w])):40===w?(X=V(r,H,E),aa=V(p,H,E),ra=V(p,x,B),W=V(r,x,B),ja.push(La[w]),ja.push(Ja[w])):101===w?(na=V(r,E,B),ra=V(r,x,B),ja.push(Ga[w])):69===w?(na=1-V(p,B,E),ra=1-V(p,B,x),ja.push(Ga[w])):149===w?(ia=V(r,H,x),W=1-V(r,B,x),ja.push(Ua[w])):21===w?(ia=1-V(p,x,H),W=V(p,x,B),ja.push(Ua[w])):86===w?(X=1-V(r,E,H),qa=1-V(r,x,H),ja.push(La[w])):
84===w?(X=V(p,H,E),qa=V(p,H,x),ja.push(La[w])):89===w?(fa=1-V(r,B,E),aa=V(r,H,E),ja.push(Ja[w])):81===w?(fa=V(p,E,B),aa=1-V(p,E,H),ja.push(Ja[w])):96===w?(fa=V(r,E,B),na=V(p,E,B),qa=V(p,H,x),ra=V(r,x,B),ja.push(Ha[w]),ja.push(Ga[w])):74===w?(fa=1-V(p,B,E),na=1-V(r,B,E),qa=1-V(r,x,H),ra=1-V(p,B,x),ja.push(Ha[w]),ja.push(Ga[w])):24===w?(fa=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),W=V(p,x,B),ja.push(Ha[w]),ja.push(Ja[w])):146===w?(fa=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),W=1-V(r,B,x),ja.push(Ha[w]),ja.push(Ja[w])):
6===w?(na=1-V(p,B,E),X=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ja.push(Ga[w]),ja.push(La[w])):164===w?(na=V(r,E,B),X=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ja.push(Ga[w]),ja.push(La[w])):129===w?(aa=1-V(p,E,H),ia=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(Ja[w]),ja.push(Ua[w])):41===w?(aa=V(r,H,E),ia=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B),ja.push(Ja[w]),ja.push(Ua[w])):66===w?(X=1-V(p,E,H),aa=1-V(r,E,H),qa=1-V(r,x,H),ra=1-V(p,B,x),ja.push(La[w]),ja.push(Ja[w])):104===w?(X=V(r,H,E),aa=V(p,H,E),qa=V(p,H,x),ra=
V(r,x,B),ja.push(Ja[w]),ja.push(eb[w])):144===w?(fa=V(p,E,B),ia=V(p,H,x),qa=V(r,H,x),W=1-V(r,B,x),ja.push(Ha[w]),ja.push(Ta[w])):26===w?(fa=1-V(r,B,E),ia=1-V(r,x,H),qa=1-V(p,x,H),W=V(p,x,B),ja.push(Ha[w]),ja.push(Ta[w])):36===w?(na=V(r,E,B),X=V(p,H,E),ra=V(p,x,B),W=V(r,x,B),ja.push(Ga[w]),ja.push(La[w])):134===w?(na=1-V(p,B,E),X=1-V(r,E,H),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(Ga[w]),ja.push(La[w])):9===w?(fa=1-V(p,B,E),na=1-V(r,B,E),aa=V(r,H,E),ia=1-V(p,x,H),ja.push(Ha[w]),ja.push(Ga[w])):161===w?(fa=
V(r,E,B),na=V(p,E,B),aa=1-V(p,E,H),ia=V(r,H,x),ja.push(Ha[w]),ja.push(Ga[w])):37===w?(na=V(r,E,B),ia=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B),ja.push(Ga[w]),ja.push(Ua[w])):133===w?(na=1-V(p,B,E),ia=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x),ja.push(Ga[w]),ja.push(Ua[w])):148===w?(X=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),W=1-V(r,B,x),ja.push(La[w]),ja.push(Ta[w])):22===w?(X=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),W=V(p,x,B),ja.push(La[w]),ja.push(Ta[w])):82===w?(fa=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),qa=1-V(r,x,H),ja.push(Ha[w]),
ja.push(Ja[w])):88===w?(fa=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),qa=V(p,H,x),ja.push(Ha[w]),ja.push(Ja[w])):73===w?(fa=1-V(p,B,E),na=1-V(r,B,E),aa=V(r,H,E),ra=1-V(p,B,x),ja.push(Ha[w]),ja.push(Ga[w])):97===w?(fa=V(r,E,B),na=V(p,E,B),aa=1-V(p,E,H),ra=V(r,x,B),ja.push(Ha[w]),ja.push(Ga[w])):145===w?(fa=V(p,E,B),aa=1-V(p,E,H),ia=V(r,H,x),W=1-V(r,B,x),ja.push(Ha[w]),ja.push(Ua[w])):25===w?(fa=1-V(r,B,E),aa=V(r,H,E),ia=1-V(p,x,H),W=V(p,x,B),ja.push(Ha[w]),ja.push(Ua[w])):70===w?(na=1-V(p,B,E),X=1-V(r,E,H),
qa=1-V(r,x,H),ra=1-V(p,B,x),ja.push(Ga[w]),ja.push(La[w])):100===w?(na=V(r,E,B),X=V(p,H,E),qa=V(p,H,x),ra=V(r,x,B),ja.push(Ga[w]),ja.push(La[w])):34===w?(0===T?(fa=1-V(p,B,E),na=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)):(fa=V(r,E,B),na=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ua[w]),ja.push(Ta[w])):35===w?(4===T?(fa=1-V(p,B,E),na=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ia=V(p,
H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)):(fa=V(r,E,B),na=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ja[w]),ja.push(Ta[w])):136===w?(0===T?(fa=V(r,E,B),na=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)):(fa=1-V(p,B,E),na=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ua[w]),ja.push(Ta[w])):153===w?
(0===T?(fa=V(p,E,B),aa=1-V(p,E,H),ia=1-V(p,x,H),W=V(p,x,B)):(fa=1-V(r,B,E),aa=V(r,H,E),ia=V(r,H,x),W=1-V(r,B,x)),ja.push(Ha[w]),ja.push(Ja[w])):102===w?(0===T?(na=1-V(p,B,E),X=V(p,H,E),qa=V(p,H,x),ra=1-V(p,B,x)):(na=V(r,E,B),X=1-V(r,E,H),qa=1-V(r,x,H),ra=V(r,x,B)),ja.push(Ga[w]),ja.push(Ta[w])):155===w?(4===T?(fa=V(p,E,B),aa=1-V(p,E,H),ia=1-V(p,x,H),W=V(p,x,B)):(fa=1-V(r,B,E),aa=V(r,H,E),ia=V(r,H,x),W=1-V(r,B,x)),ja.push(Ha[w]),ja.push(Ua[w])):103===w?(4===T?(na=1-V(p,B,E),X=V(p,H,E),qa=V(p,H,x),
ra=1-V(p,B,x)):(na=V(r,E,B),X=1-V(r,E,H),qa=1-V(r,x,H),ra=V(r,x,B)),ja.push(Ga[w]),ja.push(La[w])):152===w?(0===T?(fa=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),W=V(p,x,B)):(fa=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),W=1-V(r,B,x)),ja.push(Ha[w]),ja.push(La[w]),ja.push(Ja[w])):156===w?(4===T?(fa=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),W=V(p,x,B)):(fa=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),W=1-V(r,B,x)),ja.push(Ha[w]),
ja.push(Ja[w]),ja.push(Ta[w])):137===w?(0===T?(fa=V(r,E,B),na=V(p,E,B),aa=1-V(p,E,H),ia=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)):(fa=1-V(p,B,E),na=1-V(r,B,E),aa=V(r,H,E),ia=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ja[w])):139===w?(4===T?(fa=V(r,E,B),na=V(p,E,B),aa=1-V(p,E,H),ia=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)):(fa=1-V(p,B,E),na=1-V(r,B,E),aa=V(r,H,E),ia=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ua[w])):98===w?(0===T?(fa=1-V(p,B,E),na=
1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),qa=V(p,H,x),ra=1-V(p,B,x)):(fa=V(r,E,B),na=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),qa=1-V(r,x,H),ra=V(r,x,B)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ta[w])):99===w?(4===T?(fa=1-V(p,B,E),na=1-V(r,B,E),X=V(r,H,E),aa=V(p,H,E),qa=V(p,H,x),ra=1-V(p,B,x)):(fa=V(r,E,B),na=V(p,E,B),X=1-V(p,E,H),aa=1-V(r,E,H),qa=1-V(r,x,H),ra=V(r,x,B)),ja.push(Ha[w]),ja.push(Ga[w]),ja.push(Ja[w])):38===w?(0===T?(na=1-V(p,B,E),X=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)):(na=V(r,
E,B),X=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)),ja.push(Ga[w]),ja.push(Ua[w]),ja.push(Ta[w])):39===w?(4===T?(na=1-V(p,B,E),X=V(p,H,E),ia=V(p,H,x),qa=V(r,H,x),ra=1-V(r,B,x),W=1-V(p,B,x)):(na=V(r,E,B),X=1-V(r,E,H),ia=1-V(r,x,H),qa=1-V(p,x,H),ra=V(p,x,B),W=V(r,x,B)),ja.push(Ga[w]),ja.push(La[w]),ja.push(Ta[w])):85===w&&(fa=1,na=0,X=1,aa=0,ia=0,qa=1,ra=0,W=1);(0>ra||1<ra||0>W||1<W||0>fa||1<fa||0>X||1<X||0>ia||1<ia||0>qa||1<qa)&&console.log("MarchingSquaresJS-isoBands: "+w+" "+P+
" "+x+","+B+","+E+","+H+" "+T+" "+ra+" "+W+" "+fa+" "+na+" "+X+" "+aa+" "+ia+" "+qa);u.cells[y][C]={cval:w,cval_real:P,flipped:T,topleft:ra,topright:W,righttop:fa,rightbottom:na,bottomright:X,bottomleft:aa,leftbottom:ia,lefttop:qa,edges:ja}}}}}return u}(b,c,f);return mf.polygons?(mf.verbose&&console.log("MarchingSquaresJS-isoBands: returning single polygons for each grid cell"),m=function(q){var p=[],r=0;return q.cells.forEach(function(v,A){v.forEach(function(u,y){void 0!==u&&(u=Ea[u.cval](u),"object"==
typeof u&&Si(u)?"object"==typeof u[0]&&Si(u[0])?"object"==typeof u[0][0]&&Si(u[0][0])?u.forEach(function(C){C.forEach(function(w){w[0]+=y;w[1]+=A});p[r++]=C}):(u.forEach(function(C){C[0]+=y;C[1]+=A}),p[r++]=u):console.log("MarchingSquaresJS-isoBands: bandcell polygon with malformed coordinates"):console.log("MarchingSquaresJS-isoBands: bandcell polygon with null coordinates"))})}),p}(b)):(mf.verbose&&console.log("MarchingSquaresJS-isoBands: returning polygon paths for entire data grid"),m=function(q){for(var p=
[],r=q.rows,v=q.cols,A=[],u=0;u<r;u++)for(var y=0;y<v;y++)if(void 0!==q.cells[u][y]&&0<q.cells[u][y].edges.length){var C=eo(q.cells[u][y]),w=null,x=y,B=u;null!==C&&A.push([C.p[0]+x,C.p[1]+B]);do{if(null===(w=fo(q.cells[B][x],C.x,C.y,C.o)))break;if(A.push([w.p[0]+x,w.p[1]+B]),x+=w.x,C=w,0>(B+=w.y)||B>=r||0>x||x>=v||void 0===q.cells[B][x]){C=go(q,x-=w.x,B-=w.y,w.x,w.y,w.o);if(null===C)break;C.path.forEach(function(E){A.push(E)});x=C.i;B=C.j}}while(void 0!==q.cells[B][x]&&0<q.cells[B][x].edges.length);
p.push(A);A=[];0<q.cells[u][y].edges.length&&y--}return p}(b)),"function"==typeof mf.successCallback&&mf.successCallback(m),m}function V(b,c,f){return(b-c)/(f-c)}function Si(b){return-1<b.constructor.toString().indexOf("Array")}function go(b,c,f,k,d,g){for(var l,h,m=c+k,q=f+d,p=[];;){if(void 0===b.cells[q]||void 0===b.cells[q][m])if(q-=d,m-=k,h=(l=b.cells[q][m]).cval_real,-1===d){if(0===g)if(1&h)p.push([m,q]),k=-1;else{if(!(4&h)){p.push([m+l.bottomright,q]);k=0;g=d=1;break}p.push([m+1,q]);k=1}else{if(!(1&
h)){if(4&h){p.push([m+l.bottomright,q]);k=0;g=d=1;break}p.push([m+l.bottomleft,q]);k=0;d=1;g=0;break}p.push([m,q]);k=-1}g=d=0}else if(1===d){if(0===g&&!(h&Rd)){if(h&Nc){p.push([m+l.topleft,q+1]);k=0;d=-1;g=0;break}p.push([m+l.topright,q+1]);k=0;d=-1;g=1;break}p.push([m+1,q+1]);k=1;d=0;g=1}else if(-1===k){if(0===g){if(!(h&Nc)){if(1&h){p.push([m,q+l.leftbottom]);k=1;g=d=0;break}p.push([m,q+l.lefttop]);k=1;d=0;g=1;break}}else if(!(h&Nc)){console.log("MarchingSquaresJS-isoBands: wtf");break}p.push([m,
q+1]);k=0;d=1;g=0}else{if(1!==k){console.log("MarchingSquaresJS-isoBands: we came from nowhere!");break}if(0===g){if(!(4&h)){p.push([m+1,q+l.rightbottom]);k=-1;g=d=0;break}}else if(!(4&h)){if(h&Rd){p.push([m+1,q+l.righttop]);k=-1;d=0;g=1;break}p.push([m+1,q+l.rightbottom]);k=-1;g=d=0;break}p.push([m+1,q]);k=0;d=-1;g=1}else if(h=(l=b.cells[q][m]).cval_real,-1===k)if(0===g)if(void 0!==b.cells[q-1]&&void 0!==b.cells[q-1][m])k=0,d=-1,g=1;else{if(!(1&h)){p.push([m+l.bottomright,q]);k=0;g=d=1;break}p.push([m,
q])}else{if(!(h&Nc)){console.log("MarchingSquaresJS-isoBands: found entry from top at "+m+","+q);break}console.log("MarchingSquaresJS-isoBands: proceeding in x-direction!")}else if(1===k){if(0===g){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==b.cells[q+1]&&void 0!==b.cells[q+1][m])k=0,d=1,g=0;else{if(!(h&Rd)){p.push([m+l.topleft,q+1]);k=0;d=-1;g=0;break}p.push([m+1,q+1]);k=1;d=0;g=1}}else if(-1===d){if(1!==g){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==b.cells[q][m+
1])k=1,d=0;else{if(!(4&h)){p.push([m+1,q+l.righttop]);k=-1;d=0;g=1;break}p.push([m+1,q]);k=0;d=-1}g=1}else{if(1!==d){console.log("MarchingSquaresJS-isoBands: where did we came from???");break}if(0!==g){console.log("MarchingSquaresJS-isoBands: wtf");break}if(void 0!==b.cells[q][m-1])k=-1,d=0;else{if(!(h&Nc)){p.push([m,q+l.leftbottom]);k=1;g=d=0;break}p.push([m,q+1]);k=0;d=1}g=0}if(q+=d,(m+=k)===c&&q===f)break}return{path:p,i:m,j:q,x:k,y:d,o:g}}function eo(b){if(0<b.edges.length){var c=b.cval_real;
switch(b.edges[b.edges.length-1]){case 0:return c&Rd?{p:[1,b.righttop],x:-1,y:0,o:1}:{p:[b.topleft,1],x:0,y:-1,o:0};case 1:return 4&c?{p:[b.topleft,1],x:0,y:-1,o:0}:{p:[1,b.rightbottom],x:-1,y:0,o:0};case 2:return 4&c?{p:[b.bottomright,0],x:0,y:1,o:1}:{p:[b.topleft,1],x:0,y:-1,o:0};case 3:return 1&c?{p:[b.topleft,1],x:0,y:-1,o:0}:{p:[b.bottomleft,0],x:0,y:1,o:0};case 4:return c&Rd?{p:[1,b.righttop],x:-1,y:0,o:1}:{p:[b.topright,1],x:0,y:-1,o:1};case 5:return 4&c?{p:[b.topright,1],x:0,y:-1,o:1}:{p:[1,
b.rightbottom],x:-1,y:0,o:0};case 6:return 4&c?{p:[b.bottomright,0],x:0,y:1,o:1}:{p:[b.topright,1],x:0,y:-1,o:1};case 7:return 1&c?{p:[b.topright,1],x:0,y:-1,o:1}:{p:[b.bottomleft,0],x:0,y:1,o:0};case 8:return 4&c?{p:[b.bottomright,0],x:0,y:1,o:1}:{p:[1,b.righttop],x:-1,y:0,o:1};case 9:return 1&c?{p:[1,b.righttop],x:-1,y:0,o:1}:{p:[b.bottomleft,0],x:0,y:1,o:0};case 10:return 1&c?{p:[0,b.leftbottom],x:1,y:0,o:0}:{p:[1,b.righttop],x:-1,y:0,o:1};case 11:return c&Nc?{p:[1,b.righttop],x:-1,y:0,o:1}:{p:[0,
b.lefttop],x:1,y:0,o:1};case 12:return 4&c?{p:[b.bottomright,0],x:0,y:1,o:1}:{p:[1,b.rightbottom],x:-1,y:0,o:0};case 13:return 1&c?{p:[1,b.rightbottom],x:-1,y:0,o:0}:{p:[b.bottomleft,0],x:0,y:1,o:0};case 14:return 1&c?{p:[0,b.leftbottom],x:1,y:0,o:0}:{p:[1,b.rightbottom],x:-1,y:0,o:0};case 15:return c&Nc?{p:[1,b.rightbottom],x:-1,y:0,o:0}:{p:[0,b.lefttop],x:1,y:0,o:1};case 16:return 4&c?{p:[b.bottomright,0],x:0,y:1,o:1}:{p:[0,b.leftbottom],x:1,y:0,o:0};case 17:return c&Nc?{p:[b.bottomright,0],x:0,
y:1,o:1}:{p:[0,b.lefttop],x:1,y:0,o:1};case 18:return 1&c?{p:[0,b.leftbottom],x:1,y:0,o:0}:{p:[b.bottomleft,0],x:0,y:1,o:0};case 19:return c&Nc?{p:[b.bottomleft,0],x:0,y:1,o:0}:{p:[0,b.lefttop],x:1,y:0,o:1};case 20:return c&Nc?{p:[b.topleft,1],x:0,y:-1,o:0}:{p:[0,b.leftbottom],x:1,y:0,o:0};case 21:return c&Rd?{p:[0,b.leftbottom],x:1,y:0,o:0}:{p:[b.topright,1],x:0,y:-1,o:1};case 22:return c&Nc?{p:[b.topleft,1],x:0,y:-1,o:0}:{p:[0,b.lefttop],x:1,y:0,o:1};case 23:return c&Rd?{p:[0,b.lefttop],x:1,y:0,
o:1}:{p:[b.topright,1],x:0,y:-1,o:1};default:console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(b)}}return null}function fo(b,c,f,k){var d,g=b.cval;switch(c){case -1:switch(k){case 0:var l=Ga[g];var h=fb[g];var m=gb[g];var q=hb[g];break;default:l=Ha[g],h=ib[g],m=jb[g],q=kb[g]}break;case 1:switch(k){case 0:l=Ua[g];h=lb[g];m=mb[g];q=nb[g];break;default:l=Ta[g],h=ob[g],m=pb[g],q=qb[g]}break;default:switch(f){case -1:switch(k){case 0:l=eb[g];h=rb[g];m=sb[g];q=tb[g];break;
default:l=Db[g],h=ub[g],m=vb[g],q=wb[g]}break;case 1:switch(k){case 0:l=Ja[g];h=xb[g];m=yb[g];q=zb[g];break;default:l=La[g],h=Ab[g],m=Bb[g],q=Cb[g]}}}if(d=b.edges.indexOf(l),void 0===b.edges[d])return null;delete b.edges[d];for(k=d+1;k<b.edges.length;k++)b.edges[k-1]=b.edges[k];b.edges.pop();switch(g=b.cval_real,l){case 0:g&Rd?(c=b.topleft,f=1):(c=1,f=b.righttop);break;case 1:4&g?(c=1,f=b.rightbottom):(c=b.topleft,f=1);break;case 2:4&g?(c=b.topleft,f=1):(c=b.bottomright,f=0);break;case 3:1&g?(c=b.bottomleft,
f=0):(c=b.topleft,f=1);break;case 4:g&Rd?(c=b.topright,f=1):(c=1,f=b.righttop);break;case 5:4&g?(c=1,f=b.rightbottom):(c=b.topright,f=1);break;case 6:4&g?(c=b.topright,f=1):(c=b.bottomright,f=0);break;case 7:1&g?(c=b.bottomleft,f=0):(c=b.topright,f=1);break;case 8:4&g?(c=1,f=b.righttop):(c=b.bottomright,f=0);break;case 9:1&g?(c=b.bottomleft,f=0):(c=1,f=b.righttop);break;case 10:1&g?(c=1,f=b.righttop):(c=0,f=b.leftbottom);break;case 11:g&Nc?(c=0,f=b.lefttop):(c=1,f=b.righttop);break;case 12:4&g?(c=
1,f=b.rightbottom):(c=b.bottomright,f=0);break;case 13:1&g?(c=b.bottomleft,f=0):(c=1,f=b.rightbottom);break;case 14:1&g?(c=1,f=b.rightbottom):(c=0,f=b.leftbottom);break;case 15:g&Nc?(c=0,f=b.lefttop):(c=1,f=b.rightbottom);break;case 16:4&g?(c=0,f=b.leftbottom):(c=b.bottomright,f=0);break;case 17:g&Nc?(c=0,f=b.lefttop):(c=b.bottomright,f=0);break;case 18:1&g?(c=b.bottomleft,f=0):(c=0,f=b.leftbottom);break;case 19:g&Nc?(c=0,f=b.lefttop):(c=b.bottomleft,f=0);break;case 20:g&Nc?(c=0,f=b.leftbottom):(c=
b.topleft,f=1);break;case 21:g&Rd?(c=b.topright,f=1):(c=0,f=b.leftbottom);break;case 22:g&Nc?(c=0,f=b.lefttop):(c=b.topleft,f=1);break;case 23:g&Rd?(c=b.topright,f=1):(c=0,f=b.lefttop);break;default:return console.log("MarchingSquaresJS-isoBands: edge index out of range!"),console.log(b),null}return void 0!==c&&void 0!==f&&void 0!==h&&void 0!==m&&void 0!==q||(console.log("MarchingSquaresJS-isoBands: undefined value!"),console.log(b),console.log(c+" "+f+" "+h+" "+m+" "+q)),{p:[c,f],x:h,y:m,o:q}}function ho(b){var c=
[],f=[];b.forEach(function(d){var g=Li(D([d]));f.push(g);c.push({ring:d,area:g})});f.sort(function(d,g){return g-d});var k=[];return f.forEach(function(d){for(var g=0;g<c.length;g++)if(c[g].area===d){k.push(c[g].ring);c.splice(g,1);break}}),k}function io(b){b=b.map(function(l){return{lrCoordinates:l,grouped:!1}});for(var c=[];!jo(b);)for(var f=0;f<b.length;f++)if(!b[f].grouped){var k=[];k.push(b[f].lrCoordinates);b[f].grouped=!0;for(var d=D([b[f].lrCoordinates]),g=f+1;g<b.length;g++)b[g].grouped||
ko(D([b[g].lrCoordinates]),d)&&(k.push(b[g].lrCoordinates),b[g].grouped=!0);c.push(k)}return c}function ko(b,c){b=xh(b);for(var f=0;f<b.features.length;f++)if(!Tb(b.features[f],c))return!1;return!0}function jo(b){for(var c=0;c<b.length;c++)if(!1===b[c].grouped)return!1;return!0}function jl(b,c,f){if(!ta(f=f||{}))throw Error("options is invalid");var k=f.pivot;f=f.mutate;if(!b)throw Error("geojson is required");if(null==c||isNaN(c))throw Error("angle is required");return 0===c||(k||=Ne(b),!1!==f&&
void 0!==f||(b=Dc(b)),Ca(b,function(d){var g=lf(k,d)+c,l=Bh(k,d);g=Y(Hf(k,l,g));d[0]=g[0];d[1]=g[1]})),b}function kl(b,c,f){if(!ta(f=f||{}))throw Error("options is invalid");var k=f.origin;f=f.mutate;if(!b)throw Error("geojson required");if("number"!=typeof c||0===c)throw Error("invalid factor");var d=Array.isArray(k)||"object"==typeof k;return!0!==f&&(b=Dc(b)),"FeatureCollection"!==b.type||d?ll(b,c,k):(Sa(b,function(g,l){b.features[l]=ll(g,c,k)}),b)}function ll(b,c,f){var k="Point"===qc(b);return f=
function(d,g){null==g&&(g="centroid");if(Array.isArray(g)||"object"==typeof g)return ca(g);var l=d.bbox?d.bbox:ya(d),h=l[0],m=l[1],q=l[2];l=l[3];switch(g){case "sw":case "southwest":case "westsouth":case "bottomleft":return t([h,m]);case "se":case "southeast":case "eastsouth":case "bottomright":return t([q,m]);case "nw":case "northwest":case "westnorth":case "topleft":return t([h,l]);case "ne":case "northeast":case "eastnorth":case "topright":return t([q,l]);case "center":return wh(d);case void 0:case null:case "centroid":return Ne(d);
default:throw Error("invalid origin");}}(b,f),1===c||k||Ca(b,function(d){var g=Bh(f,d),l=lf(f,d);g=Y(Hf(f,g*c,l));d[0]=g[0];d[1]=g[1];3===d.length&&(d[2]*=c)}),b}function Fh(b){var c=b[0];b=b[1];return[b[0]-c[0],b[1]-c[1]]}function Ti(b,c){return b[0]*c[1]-c[0]*b[1]}function lo(b,c){return!function(f,k){return 0===Ti(Fh(f),Fh(k))}(b,c)&&function(f,k){var d=f[0];f=Fh(f);var g=k[0];k=Fh(k);var l=Ti(f,k);return function(h,m){return[h[0]+m[0],h[1]+m[1]]}(d,function(h,m){return[h*m[0],h*m[1]]}(Ti([g[0]-
d[0],g[1]-d[1]],k)/l,f))}(b,c)}function ml(b,c,f){var k=[],d=R(c,f),g=Y(b),l=[];return g.forEach(function(h,m){if(m!==g.length-1){h=(q=h,p=g[m+1],r=d,v=Math.sqrt((q[0]-p[0])*(q[0]-p[0])+(q[1]-p[1])*(q[1]-p[1])),A=q[0]+r*(p[1]-q[1])/v,u=p[0]+r*(p[1]-q[1])/v,y=q[1]+r*(q[0]-p[0])/v,C=p[1]+r*(q[0]-p[0])/v,[[A,y],[u,C]]);if(k.push(h),0<m)q=k[m-1],p=lo(h,q),!1!==p&&(q[1]=p,h[0]=p),l.push(q[0]),m===g.length-2&&(l.push(h[0]),l.push(h[1]));2===g.length&&(l.push(h[0]),l.push(h[1]))}var q,p,r,v,A,u,y,C}),J(l,
b.properties)}function Ui(b,c,f){b=(c[0]-b[0])*(f[1]-c[1])-(f[0]-c[0])*(c[1]-b[1]);return(0<b)-(0>b)||+b}function nl(b,c){return c.geometry.coordinates[0].every(function(f){return Tb(t(f),b)})}function ol(b,c){var f=!0;return Rb(b,function(k){Rb(c,function(d){if(!1===f)return!1;f=function(g,l){switch(g.type){case "Point":switch(l.type){case "Point":return h=g.coordinates,m=l.coordinates,!(h[0]===m[0]&&h[1]===m[1]);case "LineString":return!pl(l,g);case "Polygon":return!Tb(g,l)}break;case "LineString":switch(l.type){case "Point":return!pl(g,
l);case "LineString":return g=0<ke(g,l).features.length?!0:!1,!g;case "Polygon":return!ql(l,g)}break;case "Polygon":switch(l.type){case "Point":return!Tb(l,g);case "LineString":return!ql(g,l);case "Polygon":a:{h=0;for(m=l.coordinates[0];h<m.length;h++)if(Tb(m[h],g)){g=!0;break a}h=0;for(m=g.coordinates[0];h<m.length;h++)if(Tb(m[h],l)){g=!0;break a}g=0<ke(zg(l),zg(g)).features.length?!0:!1}return!g}}var h,m;return!1}(k.geometry,d.geometry)})}),f}function pl(b,c){for(var f=0;f<b.coordinates.length-
1;f++){var k=b.coordinates[f],d=b.coordinates[f+1],g=c.coordinates,l=d[0]-k[0],h=d[1]-k[1];if(0==(g[0]-k[0])*h-(g[1]-k[1])*l&&(Math.abs(l)>=Math.abs(h)?0<l?k[0]<=g[0]&&g[0]<=d[0]:d[0]<=g[0]&&g[0]<=k[0]:0<h?k[1]<=g[1]&&g[1]<=d[1]:d[1]<=g[1]&&g[1]<=k[1]))return!0}return!1}function ql(b,c){for(var f=0,k=c.coordinates;f<k.length;f++)if(Tb(k[f],b))return!0;return 0<ke(c,zg(b)).features.length}function rl(b,c){return!(b[0]>c[0])&&!(b[2]<c[2])&&!(b[1]>c[1])&&!(b[3]<c[3])}function Vi(b,c){return b[0]===c[0]&&
b[1]===c[1]}function sl(b,c){for(var f=!1,k=!1,d=b.coordinates.length,g=0;g<d&&!f&&!k;){for(var l=0;l<c.coordinates.length-1;l++){var h=!0;0!==l&&l!==c.coordinates.length-2||(h=!1);tl(c.coordinates[l],c.coordinates[l+1],b.coordinates[g],h)?f=!0:k=!0}g++}return f&&k}function ul(b,c){for(var f=!1,k=!1,d=b.coordinates.length,g=0;g<d&&(!f||!k);g++)Tb(t(b.coordinates[g]),c)?f=!0:k=!0;return k&&f}function tl(b,c,f,k){var d=c[0]-b[0],g=c[1]-b[1];return 0==(f[0]-b[0])*g-(f[1]-b[1])*d&&(k?Math.abs(d)>=Math.abs(g)?
0<d?b[0]<=f[0]&&f[0]<=c[0]:c[0]<=f[0]&&f[0]<=b[0]:0<g?b[1]<=f[1]&&f[1]<=c[1]:c[1]<=f[1]&&f[1]<=b[1]:Math.abs(d)>=Math.abs(g)?0<d?b[0]<f[0]&&f[0]<c[0]:c[0]<f[0]&&f[0]<b[0]:0<g?b[1]<f[1]&&f[1]<c[1]:c[1]<f[1]&&f[1]<b[1])}function vl(b){return b.coordinates.map(function(c){return{type:b.type.replace("Multi",""),coordinates:c}})}function wl(b,c){return b.hasOwnProperty("coordinates")?b.coordinates.length===c.coordinates.length:b.length===c.length}function mo(b,c){return Gf(b,c,{strict:!0})}function xl(b,
c){var f=!1;return Rb(b,function(k){Rb(c,function(d){if(!0===f)return!0;f=!ol(k.geometry,d.geometry)})}),f}function yl(b,c,f){f=f||[];for(var k=0;k<b;k++)f[k]=c;return f}function zl(b,c){if(b.geometry&&b.geometry.type)return b.geometry.type;if(b.type)return b.type;throw Error("Invalid GeoJSON object for "+c);}function Al(b){for(var c=[];b.parent;)c.unshift(b),b=b.parent;return c}function If(b,c){c=c||{};this.nodes=[];this.diagonal=!!c.diagonal;this.grid=[];for(c=0;c<b.length;c++){this.grid[c]=[];
for(var f=0,k=b[c];f<k.length;f++){var d=new Gh(c,f,k[f]);this.grid[c][f]=d;this.nodes.push(d)}}this.init()}function Gh(b,c,f){this.x=b;this.y=c;this.weight=f}function Bl(b){this.content=[];this.scoreFunction=b}function no(b,c){for(var f=0;f<c.features.length;f++)if(Tb(b,c.features[f]))return!0;return!1}function Cl(b){return function(){return b}}function oo(b){return b[0]}function po(b){return b[1]}function Hh(){this._=null}function Ih(b){b.U=b.C=b.L=b.R=b.P=b.N=null}function Bg(b,c){var f=c.R,k=
c.U;k?k.L===c?k.L=f:k.R=f:b._=f;f.U=k;c.U=f;c.R=f.L;c.R&&(c.R.U=c);f.L=c}function Cg(b,c){var f=c.L,k=c.U;k?k.L===c?k.L=f:k.R=f:b._=f;f.U=k;c.U=f;c.L=f.R;c.L&&(c.L.U=c);f.R=c}function Dl(b){for(;b.L;)b=b.L;return b}function Dg(b,c,f,k){var d=[null,null],g=Vc.push(d)-1;return d.left=b,d.right=c,f&&Jh(d,b,c,f),k&&Jh(d,c,b,k),qd[b.index].halfedges.push(g),qd[c.index].halfedges.push(g),d}function Eg(b,c,f){c=[c,f];return c.left=b,c}function Jh(b,c,f,k){b[0]||b[1]?b.left===f?b[1]=k:b[0]=k:(b[0]=k,b.left=
c,b.right=f)}function qo(b,c,f,k,d){var g,l=b[0],h=b[1],m=l[0];l=l[1];var q=0,p=1,r=h[0]-m;h=h[1]-l;if(g=c-m,r||!(0<g)){if(g/=r,0>r){if(g<q)return;g<p&&(p=g)}else if(0<r){if(g>p)return;g>q&&(q=g)}if(g=k-m,r||!(0>g)){if(g/=r,0>r){if(g>p)return;g>q&&(q=g)}else if(0<r){if(g<q)return;g<p&&(p=g)}if(g=f-l,h||!(0<g)){if(g/=h,0>h){if(g<q)return;g<p&&(p=g)}else if(0<h){if(g>p)return;g>q&&(q=g)}if(g=d-l,h||!(0>g)){if(g/=h,0>h){if(g>p)return;g>q&&(q=g)}else if(0<h){if(g<q)return;g<p&&(p=g)}return!(0<q||1>p)||
(0<q&&(b[0]=[m+q*r,l+q*h]),1>p&&(b[1]=[m+p*r,l+p*h]),!0)}}}}}function ro(b,c,f,k,d){var g=b[1];if(g)return!0;var l,h=b[0],m=b.left;var q=b.right;g=m[0];m=m[1];var p=q[0],r=q[1],v=(g+p)/2;if(r===m){if(v<c||v>=k)return;if(g>p){if(h){if(h[1]>=d)return}else h=[v,f];g=[v,d]}else{if(h){if(h[1]<f)return}else h=[v,d];g=[v,f]}}else if(q=(m+r)/2-(l=(g-p)/(r-m))*v,-1>l||1<l)if(g>p){if(h){if(h[1]>=d)return}else h=[(f-q)/l,f];g=[(d-q)/l,d]}else{if(h){if(h[1]<f)return}else h=[(d-q)/l,d];g=[(f-q)/l,f]}else if(m<
r){if(h){if(h[0]>=k)return}else h=[c,l*c+q];g=[k,l*k+q]}else{if(h){if(h[0]<c)return}else h=[k,l*k+q];g=[c,l*c+q]}return b[0]=h,b[1]=g,!0}function so(b,c){b=b.site;var f=c.left,k=c.right;return b===k&&(k=f,f=b),k?Math.atan2(k[1]-f[1],k[0]-f[0]):(b===f?(f=c[1],k=c[0]):(f=c[0],k=c[1]),Math.atan2(f[0]-k[0],k[1]-f[1]))}function El(b,c){return c[+(c.left!==b.site)]}function to(){Ih(this);this.x=this.y=this.arc=this.site=this.cy=null}function Jf(b){var c=b.P,f=b.N;if(c&&f){var k=c.site;c=b.site;var d=f.site;
if(k!==d){f=c[0];var g=c[1],l=k[0]-f,h=k[1]-g;k=d[0]-f;var m=d[1]-g;d=2*(l*m-h*k);if(!(d>=-uo)){var q=l*l+h*h,p=k*k+m*m;h=(m*q-h*p)/d;k=(l*p-k*q)/d;l=Fl.pop()||new to;l.arc=b;l.site=c;l.x=h+f;l.y=(l.cy=k+g)+Math.sqrt(h*h+k*k);b.circle=l;b=null;for(c=Fg._;c;)if(l.y<c.y||l.y===c.y&&l.x<=c.x){if(!c.L){b=c.P;break}c=c.L}else{if(!c.R){b=c;break}c=c.R}Fg.insert(b,l);b||(Wi=l)}}}}function Kf(b){var c=b.circle;c&&(c.P||(Wi=c.N),Fg.remove(c),Fl.push(c),Ih(c),b.circle=null)}function vo(){Ih(this);this.edge=
this.site=this.circle=null}function Gl(b){var c=Hl.pop()||new vo;return c.site=b,c}function Xi(b){Kf(b);Lf.remove(b);Hl.push(b);Ih(b)}function wo(b){var c=b.circle,f=c.x,k=c.cy;c=[f,k];var d=b.P,g=b.N,l=[b];Xi(b);for(b=d;b.circle&&Math.abs(f-b.circle.x)<Wb&&Math.abs(k-b.circle.cy)<Wb;)d=b.P,l.unshift(b),Xi(b),b=d;l.unshift(b);Kf(b);for(d=g;d.circle&&Math.abs(f-d.circle.x)<Wb&&Math.abs(k-d.circle.cy)<Wb;)g=d.N,l.push(d),Xi(d),d=g;l.push(d);Kf(d);k=l.length;for(f=1;f<k;++f)d=l[f],b=l[f-1],Jh(d.edge,
b.site,d.site,c);b=l[0];(d=l[k-1]).edge=Dg(b.site,d.site,null,c);Jf(b);Jf(d)}function xo(b){for(var c,f,k,d,g=b[0],l=b[1],h=Lf._;h;)if((k=Il(h,l)-g)>Wb)h=h.L;else{var m=h;d=l;var q=m.N;q?d=Il(q,d):(m=m.site,d=m[1]===d?m[0]:1/0);if(!((d=g-d)>Wb)){k>-Wb?(c=h.P,f=h):d>-Wb?(c=h,f=h.N):c=f=h;break}if(!h.R){c=h;break}h=h.R}qd[b.index]={site:b,halfedges:[]};!0;k=Gl(b);if(Lf.insert(c,k),c||f){if(c===f)return Kf(c),f=Gl(c.site),Lf.insert(k,f),k.edge=f.edge=Dg(c.site,k.site),Jf(c),void Jf(f);if(f){Kf(c);Kf(f);
g=c.site;h=g[0];d=g[1];m=b[0]-h;q=b[1]-d;l=f.site;var p=l[0]-h,r=l[1]-d,v=2*(m*r-q*p),A=m*m+q*q,u=p*p+r*r;h=[(r*A-q*u)/v+h,(m*u-p*A)/v+d];Jh(f.edge,g,l,h);k.edge=Dg(g,b,null,h);f.edge=Dg(b,l,null,h);Jf(c);Jf(f)}else k.edge=Dg(c.site,k.site)}}function Il(b,c){var f=b.site,k=f[0],d=f[1],g=d-c;if(!g)return k;b=b.P;if(!b)return-1/0;b=(f=b.site)[0];f=f[1];c=f-c;if(!c)return b;var l=b-k,h=1/g-1/c,m=l/c;return h?(-m+Math.sqrt(m*m-2*h*(l*l/(-2*c)-f+c/2+d-g/2)))/h+k:(k+b)/2}function yo(b,c){return c[1]-b[1]||
c[0]-b[0]}function Yi(b,c){var f,k,d,g=b.sort(yo).pop();Vc=[];qd=Array(b.length);Lf=new Hh;for(Fg=new Hh;;)if(d=Wi,g&&(!d||g[1]<d.y||g[1]===d.y&&g[0]<d.x))g[0]===f&&g[1]===k||(xo(g),f=g[0],k=g[1]),g=b.pop();else{if(!d)break;wo(d.arc)}if(function(){for(var l,h,m,q,p=0,r=qd.length;p<r;++p)if((l=qd[p])&&(q=(h=l.halfedges).length)){var v=Array(q),A=Array(q);for(m=0;m<q;++m)v[m]=m,A[m]=so(l,Vc[h[m]]);v.sort(function(u,y){return A[y]-A[u]});for(m=0;m<q;++m)A[m]=h[v[m]];for(m=0;m<q;++m)h[m]=A[m]}}(),c)b=
+c[0][0],f=+c[0][1],k=+c[1][0],c=+c[1][1],!function(l,h,m,q){for(var p,r=Vc.length;r--;)ro(p=Vc[r],l,h,m,q)&&qo(p,l,h,m,q)&&(Math.abs(p[0][0]-p[1][0])>Wb||Math.abs(p[0][1]-p[1][1])>Wb)||delete Vc[r]}(b,f,k,c),function(l,h,m,q){var p,r,v,A,u,y,C,w=qd.length,x=!0;for(p=0;p<w;++p)if(r=qd[p]){var B=r.site;for(v=(A=r.halfedges).length;v--;)Vc[A[v]]||A.splice(v,1);v=0;for(u=A.length;v<u;){var E=Vc[A[v]];var H=(C=E[+(E.left===r.site)])[0];var P=C[1];E=(y=El(r,Vc[A[++v%u]]))[0];y=y[1];(Math.abs(H-E)>Wb||
Math.abs(P-y)>Wb)&&(A.splice(v,0,Vc.push(Eg(B,C,Math.abs(H-l)<Wb&&q-P>Wb?[l,Math.abs(E-l)<Wb?y:q]:Math.abs(P-q)<Wb&&m-H>Wb?[Math.abs(y-q)<Wb?E:m,q]:Math.abs(H-m)<Wb&&P-h>Wb?[m,Math.abs(E-m)<Wb?y:h]:Math.abs(P-h)<Wb&&H-l>Wb?[Math.abs(y-h)<Wb?E:l,h]:null))-1),++u)}u&&(x=!1)}if(x){var T,W,aa;v=1/0;p=0;for(x=null;p<w;++p)(r=qd[p])&&(aa=(T=(B=r.site)[0]-l)*T+(W=B[1]-h)*W)<v&&(v=aa,x=r);x&&(p=[l,h],l=[l,q],q=[m,q],h=[m,h],x.halfedges.push(Vc.push(Eg(B=x.site,p,l))-1,Vc.push(Eg(B,l,q))-1,Vc.push(Eg(B,q,
h))-1,Vc.push(Eg(B,h,p))-1))}for(p=0;p<w;++p)(r=qd[p])&&(r.halfedges.length||delete qd[p])}(b,f,k,c);this.edges=Vc;this.cells=qd;Lf=Fg=Vc=qd=null}function zo(b){return(b=b.slice()).push(b[0]),D([b])}function Jl(b,c,f,k){var d=(k=k||{}).steps||64,g=k.units||"kilometers",l=k.angle||0,h=k.pivot||b,m=k.properties||b.properties||{};if(!b)throw Error("center is required");if(!c)throw Error("xSemiAxis is required");if(!f)throw Error("ySemiAxis is required");if(!ta(k))throw Error("options must be an object");
if(!la(d))throw Error("steps must be a number");if(!la(l))throw Error("angle must be a number");k=ca(b);if("degrees"===g)var q=ma(l);else c=Hf(b,c,90,{units:g}),f=Hf(b,f,0,{units:g}),c=ca(c)[0]-k[0],f=ca(f)[1]-k[1];b=[];for(var p=0;p<d;p+=1){var r=-360*p/d,v=c*f/Math.sqrt(Math.pow(f,2)+Math.pow(c,2)*Math.pow(Math.tan(r*Math.PI/180),2)),A=c*f/Math.sqrt(Math.pow(c,2)+Math.pow(f,2)/Math.pow(Math.tan(r*Math.PI/180),2));if(-90>r&&-270<=r&&(v=-v),-180>r&&-360<=r&&(A=-A),"degrees"===g)r=A*Math.cos(q)-v*
Math.sin(q),v=v*Math.cos(q)+A*Math.sin(q),A=r;b.push([v+k[0],A+k[1]])}return b.push(b[0]),"degrees"===g?D([b],m):jl(D([b],m),l,{pivot:h})}function Zi(b,c){void 0===c&&(c={});var f=0,k=0,d=0;return Zb(b,function(g,l,h){var m=c.weight?null==h?void 0:h[c.weight]:void 0;if(!la(m=null==m?1:m))throw Error("weight value must be a number for feature index "+l);0<(m=Number(m))&&Ca(g,function(q){f+=q[0]*m;k+=q[1]*m;d+=m})}),t([f/d,k/d],c.properties,c)}function Kl(b,c,f,k,d){var g=k.tolerance||.001,l=0,h=0,
m=0,q=0;if(Sa(f,function(v){var A,u=null===(A=v.properties)||void 0===A?void 0:A.weight;A=null==u?1:u;if(!la(A=Number(A)))throw Error("weight value must be a number");0<A&&(q+=1,u=A*Lb(v,b),0===u&&(u=1),A/=u,l+=v.geometry.coordinates[0]*A,h+=v.geometry.coordinates[1]*A,m+=A)}),1>q)throw Error("no features to measure");var p=l/m,r=h/m;return 1===q||0===d||Math.abs(p-c[0])<g&&Math.abs(r-c[1])<g?t([p,r],{medianCandidates:k.medianCandidates}):(k.medianCandidates.push([p,r]),Kl([p,r],b,f,k,d-1))}function Ll(b,
c){return{x:b[0]-c[0],y:b[1]-c[1]}}function Ao(b,c){var f=0,k=0;Ca(b,function(d,g,l,h,m){m>f&&(f=m,k=g,c.push([]));l=b.coordinates[m][g-k+1];g=d[0];d=d[1];h=l[0];l=l[1];c[m].push([.75*g+.25*h,.75*d+.25*l]);c[m].push([.25*g+.75*h,.25*d+.75*l])},!0);c.forEach(function(d){d.push(d[0])})}function Bo(b,c){var f=0,k=0,d=0;Ca(b,function(g,l,h,m,q){m>d&&(d=m,k=l,c.push([[]]));q>f&&(f=q,k=l,c[m].push([]));h=b.coordinates[m][q][l-k+1];l=g[0];g=g[1];var p=h[0];h=h[1];c[m][q].push([.75*l+.25*p,.75*g+.25*h]);
c[m][q].push([.25*l+.75*p,.25*g+.75*h])},!0);c.forEach(function(g){g.forEach(function(l){l.push(l[0])})})}function Co(b,c,f){void 0===f&&(f=2);b=ca(b);var k=ca(c);c=b[0]-k[0];b=b[1]-k[1];return 1===f?Math.abs(c)+Math.abs(b):Math.pow(Math.pow(c,f)+Math.pow(b,f),1/f)}function Ml(b,c){var f=(c=c||{}).threshold||1E4,k=c.p||2,d=c.binary||!1,g=c.alpha||-1;c=c.standardization||!1;var l=[];Sa(b,function(p){l.push(Ne(p))});b=[];for(var h=0;h<l.length;h++)b[h]=[];for(h=0;h<l.length;h++)for(var m=h;m<l.length;m++){h===
m&&(b[h][m]=0);var q=Co(l[h],l[m],k);b[h][m]=q;b[m][h]=q}for(h=0;h<l.length;h++)for(m=0;m<l.length;m++)0!==(q=b[h][m])&&(b[h][m]=d?q<=f?1:0:q<=f?Math.pow(q,g):0);if(c)for(h=0;h<l.length;h++)for(f=b[h].reduce(function(p,r){return p+r},0),m=0;m<l.length;m++)b[h][m]/=f;return b}function Nl(b){for(var c=0,f=0;f<b.length;f++)c+=b[f];return c/b.length}function Ol(b,c){return void 0===c&&(c={}),Pl(b,"mercator",c)}function Ql(b,c){return void 0===c&&(c={}),Pl(b,"wgs84",c)}function Pl(b,c,f){void 0===f&&(f=
{});var k=(f=f||{}).mutate;if(!b)throw Error("geojson is required");return Array.isArray(b)&&la(b[0])?b="mercator"===c?Rl(b):Sl(b):(!0!==k&&(b=Dc(b)),Ca(b,function(d){var g="mercator"===c?Rl(d):Sl(d);d[0]=g[0];d[1]=g[1]})),b}function Rl(b){var c=Math.PI/180;if(180>=Math.abs(b[0]))var f=b[0];else f=b[0],f=b[0]-360*(0>f?-1:0<f?1:0);b=[6378137*f*c,6378137*Math.log(Math.tan(.25*Math.PI+.5*b[1]*c))];return 2.0037508342789244E7<b[0]&&(b[0]=2.0037508342789244E7),-2.0037508342789244E7>b[0]&&(b[0]=-2.0037508342789244E7),
2.0037508342789244E7<b[1]&&(b[1]=2.0037508342789244E7),-2.0037508342789244E7>b[1]&&(b[1]=-2.0037508342789244E7),b}function Sl(b){var c=180/Math.PI;return[b[0]*c/6378137,(.5*Math.PI-2*Math.atan(Math.exp(-b[1]/6378137)))*c]}function Gg(b){return Array.isArray(b)?Tl(b):b&&b.bbox?Tl(b.bbox):[360*(Math.random()-.5),180*(Math.random()-.5)]}function Ul(b,c){void 0===c&&(c={});null==b&&(b=1);for(var f=[],k=0;k<b;k++)f.push(t(Gg(c.bbox)));return K(f)}function Vl(b,c){void 0===c&&(c={});null==b&&(b=1);la(c.num_vertices)&&
void 0!==c.num_vertices||(c.num_vertices=10);la(c.max_radial_length)&&void 0!==c.max_radial_length||(c.max_radial_length=10);for(var f=[],k=function(g){var l,h=[],m=Do(Array(c.num_vertices+1)).map(Math.random);m.forEach(function(q,p,r){r[p]=0<p?q+r[p-1]:q});m.forEach(function(q){q=2*q*Math.PI/m[m.length-1];var p=Math.random();h.push([p*(c.max_radial_length||10)*Math.sin(q),p*(c.max_radial_length||10)*Math.cos(q)])});h[h.length-1]=h[0];h=h.map((l=Gg(c.bbox),function(q){return[q[0]+l[0],q[1]+l[1]]}));
f.push(D([h]))},d=0;d<b;d++)k();return K(f)}function Wl(b,c){if(void 0===c&&(c={}),!ta(c=c||{}))throw Error("options is invalid");var f=c.bbox,k=c.num_vertices,d=c.max_length;c=c.max_rotation;null==b&&(b=1);(!la(k)||void 0===k||2>k)&&(k=10);la(d)&&void 0!==d||(d=1E-4);la(c)&&void 0!==c||(c=Math.PI/8);for(var g=[],l=0;l<b;l++){for(var h=[Gg(f)],m=0;m<k-1;m++){var q=(0===m?2*Math.random()*Math.PI:Math.tan((h[m][1]-h[m-1][1])/(h[m][0]-h[m-1][0])))+(Math.random()-.5)*c*2,p=Math.random()*d;h.push([h[m][0]+
p*Math.cos(q),h[m][1]+p*Math.sin(q)])}g.push(J(h))}return K(g)}function Tl(b){return[Math.random()*(b[2]-b[0])+b[0],Math.random()*(b[3]-b[1])+b[1]]}function Xl(b,c){if(!b)throw Error("geojson is required");if("FeatureCollection"!==b.type)throw Error("geojson must be a FeatureCollection");if(null==c)throw Error("filter is required");var f=[];return Sa(b,function(k){Kh(k.properties,c)&&f.push(k)}),K(f)}function $i(b,c,f){if(!b)throw Error("geojson is required");if("FeatureCollection"!==b.type)throw Error("geojson must be a FeatureCollection");
if(null==c)throw Error("property is required");c=aj(b,c);for(var k=Object.keys(c),d=0;d<k.length;d++){for(var g=k[d],l=c[g],h=[],m=0;m<l.length;m++)h.push(b.features[l[m]]);f(K(h),g,d)}}function Yl(b,c,f,k){var d=k;return $i(b,c,function(g,l,h){d=0===h&&void 0===k?g:f(d,g,l,h)}),d}function aj(b,c){var f={};return Sa(b,function(k,d){k=k.properties||{};Object.prototype.hasOwnProperty.call(k,String(c))&&(k=k[c],Object.prototype.hasOwnProperty.call(f,k)?f[k].push(d):f[k]=[d])}),f}function Kh(b,c){if(void 0===
b)return!1;var f=typeof c;if("number"===f||"string"===f)return Object.prototype.hasOwnProperty.call(b,c);if(Array.isArray(c)){for(f=0;f<c.length;f++)if(!Kh(b,c[f]))return!1;return!0}return bj(b,c)}function bj(b,c){for(var f=Object.keys(c),k=0;k<f.length;k++){var d=f[k];if(b[d]!==c[d])return!1}return!0}function Zl(b,c){if(!c||!c.length)return{};for(var f={},k=0;k<c.length;k++){var d=c[k];Object.prototype.hasOwnProperty.call(b,d)&&(f[d]=b[d])}return f}function Eo(b,c){return b>c?1:b<c?-1:0}function Oe(b,
c,f){for(var k=new Pe(null,null),d=k,g=k;;){var l=f(b,c.key);if(0>l){if(null===c.left)break;if(0>f(b,c.left.key)&&(l=c.left,c.left=l.right,l.right=c,null===(c=l).left))break;g=g.left=c;c=c.left}else{if(!(0<l))break;if(null===c.right)break;if(0<f(b,c.right.key)&&(l=c.right,c.right=l.left,l.left=c,null===(c=l).right))break;d=d.right=c;c=c.right}}return d.right=c.left,g.left=c.right,c.left=k.right,c.right=k.left,c}function cj(b,c,f,k){c=new Pe(b,c);if(null===f)return c.left=c.right=null,c;b=k(b,(f=Oe(b,
f,k)).key);return 0>b?(c.left=f.left,c.right=f,f.left=null):0<=b&&(c.right=f.right,c.left=f,f.right=null),c}function $l(b,c,f){var k=null,d=null;c&&(f=f((c=Oe(b,c,f)).key,b),0===f?(k=c.left,d=c.right):0>f?(d=c.right,c.right=null,k=c):(k=c.left,c.left=null,d=c));return{left:k,right:d}}function dj(b,c,f,k,d){b&&(k(c+(f?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+d(b)+"\n"),c+=f?"    ":"\u2502   ",b.left&&dj(b.left,c,!1,k,d),b.right&&dj(b.right,c,!0,k,d))}function ej(b,c,f,k){var d=k-f;if(0<d){d=f+
Math.floor(d/2);var g=new Pe(b[d],c[d]);return g.left=ej(b,c,f,d),g.right=ej(b,c,d+1,k),g}return null}function fj(b,c,f){var k=f-c;if(0<k){k=c+Math.floor(k/2);c=fj(b,c,k);var d=b.head;return d.left=c,b.head=b.head.next,d.right=fj(b,k+1,f),d}return null}function gj(b,c,f,k,d){if(!(f>=k)){for(var g=b[f+k>>1],l=f-1,h=k+1;;){do l++;while(0>d(b[l],g));do h--;while(0<d(b[h],g));if(l>=h)break;var m=b[l];b[l]=b[h];b[h]=m;m=c[l];c[l]=c[h];c[h]=m}gj(b,c,f,h,d);gj(b,c,h+1,k,d)}}function yd(b,c){if(!(b instanceof
c))throw new TypeError("Cannot call a class as a function");}function am(b,c){for(var f=0;f<c.length;f++){var k=c[f];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(b,k.key,k)}}function bd(b,c,f){return c&&am(b.prototype,c),f&&am(b,f),b}function id(){}function hj(b){this.message=b||""}function Mf(b){this.message=b||""}function Hg(b){this.message=b||""}function Lh(){}function Pb(b){return null===b?null:b.parent}function le(b,c){null!==b&&(b.color=
c)}function ij(b){return null===b?null:b.left}function bm(b){return null===b?null:b.right}function Ac(){this.root_=null;this.size_=0}function cm(){}function zd(b){this.array_=[];b instanceof kc&&this.addAll(b)}function Fo(){}function Go(){}function Ho(){}function Io(){}function Mh(b){this.message=b||""}function Ad(){this.array_=[]}function Sd(){this.reset()}function dm(b,c,f){var k=b.s=c+f,d=k-c;b.t=c-(k-d)+(f-d)}function em(b){return 1<b?0:-1>b?Nb:Math.acos(b)}function Nf(b){return 1<b?me:-1>b?-me:
Math.asin(b)}function Ig(){}function Nh(b,c){b&&fm.hasOwnProperty(b.type)&&fm[b.type](b,c)}function jj(b,c,f){var k=-1,d=b.length-f;for(c.lineStart();++k<d;)f=b[k],c.point(f[0],f[1],f[2]);c.lineEnd()}function gm(b,c){var f=-1,k=b.length;for(c.polygonStart();++f<k;)jj(b[f],c,1);c.polygonEnd()}function kj(b){return[Of(b[1],b[0]),Nf(b[2])]}function Pf(b){var c=b[0];b=b[1];var f=lc(b);return[f*lc(c),f*mc(c),mc(b)]}function Oh(b,c){return b[0]*c[0]+b[1]*c[1]+b[2]*c[2]}function Ph(b,c){return[b[1]*c[2]-
b[2]*c[1],b[2]*c[0]-b[0]*c[2],b[0]*c[1]-b[1]*c[0]]}function lj(b,c){b[0]+=c[0];b[1]+=c[1];b[2]+=c[2]}function Qh(b,c){return[b[0]*c,b[1]*c,b[2]*c]}function mj(b){var c=Jg(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);b[0]/=c;b[1]/=c;b[2]/=c}function hm(b,c){function f(k,d){return k=b(k,d),c(k[0],k[1])}return b.invert&&c.invert&&(f.invert=function(k,d){return(k=c.invert(k,d))&&b.invert(k[0],k[1])}),f}function nj(b,c){return[b>Nb?b-ne:b<-Nb?b+ne:b,c]}function im(b){return function(c,f){return[(c+=b)>Nb?c-ne:c<-Nb?
c+ne:c,f]}}function jm(b){var c=im(b);return c.invert=im(-b),c}function km(b,c){function f(h,m){var q=lc(m),p=lc(h)*q;h=mc(h)*q;m=mc(m);q=m*k+p*d;return[Of(h*g-q*l,p*k-m*d),Nf(q*g+h*l)]}var k=lc(b),d=mc(b),g=lc(c),l=mc(c);return f.invert=function(h,m){var q=lc(m),p=lc(h)*q;h=mc(h)*q;m=mc(m);q=m*g-h*l;return[Of(h*g+m*l,p*k+q*d),Nf(q*k-p*d)]},f}function lm(b,c){(c=Pf(c))[0]-=b;mj(c);b=em(-c[1]);return((0>-c[2]?-b:b)+ne-1E-6)%ne}function mm(){var b,c=[];return{point:function(f,k){b.push([f,k])},lineStart:function(){c.push(b=
[])},lineEnd:Ig,rejoin:function(){1<c.length&&c.push(c.pop().concat(c.shift()))},result:function(){var f=c;return c=[],b=null,f}}}function Rh(b,c){return 1E-6>Fc(b[0]-c[0])&&1E-6>Fc(b[1]-c[1])}function Sh(b,c,f,k){this.x=b;this.z=c;this.o=f;this.e=k;this.v=!1;this.n=this.p=null}function nm(b,c,f,k,d){var g=[],l=[];if(b.forEach(function(r){if(!(0>=(v=r.length-1))){var v,A=r[0],u=r[v];if(Rh(A,u)){d.lineStart();for(h=0;h<v;++h)d.point((A=r[h])[0],A[1]);d.lineEnd()}else g.push(v=new Sh(A,r,null,!0)),
l.push(v.o=new Sh(A,null,v,!1)),g.push(v=new Sh(u,r,null,!1)),l.push(v.o=new Sh(u,null,v,!0))}}),g.length){l.sort(c);om(g);om(l);var h=0;for(b=l.length;h<b;++h)l[h].e=f=!f;var m;for(c=g[0];;){for(var q=c,p=!0;q.v;)if((q=q.n)===c)return;f=q.z;d.lineStart();do{if(q.v=q.o.v=!0,q.e){if(p)for(h=0,b=f.length;h<b;++h)d.point((m=f[h])[0],m[1]);else k(q.x,q.n.x,1,d);q=q.n}else{if(p)for(f=q.p.z,h=f.length-1;0<=h;--h)d.point((m=f[h])[0],m[1]);else k(q.x,q.p.x,-1,d);q=q.p}f=(q=q.o).z;p=!p}while(!q.v);d.lineEnd()}}}
function om(b){if(c=b.length){for(var c,f,k=0,d=b[0];++k<c;)d.n=f=b[k],f.p=d,d=f;d.n=f=b[0];f.p=d}}function pm(b){var c,f,k=b.length;var d=-1;for(var g=0;++d<k;)g+=b[d].length;for(c=Array(g);0<=--k;)for(d=(f=b[k]).length;0<=--d;)c[--g]=f[d];return c}function Jo(b,c,f,k){function d(m,q,p,r){var v=0,A=0;if(null==m||(v=g(m,p))!==(A=g(q,p))||0>h(m,q)^0<p){do r.point(0===v||3===v?b:f,1<v?k:c);while((v=(v+p+4)%4)!==A)}else r.point(q[0],q[1])}function g(m,q){return 1E-6>Fc(m[0]-b)?0<q?0:3:1E-6>Fc(m[0]-f)?
0<q?2:1:1E-6>Fc(m[1]-c)?0<q?1:0:0<q?3:2}function l(m,q){return h(m.x,q.x)}function h(m,q){var p=g(m,1),r=g(q,1);return p!==r?p-r:0===p?q[1]-m[1]:1===p?m[0]-q[0]:2===p?m[1]-q[1]:q[0]-m[0]}return function(m){function q(aa,X){b<=aa&&aa<=f&&c<=X&&X<=k&&P.point(aa,X)}function p(aa,X){var fa=b<=aa&&aa<=f&&c<=X&&X<=k;if(v&&A.push([aa,X]),E)u=aa,y=X,C=fa,E=!1,fa&&(P.lineStart(),P.point(aa,X));else if(fa&&B)P.point(aa,X);else{var na=[w=Math.max(-1E9,Math.min(1E9,w)),x=Math.max(-1E9,Math.min(1E9,x))],qa=[aa=
Math.max(-1E9,Math.min(1E9,aa)),X=Math.max(-1E9,Math.min(1E9,X))];(function(ia,ra,ja,Ma,Pa,Sb){var Qa,Wc=ia[0],fc=ia[1],nc=0,cc=1,gc=ra[0]-Wc,Gc=ra[1]-fc;if(Qa=ja-Wc,gc||!(0<Qa)){if(Qa/=gc,0>gc){if(Qa<nc)return;Qa<cc&&(cc=Qa)}else if(0<gc){if(Qa>cc)return;Qa>nc&&(nc=Qa)}if(Qa=Pa-Wc,gc||!(0>Qa)){if(Qa/=gc,0>gc){if(Qa>cc)return;Qa>nc&&(nc=Qa)}else if(0<gc){if(Qa<nc)return;Qa<cc&&(cc=Qa)}if(Qa=Ma-fc,Gc||!(0<Qa)){if(Qa/=Gc,0>Gc){if(Qa<nc)return;Qa<cc&&(cc=Qa)}else if(0<Gc){if(Qa>cc)return;Qa>nc&&(nc=
Qa)}if(Qa=Sb-fc,Gc||!(0>Qa)){if(Qa/=Gc,0>Gc){if(Qa>cc)return;Qa>nc&&(nc=Qa)}else if(0<Gc){if(Qa<nc)return;Qa<cc&&(cc=Qa)}return 0<nc&&(ia[0]=Wc+nc*gc,ia[1]=fc+nc*Gc),1>cc&&(ra[0]=Wc+cc*gc,ra[1]=fc+cc*Gc),!0}}}}})(na,qa,b,c,f,k)?(B||(P.lineStart(),P.point(na[0],na[1])),P.point(qa[0],qa[1]),fa||P.lineEnd(),H=!1):fa&&(P.lineStart(),P.point(aa,X),H=!1)}w=aa;x=X;B=fa}var r,v,A,u,y,C,w,x,B,E,H,P=m,T=mm(),W={point:q,lineStart:function(){W.point=p;v&&v.push(A=[]);E=!0;B=!1;w=x=NaN},lineEnd:function(){r&&
(p(u,y),C&&B&&T.rejoin(),r.push(T.result()));W.point=q;B&&P.lineEnd()},polygonStart:function(){P=T;r=[];v=[];H=!0},polygonEnd:function(){for(var aa,X=aa=0,fa=v.length;X<fa;++X){var na=v[X],qa=1,ia=na.length,ra=na[0],ja=ra[0];for(ra=ra[1];qa<ia;++qa){var Ma=ja;var Pa=ra;ja=(ra=na[qa])[0];ra=ra[1];Pa<=k?ra>k&&(ja-Ma)*(k-Pa)>(ra-Pa)*(b-Ma)&&++aa:ra<=k&&(ja-Ma)*(k-Pa)<(ra-Pa)*(b-Ma)&&--aa}}X=H&&aa;fa=(r=pm(r)).length;(X||fa)&&(m.polygonStart(),X&&(m.lineStart(),d(null,null,1,m),m.lineEnd()),fa&&nm(r,
l,aa,d,m),m.polygonEnd());P=m;r=v=A=null}};return W}}function qm(b){return b}function rm(b,c,f,k){return function(d,g){function l(P,T){var W=d(P,T);b(P=W[0],T=W[1])&&g.point(P,T)}function h(P,T){P=d(P,T);C.point(P[0],P[1])}function m(){H.point=h;C.lineStart()}function q(){H.point=l;C.lineEnd()}function p(P,T){y.push([P,T]);P=d(P,T);B.point(P[0],P[1])}function r(){B.lineStart();y=[]}function v(){p(y[0][0],y[0][1]);B.lineEnd();var P;var T=B.clean();var W=x.result();var aa=W.length;if(y.pop(),A.push(y),
y=null,aa)if(1&T){if(0<(W=(aa=W[0]).length-1)){E||(g.polygonStart(),E=!0);g.lineStart();for(T=0;T<W;++T)g.point((P=aa[T])[0],P[1]);g.lineEnd()}}else 1<aa&&2&T&&W.push(W.pop().concat(W.shift())),u.push(W.filter(Ko))}var A,u,y,C=c(g),w=d.invert(k[0],k[1]),x=mm(),B=c(x),E=!1,H={point:l,lineStart:m,lineEnd:q,polygonStart:function(){H.point=p;H.lineStart=r;H.lineEnd=v;u=[];A=[]},polygonEnd:function(){H.point=l;H.lineStart=m;H.lineEnd=q;u=pm(u);var P=A;var T=w[0],W=w[1],aa=[mc(T),-lc(T),0],X=0,fa=0;oj.reset();
for(var na=0,qa=P.length;na<qa;++na)if(ra=(ia=P[na]).length){var ia,ra,ja=ia[ra-1],Ma=ja[0],Pa=ja[1]/2+sm,Sb=mc(Pa),Qa=lc(Pa);for(Pa=0;Pa<ra;++Pa,Ma=fc,Sb=nc,Qa=cc,ja=Wc){var Wc=ia[Pa],fc=Wc[0];cc=Wc[1]/2+sm;var nc=mc(cc),cc=lc(cc),gc=fc-Ma,Gc=0<=gc?1:-1,Qf=Gc*gc,Qe=Qf>Nb;Sb*=nc;if(oj.add(Of(Sb*Gc*mc(Qf),Qa*cc+Sb*lc(Qf))),X+=Qe?gc+Gc*ne:gc,Qe^Ma>=T^fc>=T)ja=Ph(Pf(ja),Pf(Wc)),mj(ja),Ma=Ph(aa,ja),mj(Ma),Ma=(Qe^0<=gc?-1:1)*Nf(Ma[2]),(W>Ma||W===Ma&&(ja[0]||ja[1]))&&(fa+=Qe^0<=gc?1:-1)}}P=(-1E-6>X||1E-6>
X&&-1E-6>oj)^1&fa;u.length?(E||(g.polygonStart(),E=!0),nm(u,Lo,P,f,g)):P&&(E||(g.polygonStart(),E=!0),g.lineStart(),f(null,null,1,g),g.lineEnd());E&&(g.polygonEnd(),E=!1);u=A=null},sphere:function(){g.polygonStart();g.lineStart();f(null,null,1,g);g.lineEnd();g.polygonEnd()}};return H}}function Ko(b){return 1<b.length}function Lo(b,c){return(0>(b=b.x)[0]?b[1]-me-1E-6:me-b[1])-(0>(c=c.x)[0]?c[1]-me-1E-6:me-c[1])}function Mo(b,c){function f(m,q){return lc(m)*lc(q)>g}function k(m,q,p){var r=[1,0,0],v=
Ph(Pf(m),Pf(q)),A=Oh(v,v),u=v[0],y=A-u*u;if(!y)return!p&&m;A=g*A/y;y=-g*u/y;u=Ph(r,v);r=Qh(r,A);lj(r,Qh(v,y));v=Oh(r,u);A=Oh(u,u);y=v*v-A*(Oh(r,r)-1);if(!(0>y)){var C=Jg(y);y=Qh(u,(-v-C)/A);if(lj(y,r),y=kj(y),!p)return y;var w;p=m[0];var x=q[0];m=m[1];q=q[1];x<p&&(w=p,p=x,x=w);var B=x-p,E=1E-6>Fc(B-Nb);if(!E&&q<m&&(w=m,m=q,q=w),E||1E-6>B?E?0<m+q^y[1]<(1E-6>Fc(y[0]-p)?m:q):m<=y[1]&&y[1]<=q:B>Nb^(p<=y[0]&&y[0]<=x))return w=Qh(u,(-v+C)/A),lj(w,r),[y,kj(w)]}}function d(m,q){var p=l?b:Nb-b,r=0;return m<
-p?r|=1:m>p&&(r|=2),q<-p?r|=4:q>p&&(r|=8),r}var g=lc(b),l=0<g,h=1E-6<Fc(g);return rm(f,function(m){var q,p,r,v,A;return{lineStart:function(){v=r=!1;A=1},point:function(u,y){var C,w=[u,y],x=f(u,y);u=l?x?0:d(u,y):x?d(u+(0>u?Nb:-Nb),y):0;if(!q&&(v=r=x)&&m.lineStart(),x!==r&&(!(C=k(q,w))||Rh(q,C)||Rh(w,C))&&(w[0]+=1E-6,w[1]+=1E-6,x=f(w[0],w[1])),x!==r)A=0,x?(m.lineStart(),C=k(w,q),m.point(C[0],C[1])):(C=k(q,w),m.point(C[0],C[1]),m.lineEnd()),q=C;else if(h&&q&&l^x){var B;u&p||!(B=k(w,q,!0))||(A=0,l?(m.lineStart(),
m.point(B[0][0],B[0][1]),m.point(B[1][0],B[1][1]),m.lineEnd()):(m.point(B[1][0],B[1][1]),m.lineEnd(),m.lineStart(),m.point(B[0][0],B[0][1])))}!x||q&&Rh(q,w)||m.point(w[0],w[1]);q=w;r=x;p=u},lineEnd:function(){r&&m.lineEnd();q=null},clean:function(){return A|(v&&r)<<1}}},function(m,q,p,r){var v=m;if(c){m=lc(b);var A=mc(b),u=p*c;null==v?(v=b+p*ne,q=b-u/2):(v=lm(m,v),q=lm(m,q),(0<p?v<q:v>q)&&(v+=p*ne));for(var y=v;0<p?y>q:y<q;y-=u)v=kj([m,-A*lc(y),-A*mc(y)]),r.point(v[0],v[1])}!0},l?[0,-b]:[-Nb,b-Nb])}
function tm(b){return function(c){var f=new pj,k;for(k in b)f[k]=b[k];return f.stream=c,f}}function pj(){}function um(b,c,f){var k=c[1][0]-c[0][0],d=c[1][1]-c[0][1],g=b.clipExtent&&b.clipExtent();b.scale(150).translate([0,0]);null!=g&&b.clipExtent(null);var l=b.stream(vm);f&&wm.hasOwnProperty(f.type)?wm[f.type](f,l):Nh(f,l);l=vm.result();f=Math.min(k/(l[1][0]-l[0][0]),d/(l[1][1]-l[0][1]));k=+c[0][0]+(k-f*(l[1][0]+l[0][0]))/2;c=+c[0][1]+(d-f*(l[1][1]+l[0][1]))/2;return null!=g&&b.clipExtent(g),b.scale(150*
f).translate([k,c])}function xm(b,c){return+c?function(f,k){function d(g,l,h,m,q,p,r,v,A,u,y,C,w,x){var B=r-g,E=v-l,H=B*B+E*E;if(H>4*k&&w--){var P=m+u,T=q+y,W=p+C,aa=Jg(P*P+T*T+W*W),X=Nf(W/=aa),fa=1E-6>Fc(Fc(W)-1)||1E-6>Fc(h-A)?(h+A)/2:Of(T,P),na=f(fa,X);X=na[0];na=na[1];var qa=X-g,ia=na-l,ra=E*qa-B*ia;(ra*ra/H>k||.3<Fc((B*qa+E*ia)/H-.5)||m*u+q*y+p*C<No)&&(d(g,l,h,m,q,p,X,na,fa,P/=aa,T/=aa,W,w,x),x.point(X,na),d(X,na,fa,P,T,W,r,v,A,u,y,C,w,x))}}return function(g){function l(X,fa){X=f(X,fa);g.point(X[0],
X[1])}function h(){E=NaN;aa.point=m;g.lineStart()}function m(X,fa){var na=Pf([X,fa]);fa=f(X,fa);d(E,H,B,P,T,W,E=fa[0],H=fa[1],B=X,P=na[0],T=na[1],W=na[2],16,g);g.point(E,H)}function q(){aa.point=l;g.lineEnd()}function p(){h();aa.point=r;aa.lineEnd=v}function r(X,fa){m(A=X,fa);u=E;y=H;C=P;w=T;x=W;aa.point=m}function v(){d(E,H,B,P,T,W,u,y,A,C,w,x,16,g);aa.lineEnd=q;q()}var A,u,y,C,w,x,B,E,H,P,T,W,aa={point:l,lineStart:h,lineEnd:q,polygonStart:function(){g.polygonStart();aa.lineStart=p},polygonEnd:function(){g.polygonEnd();
aa.lineStart=h}};return aa}}(b,c):function(f){return tm({point:function(k,d){k=f(k,d);this.stream.point(k[0],k[1])}})}(b)}function Oo(b){return function(c){function f(ia){return[(ia=p(ia[0]*Bd,ia[1]*Bd))[0]*C+h,m-ia[1]*C]}function k(ia){return(ia=p.invert((ia[0]-h)/C,(m-ia[1])/C))&&[ia[0]*Re,ia[1]*Re]}function d(ia,ra){return[(ia=l(ia,ra))[0]*C+h,m-ia[1]*C]}function g(){var ia=H,ra=P,ja=T;var Ma=(ia%=ne)?ra||ja?hm(jm(ia),km(ra,ja)):jm(ia):ra||ja?km(ra,ja):nj;p=hm(q=Ma,l);Ma=l(B,E);return h=w-Ma[0]*
C,m=x+Ma[1]*C,u=y=null,f}var l,h,m,q,p,r,v,A,u,y,C=150,w=480,x=250,B=0,E=0,H=0,P=0,T=0,W=null,aa=ym,X=null,fa=qm,na=.5,qa=xm(d,na);return f.stream=function(ia){return u&&y===ia?u:u=Po(aa(q,qa(fa(y=ia))))},f.clipAngle=function(ia){return arguments.length?(aa=+ia?Mo(W=ia*Bd,6*Bd):(W=null,ym),u=y=null,f):W*Re},f.clipExtent=function(ia){return arguments.length?(fa=null==ia?(X=r=v=A=null,qm):Jo(X=+ia[0][0],r=+ia[0][1],v=+ia[1][0],A=+ia[1][1]),u=y=null,f):null==X?null:[[X,r],[v,A]]},f.scale=function(ia){return arguments.length?
(C=+ia,g()):C},f.translate=function(ia){return arguments.length?(w=+ia[0],x=+ia[1],g()):[w,x]},f.center=function(ia){return arguments.length?(B=ia[0]%360*Bd,E=ia[1]%360*Bd,g()):[B*Re,E*Re]},f.rotate=function(ia){return arguments.length?(H=ia[0]%360*Bd,P=ia[1]%360*Bd,T=2<ia.length?ia[2]%360*Bd:0,g()):[H*Re,P*Re,T*Re]},f.precision=function(ia){return arguments.length?(qa=xm(d,na=ia*ia),u=y=null,f):Jg(na)},f.fitExtent=function(ia,ra){return um(f,ia,ra)},f.fitSize=function(ia,ra){return um(f,[[0,0],ia],
ra)},function(){return l=c.apply(this,arguments),f.invert=l.invert&&k,g()}}(function(){return b})()}function Th(b,c,f,k){var d=b.properties||{},g="Feature"===b.type?b.geometry:b;if("GeometryCollection"===g.type){var l=[];return Zb(b,function(m){(m=Th(m,c,f,k))&&l.push(m)}),K(l)}b=function(m){m=wh(m).geometry.coordinates;m=[-m[0],-m[1]];return Oo(zm).scale(79.4188).clipAngle(179.999).rotate(m).scale(6371008.8)}(g);g={type:g.type,coordinates:Am(g.coordinates,b)};g=(new qj).read(g);var h=Z(da(c,f),"meters");
g=xc.bufferOp(g,h,k);if(!Bm((g=(new Cm).write(g)).coordinates))return e({type:g.type,coordinates:Dm(g.coordinates,b)},d)}function Bm(b){return Array.isArray(b[0])?Bm(b[0]):isNaN(b[0])}function Am(b,c){return"object"!=typeof b[0]?c(b):b.map(function(f){return Am(f,c)})}function Dm(b,c){return"object"!=typeof b[0]?c.invert(b):b.map(function(f){return Dm(f,c)})}function Kg(b,c,f){void 0===f&&(f={});b=Ib(b);c=Ib(c);c=Ce.intersection(b.coordinates,c.coordinates);return 0===c.length?null:1===c.length?D(c[0],
f.properties):Q(c,f.properties)}function Em(b,c,f){void 0===f&&(f={});var k=JSON.stringify(f.properties||{}),d=b[0],g=b[1],l=b[2],h=b[3];b=(g+h)/2;var m=(d+l)/2;b=2*c/Lb([d,b],[l,b],f)*(l-d);c=2*c/Lb([m,g],[m,h],f)*(h-g);var q=b/2,p=2*q;m=Math.sqrt(3)/2*c;var r=l-d,v=h-g;l=.75*p;h=Math.floor((r-p)/(p-q/2));q=(h*l-q/2-r)/2-q/2+l/2;p=Math.floor((v-m)/m);r=(v-p*m)/2;(v=p*m-v>m/2)&&(r-=m/4);for(var A=[],u=[],y=0;6>y;y++){var C=2*Math.PI/6*y;A.push(Math.cos(C));u.push(Math.sin(C))}var w=[];for(y=0;y<=
h;y++)for(C=0;C<=p;C++){var x=1==y%2;if(!(0===C&&x||0===C&&v)){var B=y*l+d-q,E=C*m+g+r;(x&&(E-=m/2),!0===f.triangles)?Qo([B,E],b/2,c/2,JSON.parse(k),A,u).forEach(function(H){f.mask?Kg(f.mask,H)&&w.push(H):w.push(H)}):(x=Ro([B,E],b/2,c/2,JSON.parse(k),A,u),f.mask?Kg(f.mask,x)&&w.push(x):w.push(x))}}return K(w)}function Ro(b,c,f,k,d,g){for(var l=[],h=0;6>h;h++)l.push([b[0]+c*d[h],b[1]+f*g[h]]);return l.push(l[0].slice()),D([l],k)}function Qo(b,c,f,k,d,g){for(var l=[],h=0;6>h;h++){var m=[];m.push(b);
m.push([b[0]+c*d[h],b[1]+f*g[h]]);m.push([b[0]+c*d[(h+1)%6],b[1]+f*g[(h+1)%6]]);m.push(b);l.push(D([m],k))}return l}function Fm(b,c,f){void 0===f&&(f={});void 0===f&&(f={});var k=[],d=b[0],g=b[1],l=b[2],h=b[3];b=c/Lb([d,g],[l,g],f)*(l-d);c=c/Lb([d,g],[d,h],f)*(h-g);var m=l-d,q=h-g;l=Math.floor(m/b);h=Math.floor(q/c);q=(q-h*c)/2;d+=(m-l*b)/2;for(m=0;m<l;m++){for(var p=g+q,r=0;r<h;r++){var v=D([[[d,p],[d,p+c],[d+b,p+c],[d+b,p],[d,p]]],f.properties);f.mask?xl(f.mask,v)&&k.push(v):k.push(v);p+=c}d+=b}return K(k)}
function Gm(b,c,f){void 0===f&&(f={});var k=[],d=c/Lb([b[0],b[1]],[b[2],b[1]],f)*(b[2]-b[0]);c=c/Lb([b[0],b[1]],[b[0],b[3]],f)*(b[3]-b[1]);for(var g=0,l=b[0];l<=b[2];){for(var h=0,m=b[1];m<=b[3];){var q=null,p=null;0==g%2&&0==h%2?(q=D([[[l,m],[l,m+c],[l+d,m],[l,m]]],f.properties),p=D([[[l,m+c],[l+d,m+c],[l+d,m],[l,m+c]]],f.properties)):0==g%2&&1==h%2?(q=D([[[l,m],[l+d,m+c],[l+d,m],[l,m]]],f.properties),p=D([[[l,m],[l,m+c],[l+d,m+c],[l,m]]],f.properties)):0==h%2&&1==g%2?(q=D([[[l,m],[l,m+c],[l+d,m+
c],[l,m]]],f.properties),p=D([[[l,m],[l+d,m+c],[l+d,m],[l,m]]],f.properties)):1==h%2&&1==g%2&&(q=D([[[l,m],[l,m+c],[l+d,m],[l,m]]],f.properties),p=D([[[l,m+c],[l+d,m+c],[l+d,m],[l,m+c]]],f.properties));f.mask?(Kg(f.mask,q)&&k.push(q),Kg(f.mask,p)&&k.push(p)):(k.push(q),k.push(p));m+=c;h++}g++;l+=d}return K(k)}var mh={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:2.0902260511392E7,inches:39.37*6371008.8,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,
miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999},Hm={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1E3,millimetres:1E3,nauticalmiles:1/1852,radians:1/6371008.8,yards:1.0936133},nh={acres:2.47105E-4,centimeters:1E4,centimetres:1E4,feet:10.763910417,hectares:1E-4,inches:1550.003100006,kilometers:1E-6,kilometres:1E-6,
meters:1,metres:1,miles:3.86E-7,millimeters:1E6,millimetres:1E6,yards:1.195990046},So=Object.freeze({__proto__:null,earthRadius:6371008.8,factors:mh,unitsFactors:Hm,areaFactors:nh,feature:e,geometry:n,point:t,points:z,polygon:D,polygons:F,lineString:J,lineStrings:G,featureCollection:K,multiLineString:I,multiPoint:L,multiPolygon:Q,geometryCollection:M,round:U,radiansToLength:Z,lengthToRadians:da,lengthToDegrees:R,bearingToAzimuth:ba,radiansToDegrees:ha,degreesToRadians:ma,convertLength:ka,convertArea:pa,
isNumber:la,isObject:ta,validateBBox:wa,validateId:za}),To=Object.freeze({__proto__:null,coordAll:uc,coordEach:Ca,coordReduce:Vb,featureEach:Sa,featureReduce:Ya,findPoint:Ba,findSegment:oa,flattenEach:Rb,flattenReduce:Me,geomEach:Zb,geomReduce:pd,lineEach:S,lineReduce:ea,propEach:Kb,propReduce:Qd,segmentEach:N,segmentReduce:O});ya.default=ya;var Uo=Object.freeze({__proto__:null,getCoord:ca,getCoords:Y,containsNumber:xa,geojsonType:Oa,featureOf:Ob,collectionOf:Ka,getGeom:Ib,getType:qc}),Im=Object.getOwnPropertySymbols,
Vo=Object.prototype.hasOwnProperty,Wo=Object.prototype.propertyIsEnumerable,rj=function(){try{if(!Object.assign)return!1;var b=new String("abc");if(b[5]="de","5"===Object.getOwnPropertyNames(b)[0])return!1;var c={};for(b=0;10>b;b++)c["_"+String.fromCharCode(b)]=b;if("0123456789"!==Object.getOwnPropertyNames(c).map(function(k){return c[k]}).join(""))return!1;var f={};return"abcdefghijklmnopqrst".split("").forEach(function(k){f[k]=k}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},f)).join("")}catch(k){return!1}}()?
Object.assign:function(b,c){var f;if(null==b)throw new TypeError("Object.assign cannot be called with null or undefined");var k=Object(b);for(var d=1;d<arguments.length;d++){for(var g in f=Object(arguments[d]))Vo.call(f,g)&&(k[g]=f[g]);if(Im){var l=Im(f);for(var h=0;h<l.length;h++)Wo.call(f,l[h])&&(k[l[h]]=f[l[h]])}}return k},Rj={successCallback:null,verbose:!1},oh={},Vj=$b;Vj.default=$b;var Uc=mg;mg.prototype={all:function(){return this._all(this.data,[])},search:function(b){var c=this.data,f=[],
k=this.toBBox;if(!qh(b,c))return f;for(var d,g,l,h,m=[];c;){d=0;for(g=c.children.length;d<g;d++)l=c.children[d],qh(b,h=c.leaf?k(l):l)&&(c.leaf?f.push(l):pi(b,h)?this._all(l,f):m.push(l));c=m.pop()}return f},collides:function(b){var c=this.data,f=this.toBBox;if(!qh(b,c))return!1;for(var k,d,g,l,h=[];c;){k=0;for(d=c.children.length;k<d;k++)if(g=c.children[k],qh(b,l=c.leaf?f(g):g)){if(c.leaf||pi(b,l))return!0;h.push(g)}c=h.pop()}return!1},load:function(b){if(!b||!b.length)return this;if(b.length<this._minEntries){for(var c=
0,f=b.length;c<f;c++)this.insert(b[c]);return this}b=this._build(b.slice(),0,b.length-1,0);this.data.children.length?this.data.height===b.height?this._splitRoot(this.data,b):(this.data.height<b.height&&(c=this.data,this.data=b,b=c),this._insert(b,this.data.height-b.height-1,!0)):this.data=b;return this},insert:function(b){return b&&this._insert(b,this.data.height-1),this},clear:function(){return this.data=Cf([]),this},remove:function(b,c){if(!b)return this;for(var f,k,d,g,l=this.data,h=this.toBBox(b),
m=[],q=[];l||m.length;){l||(l=m.pop(),k=m[m.length-1],f=q.pop(),g=!0);var p;if(p=l.leaf){a:{d=b;p=l.children;var r=c;if(r){for(var v=0;v<p.length;v++)if(r(d,p[v])){d=v;break a}d=-1}else d=p.indexOf(d)}p=-1!==d}if(p)return l.children.splice(d,1),m.push(l),this._condense(m),this;g||l.leaf||!pi(l,h)?k?(f++,l=k.children[f],g=!1):l=null:(m.push(l),q.push(f),f=0,k=l,l=l.children[0])}return this},toBBox:function(b){return b},compareMinX:Sj,compareMinY:Tj,toJSON:function(){return this.data},fromJSON:function(b){return this.data=
b,this},_all:function(b,c){for(var f=[];b;)b.leaf?c.push.apply(c,b.children):f.push.apply(f,b.children),b=f.pop();return c},_build:function(b,c,f,k){var d,g=f-c+1,l=this._maxEntries;if(g<=l)return Bf(d=Cf(b.slice(c,f+1)),this.toBBox),d;k||(k=Math.ceil(Math.log(g)/Math.log(l)),l=Math.ceil(g/Math.pow(l,k-1)));(d=Cf([])).leaf=!1;d.height=k;var h,m;g=Math.ceil(g/l);l=g*Math.ceil(Math.sqrt(l));for(Uj(b,c,f,l,this.compareMinX);c<=f;c+=l)for(Uj(b,c,m=Math.min(c+l-1,f),g,this.compareMinY),h=c;h<=m;h+=g){var q=
Math.min(h+g-1,m);d.children.push(this._build(b,h,q,k-1))}return Bf(d,this.toBBox),d},_chooseSubtree:function(b,c,f,k){for(var d,g,l,h,m,q,p,r,v,A;k.push(c),!c.leaf&&k.length-1!==f;){p=r=1/0;d=0;for(g=c.children.length;d<g;d++)m=oi(l=c.children[d]),v=b,A=l,(q=(Math.max(A.maxX,v.maxX)-Math.min(A.minX,v.minX))*(Math.max(A.maxY,v.maxY)-Math.min(A.minY,v.minY))-m)<r?(r=q,p=m<p?m:p,h=l):q===r&&m<p&&(p=m,h=l);c=h||c.children[0]}return c},_insert:function(b,c,f){var k=this.toBBox;f=f?b:k(b);k=[];var d=this._chooseSubtree(f,
this.data,c,k);d.children.push(b);for(og(d,f);0<=c&&k[c].children.length>this._maxEntries;)this._split(k,c),c--;this._adjustParentBBoxes(f,k,c)},_split:function(b,c){var f=b[c],k=f.children.length,d=this._minEntries;this._chooseSplitAxis(f,d,k);k=this._chooseSplitIndex(f,d,k);k=Cf(f.children.splice(k,f.children.length-k));k.height=f.height;k.leaf=f.leaf;Bf(f,this.toBBox);Bf(k,this.toBBox);c?b[c-1].children.push(k):this._splitRoot(f,k)},_splitRoot:function(b,c){this.data=Cf([b,c]);this.data.height=
b.height+1;this.data.leaf=!1;Bf(this.data,this.toBBox)},_chooseSplitIndex:function(b,c,f){var k,d,g;var l=d=1/0;for(k=c;k<=f-c;k++){var h=ng(b,0,k,this.toBBox);var m=ng(b,k,f,this.toBBox);var q=h;var p=m;var r=Math.max(q.minX,p.minX);var v=Math.max(q.minY,p.minY);var A=Math.min(q.maxX,p.maxX);q=Math.min(q.maxY,p.maxY);r=Math.max(0,A-r)*Math.max(0,q-v);h=oi(h)+oi(m);r<l?(l=r,g=k,d=h<d?h:d):r===l&&h<d&&(d=h,g=k)}return g},_chooseSplitAxis:function(b,c,f){var k=b.leaf?this.compareMinX:Sj,d=b.leaf?this.compareMinY:
Tj;this._allDistMargin(b,c,f,k)<this._allDistMargin(b,c,f,d)&&b.children.sort(k)},_allDistMargin:function(b,c,f,k){b.children.sort(k);var d=this.toBBox,g=ng(b,0,c,d),l=ng(b,f-c,f,d),h=ph(g)+ph(l);for(k=c;k<f-c;k++){var m=b.children[k];og(g,b.leaf?d(m):m);h+=ph(g)}for(k=f-c-1;k>=c;k--)m=b.children[k],og(l,b.leaf?d(m):m),h+=ph(l);return h},_adjustParentBBoxes:function(b,c,f){for(;0<=f;f--)og(c[f],b)},_condense:function(b){for(var c,f=b.length-1;0<=f;f--)0===b[f].children.length?0<f?(c=b[f-1].children).splice(c.indexOf(b[f]),
1):this.clear():Bf(b[f],this.toBBox)},_initFormat:function(b){var c=["return a"," - b",";"];this.compareMinX=new Function("a","b",c.join(b[0]));this.compareMinY=new Function("a","b",c.join(b[1]));this.toBBox=new Function("a","return {minX: a"+b[0]+", minY: a"+b[1]+", maxX: a"+b[2]+", maxY: a"+b[3]+"};")}};Uc.default=mg;var Uh=function(b,c,f){var k=b*c,d=Jm*b;d-=d-b;b-=d;var g=Jm*c;g-=g-c;c-=g;c=b*c-(k-d*g-b*g-d*c);return f?(f[0]=c,f[1]=k,f):[c,k]},Jm=+(Math.pow(2,27)+1),Xo=function(b,c){var f=0|b.length,
k=0|c.length;if(1===f&&1===k)return b=b[0],f=c[0],c=b+f,k=c-b,c=(b=b-(c-k)+(f-k))?[b,c]:[c],c;var d,g,l=Array(f+k),h=0,m=0,q=0,p=Math.abs,r=b[m],v=p(r),A=c[q],u=p(A);v<u?(g=r,(m+=1)<f&&(r=b[m],v=p(r))):(g=A,(q+=1)<k&&(A=c[q],u=p(A)));m<f&&v<u||q>=k?(d=r,(m+=1)<f&&(r=b[m],v=p(r))):(d=A,(q+=1)<k&&(A=c[q],u=p(A)));for(var y,C,w=d+g,x,B=g-(w-d),E=w;m<f&&q<k;)v<u?(d=r,(m+=1)<f&&(r=b[m],v=p(r))):(d=A,(q+=1)<k&&(A=c[q],u=p(A))),(x=(g=B)-((w=d+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y;for(;m<f;)(x=
(g=B)-((w=(d=r)+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y,(m+=1)<f&&(r=b[m]);for(;q<k;)(x=(g=B)-((w=(d=A)+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y,(q+=1)<k&&(A=c[q]);B&&(l[h++]=B);E&&(l[h++]=E);h||(l[h++]=0);return l.length=h,l},Yo=function(b,c){var f=b.length;if(1===f)return b=Uh(b[0],c),b[0]?b:[b[1]];var k=Array(2*f),d=[.1,.1],g=[.1,.1],l=0;Uh(b[0],c,d);d[0]&&(k[l++]=d[0]);for(var h=1;h<f;++h){Uh(b[h],c,g);var m=d[1];var q=g[0],p=d,r=m+q,v=r-m;q-=v;m-=r-v;p&&(p[0]=m+q,p[1]=r);
d[0]&&(k[l++]=d[0]);r=g[1];m=d[1];p=r+m;r=m-(p-r);d[1]=p;r&&(k[l++]=r)}d[1]&&(k[l++]=d[1]);0===l&&(k[l++]=0);return k.length=l,k},Zo=function(b,c){var f=0|b.length,k=0|c.length;if(1===f&&1===k)return b=b[0],f=-c[0],c=b+f,k=c-b,c=(b=b-(c-k)+(f-k))?[b,c]:[c],c;var d,g,l=Array(f+k),h=0,m=0,q=0,p=Math.abs,r=b[m],v=p(r),A=-c[q],u=p(A);v<u?(g=r,(m+=1)<f&&(r=b[m],v=p(r))):(g=A,(q+=1)<k&&(A=-c[q],u=p(A)));m<f&&v<u||q>=k?(d=r,(m+=1)<f&&(r=b[m],v=p(r))):(d=A,(q+=1)<k&&(A=-c[q],u=p(A)));for(var y,C,w=d+g,x,
B=g-(w-d),E=w;m<f&&q<k;)v<u?(d=r,(m+=1)<f&&(r=b[m],v=p(r))):(d=A,(q+=1)<k&&(A=-c[q],u=p(A))),(x=(g=B)-((w=d+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y;for(;m<f;)(x=(g=B)-((w=(d=r)+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y,(m+=1)<f&&(r=b[m]);for(;q<k;)(x=(g=B)-((w=(d=A)+g)-d))&&(l[h++]=x),B=E-((y=E+w)-(C=y-E))+(w-C),E=y,(q+=1)<k&&(A=-c[q]);B&&(l[h++]=B);E&&(l[h++]=E);h||(l[h++]=0);return l.length=h,l},Km=ie(function(b){function c(q,p){for(var r=Array(q.length-1),v=1;v<q.length;++v)for(var A=
r[v-1]=Array(q.length-1),u=0,y=0;u<q.length;++u)u!==p&&(A[y++]=q[v][u]);return r}function f(q){if(1===q.length)return q[0];if(2===q.length)return["sum(",q[0],",",q[1],")"].join("");var p=q.length>>1;return["sum(",f(q.slice(0,p)),",",f(q.slice(p)),")"].join("")}function k(q){if(2===q.length)return[["sum(prod(",q[0][0],",",q[1][1],"),prod(-",q[0][1],",",q[1][0],"))"].join("")];for(var p=[],r=0;r<q.length;++r)p.push(["scale(",f(k(c(q,r))),",",(v=r,1&v?"-":""),q[0][r],")"].join(""));return p;var v}function d(q){for(var p=
[],r=[],v=Array(q),A=0;A<q;++A){v[A]=Array(q);for(var u=0;u<q;++u)v[A][u]=["m",u,"[",q-A-1,"]"].join("")}A=[];for(u=0;u<q;++u)0==(1&u)?p.push.apply(p,k(c(v,u))):r.push.apply(r,k(c(v,u))),A.push("m"+u);p=f(p);r=f(r);q="orientation"+q+"Exact";q=["function ",q,"(",A.join(),"){var p=",p,",n=",r,",d=sub(p,n);return d[d.length-1];};return ",q].join("");return(new Function("sum","prod","scale","sub",q))(Xo,Uh,Yo,Zo)}function g(q){var p=m[q.length];return p||=m[q.length]=d(q.length),p.apply(void 0,q)}var l=
d(3),h=d(4),m=[function(){return 0},function(){return 0},function(q,p){return p[0]-q[0]},function(q,p,r){var v=(q[1]-r[1])*(p[0]-r[0]);var A=(q[0]-r[0])*(p[1]-r[1]),u=v-A;if(0<v){if(0>=A)return u;v+=A}else{if(!(0>v)||0<=A)return u;v=-(v+A)}v*=3.3306690738754716E-16;return u>=v||u<=-v?u:l(q,p,r)},function(q,p,r,v){var A=q[0]-v[0],u=p[0]-v[0],y=r[0]-v[0],C=q[1]-v[1],w=p[1]-v[1],x=r[1]-v[1],B=q[2]-v[2],E=p[2]-v[2],H=r[2]-v[2],P=u*x,T=y*w;y*=C;x*=A;A*=w;C*=u;u=B*(P-T)+E*(y-x)+H*(A-C);B=7.771561172376103E-16*
((Math.abs(P)+Math.abs(T))*Math.abs(B)+(Math.abs(y)+Math.abs(x))*Math.abs(E)+(Math.abs(A)+Math.abs(C))*Math.abs(H));return u>B||-u>B?u:h(q,p,r,v)}];!function(){for(;5>=m.length;)m.push(d(m.length));for(var q=[],p=["slow"],r=0;5>=r;++r)q.push("a"+r),p.push("o"+r);var v=["function getOrientation(",q.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(r=2;5>=r;++r)v.push("case ",r,":return o",r,"(",q.slice(0,r).join(),");");v.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation");
p.push(v.join(""));q=Function.apply(void 0,p);b.exports=q.apply(void 0,[g].concat(m));for(r=0;5>=r;++r)b.exports[r]=m[r]}()}),En=function(b){var c=b.length;if(3>c){for(var f=Array(c),k=0;k<c;++k)f[k]=k;return 2===c&&b[0][0]===b[1][0]&&b[0][1]===b[1][1]?[0]:f}f=Array(c);for(k=0;k<c;++k)f[k]=k;f.sort(function(q,p){return b[q][0]-b[p][0]||b[q][1]-b[p][1]});var d=[f[0],f[1]],g=[f[0],f[1]];for(k=2;k<c;++k){for(var l=f[k],h=b[l],m=d.length;1<m&&0>=Lm(b[d[m-2]],b[d[m-1]],h);)--m,d.pop();d.push(l);for(m=
g.length;1<m&&0<=Lm(b[g[m-2]],b[g[m-1]],h);)--m,g.pop();g.push(l)}f=Array(g.length+d.length-2);c=0;for(l=(k=0,d.length);k<l;++k)f[c++]=d[k];for(k=g.length-2;0<k;--k)f[c++]=g[k];return f},Lm=Km[3],Yj=pg;pg.prototype={push:function(b){this.data.push(b);this.length++;this._up(this.length-1)},pop:function(){if(0!==this.length){var b=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),b}},peek:function(){return this.data[0]},_up:function(b){for(var c=
this.data,f=this.compare,k=c[b];0<b;){var d=b-1>>1,g=c[d];if(0<=f(k,g))break;c[b]=g;b=d}c[b]=k},_down:function(b){for(var c=this.data,f=this.compare,k=this.length>>1,d=c[b];b<k;){var g=1+(b<<1),l=g+1,h=c[g];if(l<this.length&&0>f(c[l],h)&&(g=l,h=c[l]),0<=f(h,d))break;c[b]=h;b=g}c[b]=d}};Yj.default=pg;var sh=Km[3],ck=Wj;ck.default=Wj;var fk=function(b,c,f){this.a=b;this.b=c;this.c=f;var k=c.x-b.x;var d=c.y-b.y,g=f.x-b.x,l=f.y-b.y,h=k*(b.x+c.x)+d*(b.y+c.y),m=g*(b.x+f.x)+l*(b.y+f.y);c=2*(k*(f.y-c.y)-
d*(f.x-c.x));this.x=(l*h-d*m)/c;this.y=(k*m-g*h)/c;k=this.x-b.x;b=this.y-b.y;this.r=k*k+b*b},vh=Object.prototype.hasOwnProperty,Mm=new ArrayBuffer(16),kk=new Float64Array(Mm),uh=new Uint32Array(Mm),Un=function(){function b(c){this.points=c.points||[];this.duration=c.duration||1E4;this.sharpness=c.sharpness||.85;this.centers=[];this.controls=[];this.stepLength=c.stepLength||60;this.length=this.points.length;for(c=this.delay=0;c<this.length;c++)this.points[c].z=this.points[c].z||0;for(c=0;c<this.length-
1;c++){var f=this.points[c],k=this.points[c+1];this.centers.push({x:(f.x+k.x)/2,y:(f.y+k.y)/2,z:(f.z+k.z)/2})}this.controls.push([this.points[0],this.points[0]]);for(c=0;c<this.centers.length-1;c++){f=this.points[c+1].x-(this.centers[c].x+this.centers[c+1].x)/2;k=this.points[c+1].y-(this.centers[c].y+this.centers[c+1].y)/2;var d=this.points[c+1].z-(this.centers[c].y+this.centers[c+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[c+1].x+this.sharpness*(this.centers[c].x+f),y:(1-this.sharpness)*
this.points[c+1].y+this.sharpness*(this.centers[c].y+k),z:(1-this.sharpness)*this.points[c+1].z+this.sharpness*(this.centers[c].z+d)},{x:(1-this.sharpness)*this.points[c+1].x+this.sharpness*(this.centers[c+1].x+f),y:(1-this.sharpness)*this.points[c+1].y+this.sharpness*(this.centers[c+1].y+k),z:(1-this.sharpness)*this.points[c+1].z+this.sharpness*(this.centers[c+1].z+d)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),
this}return b.prototype.cacheSteps=function(c){var f=[],k=this.pos(0);f.push(0);for(var d=0;d<this.duration;d+=10){var g=this.pos(d);Math.sqrt((g.x-k.x)*(g.x-k.x)+(g.y-k.y)*(g.y-k.y)+(g.z-k.z)*(g.z-k.z))>c&&(f.push(d),k=g)}return f},b.prototype.vector=function(c){var f=this.pos(c+10);c=this.pos(c-10);return{angle:180*Math.atan2(f.y-c.y,f.x-c.x)/3.14,speed:Math.sqrt((c.x-f.x)*(c.x-f.x)+(c.y-f.y)*(c.y-f.y)+(c.z-f.z)*(c.z-f.z))}},b.prototype.pos=function(c){c-=this.delay;0>c&&(c=0);c>this.duration&&
(c=this.duration-1);c/=this.duration;if(1<=c)return this.points[this.length-1];var f=Math.floor((this.points.length-1)*c),k=(this.length-1)*c-f;c=this.points[f];var d=this.controls[f][1],g=this.controls[f+1][0];f=this.points[f+1];var l=k*k;k=[l*k,3*l*(1-k),3*k*(1-k)*(1-k),(1-k)*(1-k)*(1-k)];return{x:f.x*k[0]+g.x*k[1]+d.x*k[2]+c.x*k[3],y:f.y*k[0]+g.y*k[1]+d.y*k[2]+c.y*k[3],z:f.z*k[0]+g.z*k[1]+d.z*k[2]+c.z*k[3]}},b}(),yk=yh;yh.deviation=function(b,c,f,k){var d=c&&c.length,g=Math.abs(Ei(b,0,d?c[0]*f:
b.length,f));if(d){d=0;for(var l=c.length;d<l;d++)g-=Math.abs(Ei(b,c[d]*f,d<l-1?c[d+1]*f:b.length,f))}for(d=c=0;d<k.length;d+=3){l=k[d]*f;var h=k[d+1]*f,m=k[d+2]*f;c+=Math.abs((b[l]-b[m])*(b[h+1]-b[l+1])-(b[l]-b[h])*(b[m+1]-b[l+1]))}return 0===g&&0===c?0:Math.abs((c-g)/g)};yh.flatten=function(b){for(var c=b[0][0].length,f={vertices:[],holes:[],dimensions:c},k=0,d=0;d<b.length;d++){for(var g=0;g<b[d].length;g++)for(var l=0;l<c;l++)f.vertices.push(b[d][g][l]);0<d&&(k+=b[d-1].length,f.holes.push(k))}return f};
yk.default=yh;var Ec=ie(function(b,c){function f(u,y,C){void 0===C&&(C={});var w={type:"Feature"};return(0===C.id||C.id)&&(w.id=C.id),C.bbox&&(w.bbox=C.bbox),w.properties=y||{},w.geometry=u,w}function k(u,y,C){if(void 0===C&&(C={}),!u)throw Error("coordinates is required");if(!Array.isArray(u))throw Error("coordinates must be an Array");if(2>u.length)throw Error("coordinates must be at least 2 numbers long");if(!A(u[0])||!A(u[1]))throw Error("coordinates must contain numbers");return f({type:"Point",
coordinates:u},y,C)}function d(u,y,C){void 0===C&&(C={});for(var w=0;w<u.length;w++){var x=u[w];if(4>x.length)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var B=0;B<x[x.length-1].length;B++)if(x[x.length-1][B]!==x[0][B])throw Error("First and last Position are not equivalent.");}return f({type:"Polygon",coordinates:u},y,C)}function g(u,y,C){if(void 0===C&&(C={}),2>u.length)throw Error("coordinates must be an array of two or more positions");return f({type:"LineString",
coordinates:u},y,C)}function l(u,y){void 0===y&&(y={});var C={type:"FeatureCollection"};return y.id&&(C.id=y.id),y.bbox&&(C.bbox=y.bbox),C.features=u,C}function h(u,y,C){return void 0===C&&(C={}),f({type:"MultiLineString",coordinates:u},y,C)}function m(u,y,C){return void 0===C&&(C={}),f({type:"MultiPoint",coordinates:u},y,C)}function q(u,y,C){return void 0===C&&(C={}),f({type:"MultiPolygon",coordinates:u},y,C)}function p(u,y){void 0===y&&(y="kilometers");var C=c.factors[y];if(!C)throw Error(y+" units is invalid");
return u*C}function r(u,y){void 0===y&&(y="kilometers");var C=c.factors[y];if(!C)throw Error(y+" units is invalid");return u/C}function v(u){return u%(2*Math.PI)*180/Math.PI}function A(u){return!isNaN(u)&&null!==u&&!Array.isArray(u)}Object.defineProperty(c,"__esModule",{value:!0});c.earthRadius=6371008.8;c.factors={centimeters:100*c.earthRadius,centimetres:100*c.earthRadius,degrees:c.earthRadius/111325,feet:3.28084*c.earthRadius,inches:39.37*c.earthRadius,kilometers:c.earthRadius/1E3,kilometres:c.earthRadius/
1E3,meters:c.earthRadius,metres:c.earthRadius,miles:c.earthRadius/1609.344,millimeters:1E3*c.earthRadius,millimetres:1E3*c.earthRadius,nauticalmiles:c.earthRadius/1852,radians:1,yards:1.0936*c.earthRadius};c.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1E3,millimetres:1E3,nauticalmiles:1/1852,radians:1/c.earthRadius,yards:1.0936133};c.areaFactors={acres:2.47105E-4,centimeters:1E4,
centimetres:1E4,feet:10.763910417,hectares:1E-4,inches:1550.003100006,kilometers:1E-6,kilometres:1E-6,meters:1,metres:1,miles:3.86E-7,millimeters:1E6,millimetres:1E6,yards:1.195990046};c.feature=f;c.geometry=function(u,y,C){switch(u){case "Point":return k(y).geometry;case "LineString":return g(y).geometry;case "Polygon":return d(y).geometry;case "MultiPoint":return m(y).geometry;case "MultiLineString":return h(y).geometry;case "MultiPolygon":return q(y).geometry;default:throw Error(u+" is invalid");
}};c.point=k;c.points=function(u,y,C){return void 0===C&&(C={}),l(u.map(function(w){return k(w,y)}),C)};c.polygon=d;c.polygons=function(u,y,C){return void 0===C&&(C={}),l(u.map(function(w){return d(w,y)}),C)};c.lineString=g;c.lineStrings=function(u,y,C){return void 0===C&&(C={}),l(u.map(function(w){return g(w,y)}),C)};c.featureCollection=l;c.multiLineString=h;c.multiPoint=m;c.multiPolygon=q;c.geometryCollection=function(u,y,C){return void 0===C&&(C={}),f({type:"GeometryCollection",geometries:u},y,
C)};c.round=function(u,y){if(void 0===y&&(y=0),y&&!(0<=y))throw Error("precision must be a positive number");y=Math.pow(10,y||0);return Math.round(u*y)/y};c.radiansToLength=p;c.lengthToRadians=r;c.lengthToDegrees=function(u,y){return v(r(u,y))};c.bearingToAzimuth=function(u){u%=360;return 0>u&&(u+=360),u};c.radiansToDegrees=v;c.degreesToRadians=function(u){return u%360*Math.PI/180};c.convertLength=function(u,y,C){if(void 0===y&&(y="kilometers"),void 0===C&&(C="kilometers"),!(0<=u))throw Error("length must be a positive number");
return p(r(u,y),C)};c.convertArea=function(u,y,C){if(void 0===y&&(y="meters"),void 0===C&&(C="kilometers"),!(0<=u))throw Error("area must be a positive number");y=c.areaFactors[y];if(!y)throw Error("invalid original units");C=c.areaFactors[C];if(!C)throw Error("invalid final units");return u/y*C};c.isNumber=A;c.isObject=function(u){return!!u&&u.constructor===Object};c.validateBBox=function(u){if(!u)throw Error("bbox is required");if(!Array.isArray(u))throw Error("bbox must be an Array");if(4!==u.length&&
6!==u.length)throw Error("bbox must be an Array of 4 or 6 numbers");u.forEach(function(y){if(!A(y))throw Error("bbox must only contain numbers");})};c.validateId=function(u){if(!u)throw Error("id is required");if(-1===["string","number"].indexOf(typeof u))throw Error("id must be a number or a string");}}),Ji=Object.defineProperty({coordAll:function(b){var c=[];return ug(b,function(f){c.push(f)}),c},coordEach:ug,coordReduce:function(b,c,f,k){var d=f;return ug(b,function(g,l,h,m,q){d=0===l&&void 0===
f?g:c(d,g,l,h,m,q)},k),d},featureEach:Ak,featureReduce:function(b,c,f){var k=f;return Ak(b,function(d,g){k=0===g&&void 0===f?d:c(k,d,g)}),k},findPoint:function(b,c){if(c=c||{},!Ec.isObject(c))throw Error("options is invalid");var f=c.featureIndex||0,k=c.multiFeatureIndex||0,d=c.geometryIndex||0,g=c.coordIndex||0,l=c.properties;switch(b.type){case "FeatureCollection":0>f&&(f=b.features.length+f);l=l||b.features[f].properties;b=b.features[f].geometry;break;case "Feature":l=l||b.properties;b=b.geometry;
break;case "Point":case "MultiPoint":return null;case "LineString":case "Polygon":case "MultiLineString":case "MultiPolygon":break;default:throw Error("geojson is invalid");}if(null===b)return null;f=b.coordinates;switch(b.type){case "Point":return Ec.point(f,l,c);case "MultiPoint":return 0>k&&(k=f.length+k),Ec.point(f[k],l,c);case "LineString":return 0>g&&(g=f.length+g),Ec.point(f[g],l,c);case "Polygon":return 0>d&&(d=f.length+d),0>g&&(g=f[d].length+g),Ec.point(f[d][g],l,c);case "MultiLineString":return 0>
k&&(k=f.length+k),0>g&&(g=f[k].length+g),Ec.point(f[k][g],l,c);case "MultiPolygon":return 0>k&&(k=f.length+k),0>d&&(d=f[k].length+d),0>g&&(g=f[k][d].length-g),Ec.point(f[k][d][g],l,c)}throw Error("geojson is invalid");},findSegment:function(b,c){if(c=c||{},!Ec.isObject(c))throw Error("options is invalid");var f=c.featureIndex||0,k=c.multiFeatureIndex||0,d=c.geometryIndex||0,g=c.segmentIndex||0,l=c.properties;switch(b.type){case "FeatureCollection":0>f&&(f=b.features.length+f);l=l||b.features[f].properties;
b=b.features[f].geometry;break;case "Feature":l=l||b.properties;b=b.geometry;break;case "Point":case "MultiPoint":return null;case "LineString":case "Polygon":case "MultiLineString":case "MultiPolygon":break;default:throw Error("geojson is invalid");}if(null===b)return null;f=b.coordinates;switch(b.type){case "Point":case "MultiPoint":return null;case "LineString":return 0>g&&(g=f.length+g-1),Ec.lineString([f[g],f[g+1]],l,c);case "Polygon":return 0>d&&(d=f.length+d),0>g&&(g=f[d].length+g-1),Ec.lineString([f[d][g],
f[d][g+1]],l,c);case "MultiLineString":return 0>k&&(k=f.length+k),0>g&&(g=f[k].length+g-1),Ec.lineString([f[k][g],f[k][g+1]],l,c);case "MultiPolygon":return 0>k&&(k=f.length+k),0>d&&(d=f[k].length+d),0>g&&(g=f[k][d].length-g-1),Ec.lineString([f[k][d][g],f[k][d][g+1]],l,c)}throw Error("geojson is invalid");},flattenEach:Ah,flattenReduce:function(b,c,f){var k=f;return Ah(b,function(d,g,l){k=0===g&&0===l&&void 0===f?d:c(k,d,g,l)}),k},geomEach:Hi,geomReduce:function(b,c,f){var k=f;return Hi(b,function(d,
g,l,h,m){k=0===g&&void 0===f?d:c(k,d,g,l,h,m)}),k},lineEach:Ck,lineReduce:function(b,c,f){var k=f;return Ck(b,function(d,g,l,h){k=0===g&&void 0===f?d:c(k,d,g,l,h)}),k},propEach:zk,propReduce:function(b,c,f){var k=f;return zk(b,function(d,g){k=0===g&&void 0===f?d:c(k,d,g)}),k},segmentEach:Bk,segmentReduce:function(b,c,f){var k=f,d=!1;return Bk(b,function(g,l,h,m,q){k=!1===d&&void 0===f?g:c(k,g,l,h,m,q);d=!0}),k}},"__esModule",{value:!0});Ii.default=Ii;var vg=Object.defineProperty({default:Ii},"__esModule",
{value:!0}).default,Yn=Ji.featureEach,Ek=(Ji.coordEach,Ec.polygon,Ec.featureCollection),wg=Dk;wg.default=Dk;var Rk=function(b,c,f,k,d){this.coord=b;this.param=c;this.ringAndEdgeIn=f;this.ringAndEdgeOut=k;this.nxtIsectAlongEdgeIn=d},Sk=function(b,c,f,k,d,g,l){this.coord=b;this.ringAndEdge1=c;this.ringAndEdge2=f;this.nxtIsectAlongRingAndEdge1=k;this.nxtIsectAlongRingAndEdge2=d;this.ringAndEdge1Walkable=g;this.ringAndEdge2Walkable=l},Nm=Math.PI/180,Om=180/Math.PI,Lg=function(b,c){this.lon=b;this.lat=
c;this.x=Nm*b;this.y=Nm*c};Lg.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)};Lg.prototype.antipode=function(){return new Lg(0>this.lon?180+this.lon:-1*(180-this.lon),-1*this.lat)};var Pm=function(){this.coords=[];this.length=0};Pm.prototype.move_to=function(b){this.length++;this.coords.push(b)};var sj=function(b){this.properties=b||{};this.geometries=[]};sj.prototype.json=function(){if(0>=this.geometries.length)return{geometry:{type:"LineString",coordinates:null},
type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var b=[],c=0;c<this.geometries.length;c++)b.push(this.geometries[c].coords);return{geometry:{type:"MultiLineString",coordinates:b},type:"Feature",properties:this.properties}};sj.prototype.wkt=function(){for(var b="",c="LINESTRING(",f=function(d){c+=d[0]+" "+d[1]+","},k=0;k<this.geometries.length;k++){if(0===
this.geometries[k].coords.length)return"LINESTRING(empty)";this.geometries[k].coords.forEach(f);b+=c.substring(0,c.length-1)+")"}return b};var tj=function(b,c,f){if(!b||void 0===b.x||void 0===b.y)throw Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!c||void 0===c.x||void 0===c.y)throw Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Lg(b.x,b.y);this.end=new Lg(c.x,c.y);this.properties=
f||{};if(this.g=2*Math.asin(Math.sqrt(Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin((this.start.x-this.end.x)/2),2))),this.g===Math.PI)throw Error("it appears "+b.view()+" and "+c.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw Error("could not calculate great circle between "+b+" and "+c);};tj.prototype.interpolate=function(b){var c=Math.sin((1-b)*this.g)/
Math.sin(this.g);b=Math.sin(b*this.g)/Math.sin(this.g);var f=c*Math.cos(this.start.y)*Math.cos(this.start.x)+b*Math.cos(this.end.y)*Math.cos(this.end.x),k=c*Math.cos(this.start.y)*Math.sin(this.start.x)+b*Math.cos(this.end.y)*Math.sin(this.end.x);return[Om*Math.atan2(k,f),Om*Math.atan2(c*Math.sin(this.start.y)+b*Math.sin(this.end.y),Math.sqrt(Math.pow(f,2)+Math.pow(k,2)))]};tj.prototype.Arc=function(b,c){var f=[];if(!b||2>=b)f.push([this.start.lon,this.start.lat]),f.push([this.end.lon,this.end.lat]);
else for(var k=1/(b-1),d=0;d<b;++d){var g=this.interpolate(k*d);f.push(g)}g=!1;var l=0,h=c&&c.offset?c.offset:10;b=180-h;k=-180+h;d=360-h;for(c=1;c<f.length;++c){var m=f[c-1][0],q=f[c][0],p=Math.abs(q-m);p>d&&(q>b&&m<k||m>b&&q<k)?g=!0:p>l&&(l=p)}c=[];if(g&&l<h)for(g=[],c.push(g),l=0;l<f.length;++l)if(h=parseFloat(f[l][0]),0<l&&Math.abs(h-f[l-1][0])>d){p=parseFloat(f[l-1][0]);m=parseFloat(f[l-1][1]);var r=parseFloat(f[l][0]);q=parseFloat(f[l][1]);if(-180<p&&p<k&&180===r&&l+1<f.length&&-180<f[l-1][0]&&
f[l-1][0]<k)g.push([-180,f[l][1]]),l++,g.push([f[l][0],f[l][1]]);else if(p>b&&180>p&&-180===r&&l+1<f.length&&f[l-1][0]>b&&180>f[l-1][0])g.push([180,f[l][1]]),l++,g.push([f[l][0],f[l][1]]);else{if(p<k&&r>b){var v=p;p=r;r=v;v=m;m=q;q=v}(p>b&&r<k&&(r+=360),180>=p&&180<=r&&p<r)?(p=(180-p)/(r-p),m=p*q+(1-p)*m,g.push([f[l-1][0]>b?180:-180,m]),(g=[]).push([f[l-1][0]>b?-180:180,m])):g=[];c.push(g);g.push([h,f[l][1]])}}else g.push([f[l][0],f[l][1]]);else for(b=[],c.push(b),k=0;k<f.length;++k)b.push([f[k][0],
f[k][1]]);f=new sj(this.properties);for(b=0;b<c.length;++b)for(k=new Pm,f.geometries.push(k),d=c[b],g=0;g<d.length;++g)k.move_to(d[g]);return f};var Qm=ie(function(b,c){function f(k){var d=[],g;for(g in k)d.push(g);return d}(b.exports="function"==typeof Object.keys?Object.keys:f).shim=f}),Rm=ie(function(b,c){function f(d){return"[object Arguments]"==Object.prototype.toString.call(d)}function k(d){return d&&"object"==typeof d&&"number"==typeof d.length&&Object.prototype.hasOwnProperty.call(d,"callee")&&
!Object.prototype.propertyIsEnumerable.call(d,"callee")||!1}c="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(c=b.exports=c?f:k).supported=f;c.unsupported=k}),Gf=ie(function(b){function c(d){return!(!d||"object"!=typeof d||"number"!=typeof d.length)&&"function"==typeof d.copy&&"function"==typeof d.slice&&!(0<d.length&&"number"!=typeof d[0])}var f=Array.prototype.slice,k=b.exports=function(d,g,l){return l||={},d===g||(d instanceof Date&&g instanceof Date?d.getTime()===
g.getTime():!d||!g||"object"!=typeof d&&"object"!=typeof g?l.strict?d===g:d==g:function(h,m,q){var p,r;if(null==h||null==m||h.prototype!==m.prototype)return!1;if(Rm(h))return!!Rm(m)&&(h=f.call(h),m=f.call(m),k(h,m,q));if(c(h)){if(!c(m)||h.length!==m.length)return!1;for(p=0;p<h.length;p++)if(h[p]!==m[p])return!1;return!0}try{var v=Qm(h),A=Qm(m)}catch(u){return!1}if(v.length!=A.length)return!1;v.sort();A.sort();for(p=v.length-1;0<=p;p--)if(v[p]!=A[p])return!1;for(p=v.length-1;0<=p;p--)if(r=v[p],!k(h[r],
m[r],q))return!1;return typeof h==typeof m}(d,g,l))}}),il={successCallback:null,verbose:!1,polygons:!1},mf={},Nc=64,Rd=16,rb=[],sb=[],tb=[],ub=[],vb=[],wb=[],ib=[],jb=[],kb=[],fb=[],gb=[],hb=[],xb=[],yb=[],zb=[],Ab=[],Bb=[],Cb=[],ob=[],pb=[],qb=[],lb=[],mb=[],nb=[];ib[85]=fb[85]=-1;jb[85]=gb[85]=0;kb[85]=hb[85]=1;ob[85]=lb[85]=1;pb[85]=mb[85]=0;qb[85]=nb[85]=1;rb[85]=ub[85]=0;sb[85]=vb[85]=-1;tb[85]=zb[85]=0;Ab[85]=xb[85]=0;Bb[85]=yb[85]=1;wb[85]=Cb[85]=1;lb[1]=lb[169]=0;mb[1]=mb[169]=-1;nb[1]=nb[169]=
0;xb[1]=xb[169]=-1;yb[1]=yb[169]=0;zb[1]=zb[169]=0;fb[4]=fb[166]=0;gb[4]=gb[166]=-1;hb[4]=hb[166]=1;Ab[4]=Ab[166]=1;Bb[4]=Bb[166]=0;Cb[4]=Cb[166]=0;ib[16]=ib[154]=0;jb[16]=jb[154]=1;kb[16]=kb[154]=1;ub[16]=ub[154]=1;vb[16]=vb[154]=0;wb[16]=wb[154]=1;ob[64]=ob[106]=0;pb[64]=pb[106]=1;qb[64]=qb[106]=0;rb[64]=rb[106]=-1;sb[64]=sb[106]=0;tb[64]=tb[106]=1;ob[2]=ob[168]=0;pb[2]=pb[168]=-1;qb[2]=qb[168]=1;lb[2]=lb[168]=0;mb[2]=mb[168]=-1;nb[2]=nb[168]=0;xb[2]=xb[168]=-1;yb[2]=yb[168]=0;zb[2]=zb[168]=0;Ab[2]=
Ab[168]=-1;Bb[2]=Bb[168]=0;Cb[2]=Cb[168]=1;ib[8]=ib[162]=0;jb[8]=jb[162]=-1;kb[8]=kb[162]=0;fb[8]=fb[162]=0;gb[8]=gb[162]=-1;hb[8]=hb[162]=1;xb[8]=xb[162]=1;yb[8]=yb[162]=0;zb[8]=zb[162]=1;Ab[8]=Ab[162]=1;Bb[8]=Bb[162]=0;Cb[8]=Cb[162]=0;ib[32]=ib[138]=0;jb[32]=jb[138]=1;kb[32]=kb[138]=1;fb[32]=fb[138]=0;gb[32]=gb[138]=1;hb[32]=hb[138]=0;rb[32]=rb[138]=1;sb[32]=sb[138]=0;tb[32]=tb[138]=0;ub[32]=ub[138]=1;vb[32]=vb[138]=0;wb[32]=wb[138]=1;lb[128]=lb[42]=0;mb[128]=mb[42]=1;nb[128]=nb[42]=1;ob[128]=ob[42]=
0;pb[128]=pb[42]=1;qb[128]=qb[42]=0;rb[128]=rb[42]=-1;sb[128]=sb[42]=0;tb[128]=tb[42]=1;ub[128]=ub[42]=-1;vb[128]=vb[42]=0;wb[128]=wb[42]=0;fb[5]=fb[165]=-1;gb[5]=gb[165]=0;hb[5]=hb[165]=0;lb[5]=lb[165]=1;mb[5]=mb[165]=0;nb[5]=nb[165]=0;Ab[20]=Ab[150]=0;Bb[20]=Bb[150]=1;Cb[20]=Cb[150]=1;ub[20]=ub[150]=0;vb[20]=vb[150]=-1;wb[20]=wb[150]=1;ib[80]=ib[90]=-1;jb[80]=jb[90]=0;kb[80]=kb[90]=1;ob[80]=ob[90]=1;pb[80]=pb[90]=0;qb[80]=qb[90]=1;xb[65]=xb[105]=0;yb[65]=yb[105]=1;zb[65]=zb[105]=0;rb[65]=rb[105]=
0;sb[65]=sb[105]=-1;tb[65]=tb[105]=0;ib[160]=ib[10]=-1;jb[160]=jb[10]=0;kb[160]=kb[10]=1;fb[160]=fb[10]=-1;gb[160]=gb[10]=0;hb[160]=hb[10]=0;lb[160]=lb[10]=1;mb[160]=mb[10]=0;nb[160]=nb[10]=0;ob[160]=ob[10]=1;pb[160]=pb[10]=0;qb[160]=qb[10]=1;Ab[130]=Ab[40]=0;Bb[130]=Bb[40]=1;Cb[130]=Cb[40]=1;xb[130]=xb[40]=0;yb[130]=yb[40]=1;zb[130]=zb[40]=0;rb[130]=rb[40]=0;sb[130]=sb[40]=-1;tb[130]=tb[40]=0;ub[130]=ub[40]=0;vb[130]=vb[40]=-1;wb[130]=wb[40]=1;fb[37]=fb[133]=0;gb[37]=gb[133]=1;hb[37]=hb[133]=1;lb[37]=
lb[133]=0;mb[37]=mb[133]=1;nb[37]=nb[133]=0;rb[37]=rb[133]=-1;sb[37]=sb[133]=0;tb[37]=tb[133]=0;ub[37]=ub[133]=1;vb[37]=vb[133]=0;wb[37]=wb[133]=0;Ab[148]=Ab[22]=-1;Bb[148]=Bb[22]=0;Cb[148]=Cb[22]=0;lb[148]=lb[22]=0;mb[148]=mb[22]=-1;nb[148]=nb[22]=1;ob[148]=ob[22]=0;pb[148]=pb[22]=1;qb[148]=qb[22]=1;ub[148]=ub[22]=-1;vb[148]=vb[22]=0;wb[148]=wb[22]=1;ib[82]=ib[88]=0;jb[82]=jb[88]=-1;kb[82]=kb[88]=1;Ab[82]=Ab[88]=1;Bb[82]=Bb[88]=0;Cb[82]=Cb[88]=1;xb[82]=xb[88]=-1;yb[82]=yb[88]=0;zb[82]=zb[88]=1;ob[82]=
ob[88]=0;pb[82]=pb[88]=-1;qb[82]=qb[88]=0;ib[73]=ib[97]=0;jb[73]=jb[97]=1;kb[73]=kb[97]=0;fb[73]=fb[97]=0;gb[73]=gb[97]=-1;hb[73]=hb[97]=0;xb[73]=xb[97]=1;yb[73]=yb[97]=0;zb[73]=zb[97]=0;rb[73]=rb[97]=1;sb[73]=sb[97]=0;tb[73]=tb[97]=1;ib[145]=ib[25]=0;jb[145]=jb[25]=-1;kb[145]=kb[25]=0;xb[145]=xb[25]=1;yb[145]=yb[25]=0;zb[145]=zb[25]=1;lb[145]=lb[25]=0;mb[145]=mb[25]=1;nb[145]=nb[25]=1;ub[145]=ub[25]=-1;vb[145]=vb[25]=0;wb[145]=wb[25]=0;fb[70]=fb[100]=0;gb[70]=gb[100]=1;hb[70]=hb[100]=0;Ab[70]=Ab[100]=
-1;Bb[70]=Bb[100]=0;Cb[70]=Cb[100]=1;ob[70]=ob[100]=0;pb[70]=pb[100]=-1;qb[70]=qb[100]=1;rb[70]=rb[100]=1;sb[70]=sb[100]=0;tb[70]=tb[100]=0;fb[101]=fb[69]=0;gb[101]=gb[69]=1;hb[101]=hb[69]=0;rb[101]=rb[69]=1;sb[101]=sb[69]=0;tb[101]=tb[69]=0;lb[149]=lb[21]=0;mb[149]=mb[21]=1;nb[149]=nb[21]=1;ub[149]=ub[21]=-1;vb[149]=vb[21]=0;wb[149]=wb[21]=0;Ab[86]=Ab[84]=-1;Bb[86]=Bb[84]=0;Cb[86]=Cb[84]=1;ob[86]=ob[84]=0;pb[86]=pb[84]=-1;qb[86]=qb[84]=1;ib[89]=ib[81]=0;jb[89]=jb[81]=-1;kb[89]=kb[81]=0;xb[89]=xb[81]=
1;yb[89]=yb[81]=0;zb[89]=zb[81]=1;ib[96]=ib[74]=0;jb[96]=jb[74]=1;kb[96]=kb[74]=0;fb[96]=fb[74]=-1;gb[96]=gb[74]=0;hb[96]=hb[74]=1;ob[96]=ob[74]=1;pb[96]=pb[74]=0;qb[96]=qb[74]=0;rb[96]=rb[74]=1;sb[96]=sb[74]=0;tb[96]=tb[74]=1;ib[24]=ib[146]=0;jb[24]=jb[146]=-1;kb[24]=kb[146]=1;Ab[24]=Ab[146]=1;Bb[24]=Bb[146]=0;Cb[24]=Cb[146]=1;xb[24]=xb[146]=0;yb[24]=yb[146]=1;zb[24]=zb[146]=1;ub[24]=ub[146]=0;vb[24]=vb[146]=-1;wb[24]=wb[146]=0;fb[6]=fb[164]=-1;gb[6]=gb[164]=0;hb[6]=hb[164]=1;Ab[6]=Ab[164]=-1;Bb[6]=
Bb[164]=0;Cb[6]=Cb[164]=0;lb[6]=lb[164]=0;mb[6]=mb[164]=-1;nb[6]=nb[164]=1;ob[6]=ob[164]=1;pb[6]=pb[164]=0;qb[6]=qb[164]=0;xb[129]=xb[41]=0;yb[129]=yb[41]=1;zb[129]=zb[41]=1;lb[129]=lb[41]=0;mb[129]=mb[41]=1;nb[129]=nb[41]=0;rb[129]=rb[41]=-1;sb[129]=sb[41]=0;tb[129]=tb[41]=0;ub[129]=ub[41]=0;vb[129]=vb[41]=-1;wb[129]=wb[41]=0;Ab[66]=Ab[104]=0;Bb[66]=Bb[104]=1;Cb[66]=Cb[104]=0;xb[66]=xb[104]=-1;yb[66]=yb[104]=0;zb[66]=zb[104]=1;ob[66]=ob[104]=0;pb[66]=pb[104]=-1;qb[66]=qb[104]=0;rb[66]=rb[104]=0;
sb[66]=sb[104]=-1;tb[66]=tb[104]=1;ib[144]=ib[26]=-1;jb[144]=jb[26]=0;kb[144]=kb[26]=0;lb[144]=lb[26]=1;mb[144]=mb[26]=0;nb[144]=nb[26]=1;ob[144]=ob[26]=0;pb[144]=pb[26]=1;qb[144]=qb[26]=1;ub[144]=ub[26]=-1;vb[144]=vb[26]=0;wb[144]=wb[26]=1;fb[36]=fb[134]=0;gb[36]=gb[134]=1;hb[36]=hb[134]=1;Ab[36]=Ab[134]=0;Bb[36]=Bb[134]=1;Cb[36]=Cb[134]=0;rb[36]=rb[134]=0;sb[36]=sb[134]=-1;tb[36]=tb[134]=1;ub[36]=ub[134]=1;vb[36]=vb[134]=0;wb[36]=wb[134]=0;ib[9]=ib[161]=-1;jb[9]=jb[161]=0;kb[9]=kb[161]=0;fb[9]=
fb[161]=0;gb[9]=gb[161]=-1;hb[9]=hb[161]=0;xb[9]=xb[161]=1;yb[9]=yb[161]=0;zb[9]=zb[161]=0;lb[9]=lb[161]=1;mb[9]=mb[161]=0;nb[9]=nb[161]=1;ib[136]=0;jb[136]=1;kb[136]=1;fb[136]=0;gb[136]=1;hb[136]=0;Ab[136]=-1;Bb[136]=0;Cb[136]=1;xb[136]=-1;yb[136]=0;zb[136]=0;lb[136]=0;mb[136]=-1;nb[136]=0;ob[136]=0;pb[136]=-1;qb[136]=1;rb[136]=1;sb[136]=0;tb[136]=0;ub[136]=1;vb[136]=0;wb[136]=1;ib[34]=0;jb[34]=-1;kb[34]=0;fb[34]=0;gb[34]=-1;hb[34]=1;Ab[34]=1;Bb[34]=0;Cb[34]=0;xb[34]=1;yb[34]=0;zb[34]=1;lb[34]=0;
mb[34]=1;nb[34]=1;ob[34]=0;pb[34]=1;qb[34]=0;rb[34]=-1;sb[34]=0;tb[34]=1;ub[34]=-1;vb[34]=0;wb[34]=0;ib[35]=0;jb[35]=1;kb[35]=1;fb[35]=0;gb[35]=-1;hb[35]=1;Ab[35]=1;Bb[35]=0;Cb[35]=0;xb[35]=-1;yb[35]=0;zb[35]=0;lb[35]=0;mb[35]=-1;nb[35]=0;ob[35]=0;pb[35]=1;qb[35]=0;rb[35]=-1;sb[35]=0;tb[35]=1;ub[35]=1;vb[35]=0;wb[35]=1;ib[153]=0;jb[153]=1;kb[153]=1;xb[153]=-1;yb[153]=0;zb[153]=0;lb[153]=0;mb[153]=-1;nb[153]=0;ub[153]=1;vb[153]=0;wb[153]=1;fb[102]=0;gb[102]=-1;hb[102]=1;Ab[102]=1;Bb[102]=0;Cb[102]=
0;ob[102]=0;pb[102]=1;qb[102]=0;rb[102]=-1;sb[102]=0;tb[102]=1;ib[155]=0;jb[155]=-1;kb[155]=0;xb[155]=1;yb[155]=0;zb[155]=1;lb[155]=0;mb[155]=1;nb[155]=1;ub[155]=-1;vb[155]=0;wb[155]=0;fb[103]=0;gb[103]=1;hb[103]=0;Ab[103]=-1;Bb[103]=0;Cb[103]=1;ob[103]=0;pb[103]=-1;qb[103]=1;rb[103]=1;sb[103]=0;tb[103]=0;ib[152]=0;jb[152]=1;kb[152]=1;Ab[152]=-1;Bb[152]=0;Cb[152]=1;xb[152]=-1;yb[152]=0;zb[152]=0;lb[152]=0;mb[152]=-1;nb[152]=0;ob[152]=0;pb[152]=-1;qb[152]=1;ub[152]=1;vb[152]=0;wb[152]=1;ib[156]=0;
jb[156]=-1;kb[156]=1;Ab[156]=1;Bb[156]=0;Cb[156]=1;xb[156]=-1;yb[156]=0;zb[156]=0;lb[156]=0;mb[156]=-1;nb[156]=0;ob[156]=0;pb[156]=1;qb[156]=1;ub[156]=-1;vb[156]=0;wb[156]=1;ib[137]=0;jb[137]=1;kb[137]=1;fb[137]=0;gb[137]=1;hb[137]=0;xb[137]=-1;yb[137]=0;zb[137]=0;lb[137]=0;mb[137]=-1;nb[137]=0;rb[137]=1;sb[137]=0;tb[137]=0;ub[137]=1;vb[137]=0;wb[137]=1;ib[139]=0;jb[139]=1;kb[139]=1;fb[139]=0;gb[139]=-1;hb[139]=0;xb[139]=1;yb[139]=0;zb[139]=0;lb[139]=0;mb[139]=1;nb[139]=0;rb[139]=-1;sb[139]=0;tb[139]=
0;ub[139]=1;vb[139]=0;wb[139]=1;ib[98]=0;jb[98]=-1;kb[98]=0;fb[98]=0;gb[98]=-1;hb[98]=1;Ab[98]=1;Bb[98]=0;Cb[98]=0;xb[98]=1;yb[98]=0;zb[98]=1;ob[98]=0;pb[98]=1;qb[98]=0;rb[98]=-1;sb[98]=0;tb[98]=1;ib[99]=0;jb[99]=1;kb[99]=0;fb[99]=0;gb[99]=-1;hb[99]=1;Ab[99]=1;Bb[99]=0;Cb[99]=0;xb[99]=-1;yb[99]=0;zb[99]=1;ob[99]=0;pb[99]=-1;qb[99]=0;rb[99]=1;sb[99]=0;tb[99]=1;fb[38]=0;gb[38]=-1;hb[38]=1;Ab[38]=1;Bb[38]=0;Cb[38]=0;lb[38]=0;mb[38]=1;nb[38]=1;ob[38]=0;pb[38]=1;qb[38]=0;rb[38]=-1;sb[38]=0;tb[38]=1;ub[38]=
-1;vb[38]=0;wb[38]=0;fb[39]=0;gb[39]=1;hb[39]=1;Ab[39]=-1;Bb[39]=0;Cb[39]=0;lb[39]=0;mb[39]=-1;nb[39]=1;ob[39]=0;pb[39]=1;qb[39]=0;rb[39]=-1;sb[39]=0;tb[39]=1;ub[39]=1;vb[39]=0;wb[39]=0;var uj=function(b){return[[b.bottomleft,0],[0,0],[0,b.leftbottom]]},vj=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0]]},wj=function(b){return[[b.topright,1],[1,1],[1,b.righttop]]},xj=function(b){return[[0,b.lefttop],[0,1],[b.topleft,1]]},yj=function(b){return[[b.bottomright,0],[b.bottomleft,0],[0,b.leftbottom],
[0,b.lefttop]]},zj=function(b){return[[b.bottomright,0],[b.bottomleft,0],[1,b.righttop],[1,b.rightbottom]]},Aj=function(b){return[[1,b.righttop],[1,b.rightbottom],[b.topleft,1],[b.topright,1]]},Bj=function(b){return[[0,b.leftbottom],[0,b.lefttop],[b.topleft,1],[b.topright,1]]},Ha=[],Ga=[],La=[],Ja=[],Ua=[],Ta=[],eb=[],Db=[];Ja[1]=Ua[1]=18;Ja[169]=Ua[169]=18;La[4]=Ga[4]=12;La[166]=Ga[166]=12;Ha[16]=Db[16]=4;Ha[154]=Db[154]=4;Ta[64]=eb[64]=22;Ta[106]=eb[106]=22;La[2]=Ta[2]=17;Ja[2]=Ua[2]=18;La[168]=
Ta[168]=17;Ja[168]=Ua[168]=18;Ha[8]=Ja[8]=9;Ga[8]=La[8]=12;Ha[162]=Ja[162]=9;Ga[162]=La[162]=12;Ha[32]=Db[32]=4;Ga[32]=eb[32]=1;Ha[138]=Db[138]=4;Ga[138]=eb[138]=1;Ua[128]=Db[128]=21;Ta[128]=eb[128]=22;Ua[42]=Db[42]=21;Ta[42]=eb[42]=22;Ga[5]=Ua[5]=14;Ga[165]=Ua[165]=14;La[20]=Db[20]=6;La[150]=Db[150]=6;Ha[80]=Ta[80]=11;Ha[90]=Ta[90]=11;Ja[65]=eb[65]=3;Ja[105]=eb[105]=3;Ha[160]=Ta[160]=11;Ga[160]=Ua[160]=14;Ha[10]=Ta[10]=11;Ga[10]=Ua[10]=14;La[130]=Db[130]=6;Ja[130]=eb[130]=3;La[40]=Db[40]=6;Ja[40]=
eb[40]=3;Ga[101]=eb[101]=1;Ga[69]=eb[69]=1;Ua[149]=Db[149]=21;Ua[21]=Db[21]=21;La[86]=Ta[86]=17;La[84]=Ta[84]=17;Ha[89]=Ja[89]=9;Ha[81]=Ja[81]=9;Ha[96]=eb[96]=0;Ga[96]=Ta[96]=15;Ha[74]=eb[74]=0;Ga[74]=Ta[74]=15;Ha[24]=La[24]=8;Ja[24]=Db[24]=7;Ha[146]=La[146]=8;Ja[146]=Db[146]=7;Ga[6]=Ta[6]=15;La[6]=Ua[6]=16;Ga[164]=Ta[164]=15;La[164]=Ua[164]=16;Ja[129]=Db[129]=7;Ua[129]=eb[129]=20;Ja[41]=Db[41]=7;Ua[41]=eb[41]=20;La[66]=eb[66]=2;Ja[66]=Ta[66]=19;La[104]=eb[104]=2;Ja[104]=Ta[104]=19;Ha[144]=Ua[144]=
10;Ta[144]=Db[144]=23;Ha[26]=Ua[26]=10;Ta[26]=Db[26]=23;Ga[36]=Db[36]=5;La[36]=eb[36]=2;Ga[134]=Db[134]=5;La[134]=eb[134]=2;Ha[9]=Ua[9]=10;Ga[9]=Ja[9]=13;Ha[161]=Ua[161]=10;Ga[161]=Ja[161]=13;Ga[37]=Db[37]=5;Ua[37]=eb[37]=20;Ga[133]=Db[133]=5;Ua[133]=eb[133]=20;La[148]=Ua[148]=16;Ta[148]=Db[148]=23;La[22]=Ua[22]=16;Ta[22]=Db[22]=23;Ha[82]=La[82]=8;Ja[82]=Ta[82]=19;Ha[88]=La[88]=8;Ja[88]=Ta[88]=19;Ha[73]=eb[73]=0;Ga[73]=Ja[73]=13;Ha[97]=eb[97]=0;Ga[97]=Ja[97]=13;Ha[145]=Ja[145]=9;Ua[145]=Db[145]=21;
Ha[25]=Ja[25]=9;Ua[25]=Db[25]=21;Ga[70]=eb[70]=1;La[70]=Ta[70]=17;Ga[100]=eb[100]=1;La[100]=Ta[100]=17;Ha[34]=Ja[34]=9;Ga[34]=La[34]=12;Ua[34]=Db[34]=21;Ta[34]=eb[34]=22;Ha[136]=Db[136]=4;Ga[136]=eb[136]=1;La[136]=Ta[136]=17;Ja[136]=Ua[136]=18;Ha[35]=Db[35]=4;Ga[35]=La[35]=12;Ja[35]=Ua[35]=18;Ta[35]=eb[35]=22;Ha[153]=Db[153]=4;Ja[153]=Ua[153]=18;Ga[102]=La[102]=12;Ta[102]=eb[102]=22;Ha[155]=Ja[155]=9;Ua[155]=Db[155]=23;Ga[103]=eb[103]=1;La[103]=Ta[103]=17;Ha[152]=Db[152]=4;La[152]=Ta[152]=17;Ja[152]=
Ua[152]=18;Ha[156]=La[156]=8;Ja[156]=Ua[156]=18;Ta[156]=Db[156]=23;Ha[137]=Db[137]=4;Ga[137]=eb[137]=1;Ja[137]=Ua[137]=18;Ha[139]=Db[139]=4;Ga[139]=Ja[139]=13;Ua[139]=eb[139]=20;Ha[98]=Ja[98]=9;Ga[98]=La[98]=12;Ta[98]=eb[98]=22;Ha[99]=eb[99]=0;Ga[99]=La[99]=12;Ja[99]=Ta[99]=19;Ga[38]=La[38]=12;Ua[38]=Db[38]=21;Ta[38]=eb[38]=22;Ga[39]=Db[39]=5;La[39]=Ua[39]=16;Ta[39]=eb[39]=22;var Ea=[];Ea[1]=Ea[169]=uj;Ea[4]=Ea[166]=vj;Ea[16]=Ea[154]=wj;Ea[64]=Ea[106]=xj;Ea[168]=Ea[2]=yj;Ea[162]=Ea[8]=zj;Ea[138]=
Ea[32]=Aj;Ea[42]=Ea[128]=Bj;Ea[5]=Ea[165]=function(b){return[[0,0],[0,b.leftbottom],[1,b.rightbottom],[1,0]]};Ea[20]=Ea[150]=function(b){return[[1,0],[b.bottomright,0],[b.topright,1],[1,1]]};Ea[80]=Ea[90]=function(b){return[[1,1],[1,b.righttop],[0,b.lefttop],[0,1]]};Ea[65]=Ea[105]=function(b){return[[b.bottomleft,0],[0,0],[0,1],[b.topleft,1]]};Ea[160]=Ea[10]=function(b){return[[1,b.righttop],[1,b.rightbottom],[0,b.leftbottom],[0,b.lefttop]]};Ea[130]=Ea[40]=function(b){return[[b.topleft,1],[b.topright,
1],[b.bottomright,0],[b.bottomleft,0]]};Ea[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]};Ea[101]=Ea[69]=function(b){return[[1,b.rightbottom],[1,0],[0,0],[0,1],[b.topleft,1]]};Ea[149]=Ea[21]=function(b){return[[b.topright,1],[1,1],[1,0],[0,0],[0,b.leftbottom]]};Ea[86]=Ea[84]=function(b){return[[1,0],[b.bottomright,0],[0,b.lefttop],[0,1],[1,1]]};Ea[89]=Ea[81]=function(b){return[[1,1],[1,b.righttop],[b.bottomleft,0],[0,0],[0,1]]};Ea[96]=Ea[74]=function(b){return[[1,b.righttop],[1,b.rightbottom],[0,
b.lefttop],[0,1],[b.topleft,1]]};Ea[24]=Ea[146]=function(b){return[[1,1],[1,b.righttop],[b.bottomright,0],[b.bottomleft,0],[b.topright,1]]};Ea[6]=Ea[164]=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0],[0,b.leftbottom],[0,b.lefttop]]};Ea[129]=Ea[41]=function(b){return[[b.topright,1],[b.bottomleft,0],[0,0],[0,b.leftbottom],[b.topleft,1]]};Ea[66]=Ea[104]=function(b){return[[b.bottomright,0],[b.bottomleft,0],[0,b.lefttop],[0,1],[b.topleft,1]]};Ea[144]=Ea[26]=function(b){return[[1,1],[1,
b.righttop],[0,b.leftbottom],[0,b.lefttop],[b.topright,1]]};Ea[36]=Ea[134]=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0],[b.topleft,1],[b.topright,1]]};Ea[9]=Ea[161]=function(b){return[[1,b.righttop],[1,b.rightbottom],[b.bottomleft,0],[0,0],[0,b.leftbottom]]};Ea[37]=Ea[133]=function(b){return[[1,b.rightbottom],[1,0],[0,0],[0,b.leftbottom],[b.topleft,1],[b.topright,1]]};Ea[148]=Ea[22]=function(b){return[[1,1],[1,0],[b.bottomright,0],[0,b.leftbottom],[0,b.lefttop],[b.topright,1]]};Ea[82]=
Ea[88]=function(b){return[[1,1],[1,b.righttop],[b.bottomright,0],[b.bottomleft,0],[0,b.lefttop],[0,1]]};Ea[73]=Ea[97]=function(b){return[[1,b.righttop],[1,b.rightbottom],[b.bottomleft,0],[0,0],[0,1],[b.topleft,1]]};Ea[145]=Ea[25]=function(b){return[[1,1],[1,b.righttop],[b.bottomleft,0],[0,0],[0,b.leftbottom],[b.topright,1]]};Ea[70]=Ea[100]=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0],[0,b.lefttop],[0,1],[b.topleft,1]]};Ea[34]=function(b){return[Bj(b),zj(b)]};Ea[35]=function(b){return[[1,
b.righttop],[1,b.rightbottom],[b.bottomright,0],[b.bottomleft,0],[0,b.leftbottom],[0,b.lefttop],[b.topleft,1],[b.topright,1]]};Ea[136]=function(b){return[Aj(b),yj(b)]};Ea[153]=function(b){return[wj(b),uj(b)]};Ea[102]=function(b){return[vj(b),xj(b)]};Ea[155]=function(b){return[[1,1],[1,b.righttop],[b.bottomleft,0],[0,0],[0,b.leftbottom],[b.topright,1]]};Ea[103]=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0],[0,b.lefttop],[0,1],[b.topleft,1]]};Ea[152]=function(b){return[wj(b),yj(b)]};
Ea[156]=function(b){return[[1,1],[1,b.righttop],[b.bottomright,0],[b.bottomleft,0],[0,b.leftbottom],[0,b.lefttop],[b.topright,1]]};Ea[137]=function(b){return[Aj(b),uj(b)]};Ea[139]=function(b){return[[1,b.righttop],[1,b.rightbottom],[b.bottomleft,0],[0,0],[0,b.leftbottom],[b.topleft,1],[b.topright,1]]};Ea[98]=function(b){return[zj(b),xj(b)]};Ea[99]=function(b){return[[1,b.righttop],[1,b.rightbottom],[b.bottomright,0],[b.bottomleft,0],[0,b.lefttop],[0,1],[b.topleft,1]]};Ea[38]=function(b){return[vj(b),
Bj(b)]};Ea[39]=function(b){return[[1,b.rightbottom],[1,0],[b.bottomright,0],[0,b.leftbottom],[0,b.lefttop],[b.topleft,1],[b.topright,1]]};var Sm=function(){function b(c){this.id=b.buildId(c);this.coordinates=c;this.innerEdges=[];this.outerEdges=[];this.outerEdgesSorted=!1}return b.buildId=function(c){return c.join(",")},b.prototype.removeInnerEdge=function(c){this.innerEdges=this.innerEdges.filter(function(f){return f.from.id!==c.from.id})},b.prototype.removeOuterEdge=function(c){this.outerEdges=
this.outerEdges.filter(function(f){return f.to.id!==c.to.id})},b.prototype.addOuterEdge=function(c){this.outerEdges.push(c);this.outerEdgesSorted=!1},b.prototype.sortOuterEdges=function(){var c=this;this.outerEdgesSorted||(this.outerEdges.sort(function(f,k){f=f.to;k=k.to;if(0<=f.coordinates[0]-c.coordinates[0]&&0>k.coordinates[0]-c.coordinates[0])return 1;if(0>f.coordinates[0]-c.coordinates[0]&&0<=k.coordinates[0]-c.coordinates[0])return-1;if(0==f.coordinates[0]-c.coordinates[0]&&0==k.coordinates[0]-
c.coordinates[0])return 0<=f.coordinates[1]-c.coordinates[1]||0<=k.coordinates[1]-c.coordinates[1]?f.coordinates[1]-k.coordinates[1]:k.coordinates[1]-f.coordinates[1];var d=Ui(c.coordinates,f.coordinates,k.coordinates);return 0>d?1:0<d?-1:Math.pow(f.coordinates[0]-c.coordinates[0],2)+Math.pow(f.coordinates[1]-c.coordinates[1],2)-(Math.pow(k.coordinates[0]-c.coordinates[0],2)+Math.pow(k.coordinates[1]-c.coordinates[1],2))}),this.outerEdgesSorted=!0)},b.prototype.getOuterEdges=function(){return this.sortOuterEdges(),
this.outerEdges},b.prototype.getOuterEdge=function(c){return this.sortOuterEdges(),this.outerEdges[c]},b.prototype.addInnerEdge=function(c){this.innerEdges.push(c)},b}(),$o=function(){function b(c,f){this.from=c;this.to=f;this.ring=this.symetric=this.label=this.next=void 0;this.from.addOuterEdge(this);this.to.addInnerEdge(this)}return b.prototype.getSymetric=function(){return this.symetric||(this.symetric=new b(this.to,this.from),this.symetric.symetric=this),this.symetric},b.prototype.deleteEdge=
function(){this.from.removeOuterEdge(this);this.to.removeInnerEdge(this)},b.prototype.isEqual=function(c){return this.from.id===c.from.id&&this.to.id===c.to.id},b.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},b.prototype.toLineString=function(){return J([this.from.coordinates,this.to.coordinates])},b.prototype.compareTo=function(c){return Ui(c.from.coordinates,c.to.coordinates,this.to.coordinates)},b}(),Tm=function(){function b(){this.edges=[];this.envelope=this.polygon=
void 0}return b.prototype.push=function(c){this.edges.push(c);this.polygon=this.envelope=void 0},b.prototype.get=function(c){return this.edges[c]},Object.defineProperty(b.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),b.prototype.forEach=function(c){this.edges.forEach(c)},b.prototype.map=function(c){return this.edges.map(c)},b.prototype.some=function(c){return this.edges.some(c)},b.prototype.isValid=function(){return!0},b.prototype.isHole=function(){var c=
this,f=this.edges.reduce(function(g,l,h){return l.from.coordinates[1]>c.edges[g].from.coordinates[1]&&(g=h),g},0),k=(0===f?this.length:f)-1,d=(f+1)%this.length;f=Ui(this.edges[k].from.coordinates,this.edges[f].from.coordinates,this.edges[d].from.coordinates);return 0===f?this.edges[k].from.coordinates[0]>this.edges[d].from.coordinates[0]:0<f},b.prototype.toMultiPoint=function(){return L(this.edges.map(function(c){return c.from.coordinates}))},b.prototype.toPolygon=function(){if(this.polygon)return this.polygon;
var c=this.edges.map(function(f){return f.from.coordinates});return c.push(this.edges[0].from.coordinates),this.polygon=D([c])},b.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=rk(this.toPolygon())},b.findEdgeRingContaining=function(c,f){var k,d,g=c.getEnvelope();return f.forEach(function(l){var h,m,q,p,r=l.getEnvelope();if((d&&(k=d.getEnvelope()),h=r.geometry.coordinates[0].map(function(A){return A[0]}),m=r.geometry.coordinates[0].map(function(A){return A[1]}),
q=g.geometry.coordinates[0].map(function(A){return A[0]}),p=g.geometry.coordinates[0].map(function(A){return A[1]}),Math.max.apply(null,h)!==Math.max.apply(null,q)||Math.max.apply(null,m)!==Math.max.apply(null,p)||Math.min.apply(null,h)!==Math.min.apply(null,q)||Math.min.apply(null,m)!==Math.min.apply(null,p))&&nl(r,g)){var v=void 0;h=function(A){l.some(function(u){return y=A,C=u.from.coordinates,y[0]===C[0]&&y[1]===C[1];var y,C})||(v=A)};m=0;for(q=c.map(function(A){return A.from.coordinates});m<
q.length;m++)h(q[m]);v&&l.inside(t(v))&&(d&&!nl(k,r)||(d=l))}}),d},b.prototype.inside=function(c){return Tb(c,this.toPolygon())},b}(),ap=function(){function b(){this.edges=[];this.nodes={}}return b.fromGeoJson=function(c){if(!c)throw Error("No geojson passed");if("FeatureCollection"!==c.type&&"GeometryCollection"!==c.type&&"MultiLineString"!==c.type&&"LineString"!==c.type&&"Feature"!==c.type)throw Error("Invalid input type '"+c.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature");
!0;var f=new b;return Rb(c,function(k){Ob(k,"LineString","Graph::fromGeoJson");Vb(k,function(d,g){if(d){d=f.getNode(d);var l=f.getNode(g);f.addEdge(d,l)}return g})}),f},b.prototype.getNode=function(c){var f=Sm.buildId(c),k=this.nodes[f];return k||=this.nodes[f]=new Sm(c),k},b.prototype.addEdge=function(c,f){c=new $o(c,f);f=c.getSymetric();this.edges.push(c);this.edges.push(f)},b.prototype.deleteDangles=function(){var c=this;Object.keys(this.nodes).map(function(f){return c.nodes[f]}).forEach(function(f){return c._removeIfDangle(f)})},
b.prototype._removeIfDangle=function(c){var f=this;if(1>=c.innerEdges.length){var k=c.getOuterEdges().map(function(d){return d.to});this.removeNode(c);k.forEach(function(d){return f._removeIfDangle(d)})}},b.prototype.deleteCutEdges=function(){var c=this;this._computeNextCWEdges();this._findLabeledEdgeRings();this.edges.forEach(function(f){f.label===f.symetric.label&&(c.removeEdge(f.symetric),c.removeEdge(f))})},b.prototype._computeNextCWEdges=function(c){var f=this;void 0===c?Object.keys(this.nodes).forEach(function(k){return f._computeNextCWEdges(f.nodes[k])}):
c.getOuterEdges().forEach(function(k,d){c.getOuterEdge((0===d?c.getOuterEdges().length:d)-1).symetric.next=k})},b.prototype._computeNextCCWEdges=function(c,f){var k,d;c=c.getOuterEdges();for(var g=c.length-1;0<=g;--g){var l=c[g],h=l.symetric,m=void 0,q=void 0;l.label===f&&(m=l);h.label===f&&(q=h);m&&q&&(q&&(d=q),m&&(d&&(d.next=m,d=void 0),k||=m))}d&&(d.next=k)},b.prototype._findLabeledEdgeRings=function(){var c=[],f=0;return this.edges.forEach(function(k){if(!(0<=k.label)){c.push(k);var d=k;do d.label=
f,d=d.next;while(!k.isEqual(d));f++}}),c},b.prototype.getEdgeRings=function(){var c=this;this._computeNextCWEdges();this.edges.forEach(function(k){k.label=void 0});this._findLabeledEdgeRings().forEach(function(k){c._findIntersectionNodes(k).forEach(function(d){c._computeNextCCWEdges(d,k.label)})});var f=[];return this.edges.forEach(function(k){k.ring||f.push(c._findEdgeRing(k))}),f},b.prototype._findIntersectionNodes=function(c){var f=[],k=c,d=function(){var g=0;k.from.getOuterEdges().forEach(function(l){l.label===
c.label&&++g});1<g&&f.push(k.from);k=k.next};do d();while(!c.isEqual(k));return f},b.prototype._findEdgeRing=function(c){var f=c,k=new Tm;do k.push(f),f.ring=k,f=f.next;while(!c.isEqual(f));return k},b.prototype.removeNode=function(c){var f=this;c.getOuterEdges().forEach(function(k){return f.removeEdge(k)});c.innerEdges.forEach(function(k){return f.removeEdge(k)});delete this.nodes[c.id]},b.prototype.removeEdge=function(c){this.edges=this.edges.filter(function(f){return!f.isEqual(c)});c.deleteEdge()},
b}(),Td=function(b){this.precision=b&&b.precision?b.precision:17;this.direction=!(!b||!b.direction)&&b.direction;this.pseudoNode=!(!b||!b.pseudoNode)&&b.pseudoNode;this.objectComparator=b&&b.objectComparator?b.objectComparator:mo};Td.prototype.compare=function(b,c){if(b.type!==c.type||!wl(b,c))return!1;switch(b.type){case "Point":return this.compareCoord(b.coordinates,c.coordinates);case "LineString":return this.compareLine(b.coordinates,c.coordinates,0,!1);case "Polygon":return this.comparePolygon(b,
c);case "Feature":return this.compareFeature(b,c);default:if(0===b.type.indexOf("Multi")){var f=this;b=vl(b);c=vl(c);return b.every(function(k){return this.some(function(d){return f.compare(k,d)})},c)}}return!1};Td.prototype.compareCoord=function(b,c){if(b.length!==c.length)return!1;for(var f=0;f<b.length;f++)if(b[f].toFixed(this.precision)!==c[f].toFixed(this.precision))return!1;return!0};Td.prototype.compareLine=function(b,c,f,k){if(!wl(b,c))return!1;b=this.pseudoNode?b:this.removePseudo(b);c=this.pseudoNode?
c:this.removePseudo(c);if(!k||this.compareCoord(b[0],c[0])||(c=this.fixStartIndex(c,b)))return k=this.compareCoord(b[f],c[f]),this.direction||k?this.comparePath(b,c):!!this.compareCoord(b[f],c[c.length-(1+f)])&&this.comparePath(b.slice().reverse(),c)};Td.prototype.fixStartIndex=function(b,c){for(var f,k=-1,d=0;d<b.length;d++)if(this.compareCoord(b[d],c[0])){k=d;break}return 0<=k&&(f=[].concat(b.slice(k,b.length),b.slice(1,k+1))),f};Td.prototype.comparePath=function(b,c){var f=this;return b.every(function(k,
d){return f.compareCoord(k,this[d])},c)};Td.prototype.comparePolygon=function(b,c){if(this.compareLine(b.coordinates[0],c.coordinates[0],1,!0)){b=b.coordinates.slice(1,b.coordinates.length);c=c.coordinates.slice(1,c.coordinates.length);var f=this;return b.every(function(k){return this.some(function(d){return f.compareLine(k,d,1,!0)})},c)}return!1};Td.prototype.compareFeature=function(b,c){return!(b.id!==c.id||!this.objectComparator(b.properties,c.properties)||!this.compareBBox(b,c))&&this.compare(b.geometry,
c.geometry)};Td.prototype.compareBBox=function(b,c){return!!(!b.bbox&&!c.bbox||b.bbox&&c.bbox&&this.compareCoord(b.bbox,c.bbox))};Td.prototype.removePseudo=function(b){return b};var bp=ie(function(b){function c(f,k,d,g){this.dataset=[];this.epsilon=1;this.minPts=2;this.distance=this._euclideanDistance;this.clusters=[];this.noise=[];this._visited=[];this._assigned=[];this._datasetLength=0;this._init(f,k,d,g)}c.prototype.run=function(f,k,d,g){this._init(f,k,d,g);for(f=0;f<this._datasetLength;f++)1!==
this._visited[f]&&(this._visited[f]=1,k=this._regionQuery(f),k.length<this.minPts?this.noise.push(f):(d=this.clusters.length,this.clusters.push([]),this._addToCluster(f,d),this._expandCluster(d,k)));return this.clusters};c.prototype._init=function(f,k,d,g){if(f){if(!(f instanceof Array))throw Error("Dataset must be of type array, "+typeof f+" given");this.dataset=f;this.clusters=[];this.noise=[];this._datasetLength=f.length;this._visited=Array(this._datasetLength);this._assigned=Array(this._datasetLength)}k&&
(this.epsilon=k);d&&(this.minPts=d);g&&(this.distance=g)};c.prototype._expandCluster=function(f,k){for(var d=0;d<k.length;d++){var g=k[d];if(1!==this._visited[g]){this._visited[g]=1;var l=this._regionQuery(g);l.length>=this.minPts&&(k=this._mergeArrays(k,l))}1!==this._assigned[g]&&this._addToCluster(g,f)}};c.prototype._addToCluster=function(f,k){this.clusters[k].push(f);this._assigned[f]=1};c.prototype._regionQuery=function(f){for(var k=[],d=0;d<this._datasetLength;d++)this.distance(this.dataset[f],
this.dataset[d])<this.epsilon&&k.push(d);return k};c.prototype._mergeArrays=function(f,k){for(var d=k.length,g=0;g<d;g++){var l=k[g];0>f.indexOf(l)&&f.push(l)}return f};c.prototype._euclideanDistance=function(f,k){for(var d=0,g=Math.min(f.length,k.length);g--;)d+=(f[g]-k[g])*(f[g]-k[g]);return Math.sqrt(d)};b.exports&&(b.exports=c)}),cp=ie(function(b){function c(f,k,d){this.k=3;this.dataset=[];this.assignments=[];this.centroids=[];this.init(f,k,d)}c.prototype.init=function(f,k,d){this.assignments=
[];this.centroids=[];void 0!==f&&(this.dataset=f);void 0!==k&&(this.k=k);void 0!==d&&(this.distance=d)};c.prototype.run=function(f,k){this.init(f,k);f=this.dataset.length;for(k=0;k<this.k;k++)this.centroids[k]=this.randomCentroid();for(k=!0;k;){k=this.assign();for(var d=0;d<this.k;d++){for(var g=Array(q),l=0,h=0;h<q;h++)g[h]=0;for(var m=0;m<f;m++){var q=this.dataset[m].length;if(d===this.assignments[m]){for(h=0;h<q;h++)g[h]+=this.dataset[m][h];l++}}if(0<l){for(h=0;h<q;h++)g[h]/=l;this.centroids[d]=
g}else this.centroids[d]=this.randomCentroid(),k=!0}}return this.getClusters()};c.prototype.randomCentroid=function(){var f=this.dataset.length-1;do{var k=Math.round(Math.random()*f);k=this.dataset[k]}while(0<=this.centroids.indexOf(k));return k};c.prototype.assign=function(){for(var f,k=!1,d=this.dataset.length,g=0;g<d;g++)(f=this.argmin(this.dataset[g],this.centroids,this.distance))!=this.assignments[g]&&(this.assignments[g]=f,k=!0);return k};c.prototype.getClusters=function(){for(var f,k=Array(this.k),
d=0;d<this.assignments.length;d++)void 0===k[f=this.assignments[d]]&&(k[f]=[]),k[f].push(d);return k};c.prototype.argmin=function(f,k,d){for(var g,l=Number.MAX_VALUE,h=0,m=k.length,q=0;q<m;q++)(g=d(f,k[q]))<l&&(l=g,h=q);return h};c.prototype.distance=function(f,k){for(var d=0,g=Math.min(f.length,k.length);g--;){var l=f[g]-k[g];d+=l*l}return Math.sqrt(d)};b.exports&&(b.exports=c)}),Um=ie(function(b){function c(f,k,d){this._queue=[];this._priorities=[];this._sorting="desc";this._init(f,k,d)}c.prototype.insert=
function(f,k){for(var d=this._queue.length,g=d;g--;){var l=this._priorities[g];"desc"===this._sorting?k>l&&(d=g):k<l&&(d=g)}this._insertAt(f,k,d)};c.prototype.remove=function(f){for(var k=this._queue.length;k--;)if(f===this._queue[k]){this._queue.splice(k,1);this._priorities.splice(k,1);break}};c.prototype.forEach=function(f){this._queue.forEach(f)};c.prototype.getElements=function(){return this._queue};c.prototype.getElementPriority=function(f){return this._priorities[f]};c.prototype.getPriorities=
function(){return this._priorities};c.prototype.getElementsWithPriorities=function(){for(var f=[],k=0,d=this._queue.length;k<d;k++)f.push([this._queue[k],this._priorities[k]]);return f};c.prototype._init=function(f,k,d){if(f&&k){if(this._queue=[],this._priorities=[],f.length!==k.length)throw Error("Arrays must have the same length");for(var g=0;g<f.length;g++)this.insert(f[g],k[g])}d&&(this._sorting=d)};c.prototype._insertAt=function(f,k,d){this._queue.length===d?(this._queue.push(f),this._priorities.push(k)):
(this._queue.splice(d,0,f),this._priorities.splice(d,0,k))};b.exports&&(b.exports=c)}),dp=ie(function(b){function c(k,d,g,l){this.minPts=this.epsilon=1;this.distance=this._euclideanDistance;this._reachability=[];this._processed=[];this._coreDistance=0;this._orderedList=[];this._init(k,d,g,l)}if(b.exports)var f=Um;c.prototype.run=function(k,d,g,l){this._init(k,d,g,l);k=0;for(d=this.dataset.length;k<d;k++)if(1!==this._processed[k]){this._processed[k]=1;this.clusters.push([k]);g=this.clusters.length-
1;this._orderedList.push(k);l=new f(null,null,"asc");var h=this._regionQuery(k);void 0!==this._distanceToCore(k)&&(this._updateQueue(k,h,l),this._expandCluster(g,l))}return this.clusters};c.prototype.getReachabilityPlot=function(){for(var k=[],d=0,g=this._orderedList.length;d<g;d++){var l=this._orderedList[d];k.push([l,this._reachability[l]])}return k};c.prototype._init=function(k,d,g,l){if(k){if(!(k instanceof Array))throw Error("Dataset must be of type array, "+typeof k+" given");this.dataset=k;
this.clusters=[];this._reachability=Array(this.dataset.length);this._processed=Array(this.dataset.length);this._coreDistance=0;this._orderedList=[]}d&&(this.epsilon=d);g&&(this.minPts=g);l&&(this.distance=l)};c.prototype._updateQueue=function(k,d,g){var l=this;this._coreDistance=this._distanceToCore(k);d.forEach(function(h){if(void 0===l._processed[h]){var m=l.distance(l.dataset[k],l.dataset[h]);m=Math.max(l._coreDistance,m);void 0===l._reachability[h]?(l._reachability[h]=m,g.insert(h,m)):m<l._reachability[h]&&
(l._reachability[h]=m,g.remove(h),g.insert(h,m))}})};c.prototype._expandCluster=function(k,d){for(var g=d.getElements(),l=0,h=g.length;l<h;l++){var m=g[l];if(void 0===this._processed[m]){var q=this._regionQuery(m);this._processed[m]=1;this.clusters[k].push(m);this._orderedList.push(m);void 0!==this._distanceToCore(m)&&(this._updateQueue(m,q,d),this._expandCluster(k,d))}}};c.prototype._distanceToCore=function(k){for(var d=this.epsilon,g=0;g<d;g++)if(this._regionQuery(k,g).length>=this.minPts)return g};
c.prototype._regionQuery=function(k,d){d=d||this.epsilon;for(var g=[],l=0,h=this.dataset.length;l<h;l++)this.distance(this.dataset[k],this.dataset[l])<d&&g.push(l);return g};c.prototype._euclideanDistance=function(k,d){for(var g=0,l=Math.min(k.length,d.length);l--;)g+=(k[l]-d[l])*(k[l]-d[l]);return Math.sqrt(g)};b.exports&&(b.exports=c)}),ep=ie(function(b){b.exports&&(b.exports={DBSCAN:bp,KMEANS:cp,OPTICS:dp,PriorityQueue:Um})}),Vm=function(b,c,f){for(var k=b.length,d=0,g=0;g<k;g++){var l=(b[g]||
0)-(c[g]||0);d+=l*l}return f?Math.sqrt(d):d},fp=function(b,c,f){b=Math.abs(b-c);return f?b:b*b},gp=function(b,c){var f=b[0].length?Vm:fp,k=[],d=b.length,g=b[Math.floor(Math.random()*d)];0<b[0].length&&g.join("_");for(k.push(g);k.length<c;){var l=[],h=k.length,m=0;g=[];for(var q=0;q<d;q++){for(var p=1/0,r=0;r<h;r++){var v=f(b[q],k[r]);v<=p&&(p=v)}l[q]=p}for(h=0;h<d;h++)m+=l[h];for(h=0;h<d;h++)g[h]={i:h,v:b[h],pr:l[h]/m,cs:0};g.sort(function(A,u){return A.pr-u.pr});g[0].cs=g[0].pr;for(l=1;l<d;l++)g[l].cs=
g[l-1].cs+g[l].pr;l=Math.random();for(m=0;m<d-1&&g[m++].cs<l;);k.push(g[m-1].v)}return k},hp=function(b,c,f,k){var d=[],g=[],l=[];k=k||1E4;var h=b.length,m=b[0].length,q=0<m,p=[];if(f)if("kmrand"==f){d={};f=[];var r=c<<2;var v=b.length;for(var A=0<b[0].length;f.length<c&&0<r--;){var u=b[Math.floor(Math.random()*v)],y=A?u.join("_"):""+u;d[y]||(d[y]=!0,f.push(u))}if(f.length<c)throw Error("Error initializating clusters");d=f}else d="kmpp"==f?gp(b,c):f;else for(f={};d.length<c;)r=Math.floor(Math.random()*
h),f[r]||(f[r]=!0,d.push(b[r]));do{yl(c,0,p);for(f=0;f<h;f++){r=1/0;for(A=v=0;A<c;A++)(l=q?Vm(b[f],d[A]):Math.abs(b[f]-d[A]))<=r&&(r=l,v=A);g[f]=v;p[v]++}r=[];for(v=(f=[],0);v<c;v++)r[v]=q?yl(m,0,r[v]):0,f[v]=d[v];if(q){for(v=0;v<c;v++)d[v]=[];for(v=0;v<h;v++)for(A=r[g[v]],u=b[v],y=0;y<m;y++)A[y]+=u[y];v=!0;for(A=0;A<c;A++){u=d[A];var C=r[A];y=f[A];for(var w=p[A],x=0;x<m;x++)u[x]=C[x]/w||0;if(v)for(C=0;C<m;C++)if(y[C]!=u[C]){v=!1;break}}}else{for(v=0;v<h;v++)r[g[v]]+=b[v];for(v=0;v<c;v++)d[v]=r[v]/
p[v]||0;v=!0;for(r=0;r<c;r++)if(f[r]!=d[r]){v=!1;break}}v=v||0>=--k}while(!v);return{it:1E4-k,k:c,idxs:g,centroids:d}},Vh={search:function(b,c,f,k){b.cleanDirty();var d=(k=k||{}).heuristic||Vh.heuristics.manhattan;k=k.closest||!1;var g=new Bl(function(A){return A.f}),l=c;c.h=d(c,f);for(g.push(c);0<g.size();){c=g.pop();if(c===f)return Al(c);c.closed=!0;for(var h=b.neighbors(c),m=0,q=h.length;m<q;++m){var p=h[m];if(!p.closed&&!p.isWall()){var r=c.g+p.getCost(c),v=p.visited;(!v||r<p.g)&&(p.visited=!0,
p.parent=c,p.h=p.h||d(p,f),p.g=r,p.f=p.g+p.h,b.markDirty(p),k&&(p.h<l.h||p.h===l.h&&p.g<l.g)&&(l=p),v?g.rescoreElement(p):g.push(p))}}}return k?Al(l):[]},heuristics:{manhattan:function(b,c){return Math.abs(c.x-b.x)+Math.abs(c.y-b.y)},diagonal:function(b,c){var f=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);return 1*(f+b)+(Math.sqrt(2)-2)*Math.min(f,b)}},cleanNode:function(b){b.f=0;b.g=0;b.h=0;b.visited=!1;b.closed=!1;b.parent=null}};If.prototype.init=function(){this.dirtyNodes=[];for(var b=0;b<this.nodes.length;b++)Vh.cleanNode(this.nodes[b])};
If.prototype.cleanDirty=function(){for(var b=0;b<this.dirtyNodes.length;b++)Vh.cleanNode(this.dirtyNodes[b]);this.dirtyNodes=[]};If.prototype.markDirty=function(b){this.dirtyNodes.push(b)};If.prototype.neighbors=function(b){var c=[],f=b.x;b=b.y;var k=this.grid;return k[f-1]&&k[f-1][b]&&c.push(k[f-1][b]),k[f+1]&&k[f+1][b]&&c.push(k[f+1][b]),k[f]&&k[f][b-1]&&c.push(k[f][b-1]),k[f]&&k[f][b+1]&&c.push(k[f][b+1]),this.diagonal&&(k[f-1]&&k[f-1][b-1]&&c.push(k[f-1][b-1]),k[f+1]&&k[f+1][b-1]&&c.push(k[f+
1][b-1]),k[f-1]&&k[f-1][b+1]&&c.push(k[f-1][b+1]),k[f+1]&&k[f+1][b+1]&&c.push(k[f+1][b+1])),c};If.prototype.toString=function(){for(var b,c,f,k,d=[],g=this.grid,l=0,h=g.length;l<h;l++){b=[];f=0;for(k=(c=g[l]).length;f<k;f++)b.push(c[f].weight);d.push(b.join(" "))}return d.join("\n")};Gh.prototype.toString=function(){return"["+this.x+" "+this.y+"]"};Gh.prototype.getCost=function(b){return b&&b.x!==this.x&&b.y!==this.y?1.41421*this.weight:this.weight};Gh.prototype.isWall=function(){return 0===this.weight};
Bl.prototype={push:function(b){this.content.push(b);this.sinkDown(this.content.length-1)},pop:function(){var b=this.content[0],c=this.content.pop();return 0<this.content.length&&(this.content[0]=c,this.bubbleUp(0)),b},remove:function(b){var c=this.content.indexOf(b),f=this.content.pop();c!==this.content.length-1&&(this.content[c]=f,this.scoreFunction(f)<this.scoreFunction(b)?this.sinkDown(c):this.bubbleUp(c))},size:function(){return this.content.length},rescoreElement:function(b){this.sinkDown(this.content.indexOf(b))},
sinkDown:function(b){for(var c=this.content[b];0<b;){var f=(b+1>>1)-1,k=this.content[f];if(!(this.scoreFunction(c)<this.scoreFunction(k)))break;this.content[f]=c;this.content[b]=k;b=f}},bubbleUp:function(b){for(var c=this.content.length,f=this.content[b],k=this.scoreFunction(f);;){var d,g=b+1<<1,l=g-1,h=null;l<c&&(d=this.scoreFunction(this.content[l]))<k&&(h=l);g<c&&this.scoreFunction(this.content[g])<(null===h?k:d)&&(h=g);if(null===h)break;this.content[b]=this.content[h];this.content[h]=f;b=h}}};
Hh.prototype={constructor:Hh,insert:function(b,c){var f,k;if(b){if(c.P=b,c.N=b.N,b.N&&(b.N.P=c),b.N=c,b.R){for(b=b.R;b.L;)b=b.L;b.L=c}else b.R=c;var d=b}else this._?(b=Dl(this._),c.P=null,c.N=b,b.P=b.L=c,d=b):(c.P=c.N=null,this._=c,d=null);c.L=c.R=null;c.U=d;c.C=!0;for(b=c;d&&d.C;)d===(f=d.U).L?(k=f.R)&&k.C?(d.C=k.C=!1,f.C=!0,b=f):(b===d.R&&(Bg(this,d),d=(b=d).U),d.C=!1,f.C=!0,Cg(this,f)):(k=f.L)&&k.C?(d.C=k.C=!1,f.C=!0,b=f):(b===d.L&&(Cg(this,d),d=(b=d).U),d.C=!1,f.C=!0,Bg(this,f)),d=b.U;this._.C=
!1},remove:function(b){b.N&&(b.N.P=b.P);b.P&&(b.P.N=b.N);b.N=b.P=null;var c,f,k,d=b.U,g=b.L,l=b.R;if(f=g?l?Dl(l):g:l,d?d.L===b?d.L=f:d.R=f:this._=f,g&&l?(k=f.C,f.C=b.C,f.L=g,g.U=f,f!==l?(d=f.U,f.U=b.U,b=f.R,d.L=b,f.R=l,l.U=f):(f.U=d,d=f,b=f.R)):(k=b.C,b=f),b&&(b.U=d),!k)if(b&&b.C)b.C=!1;else{do{if(b===this._)break;if(b===d.L){if((c=d.R).C&&(c.C=!1,d.C=!0,Bg(this,d),c=d.R),c.L&&c.L.C||c.R&&c.R.C){c.R&&c.R.C||(c.L.C=!1,c.C=!0,Cg(this,c),c=d.R);c.C=d.C;d.C=c.R.C=!1;Bg(this,d);b=this._;break}}else if((c=
d.L).C&&(c.C=!1,d.C=!0,Cg(this,d),c=d.L),c.L&&c.L.C||c.R&&c.R.C){c.L&&c.L.C||(c.R.C=!1,c.C=!0,Bg(this,c),c=d.L);c.C=d.C;d.C=c.L.C=!1;Cg(this,d);b=this._;break}c.C=!0;b=d;d=d.U}while(!b.C);b&&(b.C=!1)}}};var Wi,Fl=[],Hl=[],Lf,qd,Fg,Vc,Wb=1E-6,uo=1E-12;Yi.prototype={constructor:Yi,polygons:function(){var b=this.edges;return this.cells.map(function(c){var f=c.halfedges.map(function(k){return El(c,b[k])});return f.data=c.site.data,f})},triangles:function(){var b=[],c=this.edges;return this.cells.forEach(function(f,
k){if(g=(d=f.halfedges).length)for(var d,g,l,h,m,q=f.site,p=-1,r=c[d[g-1]],v=r.left===q?r.right:r.left;++p<g;)f=v,v=(r=c[d[p]]).left===q?r.right:r.left,f&&v&&k<f.index&&k<v.index&&(h=f,m=v,0>((l=q)[0]-m[0])*(h[1]-l[1])-(l[0]-h[0])*(m[1]-l[1]))&&b.push([q.data,f.data,v.data])}),b},links:function(){return this.edges.filter(function(b){return b.right}).map(function(b){return{source:b.left.data,target:b.right.data}})},find:function(b,c,f){var k,d,g=this,l=g._found||0;for(k=g.cells.length;!(d=g.cells[l]);)if(++l>=
k)return null;k=b-d.site[0];var h=c-d.site[1],m=k*k+h*h;do d=g.cells[k=l],l=null,d.halfedges.forEach(function(q){var p=g.edges[q];q=p.left;if(q!==d.site&&q||(q=p.right)){p=b-q[0];var r=c-q[1];p=p*p+r*r;p<m&&(m=p,l=q.index)}});while(null!==l);return g._found=k,null==f||m<=f*f?d.site:null}};var ip=Object.freeze({__proto__:null,toMercator:Ol,toWgs84:Ql}),Do=function(){for(var b=0,c=0,f=arguments.length;c<f;c++)b+=arguments[c].length;b=Array(b);var k=0;for(c=0;c<f;c++)for(var d=arguments[c],g=0,l=d.length;g<
l;g++,k++)b[k]=d[g];return b},jp=Object.freeze({__proto__:null,randomPosition:Gg,randomPoint:Ul,randomPolygon:Vl,randomLineString:Wl}),kp=Object.freeze({__proto__:null,getCluster:Xl,clusterEach:$i,clusterReduce:Yl,createBins:aj,applyFilter:Kh,propertiesContainsFilter:bj,filterProperties:Zl}),Pe=function(b,c){this.next=null;this.key=b;this.data=c;this.right=this.left=null},Cj=function(){function b(c){void 0===c&&(c=Eo);this._root=null;this._size=0;this._comparator=c}return b.prototype.insert=function(c,
f){return this._size++,this._root=cj(c,f,this._root,this._comparator)},b.prototype.add=function(c,f){f=new Pe(c,f);null===this._root&&(f.left=f.right=null,this._size++,this._root=f);var k=this._comparator,d=Oe(c,this._root,k);c=k(c,d.key);return 0===c?this._root=d:(0>c?(f.left=d.left,f.right=d,d.left=null):0<c&&(f.right=d.right,f.left=d,d.right=null),this._size++,this._root=f),this._root},b.prototype.remove=function(c){this._root=this._remove(c,this._root,this._comparator)},b.prototype._remove=function(c,
f,k){var d;return null===f?null:0===k(c,(f=Oe(c,f,k)).key)?(null===f.left?d=f.right:(d=Oe(c,f.left,k)).right=f.right,this._size--,d):f},b.prototype.pop=function(){var c=this._root;if(c){for(;c.left;)c=c.left;return this._root=Oe(c.key,this._root,this._comparator),this._root=this._remove(c.key,this._root,this._comparator),{key:c.key,data:c.data}}return null},b.prototype.findStatic=function(c){for(var f=this._root,k=this._comparator;f;){var d=k(c,f.key);if(0===d)return f;f=0>d?f.left:f.right}return null},
b.prototype.find=function(c){return this._root&&(this._root=Oe(c,this._root,this._comparator),0!==this._comparator(c,this._root.key))?null:this._root},b.prototype.contains=function(c){for(var f=this._root,k=this._comparator;f;){var d=k(c,f.key);if(0===d)return!0;f=0>d?f.left:f.right}return!1},b.prototype.forEach=function(c,f){for(var k=this._root,d=[],g=!1;!g;)null!==k?(d.push(k),k=k.left):0!==d.length?(k=d.pop(),c.call(f,k),k=k.right):g=!0;return this},b.prototype.range=function(c,f,k,d){for(var g=
[],l=this._comparator,h=this._root;0!==g.length||h;)if(h)g.push(h),h=h.left;else{if(0<l((h=g.pop()).key,f))break;if(0<=l(h.key,c)&&k.call(d,h))break;h=h.right}return this},b.prototype.keys=function(){var c=[];return this.forEach(function(f){return c.push(f.key)}),c},b.prototype.values=function(){var c=[];return this.forEach(function(f){return c.push(f.data)}),c},b.prototype.min=function(){return this._root?this.minNode(this._root).key:null},b.prototype.max=function(){return this._root?this.maxNode(this._root).key:
null},b.prototype.minNode=function(c){if(void 0===c&&(c=this._root),c)for(;c.left;)c=c.left;return c},b.prototype.maxNode=function(c){if(void 0===c&&(c=this._root),c)for(;c.right;)c=c.right;return c},b.prototype.at=function(c){for(var f=this._root,k=!1,d=0,g=[];!k;)if(f)g.push(f),f=f.left;else if(0<g.length){if(f=g.pop(),d===c)return f;d++;f=f.right}else k=!0;return null},b.prototype.next=function(c){var f=this._root,k=null;if(c.right){for(k=c.right;k.left;)k=k.left;return k}for(var d=this._comparator;f;){var g=
d(c.key,f.key);if(0===g)break;0>g?(k=f,f=f.left):f=f.right}return k},b.prototype.prev=function(c){var f=this._root,k=null;if(null!==c.left){for(k=c.left;k.right;)k=k.right;return k}for(var d=this._comparator;f;){var g=d(c.key,f.key);if(0===g)break;0>g?f=f.left:(k=f,f=f.right)}return k},b.prototype.clear=function(){return this._root=null,this._size=0,this},b.prototype.toList=function(){for(var c=this._root,f=[],k=!1,d=new Pe(null,null),g=d;!k;)c?(f.push(c),c=c.left):0<f.length?c=(c=g=g.next=f.pop()).right:
k=!0;return g.next=null,d.next},b.prototype.load=function(c,f,k){void 0===f&&(f=[]);void 0===k&&(k=!1);var d=c.length,g=this._comparator;(k&&gj(c,f,0,d-1,g),null===this._root)?(this._root=ej(c,f,0,d),this._size=d):(c=function(l,h,m){for(var q=new Pe(null,null),p=q;null!==l&&null!==h;)0>m(l.key,h.key)?(p.next=l,l=l.next):(p.next=h,h=h.next),p=p.next;null!==l?p.next=l:null!==h&&(p.next=h);return q.next}(this.toList(),function(l,h){for(var m=new Pe(null,null),q=m,p=0;p<l.length;p++)q=q.next=new Pe(l[p],
h[p]);return q.next=null,m.next}(c,f),g),d=this._size+d,this._root=fj({head:c},0,d));return this},b.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),b.prototype.toString=function(c){void 0===c&&(c=function(k){return String(k.key)});var f=[];return dj(this._root,"",!0,function(k){return f.push(k)},
c),f.join("")},b.prototype.update=function(c,f,k){var d=this._comparator,g=$l(c,this._root,d),l=g.left;g=g.right;0>d(c,f)?g=cj(f,k,g,d):l=cj(f,k,l,d);c=l;f=g;this._root=null===f?c:(null===c||((f=Oe(c.key,f,d)).left=c),f)},b.prototype.split=function(c){return $l(c,this._root,this._comparator)},b}(),Mg=function(b,c){return b.ll.x<=c.x&&c.x<=b.ur.x&&b.ll.y<=c.y&&c.y<=b.ur.y},Dj=function(b,c){return c.ur.x<b.ll.x||b.ur.x<c.ll.x||c.ur.y<b.ll.y||b.ur.y<c.ll.y?null:{ll:{x:b.ll.x<c.ll.x?c.ll.x:b.ll.x,y:b.ll.y<
c.ll.y?c.ll.y:b.ll.y},ur:{x:b.ur.x<c.ur.x?b.ur.x:c.ur.x,y:b.ur.y<c.ur.y?b.ur.y:c.ur.y}}},Se=Number.EPSILON;void 0===Se&&(Se=Math.pow(2,-52));var lp=Se*Se,Ej=function(b,c){if(-Se<b&&b<Se&&-Se<c&&c<Se)return 0;var f=b-c;return f*f<lp*b*c?0:b<c?-1:1},mp=function(){function b(){yd(this,b);this.reset()}return bd(b,[{key:"reset",value:function(){this.xRounder=new Wm;this.yRounder=new Wm}},{key:"round",value:function(c,f){return{x:this.xRounder.round(c),y:this.yRounder.round(f)}}}]),b}(),Wm=function(){function b(){yd(this,
b);this.tree=new Cj;this.round(0)}return bd(b,[{key:"round",value:function(c){var f=this.tree.add(c),k=this.tree.prev(f);if(null!==k&&0===Ej(f.key,k.key))return this.tree.remove(c),k.key;k=this.tree.next(f);return null!==k&&0===Ej(f.key,k.key)?(this.tree.remove(c),k.key):c}}]),b}(),Ng=new mp,Og=function(b,c){return b.x*c.y-b.y*c.x},Pg=function(b,c){return b.x*c.x+b.y*c.y},Xm=function(b,c,f){b=Og({x:c.x-b.x,y:c.y-b.y},{x:f.x-b.x,y:f.y-b.y});return Ej(b,0)},Ym=function(b,c,f){return 0===c.y?null:{x:b.x+
c.x/c.y*(f-b.y),y:f}},Zm=function(b,c,f){return 0===c.x?null:{x:f,y:b.y+c.y/c.x*(f-b.x)}},oe=function(){function b(c,f){yd(this,b);void 0===c.events?c.events=[this]:c.events.push(this);this.point=c;this.isLeft=f}return bd(b,null,[{key:"compare",value:function(c,f){var k=b.comparePoints(c.point,f.point);return 0!==k?k:(c.point!==f.point&&c.link(f),c.isLeft!==f.isLeft?c.isLeft?1:-1:Wh.compare(c.segment,f.segment))}},{key:"comparePoints",value:function(c,f){return c.x<f.x?-1:c.x>f.x?1:c.y<f.y?-1:c.y>
f.y?1:0}}]),bd(b,[{key:"link",value:function(c){if(c.point===this.point)throw Error("Tried to link already linked events");c=c.point.events;for(var f=0,k=c.length;f<k;f++){var d=c[f];this.point.events.push(d);d.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var c=this.point.events.length,f=0;f<c;f++){var k=this.point.events[f];if(void 0===k.segment.consumedBy)for(var d=f+1;d<c;d++){var g=this.point.events[d];void 0===g.consumedBy&&k.otherSE.point.events===
g.otherSE.point.events&&k.segment.consume(g.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var c=[],f=0,k=this.point.events.length;f<k;f++){var d=this.point.events[f];d!==this&&!d.segment.ringOut&&d.segment.isInResult()&&c.push(d)}return c}},{key:"getLeftmostComparator",value:function(c){var f=this,k=new Map,d=function(g){var l,h,m,q,p,r=g.otherSE,v=k.set,A=(l=f.point,h=c.point,m=r.point,q={x:h.x-l.x,y:h.y-l.y},p={x:m.x-l.x,y:m.y-l.y},Og(p,q)/Math.sqrt(Pg(p,p))/Math.sqrt(Pg(q,q)));
l=f.point;h=c.point;r=r.point;h={x:h.x-l.x,y:h.y-l.y};r={x:r.x-l.x,y:r.y-l.y};r=Pg(r,h)/Math.sqrt(Pg(r,r))/Math.sqrt(Pg(h,h));v.call(k,g,{sine:A,cosine:r})};return function(g,l){k.has(g)||d(g);k.has(l)||d(l);var h=k.get(g);g=h.sine;h=h.cosine;var m=k.get(l);l=m.sine;m=m.cosine;return 0<=g&&0<=l?h<m?1:h>m?-1:0:0>g&&0>l?h<m?-1:h>m?1:0:l<g?-1:l>g?1:0}}}]),b}(),np=0,Wh=function(){function b(c,f,k,d){yd(this,b);this.id=++np;this.leftSE=c;c.segment=this;this.rightSE=c.otherSE=f;f.segment=this;f.otherSE=
c;this.rings=k;this.windings=d}return bd(b,null,[{key:"compare",value:function(c,f){var k=c.leftSE.point.x,d=f.leftSE.point.x,g=c.rightSE.point.x,l=f.rightSE.point.x;if(l<k)return 1;if(g<d)return-1;var h=c.leftSE.point.y,m=f.leftSE.point.y,q=c.rightSE.point.y,p=f.rightSE.point.y;if(k<d){if(m<h&&m<q)return 1;if(m>h&&m>q)return-1;g=c.comparePoint(f.leftSE.point);if(0>g)return 1;if(0<g)return-1;c=f.comparePoint(c.rightSE.point);return 0!==c?c:-1}if(k>d){if(h<m&&h<p)return-1;if(h>m&&h>p)return 1;g=f.comparePoint(c.leftSE.point);
if(0!==g)return g;c=c.comparePoint(f.rightSE.point);return 0>c?1:0<c?-1:1}if(h<m)return-1;if(h>m)return 1;if(g<l){var r=f.comparePoint(c.rightSE.point);if(0!==r)return r}if(g>l){r=c.comparePoint(f.rightSE.point);if(0>r)return 1;if(0<r)return-1}if(g!==l){h=q-h;k=g-k;m=p-m;d=l-d;if(h>k&&m<d)return 1;if(h<k&&m>d)return-1}return g>l?1:g<l||q<p?-1:q>p?1:c.id<f.id?-1:c.id>f.id?1:0}}]),bd(b,[{key:"replaceRightSE",value:function(c){this.rightSE=c;this.rightSE.segment=this;this.rightSE.otherSE=this.leftSE;
this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var c=this.leftSE.point.y,f=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:c<f?c:f},ur:{x:this.rightSE.point.x,y:c>f?c:f}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(c){return c.x===this.leftSE.point.x&&c.y===this.leftSE.point.y||c.x===this.rightSE.point.x&&c.y===this.rightSE.point.y}},{key:"comparePoint",
value:function(c){if(this.isAnEndpoint(c))return 0;var f=this.leftSE.point,k=this.rightSE.point,d=this.vector();if(f.x===k.x)return c.x===f.x?0:c.x<f.x?1:-1;if(c.x===f.x+(c.y-f.y)/d.y*d.x)return 0;f=f.y+(c.x-f.x)/d.x*d.y;return c.y===f?0:c.y<f?-1:1}},{key:"getIntersection",value:function(c){var f=this.bbox(),k=c.bbox(),d=Dj(f,k);if(null===d)return null;var g=this.leftSE.point,l=this.rightSE.point,h=c.leftSE.point,m=c.rightSE.point,q=Mg(f,h)&&0===this.comparePoint(h),p=Mg(k,g)&&0===c.comparePoint(g);
f=Mg(f,m)&&0===this.comparePoint(m);k=Mg(k,l)&&0===c.comparePoint(l);if(p&&q)return k&&!f?l:!k&&f?m:null;if(p)return f&&g.x===m.x&&g.y===m.y?null:g;if(q)return k&&l.x===h.x&&l.y===h.y?null:h;if(k&&f)return null;if(k)return l;if(f)return m;c=function(r,v,A,u){if(0===v.x)return Zm(A,u,r.x);if(0===u.x)return Zm(r,v,A.x);if(0===v.y)return Ym(A,u,r.y);if(0===u.y)return Ym(r,v,A.y);var y=Og(v,u);if(0==y)return null;var C={x:A.x-r.x,y:A.y-r.y},w=Og(C,v)/y;y=Og(C,u)/y;return{x:(r.x+y*v.x+(A.x+w*u.x))/2,y:(r.y+
y*v.y+(A.y+w*u.y))/2}}(g,this.vector(),h,c.vector());return null===c?null:Mg(d,c)?Ng.round(c.x,c.y):null}},{key:"split",value:function(c){var f=[],k=void 0!==c.events,d=new oe(c,!0);c=new oe(c,!1);var g=this.rightSE;this.replaceRightSE(c);f.push(c);f.push(d);g=new b(d,g,this.rings.slice(),this.windings.slice());return 0<oe.comparePoints(g.leftSE.point,g.rightSE.point)&&g.swapEvents(),0<oe.comparePoints(this.leftSE.point,this.rightSE.point)&&this.swapEvents(),k&&(d.checkForConsuming(),c.checkForConsuming()),
f}},{key:"swapEvents",value:function(){var c=this.rightSE;this.rightSE=this.leftSE;this.leftSE=c;this.leftSE.isLeft=!0;this.rightSE.isLeft=!1;c=0;for(var f=this.windings.length;c<f;c++)this.windings[c]*=-1}},{key:"consume",value:function(c){for(var f=this;f.consumedBy;)f=f.consumedBy;for(;c.consumedBy;)c=c.consumedBy;var k=b.compare(f,c);if(0!==k){0<k&&(k=f,f=c,c=k);f.prev===c&&(k=f,f=c,c=k);k=0;for(var d=c.rings.length;k<d;k++){var g=c.rings[k],l=c.windings[k],h=f.rings.indexOf(g);-1===h?(f.rings.push(g),
f.windings.push(l)):f.windings[h]+=l}c.rings=null;c.windings=null;c.consumedBy=f;c.leftSE.consumedBy=f.leftSE;c.rightSE.consumedBy=f.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState?this._beforeState:this._beforeState=this.prev?(this.prev.consumedBy||
this.prev).afterState():{rings:[],windings:[],multiPolys:[]}}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var c=this.beforeState();this._afterState={rings:c.rings.slice(0),windings:c.windings.slice(0),multiPolys:[]};var f=this._afterState.rings,k=this._afterState.windings;c=this._afterState.multiPolys;for(var d=0,g=this.rings.length;d<g;d++){var l=this.rings[d],h=this.windings[d],m=f.indexOf(l);-1===m?(f.push(l),k.push(h)):k[m]+=h}d=[];g=[];l=0;for(h=f.length;l<
h;l++)if(0!==k[l]){m=f[l];var q=m.poly;-1===g.indexOf(q)&&(m.isExterior?d.push(q):(-1===g.indexOf(q)&&g.push(q),m=d.indexOf(m.poly),-1!==m&&d.splice(m,1)))}f=0;for(k=d.length;f<k;f++)g=d[f].multiPoly,-1===c.indexOf(g)&&c.push(g);return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var c=this.beforeState().multiPolys,f=this.afterState().multiPolys;switch(Ud.type){case "union":this._isInResult=0===c.length!==(0===
f.length);break;case "intersection":var k,d;c.length<f.length?(k=c.length,d=f.length):(k=f.length,d=c.length);this._isInResult=d===Ud.numMultiPolys&&k<d;break;case "xor":this._isInResult=1==Math.abs(c.length-f.length)%2;break;case "difference":this._isInResult=(1===c.length&&c[0].isSubject)!==(1===f.length&&f[0].isSubject);break;default:throw Error("Unrecognized operation type found ".concat(Ud.type));}return this._isInResult}}],[{key:"fromRing",value:function(c,f,k){var d=oe.comparePoints(c,f);if(0>
d)d=c,c=f,f=1;else{if(!(0<d))throw Error("Tried to create degenerate segment at [".concat(c.x,", ").concat(c.y,"]"));d=f;f=-1}return new b(new oe(d,!0),new oe(c,!1),[k],[f])}}]),b}(),$m=function(){function b(c,f,k){if(yd(this,b),!Array.isArray(c)||0===c.length)throw Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=f,this.isExterior=k,this.segments=[],"number"!=typeof c[0][0]||"number"!=typeof c[0][1])throw Error("Input geometry is not a valid Polygon or MultiPolygon");f=
Ng.round(c[0][0],c[0][1]);this.bbox={ll:{x:f.x,y:f.y},ur:{x:f.x,y:f.y}};k=f;for(var d=1,g=c.length;d<g;d++){if("number"!=typeof c[d][0]||"number"!=typeof c[d][1])throw Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Ng.round(c[d][0],c[d][1]);l.x===k.x&&l.y===k.y||(this.segments.push(Wh.fromRing(k,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),k=l)}f.x===
k.x&&f.y===k.y||this.segments.push(Wh.fromRing(k,f,this))}return bd(b,[{key:"getSweepEvents",value:function(){for(var c=[],f=0,k=this.segments.length;f<k;f++){var d=this.segments[f];c.push(d.leftSE);c.push(d.rightSE)}return c}}]),b}(),op=function(){function b(c,f){if(yd(this,b),!Array.isArray(c))throw Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new $m(c[0],this,!0);this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,
y:this.exteriorRing.bbox.ur.y}};this.interiorRings=[];for(var k=1,d=c.length;k<d;k++){var g=new $m(c[k],this,!1);g.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=g.bbox.ll.x);g.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=g.bbox.ll.y);g.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=g.bbox.ur.x);g.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=g.bbox.ur.y);this.interiorRings.push(g)}this.multiPoly=f}return bd(b,[{key:"getSweepEvents",value:function(){for(var c=this.exteriorRing.getSweepEvents(),f=0,k=this.interiorRings.length;f<
k;f++)for(var d=this.interiorRings[f].getSweepEvents(),g=0,l=d.length;g<l;g++)c.push(d[g]);return c}}]),b}(),an=function(){function b(c,f){if(yd(this,b),!Array.isArray(c))throw Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof c[0][0][0]&&(c=[c])}catch(l){}this.polys=[];this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var k=0,d=c.length;k<d;k++){var g=new op(c[k],this);g.bbox.ll.x<
this.bbox.ll.x&&(this.bbox.ll.x=g.bbox.ll.x);g.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=g.bbox.ll.y);g.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=g.bbox.ur.x);g.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=g.bbox.ur.y);this.polys.push(g)}this.isSubject=f}return bd(b,[{key:"getSweepEvents",value:function(){for(var c=[],f=0,k=this.polys.length;f<k;f++)for(var d=this.polys[f].getSweepEvents(),g=0,l=d.length;g<l;g++)c.push(d[g]);return c}}]),b}(),pp=function(){function b(c){yd(this,b);this.events=c;for(var f=
0,k=c.length;f<k;f++)c[f].segment.ringOut=this;this.poly=null}return bd(b,null,[{key:"factory",value:function(c){for(var f=[],k=0,d=c.length;k<d;k++){var g=c[k];if(g.isInResult()&&!g.ringOut){var l,h=g.leftSE,m=g.rightSE;g=[h];for(var q=h.point,p=[];l=h,h=m,g.push(h),h.point!==q;)for(;;){m=h.getAvailableLinkedEvents();if(0===m.length)throw c=g[0].point,f=g[g.length-1].point,Error("Unable to complete output ring starting at [".concat(c.x,",")+" ".concat(c.y,"]. Last matching segment found ends at")+
" [".concat(f.x,", ").concat(f.y,"]."));if(1===m.length){m=m[0].otherSE;break}for(var r=null,v=0,A=p.length;v<A;v++)if(p[v].point===h.point){r=v;break}if(null===r){p.push({index:g.length,point:h.point});l=h.getLeftmostComparator(l);m=m.sort(l)[0].otherSE;break}m=p.splice(r)[0];m=g.splice(m.index);m.unshift(m[0].otherSE);f.push(new b(m.reverse()))}f.push(new b(g))}}return f}}]),bd(b,[{key:"getGeom",value:function(){for(var c=this.events[0].point,f=[c],k=1,d=this.events.length-1;k<d;k++){var g=this.events[k].point;
0!==Xm(g,c,this.events[k+1].point)&&(f.push(g),c=g)}if(1===f.length)return null;0===Xm(f[0],c,f[1])&&f.shift();f.push(f[0]);c=this.isExteriorRing()?1:-1;g=this.isExteriorRing()?0:f.length-1;k=this.isExteriorRing()?f.length:-1;for(d=[];g!=k;g+=c)d.push([f[g].x,f[g].y]);return d}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var c=this.enclosingRing();this._isExteriorRing=!c||!c.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===
this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var c=this.events[0],f=1,k=this.events.length;f<k;f++){var d=this.events[f];0<oe.compare(c,d)&&(c=d)}for(f=(c=c.segment.prevInResult())?c.prevInResult():null;;){if(!c)return null;if(!f)return c.ringOut;if(f.ringOut!==c.ringOut)return f.ringOut.enclosingRing()!==c.ringOut?c.ringOut:c.ringOut.enclosingRing();f=(c=f.prevInResult())?c.prevInResult():null}}}]),b}(),
bn=function(){function b(c){yd(this,b);this.exteriorRing=c;c.poly=this;this.interiorRings=[]}return bd(b,[{key:"addInterior",value:function(c){this.interiorRings.push(c);c.poly=this}},{key:"getGeom",value:function(){var c=[this.exteriorRing.getGeom()];if(null===c[0])return null;for(var f=0,k=this.interiorRings.length;f<k;f++){var d=this.interiorRings[f].getGeom();null!==d&&c.push(d)}return c}}]),b}(),qp=function(){function b(c){yd(this,b);this.rings=c;this.polys=this._composePolys(c)}return bd(b,
[{key:"getGeom",value:function(){for(var c=[],f=0,k=this.polys.length;f<k;f++){var d=this.polys[f].getGeom();null!==d&&c.push(d)}return c}},{key:"_composePolys",value:function(c){for(var f=[],k=0,d=c.length;k<d;k++){var g=c[k];if(!g.poly)if(g.isExteriorRing())f.push(new bn(g));else{var l=g.enclosingRing();l.poly||f.push(new bn(l));l.poly.addInterior(g)}}return f}}]),b}(),rp=function(){function b(c){var f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:Wh.compare;yd(this,b);this.queue=c;this.tree=
new Cj(f);this.segments=[]}return bd(b,[{key:"process",value:function(c){var f=c.segment,k=[];if(c.consumedBy)return c.isLeft?this.queue.remove(c.otherSE):this.tree.remove(f),k;var d=c.isLeft?this.tree.insert(f):this.tree.find(f);if(!d)throw Error("Unable to find segment #".concat(f.id," ")+"[".concat(f.leftSE.point.x,", ").concat(f.leftSE.point.y,"] -> ")+"[".concat(f.rightSE.point.x,", ").concat(f.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var g=d,l=d,h=d=void 0;void 0===
d;)null===(g=this.tree.prev(g))?d=null:void 0===g.key.consumedBy&&(d=g.key);for(;void 0===h;)null===(l=this.tree.next(l))?h=null:void 0===l.key.consumedBy&&(h=l.key);if(c.isLeft){g=null;if(d&&(l=d.getIntersection(f),null!==l&&(f.isAnEndpoint(l)||(g=l),!d.isAnEndpoint(l)))){l=this._splitSafely(d,l);for(var m=0,q=l.length;m<q;m++)k.push(l[m])}l=null;if(h&&(m=h.getIntersection(f),null!==m&&(f.isAnEndpoint(m)||(l=m),!h.isAnEndpoint(m))))for(h=this._splitSafely(h,m),m=0,q=h.length;m<q;m++)k.push(h[m]);
if(null!==g||null!==l)for(h=null===g?l:null===l?g:0>=oe.comparePoints(g,l)?g:l,this.queue.remove(f.rightSE),k.push(f.rightSE),h=f.split(h),g=0,l=h.length;g<l;g++)k.push(h[g]);0<k.length?(this.tree.remove(f),k.push(c)):(this.segments.push(f),f.prev=d)}else{if(d&&h&&(c=d.getIntersection(h),null!==c)){if(!d.isAnEndpoint(c))for(d=this._splitSafely(d,c),g=0,l=d.length;g<l;g++)k.push(d[g]);if(!h.isAnEndpoint(c))for(c=this._splitSafely(h,c),d=0,h=c.length;d<h;d++)k.push(c[d])}this.tree.remove(f)}return k}},
{key:"_splitSafely",value:function(c,f){this.tree.remove(c);var k=c.rightSE;this.queue.remove(k);f=c.split(f);return f.push(k),void 0===c.consumedBy&&this.tree.insert(c),f}}]),b}(),cn="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1E6,sp="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1E6,Ud=new (function(){function b(){yd(this,b)}return bd(b,[{key:"run",value:function(c,f,k){Ud.type=c;Ng.reset();c=[new an(f,!0)];f=0;for(var d=k.length;f<
d;f++)c.push(new an(k[f],!1));if(Ud.numMultiPolys=c.length,"difference"===Ud.type)for(k=c[0],f=1;f<c.length;)null!==Dj(c[f].bbox,k.bbox)?f++:c.splice(f,1);if("intersection"===Ud.type)for(k=0,f=c.length;k<f;k++){d=c[k];for(var g=k+1,l=c.length;g<l;g++)if(null===Dj(d.bbox,c[g].bbox))return[]}k=new Cj(oe.compare);f=0;for(d=c.length;f<d;f++){g=c[f].getSweepEvents();l=0;for(var h=g.length;l<h;l++)if(k.insert(g[l]),k.size>cn)throw Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");
}c=new rp(k);f=k.size;for(d=k.pop();d;){d=d.key;if(k.size===f)throw c=d.segment,Error("Unable to pop() ".concat(d.isLeft?"left":"right"," SweepEvent ")+"[".concat(d.point.x,", ").concat(d.point.y,"] from segment #").concat(c.id," ")+"[".concat(c.leftSE.point.x,", ").concat(c.leftSE.point.y,"] -> ")+"[".concat(c.rightSE.point.x,", ").concat(c.rightSE.point.y,"] from queue. ")+"Please file a bug report.");if(k.size>cn)throw Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");
if(c.segments.length>sp)throw Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");f=c.process(d);d=0;for(g=f.length;d<g;d++)l=f[d],void 0===l.consumedBy&&k.insert(l);f=k.size;d=k.pop()}Ng.reset();c=pp.factory(c.segments);return(new qp(c)).getGeom()}}]),b}()),Ce={union:function(b){for(var c=arguments.length,f=Array(1<c?c-1:0),k=1;k<c;k++)f[k-1]=arguments[k];return Ud.run("union",b,f)},intersection:function(b){for(var c=arguments.length,
f=Array(1<c?c-1:0),k=1;k<c;k++)f[k-1]=arguments[k];return Ud.run("intersection",b,f)},xor:function(b){for(var c=arguments.length,f=Array(1<c?c-1:0),k=1;k<c;k++)f[k-1]=arguments[k];return Ud.run("xor",b,f)},difference:function(b){for(var c=arguments.length,f=Array(1<c?c-1:0),k=1;k<c;k++)f[k-1]=arguments[k];return Ud.run("difference",b,f)}};"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(b){if(null==this)throw new TypeError(this+" is not an object");
var c=Object(this),f=Math.max(Math.min(c.length,9007199254740991),0)||0,k=1 in arguments&&parseInt(Number(arguments[1]),10)||0;k=0>k?Math.max(f+k,0):Math.min(k,f);var d=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:f;for(d=0>d?Math.max(f+arguments[2],0):Math.min(d,f);k<d;)c[k]=b,++k;return c},writable:!0});Number.isFinite=Number.isFinite||function(b){return"number"==typeof b&&isFinite(b)};Number.isInteger=Number.isInteger||function(b){return"number"==typeof b&&isFinite(b)&&
Math.floor(b)===b};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(b){return b!=b};Math.trunc=Math.trunc||function(b){return 0>b?Math.ceil(b):Math.floor(b)};var nf=function(){};nf.prototype.interfaces_=function(){return[]};nf.prototype.getClass=function(){return nf};nf.prototype.equalsWithTolerance=function(b,c,f){return Math.abs(b-c)<=f};var ac=function(b){function c(f){b.call(this,f);this.name="IllegalArgumentException";this.message=f;this.stack=(new b).stack}
return b&&(c.__proto__=b),c.prototype=Object.create(b&&b.prototype),c.prototype.constructor=c,c}(Error),Wa=function(){},dn={MAX_VALUE:{configurable:!0}};Wa.isNaN=function(b){return Number.isNaN(b)};Wa.doubleToLongBits=function(b){return b};Wa.longBitsToDouble=function(b){return b};Wa.isInfinite=function(b){return!Number.isFinite(b)};dn.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Wa,dn);var jd=function(){},Xh=function(){},Rf=function(){},sa=function c(){if(this.x=null,
this.y=null,this.z=null,0===arguments.length)this.y=this.x=0,this.z=c.NULL_ORDINATE;else if(1===arguments.length){var f=arguments[0];this.x=f.x;this.y=f.y;this.z=f.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=c.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},of={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};
sa.prototype.setOrdinate=function(c,f){switch(c){case sa.X:this.x=f;break;case sa.Y:this.y=f;break;case sa.Z:this.z=f;break;default:throw new ac("Invalid ordinate index: "+c);}};sa.prototype.equals2D=function(){if(1===arguments.length){var c=arguments[0];return this.x===c.x&&this.y===c.y}if(2===arguments.length){c=arguments[0];var f=arguments[1];return!!nf.equalsWithTolerance(this.x,c.x,f)&&!!nf.equalsWithTolerance(this.y,c.y,f)}};sa.prototype.getOrdinate=function(c){switch(c){case sa.X:return this.x;
case sa.Y:return this.y;case sa.Z:return this.z}throw new ac("Invalid ordinate index: "+c);};sa.prototype.equals3D=function(c){return this.x===c.x&&this.y===c.y&&(this.z===c.z||Wa.isNaN(this.z))&&Wa.isNaN(c.z)};sa.prototype.equals=function(c){return c instanceof sa&&this.equals2D(c)};sa.prototype.equalInZ=function(c,f){return nf.equalsWithTolerance(this.z,c.z,f)};sa.prototype.compareTo=function(c){return this.x<c.x?-1:this.x>c.x?1:this.y<c.y?-1:this.y>c.y?1:0};sa.prototype.clone=function(){};sa.prototype.copy=
function(){return new sa(this)};sa.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};sa.prototype.distance3D=function(c){var f=this.x-c.x,k=this.y-c.y;c=this.z-c.z;return Math.sqrt(f*f+k*k+c*c)};sa.prototype.distance=function(c){var f=this.x-c.x;c=this.y-c.y;return Math.sqrt(f*f+c*c)};sa.prototype.hashCode=function(){return 37*(629+sa.hashCode(this.x))+sa.hashCode(this.y)};sa.prototype.setCoordinate=function(c){this.x=c.x;this.y=c.y;this.z=c.z};sa.prototype.interfaces_=function(){return[jd,
Xh,id]};sa.prototype.getClass=function(){return sa};sa.hashCode=function(){if(1===arguments.length){var c=Wa.doubleToLongBits(arguments[0]);return Math.trunc((c^c)>>>32)}};of.DimensionalComparator.get=function(){return De};of.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800};of.NULL_ORDINATE.get=function(){return Wa.NaN};of.X.get=function(){return 0};of.Y.get=function(){return 1};of.Z.get=function(){return 2};Object.defineProperties(sa,of);var De=function(c){if((this._dimensionsToTest=2,
0!==arguments.length)&&1===arguments.length){var f=arguments[0];if(2!==f&&3!==f)throw new ac("only 2 or 3 dimensions may be specified");this._dimensionsToTest=f}};De.prototype.compare=function(c,f){var k=De.compare(c.x,f.x);if(0!==k)return k;k=De.compare(c.y,f.y);return 0!==k?k:2>=this._dimensionsToTest?0:De.compare(c.z,f.z)};De.prototype.interfaces_=function(){return[Rf]};De.prototype.getClass=function(){return De};De.compare=function(c,f){return c<f?-1:c>f?1:Wa.isNaN(c)?Wa.isNaN(f)?0:-1:Wa.isNaN(f)?
1:0};var Sf=function(){};Sf.prototype.create=function(){};Sf.prototype.interfaces_=function(){return[]};Sf.prototype.getClass=function(){return Sf};var ua=function(){},Qg={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};ua.prototype.interfaces_=function(){return[]};ua.prototype.getClass=function(){return ua};ua.toLocationSymbol=function(c){switch(c){case ua.EXTERIOR:return"e";case ua.BOUNDARY:return"b";case ua.INTERIOR:return"i";case ua.NONE:return"-"}throw new ac("Unknown location value: "+
c);};Qg.INTERIOR.get=function(){return 0};Qg.BOUNDARY.get=function(){return 1};Qg.EXTERIOR.get=function(){return 2};Qg.NONE.get=function(){return-1};Object.defineProperties(ua,Qg);var Va=function(c,f){return c.interfaces_&&-1<c.interfaces_().indexOf(f)},cd=function(){},en={LOG_10:{configurable:!0}};cd.prototype.interfaces_=function(){return[]};cd.prototype.getClass=function(){return cd};cd.log10=function(c){c=Math.log(c);return Wa.isInfinite(c)||Wa.isNaN(c)?c:c/cd.LOG_10};cd.min=function(c,f,k,d){return f<
c&&(c=f),k<c&&(c=k),d<c&&(c=d),c};cd.clamp=function(c,f,k){if("number"==typeof k&&"number"==typeof c&&"number"==typeof f||Number.isInteger(k)&&Number.isInteger(c)&&Number.isInteger(f))return c<f?f:c>k?k:c};cd.wrap=function(c,f){return 0>c?f- -c%f:c%f};cd.max=function(){if(3===arguments.length){var c=arguments[1],f=arguments[2],k=arguments[0];return c>k&&(k=c),f>k&&(k=f),k}if(4===arguments.length){c=arguments[1];f=arguments[2];k=arguments[3];var d=arguments[0];return c>d&&(d=c),f>d&&(d=f),k>d&&(d=
k),d}};cd.average=function(c,f){return(c+f)/2};en.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(cd,en);var Cd=function(c){this.str=c};Cd.prototype.append=function(c){this.str+=c};Cd.prototype.setCharAt=function(c,f){this.str=this.str.substr(0,c)+f+this.str.substr(c+1)};Cd.prototype.toString=function(c){return this.str};var Dd=function(c){this.value=c};Dd.prototype.intValue=function(){return this.value};Dd.prototype.compareTo=function(c){return this.value<c?-1:this.value>c?1:0};
Dd.isNaN=function(c){return Number.isNaN(c)};var Rg=function(){};Rg.isWhitespace=function(c){return 32>=c&&0<=c||127===c};Rg.toUpperCase=function(c){return c.toUpperCase()};var va=function f(){(this._hi=0,this._lo=0,0===arguments.length)?this.init(0):1===arguments.length?"number"==typeof arguments[0]?this.init(arguments[0]):arguments[0]instanceof f?this.init(arguments[0]):"string"==typeof arguments[0]&&f.call(this,f.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},
rd={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};va.prototype.le=function(f){return(this._hi<f._hi||this._hi===f._hi)&&this._lo<=f._lo};va.prototype.extractSignificantDigits=function(f,k){var d=this.abs(),g=va.magnitude(d._hi),l=va.TEN.pow(g);
(d=d.divide(l)).gt(va.TEN)?(d=d.divide(va.TEN),g+=1):d.lt(va.ONE)&&(d=d.multiply(va.TEN),--g);l=g+1;for(var h=new Cd,m=va.MAX_PRINT_DIGITS-1,q=0;q<=m;q++){f&&q===l&&h.append(".");var p=Math.trunc(d._hi);if(0>p)break;var r=!1,v=0;9<p?(r=!0,v="9"):v="0"+p;h.append(v);d=d.subtract(va.valueOf(p)).multiply(va.TEN);r&&d.selfAdd(va.TEN);p=!0;r=va.magnitude(d._hi);if(0>r&&Math.abs(r)>=m-q&&(p=!1),!p)break}return k[0]=g,h.toString()};va.prototype.sqr=function(){return this.multiply(this)};va.prototype.doubleValue=
function(){return this._hi+this._lo};va.prototype.subtract=function(f){if(f instanceof va)return this.add(f.negate());if("number"==typeof f)return this.add(-f)};va.prototype.equals=function(){if(1===arguments.length){var f=arguments[0];return this._hi===f._hi&&this._lo===f._lo}};va.prototype.isZero=function(){return 0===this._hi&&0===this._lo};va.prototype.selfSubtract=function(f){if(f instanceof va)return this.isNaN()?this:this.selfAdd(-f._hi,-f._lo);if("number"==typeof f)return this.isNaN()?this:
this.selfAdd(-f,0)};va.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};va.prototype.min=function(f){return this.le(f)?this:f};va.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof va){var f=arguments[0];return this.selfDivide(f._hi,f._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){f=arguments[0];var k=arguments[1],d=null,g=null,l=null,h=null,m=null,q=null,p=null,
r=null;return m=this._hi/f,r=(d=(q=va.SPLIT*m)-(d=q-m))*(l=(r=va.SPLIT*f)-(l=r-f))-(p=m*f)+d*(h=f-l)+(g=m-d)*l+g*h,r=m+(q=(this._hi-p-r+this._lo-m*k)/f),this._hi=r,this._lo=m-r+q,this}};va.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};va.prototype.divide=function(f){if(f instanceof va){var k,d=null,g=null,l=null,h=null,m=null;var q=(l=this._hi/f._hi)-(k=(h=va.SPLIT*l)-(k=h-l));m=k*(d=(m=va.SPLIT*f._hi)-(d=m-f._hi))-(h=l*f._hi)+k*(g=f._hi-d)+q*d+q*g;f=m=l+(h=(this._hi-h-m+this._lo-
l*f._lo)/f._hi);return new va(f,l-m+h)}if("number"==typeof f)return Wa.isNaN(f)?va.createNaN():va.copy(this).selfDivide(f,0)};va.prototype.ge=function(f){return(this._hi>f._hi||this._hi===f._hi)&&this._lo>=f._lo};va.prototype.pow=function(f){if(0===f)return va.valueOf(1);var k=new va(this),d=va.valueOf(1),g=Math.abs(f);if(1<g)for(;0<g;)1==g%2&&d.selfMultiply(k),0<(g/=2)&&(k=k.sqr());else d=k;return 0>f?d.reciprocal():d};va.prototype.ceil=function(){if(this.isNaN())return va.NaN;var f=Math.ceil(this._hi),
k=0;return f===this._hi&&(k=Math.ceil(this._lo)),new va(f,k)};va.prototype.compareTo=function(f){return this._hi<f._hi?-1:this._hi>f._hi?1:this._lo<f._lo?-1:this._lo>f._lo?1:0};va.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()};va.prototype.setValue=function(f){if(f instanceof va||"number"==typeof f)return this.init(f),this};va.prototype.max=function(f){return this.ge(f)?this:f};va.prototype.sqrt=function(){if(this.isZero())return va.valueOf(0);if(this.isNegative())return va.NaN;
var f=1/Math.sqrt(this._hi),k=va.valueOf(this._hi*f);f*=.5*this.subtract(k.sqr())._hi;return k.add(f)};va.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof va){var f=arguments[0];return this.selfAdd(f._hi,f._lo)}if("number"==typeof arguments[0]){f=arguments[0];var k=null,d=null,g=null,l=null,h=null,m=null;return l=(g=this._hi+f)-(h=g-this._hi),d=(m=f-h+(this._hi-l)+this._lo)+(g-(k=g+m)),this._hi=k+d,this._lo=d+(k-this._hi),this}}else if(2===arguments.length){m=arguments[0];
f=arguments[1];k=null;g=this._hi+m;var q=this._lo+f;var p=g-(l=g-this._hi);d=q-(h=q-this._lo);m=(k=g+(l=m-l+(this._hi-p)+q))+(l=f-h+(this._lo-d)+(l+(g-k)));return this._hi=m,this._lo=l+(k-m),this}};va.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof va){var f=arguments[0];return this.selfMultiply(f._hi,f._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){f=arguments[0];var k=arguments[1],d=null,g;var l=(g=
va.SPLIT*this._hi)-this._hi;var h=va.SPLIT*f;l=g-l;var m=this._hi-l;var q=h-f;var p=(g=this._hi*f)+(h=l*(q=h-q)-g+l*(d=f-q)+m*q+m*d+(this._hi*k+this._lo*f));return this._hi=p,this._lo=h+(g-p),this}};va.prototype.selfSqr=function(){return this.selfMultiply(this)};va.prototype.floor=function(){if(this.isNaN())return va.NaN;var f=Math.floor(this._hi),k=0;return f===this._hi&&(k=Math.floor(this._lo)),new va(f,k)};va.prototype.negate=function(){return this.isNaN()?this:new va(-this._hi,-this._lo)};va.prototype.clone=
function(){};va.prototype.multiply=function(f){if(f instanceof va)return f.isNaN()?va.createNaN():va.copy(this).selfMultiply(f);if("number"==typeof f)return Wa.isNaN(f)?va.createNaN():va.copy(this).selfMultiply(f,0)};va.prototype.isNaN=function(){return Wa.isNaN(this._hi)};va.prototype.intValue=function(){return Math.trunc(this._hi)};va.prototype.toString=function(){var f=va.magnitude(this._hi);return-3<=f&&20>=f?this.toStandardNotation():this.toSciNotation()};va.prototype.toStandardNotation=function(){var f=
this.getSpecialNumberString();if(null!==f)return f;var k=Array(1).fill(null);f=this.extractSignificantDigits(!0,k);k=k[0]+1;var d=f;"."===f.charAt(0)?d="0"+f:0>k?d="0."+va.stringOfChar("0",-k)+f:-1===f.indexOf(".")&&(d=f+va.stringOfChar("0",k-f.length)+".0");return this.isNegative()?"-"+d:d};va.prototype.reciprocal=function(){var f,k,d,g,l=null,h;var m=(k=1/this._hi)-(g=(l=va.SPLIT*k)-(g=l-k));var q=(h=va.SPLIT*this._hi)-this._hi;var p=k+(l=(1-(d=k*this._hi)-(g*(q=h-q)-d+g*(f=this._hi-q)+m*q+m*f)-
k*this._lo)/this._hi);return new va(p,k-p+l)};va.prototype.toSciNotation=function(){if(this.isZero())return va.SCI_NOT_ZERO;var f=this.getSpecialNumberString();if(null!==f)return f;var k=Array(1).fill(null);f=this.extractSignificantDigits(!1,k);k=va.SCI_NOT_EXPONENT_CHAR+k[0];if("0"===f.charAt(0))throw Error("Found leading zero: "+f);var d="";1<f.length&&(d=f.substring(1));f=f.charAt(0)+"."+d;return this.isNegative()?"-"+f+k:f+k};va.prototype.abs=function(){return this.isNaN()?va.NaN:this.isNegative()?
this.negate():new va(this)};va.prototype.isPositive=function(){return(0<this._hi||0===this._hi)&&0<this._lo};va.prototype.lt=function(f){return(this._hi<f._hi||this._hi===f._hi)&&this._lo<f._lo};va.prototype.add=function(f){if(f instanceof va||"number"==typeof f)return va.copy(this).selfAdd(f)};va.prototype.init=function(){if(1===arguments.length)if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else{if(arguments[0]instanceof va){var f=arguments[0];this._hi=f._hi;this._lo=f._lo}}else 2===
arguments.length&&(f=arguments[1],this._hi=arguments[0],this._lo=f)};va.prototype.gt=function(f){return(this._hi>f._hi||this._hi===f._hi)&&this._lo>f._lo};va.prototype.isNegative=function(){return(0>this._hi||0===this._hi)&&0>this._lo};va.prototype.trunc=function(){return this.isNaN()?va.NaN:this.isPositive()?this.floor():this.ceil()};va.prototype.signum=function(){return 0<this._hi?1:0>this._hi?-1:0<this._lo?1:0>this._lo?-1:0};va.prototype.interfaces_=function(){return[id,jd,Xh]};va.prototype.getClass=
function(){return va};va.sqr=function(f){return va.valueOf(f).selfMultiply(f)};va.valueOf=function(f){if("string"==typeof f)return va.parse(f);if("number"==typeof f)return new va(f)};va.sqrt=function(f){return va.valueOf(f).sqrt()};va.parse=function(f){for(var k=0,d=f.length;Rg.isWhitespace(f.charAt(k));)k++;var g=!1;if(k<d){var l=f.charAt(k);"-"!==l&&"+"!==l||(k++,"-"===l&&(g=!0))}l=new va;for(var h=0,m=0,q=0;!(k>=d);){var p=f.charAt(k);if(k++,Rg.isDigit(p))p-=0,l.selfMultiply(va.TEN),l.selfAdd(p),
h++;else{if("."!==p){if("e"===p||"E"===p){k=f.substring(k);try{q=Dd.parseInt(k)}catch(r){throw r instanceof Error?Error("Invalid exponent "+k+" in string "+f):r;}break}throw Error("Unexpected character '"+p+"' at position "+k+" in string "+f);}m=h}}f=l;h=h-m-q;0===h?f=l:0<h?(f=va.TEN.pow(h),f=l.divide(f)):0>h&&(f=va.TEN.pow(-h),f=l.multiply(f));return g?f.negate():f};va.createNaN=function(){return new va(Wa.NaN,Wa.NaN)};va.copy=function(f){return new va(f)};va.magnitude=function(f){f=Math.abs(f);
var k=Math.trunc(Math.floor(Math.log(f)/Math.log(10)));return 10*Math.pow(10,k)<=f&&(k+=1),k};va.stringOfChar=function(f,k){for(var d=new Cd,g=0;g<k;g++)d.append(f);return d.toString()};rd.PI.get=function(){return new va(3.141592653589793,1.2246467991473532E-16)};rd.TWO_PI.get=function(){return new va(6.283185307179586,2.4492935982947064E-16)};rd.PI_2.get=function(){return new va(1.5707963267948966,6.123233995736766E-17)};rd.E.get=function(){return new va(2.718281828459045,1.4456468917292502E-16)};
rd.NaN.get=function(){return new va(Wa.NaN,Wa.NaN)};rd.EPS.get=function(){return 1.23259516440783E-32};rd.SPLIT.get=function(){return 134217729};rd.MAX_PRINT_DIGITS.get=function(){return 32};rd.TEN.get=function(){return va.valueOf(10)};rd.ONE.get=function(){return va.valueOf(1)};rd.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};rd.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(va,rd);var Xc=function(){},fn={DP_SAFE_EPSILON:{configurable:!0}};Xc.prototype.interfaces_=function(){return[]};
Xc.prototype.getClass=function(){return Xc};Xc.orientationIndex=function(f,k,d){var g=Xc.orientationIndexFilter(f,k,d);if(1>=g)return g;g=va.valueOf(k.x).selfAdd(-f.x);f=va.valueOf(k.y).selfAdd(-f.y);var l=va.valueOf(d.x).selfAdd(-k.x);k=va.valueOf(d.y).selfAdd(-k.y);return g.selfMultiply(k).selfSubtract(f.selfMultiply(l)).signum()};Xc.signOfDet2x2=function(f,k,d,g){return f.multiply(g).selfSubtract(k.multiply(d)).signum()};Xc.intersection=function(f,k,d,g){var l=va.valueOf(g.y).selfSubtract(d.y).selfMultiply(va.valueOf(k.x).selfSubtract(f.x)),
h=va.valueOf(g.x).selfSubtract(d.x).selfMultiply(va.valueOf(k.y).selfSubtract(f.y));l=l.subtract(h);h=va.valueOf(g.x).selfSubtract(d.x).selfMultiply(va.valueOf(f.y).selfSubtract(d.y));var m=va.valueOf(g.y).selfSubtract(d.y).selfMultiply(va.valueOf(f.x).selfSubtract(d.x));h=h.subtract(m).selfDivide(l).doubleValue();h=va.valueOf(f.x).selfAdd(va.valueOf(k.x).selfSubtract(f.x).selfMultiply(h)).doubleValue();m=va.valueOf(k.x).selfSubtract(f.x).selfMultiply(va.valueOf(f.y).selfSubtract(d.y));f=va.valueOf(k.y).selfSubtract(f.y).selfMultiply(va.valueOf(f.x).selfSubtract(d.x));
f=m.subtract(f).selfDivide(l).doubleValue();d=va.valueOf(d.y).selfAdd(va.valueOf(g.y).selfSubtract(d.y).selfMultiply(f)).doubleValue();return new sa(h,d)};Xc.orientationIndexFilter=function(f,k,d){var g=(f.x-d.x)*(k.y-d.y);k=(f.y-d.y)*(k.x-d.x);f=g-k;if(0<g){if(0>=k)return Xc.signum(f);g+=k}else{if(!(0>g)||0<=k)return Xc.signum(f);g=-g-k}g*=Xc.DP_SAFE_EPSILON;return f>=g||-f>=g?Xc.signum(f):2};Xc.signum=function(f){return 0<f?1:0>f?-1:0};fn.DP_SAFE_EPSILON.get=function(){return 1E-15};Object.defineProperties(Xc,
fn);var db=function(){},Sg={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Sg.X.get=function(){return 0};Sg.Y.get=function(){return 1};Sg.Z.get=function(){return 2};Sg.M.get=function(){return 3};db.prototype.setOrdinate=function(f,k,d){};db.prototype.size=function(){};db.prototype.getOrdinate=function(f,k){};db.prototype.getCoordinate=function(){};db.prototype.getCoordinateCopy=function(f){};db.prototype.getDimension=function(){};db.prototype.getX=function(f){};db.prototype.clone=
function(){};db.prototype.expandEnvelope=function(f){};db.prototype.copy=function(){};db.prototype.getY=function(f){};db.prototype.toCoordinateArray=function(){};db.prototype.interfaces_=function(){return[Xh]};db.prototype.getClass=function(){return db};Object.defineProperties(db,Sg);var gn=function(){},Tf=function(f){function k(){f.call(this,"Projective point not representable on the Cartesian plane.")}return f&&(k.__proto__=f),k.prototype=Object.create(f&&f.prototype),k.prototype.constructor=k,
k.prototype.interfaces_=function(){return[]},k.prototype.getClass=function(){return k},k}(gn),Oc=function(){};Oc.arraycopy=function(f,k,d,g,l){for(var h=0,m=k;m<k+l;m++)d[g+h]=f[m],h++};Oc.getProperty=function(f){return{"line.separator":"\n"}[f]};var sd=function k(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.y=this.x=0,this.w=1;else if(1===arguments.length){var d=arguments[0];this.x=d.x;this.y=d.y;this.w=1}else if(2===arguments.length)if("number"==typeof arguments[0]&&"number"==
typeof arguments[1])d=arguments[1],this.x=arguments[0],this.y=d,this.w=1;else if(arguments[0]instanceof k&&arguments[1]instanceof k){d=arguments[0];var g=arguments[1];this.x=d.y*g.w-g.y*d.w;this.y=g.x*d.w-d.x*g.w;this.w=d.x*g.y-g.x*d.y}else arguments[0]instanceof sa&&arguments[1]instanceof sa&&(d=arguments[0],g=arguments[1],this.x=d.y-g.y,this.y=g.x-d.x,this.w=d.x*g.y-g.x*d.y);else if(3===arguments.length)d=arguments[1],g=arguments[2],this.x=arguments[0],this.y=d,this.w=g;else if(4===arguments.length){var l=
arguments[0],h=arguments[1],m=arguments[2],q=arguments[3];d=l.y-h.y;g=h.x-l.x;l=l.x*h.y-h.x*l.y;h=m.y-q.y;var p=q.x-m.x;m=m.x*q.y-q.x*m.y;this.x=g*m-p*l;this.y=h*l-d*m;this.w=d*p-h*g}};sd.prototype.getY=function(){var k=this.y/this.w;if(Wa.isNaN(k)||Wa.isInfinite(k))throw new Tf;return k};sd.prototype.getX=function(){var k=this.x/this.w;if(Wa.isNaN(k)||Wa.isInfinite(k))throw new Tf;return k};sd.prototype.getCoordinate=function(){var k=new sa;return k.x=this.getX(),k.y=this.getY(),k};sd.prototype.interfaces_=
function(){return[]};sd.prototype.getClass=function(){return sd};sd.intersection=function(k,d,g,l){var h=k.y-d.y,m=d.x-k.x;k=k.x*d.y-d.x*k.y;d=g.y-l.y;var q=l.x-g.x;g=g.x*l.y-l.x*g.y;l=h*q-d*m;m=(m*g-q*k)/l;h=(d*k-h*g)/l;if(Wa.isNaN(m)||Wa.isInfinite(m)||Wa.isNaN(h)||Wa.isInfinite(h))throw new Tf;return new sa(m,h)};var Ia=function d(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof sa){var g=
arguments[0];this.init(g.x,g.x,g.y,g.y)}else arguments[0]instanceof d&&this.init(arguments[0]);else if(2===arguments.length){g=arguments[0];var l=arguments[1];this.init(g.x,l.x,g.y,l.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},hn={serialVersionUID:{configurable:!0}};Ia.prototype.getArea=function(){return this.getWidth()*this.getHeight()};Ia.prototype.equals=function(d){return d instanceof Ia?this.isNull()?d.isNull():this._maxx===d.getMaxX()&&this._maxy===
d.getMaxY()&&this._minx===d.getMinX()&&this._miny===d.getMinY():!1};Ia.prototype.intersection=function(d){return this.isNull()||d.isNull()||!this.intersects(d)?new Ia:new Ia(this._minx>d._minx?this._minx:d._minx,this._maxx<d._maxx?this._maxx:d._maxx,this._miny>d._miny?this._miny:d._miny,this._maxy<d._maxy?this._maxy:d._maxy)};Ia.prototype.isNull=function(){return this._maxx<this._minx};Ia.prototype.getMaxX=function(){return this._maxx};Ia.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof
sa){var d=arguments[0];return this.covers(d.x,d.y)}if(arguments[0]instanceof Ia)return d=arguments[0],!this.isNull()&&!d.isNull()&&d.getMinX()>=this._minx&&d.getMaxX()<=this._maxx&&d.getMinY()>=this._miny&&d.getMaxY()<=this._maxy}else if(2===arguments.length){d=arguments[0];var g=arguments[1];return!this.isNull()&&d>=this._minx&&d<=this._maxx&&g>=this._miny&&g<=this._maxy}};Ia.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Ia){var d=arguments[0];return!this.isNull()&&
!d.isNull()&&!(d._minx>this._maxx||d._maxx<this._minx||d._miny>this._maxy||d._maxy<this._miny)}if(arguments[0]instanceof sa)return d=arguments[0],this.intersects(d.x,d.y)}else if(2===arguments.length){d=arguments[0];var g=arguments[1];return!this.isNull()&&!(d>this._maxx||d<this._minx||g>this._maxy||g<this._miny)}};Ia.prototype.getMinY=function(){return this._miny};Ia.prototype.getMinX=function(){return this._minx};Ia.prototype.expandToInclude=function(){if(1===arguments.length)if(arguments[0]instanceof
sa){var d=arguments[0];this.expandToInclude(d.x,d.y)}else{if(arguments[0]instanceof Ia){d=arguments[0];if(d.isNull())return null;this.isNull()?(this._minx=d.getMinX(),this._maxx=d.getMaxX(),this._miny=d.getMinY(),this._maxy=d.getMaxY()):(d._minx<this._minx&&(this._minx=d._minx),d._maxx>this._maxx&&(this._maxx=d._maxx),d._miny<this._miny&&(this._miny=d._miny),d._maxy>this._maxy&&(this._maxy=d._maxy))}}else if(2===arguments.length){d=arguments[0];var g=arguments[1];this.isNull()?(this._minx=d,this._maxx=
d,this._miny=g,this._maxy=g):(d<this._minx&&(this._minx=d),d>this._maxx&&(this._maxx=d),g<this._miny&&(this._miny=g),g>this._maxy&&(this._maxy=g))}};Ia.prototype.minExtent=function(){if(this.isNull())return 0;var d=this.getWidth(),g=this.getHeight();return d<g?d:g};Ia.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};Ia.prototype.compareTo=function(d){return this.isNull()?d.isNull()?0:-1:d.isNull()?1:this._minx<d._minx?-1:this._minx>d._minx?1:this._miny<d._miny?-1:this._miny>
d._miny?1:this._maxx<d._maxx?-1:this._maxx>d._maxx?1:this._maxy<d._maxy?-1:this._maxy>d._maxy?1:0};Ia.prototype.translate=function(d,g){if(this.isNull())return null;this.init(this.getMinX()+d,this.getMaxX()+d,this.getMinY()+g,this.getMaxY()+g)};Ia.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};Ia.prototype.setToNull=function(){this._minx=0;this._maxx=-1;this._miny=0;this._maxy=-1};Ia.prototype.getHeight=function(){return this.isNull()?
0:this._maxy-this._miny};Ia.prototype.maxExtent=function(){if(this.isNull())return 0;var d=this.getWidth(),g=this.getHeight();return d>g?d:g};Ia.prototype.expandBy=function(){if(1===arguments.length){var d=arguments[0];this.expandBy(d,d)}else if(2===arguments.length){d=arguments[0];var g=arguments[1];if(this.isNull())return null;this._minx-=d;this._maxx+=d;this._miny-=g;this._maxy+=g;(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};Ia.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof
Ia||arguments[0]instanceof sa)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])};Ia.prototype.centre=function(){return this.isNull()?null:new sa((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};Ia.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length)if(arguments[0]instanceof sa){var d=arguments[0];this.init(d.x,d.x,d.y,d.y)}else arguments[0]instanceof Ia&&(d=arguments[0],this._minx=
d._minx,this._maxx=d._maxx,this._miny=d._miny,this._maxy=d._maxy);else if(2===arguments.length){d=arguments[0];var g=arguments[1];this.init(d.x,g.x,d.y,g.y)}else if(4===arguments.length){d=arguments[0];g=arguments[1];var l=arguments[2],h=arguments[3];d<g?(this._minx=d,this._maxx=g):(this._minx=g,this._maxx=d);l<h?(this._miny=l,this._maxy=h):(this._miny=h,this._maxy=l)}};Ia.prototype.getMaxY=function(){return this._maxy};Ia.prototype.distance=function(d){if(this.intersects(d))return 0;var g=0;this._maxx<
d._minx?g=d._minx-this._maxx:this._minx>d._maxx&&(g=this._minx-d._maxx);var l=0;return this._maxy<d._miny?l=d._miny-this._maxy:this._miny>d._maxy&&(l=this._miny-d._maxy),0===g?l:0===l?g:Math.sqrt(g*g+l*l)};Ia.prototype.hashCode=function(){return 37*(37*(37*(629+sa.hashCode(this._minx))+sa.hashCode(this._maxx))+sa.hashCode(this._miny))+sa.hashCode(this._maxy)};Ia.prototype.interfaces_=function(){return[jd,id]};Ia.prototype.getClass=function(){return Ia};Ia.intersects=function(){if(3===arguments.length){var d=
arguments[0],g=arguments[1],l=arguments[2];return l.x>=(d.x<g.x?d.x:g.x)&&l.x<=(d.x>g.x?d.x:g.x)&&l.y>=(d.y<g.y?d.y:g.y)&&l.y<=(d.y>g.y?d.y:g.y)}if(4===arguments.length){d=arguments[0];g=arguments[1];l=arguments[2];var h=arguments[3],m=Math.min(l.x,h.x),q=Math.max(l.x,h.x),p=Math.min(d.x,g.x),r=Math.max(d.x,g.x);return!(p>q)&&!(r<m)&&(m=Math.min(l.y,h.y),q=Math.max(l.y,h.y),p=Math.min(d.y,g.y),r=Math.max(d.y,g.y),!(p>q)&&!(r<m))}};hn.serialVersionUID.get=function(){return 0x51845cd552189800};Object.defineProperties(Ia,
hn);var tp=/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,up=/^\s*(\w+)\s*EMPTY\s*$/,Fj=/\s+/,jn=/\)\s*,\s*\(/,vp=/\)\s*\)\s*,\s*\(\s*\(/,Yh=/^\s*\(?(.*?)\)?\s*$/,Zh=function(d){this.geometryFactory=d||new bb};Zh.prototype.read=function(d){var g,l,h;d=d.replace(/[\n\r]/g," ");var m=tp.exec(d);if(-1!==d.search("EMPTY")&&((m=up.exec(d))[2]=void 0),m&&(l=m[1].toLowerCase(),h=m[2],Uf[l]&&(g=Uf[l].apply(this,[h]))),void 0===g)throw Error("Could not parse WKT "+d);return g};Zh.prototype.write=function(d){return this.extractGeometry(d)};
Zh.prototype.extractGeometry=function(d){var g=d.getGeometryType().toLowerCase();if(!pe[g])return null;var l=g.toUpperCase();return d.isEmpty()?l+" EMPTY":l+"("+pe[g].apply(this,[d])+")"};var pe={coordinate:function(d){return d.x+" "+d.y},point:function(d){return pe.coordinate.call(this,d._coordinates._coordinates[0])},multipoint:function(d){for(var g=[],l=0,h=d._geometries.length;l<h;++l)g.push("("+pe.point.apply(this,[d._geometries[l]])+")");return g.join(",")},linestring:function(d){for(var g=
[],l=0,h=d._points._coordinates.length;l<h;++l)g.push(pe.coordinate.apply(this,[d._points._coordinates[l]]));return g.join(",")},linearring:function(d){for(var g=[],l=0,h=d._points._coordinates.length;l<h;++l)g.push(pe.coordinate.apply(this,[d._points._coordinates[l]]));return g.join(",")},multilinestring:function(d){for(var g=[],l=0,h=d._geometries.length;l<h;++l)g.push("("+pe.linestring.apply(this,[d._geometries[l]])+")");return g.join(",")},polygon:function(d){var g=[];g.push("("+pe.linestring.apply(this,
[d._shell])+")");for(var l=0,h=d._holes.length;l<h;++l)g.push("("+pe.linestring.apply(this,[d._holes[l]])+")");return g.join(",")},multipolygon:function(d){for(var g=[],l=0,h=d._geometries.length;l<h;++l)g.push("("+pe.polygon.apply(this,[d._geometries[l]])+")");return g.join(",")},geometrycollection:function(d){for(var g=[],l=0,h=d._geometries.length;l<h;++l)g.push(this.extractGeometry(d._geometries[l]));return g.join(",")}},Uf={point:function(d){if(void 0===d)return this.geometryFactory.createPoint();
d=d.trim().split(Fj);return this.geometryFactory.createPoint(new sa(Number.parseFloat(d[0]),Number.parseFloat(d[1])))},multipoint:function(d){if(void 0===d)return this.geometryFactory.createMultiPoint();for(var g=d.trim().split(","),l=[],h=0,m=g.length;h<m;++h)d=g[h].replace(Yh,"$1"),l.push(Uf.point.apply(this,[d]));return this.geometryFactory.createMultiPoint(l)},linestring:function(d){if(void 0===d)return this.geometryFactory.createLineString();for(var g=d.trim().split(","),l=[],h=0,m=g.length;h<
m;++h)d=g[h].trim().split(Fj),l.push(new sa(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLineString(l)},linearring:function(d){if(void 0===d)return this.geometryFactory.createLinearRing();for(var g=d.trim().split(","),l=[],h=0,m=g.length;h<m;++h)d=g[h].trim().split(Fj),l.push(new sa(Number.parseFloat(d[0]),Number.parseFloat(d[1])));return this.geometryFactory.createLinearRing(l)},multilinestring:function(d){if(void 0===d)return this.geometryFactory.createMultiLineString();
for(var g=d.trim().split(jn),l=[],h=0,m=g.length;h<m;++h)d=g[h].replace(Yh,"$1"),l.push(Uf.linestring.apply(this,[d]));return this.geometryFactory.createMultiLineString(l)},polygon:function(d){if(void 0===d)return this.geometryFactory.createPolygon();var g;d=d.trim().split(jn);for(var l=[],h=0,m=d.length;h<m;++h){var q=d[h].replace(Yh,"$1");q=Uf.linestring.apply(this,[q]);q=this.geometryFactory.createLinearRing(q._points);0===h?g=q:l.push(q)}return this.geometryFactory.createPolygon(g,l)},multipolygon:function(d){if(void 0===
d)return this.geometryFactory.createMultiPolygon();for(var g=d.trim().split(vp),l=[],h=0,m=g.length;h<m;++h)d=g[h].replace(Yh,"$1"),l.push(Uf.polygon.apply(this,[d]));return this.geometryFactory.createMultiPolygon(l)},geometrycollection:function(d){if(void 0===d)return this.geometryFactory.createGeometryCollection();d=d.replace(/,\s*([A-Za-z])/g,"|$1").trim().split("|");for(var g=[],l=0,h=d.length;l<h;++l)g.push(this.read(d[l]));return this.geometryFactory.createGeometryCollection(g)}},qe=function(d){this.parser=
new Zh(d)};qe.prototype.write=function(d){return this.parser.write(d)};qe.toLineString=function(d,g){if(2!==arguments.length)throw Error("Not implemented");return"LINESTRING ( "+d.x+" "+d.y+", "+g.x+" "+g.y+" )"};var re=function(d){function g(l){d.call(this,l);this.name="RuntimeException";this.message=l;this.stack=(new d).stack}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g}(Error),$h=function(d){function g(){(d.call(this),0===arguments.length)?d.call(this):
1===arguments.length&&d.call(this,arguments[0])}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.interfaces_=function(){return[]},g.prototype.getClass=function(){return g},g}(re),Xa=function(){};Xa.prototype.interfaces_=function(){return[]};Xa.prototype.getClass=function(){return Xa};Xa.shouldNeverReachHere=function(){if(0===arguments.length)Xa.shouldNeverReachHere(null);else if(1===arguments.length){var d=arguments[0];throw new $h("Should never reach here"+
(null!==d?": "+d:""));}};Xa.isTrue=function(){var d;if(1===arguments.length)Xa.isTrue(arguments[0],null);else if(2===arguments.length&&(d=arguments[1],!arguments[0]))throw null===d?new $h:new $h(d);};Xa.equals=function(){var d,g,l;if(2===arguments.length)Xa.equals(arguments[0],arguments[1],null);else if(3===arguments.length&&(d=arguments[0],l=arguments[2],!(g=arguments[1]).equals(d)))throw new $h("Expected "+d+" but encountered "+g+(null!==l?": "+l:""));};var Xb=function(){this._result=null;this._inputLines=
Array(2).fill().map(function(){return Array(2)});this._intPt=Array(2).fill(null);this._precisionModel=this._pb=this._pa=this._isProper=this._intLineIndex=null;this._intPt[0]=new sa;this._intPt[1]=new sa;this._pa=this._intPt[0];this._pb=this._intPt[1];this._result=0},pf={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Xb.prototype.getIndexAlongSegment=
function(d,g){return this.computeIntLineIndex(),this._intLineIndex[d][g]};Xb.prototype.getTopologySummary=function(){var d=new Cd;return this.isEndPoint()&&d.append(" endpoint"),this._isProper&&d.append(" proper"),this.isCollinear()&&d.append(" collinear"),d.toString()};Xb.prototype.computeIntersection=function(d,g,l,h){this._inputLines[0][0]=d;this._inputLines[0][1]=g;this._inputLines[1][0]=l;this._inputLines[1][1]=h;this._result=this.computeIntersect(d,g,l,h)};Xb.prototype.getIntersectionNum=function(){return this._result};
Xb.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var d=arguments[0],g=this.getEdgeDistance(d,0),l=this.getEdgeDistance(d,1);g>l?(this._intLineIndex[d][0]=0,this._intLineIndex[d][1]=1):(this._intLineIndex[d][0]=1,this._intLineIndex[d][1]=0)}};Xb.prototype.isProper=function(){return this.hasIntersection()&&
this._isProper};Xb.prototype.setPrecisionModel=function(d){this._precisionModel=d};Xb.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var d=arguments[0],g=0;g<this._result;g++)if(!this._intPt[g].equals2D(this._inputLines[d][0])&&!this._intPt[g].equals2D(this._inputLines[d][1]))return!0;return!1}};Xb.prototype.getIntersection=function(d){return this._intPt[d]};Xb.prototype.isEndPoint=
function(){return this.hasIntersection()&&!this._isProper};Xb.prototype.hasIntersection=function(){return this._result!==Xb.NO_INTERSECTION};Xb.prototype.getEdgeDistance=function(d,g){return Xb.computeEdgeDistance(this._intPt[g],this._inputLines[d][0],this._inputLines[d][1])};Xb.prototype.isCollinear=function(){return this._result===Xb.COLLINEAR_INTERSECTION};Xb.prototype.toString=function(){return qe.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qe.toLineString(this._inputLines[1][0],
this._inputLines[1][1])+this.getTopologySummary()};Xb.prototype.getEndpoint=function(d,g){return this._inputLines[d][g]};Xb.prototype.isIntersection=function(d){for(var g=0;g<this._result;g++)if(this._intPt[g].equals2D(d))return!0;return!1};Xb.prototype.getIntersectionAlongSegment=function(d,g){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[d][g]]};Xb.prototype.interfaces_=function(){return[]};Xb.prototype.getClass=function(){return Xb};Xb.computeEdgeDistance=function(d,g,l){var h=
Math.abs(l.x-g.x),m=Math.abs(l.y-g.y);if(d.equals(g))h=0;else if(d.equals(l))h=h>m?h:m;else{l=Math.abs(d.x-g.x);var q=Math.abs(d.y-g.y);0!==(h=h>m?l:q)||d.equals(g)||(h=Math.max(l,q))}return Xa.isTrue(!(0===h&&!d.equals(g)),"Bad distance calculation"),h};Xb.nonRobustComputeEdgeDistance=function(d,g,l){l=d.x-g.x;var h=d.y-g.y;l=Math.sqrt(l*l+h*h);return Xa.isTrue(!(0===l&&!d.equals(g)),"Invalid distance calculation"),l};pf.DONT_INTERSECT.get=function(){return 0};pf.DO_INTERSECT.get=function(){return 1};
pf.COLLINEAR.get=function(){return 2};pf.NO_INTERSECTION.get=function(){return 0};pf.POINT_INTERSECTION.get=function(){return 1};pf.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Xb,pf);var Te=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.isInSegmentEnvelopes=function(l){var h=new Ia(this._inputLines[0][0],this._inputLines[0][1]),m=new Ia(this._inputLines[1][0],this._inputLines[1][1]);
return h.contains(l)&&m.contains(l)},g.prototype.computeIntersection=function(){if(3!==arguments.length)return d.prototype.computeIntersection.apply(this,arguments);var l=arguments[0],h=arguments[1],m=arguments[2];if(this._isProper=!1,Ia.intersects(h,m,l)&&0===Da.orientationIndex(h,m,l)&&0===Da.orientationIndex(m,h,l))return this._isProper=!0,(l.equals(h)||l.equals(m))&&(this._isProper=!1),this._result=d.POINT_INTERSECTION,null;this._result=d.NO_INTERSECTION},g.prototype.normalizeToMinimum=function(l,
h,m,q,p){p.x=this.smallestInAbsValue(l.x,h.x,m.x,q.x);p.y=this.smallestInAbsValue(l.y,h.y,m.y,q.y);l.x-=p.x;l.y-=p.y;h.x-=p.x;h.y-=p.y;m.x-=p.x;m.y-=p.y;q.x-=p.x;q.y-=p.y},g.prototype.safeHCoordinateIntersection=function(l,h,m,q){var p=null;try{p=sd.intersection(l,h,m,q)}catch(r){if(!(r instanceof Tf))throw r;p=g.nearestEndpoint(l,h,m,q)}return p},g.prototype.intersection=function(l,h,m,q){var p=this.intersectionWithNormalization(l,h,m,q);return this.isInSegmentEnvelopes(p)||(p=new sa(g.nearestEndpoint(l,
h,m,q))),null!==this._precisionModel&&this._precisionModel.makePrecise(p),p},g.prototype.smallestInAbsValue=function(l,h,m,q){var p=Math.abs(l);return Math.abs(h)<p&&(l=h,p=Math.abs(h)),Math.abs(m)<p&&(l=m,p=Math.abs(m)),Math.abs(q)<p&&(l=q),l},g.prototype.checkDD=function(l,h,m,q,p){l=Xc.intersection(l,h,m,q);h=this.isInSegmentEnvelopes(l);Oc.out.println("DD in env = "+h+"  --------------------- "+l);1E-4<p.distance(l)&&Oc.out.println("Distance = "+p.distance(l))},g.prototype.intersectionWithNormalization=
function(l,h,m,q){l=new sa(l);h=new sa(h);m=new sa(m);var p=new sa(q);q=new sa;this.normalizeToEnvCentre(l,h,m,p,q);l=this.safeHCoordinateIntersection(l,h,m,p);return l.x+=q.x,l.y+=q.y,l},g.prototype.computeCollinearIntersection=function(l,h,m,q){var p=Ia.intersects(l,h,m),r=Ia.intersects(l,h,q),v=Ia.intersects(m,q,l),A=Ia.intersects(m,q,h);return p&&r?(this._intPt[0]=m,this._intPt[1]=q,d.COLLINEAR_INTERSECTION):v&&A?(this._intPt[0]=l,this._intPt[1]=h,d.COLLINEAR_INTERSECTION):p&&v?(this._intPt[0]=
m,this._intPt[1]=l,!m.equals(l)||r||A?d.COLLINEAR_INTERSECTION:d.POINT_INTERSECTION):p&&A?(this._intPt[0]=m,this._intPt[1]=h,!m.equals(h)||r||v?d.COLLINEAR_INTERSECTION:d.POINT_INTERSECTION):r&&v?(this._intPt[0]=q,this._intPt[1]=l,!q.equals(l)||p||A?d.COLLINEAR_INTERSECTION:d.POINT_INTERSECTION):r&&A?(this._intPt[0]=q,this._intPt[1]=h,!q.equals(h)||p||v?d.COLLINEAR_INTERSECTION:d.POINT_INTERSECTION):d.NO_INTERSECTION},g.prototype.normalizeToEnvCentre=function(l,h,m,q,p){var r=l.x<h.x?l.x:h.x,v=l.y<
h.y?l.y:h.y,A=l.x>h.x?l.x:h.x,u=l.y>h.y?l.y:h.y,y=m.x<q.x?m.x:q.x,C=m.y<q.y?m.y:q.y,w=m.x>q.x?m.x:q.x,x=m.y>q.y?m.y:q.y;p.x=((r>y?r:y)+(A<w?A:w))/2;p.y=((v>C?v:C)+(u<x?u:x))/2;l.x-=p.x;l.y-=p.y;h.x-=p.x;h.y-=p.y;m.x-=p.x;m.y-=p.y;q.x-=p.x;q.y-=p.y},g.prototype.computeIntersect=function(l,h,m,q){if(this._isProper=!1,!Ia.intersects(l,h,m,q))return d.NO_INTERSECTION;var p=Da.orientationIndex(l,h,m),r=Da.orientationIndex(l,h,q);if(0<p&&0<r||0>p&&0>r)return d.NO_INTERSECTION;var v=Da.orientationIndex(m,
q,l),A=Da.orientationIndex(m,q,h);return 0<v&&0<A||0>v&&0>A?d.NO_INTERSECTION:0===p&&0===r&&0===v&&0===A?this.computeCollinearIntersection(l,h,m,q):(0===p||0===r||0===v||0===A?(this._isProper=!1,l.equals2D(m)||l.equals2D(q)?this._intPt[0]=l:h.equals2D(m)||h.equals2D(q)?this._intPt[0]=h:0===p?this._intPt[0]=new sa(m):0===r?this._intPt[0]=new sa(q):0===v?this._intPt[0]=new sa(l):0===A&&(this._intPt[0]=new sa(h))):(this._isProper=!0,this._intPt[0]=this.intersection(l,h,m,q)),d.POINT_INTERSECTION)},g.prototype.interfaces_=
function(){return[]},g.prototype.getClass=function(){return g},g.nearestEndpoint=function(l,h,m,q){var p=l,r=Da.distancePointLine(l,m,q),v=Da.distancePointLine(h,m,q);return v<r&&(r=v,p=h),(v=Da.distancePointLine(m,l,h))<r&&(r=v,p=m),Da.distancePointLine(q,l,h)<r&&(p=q),p},g}(Xb),qf=function(){};qf.prototype.interfaces_=function(){return[]};qf.prototype.getClass=function(){return qf};qf.orientationIndex=function(d,g,l){return qf.signOfDet2x2(g.x-d.x,g.y-d.y,l.x-g.x,l.y-g.y)};qf.signOfDet2x2=function(d,
g,l,h){var m,q=null;if(m=1,0===d||0===h)return 0===g||0===l?0:0<g?0<l?-m:m:0<l?m:-m;if(0===g||0===l)return 0<h?0<d?m:-m:0<d?-m:m;if(0<g?0<h?g<=h||(m=-m,q=d,d=l,l=q,q=g,g=h,h=q):g<=-h?(m=-m,l=-l,h=-h):(q=d,d=-l,l=q,q=g,g=-h,h=q):0<h?-g<=h?(m=-m,d=-d,g=-g):(q=-d,d=l,l=q,q=-g,g=h,h=q):g>=h?(d=-d,g=-g,l=-l,h=-h):(m=-m,q=-d,d=-l,l=q,q=-g,g=-h,h=q),0<d){if(!(0<l&&d<=l))return m}else{if(0<l||!(d>=l))return-m;m=-m;d=-d;l=-l}for(;;){if(0>(h-=(q=Math.floor(l/d))*g))return-m;if(h>g)return m;if(d>(l-=q*d)+l){if(g<
h+h)return m}else{if(g>h+h)return-m;l=d-l;h=g-h;m=-m}if(0===h)return 0===l?0:-m;if(0===l||0>(g-=(q=Math.floor(d/l))*h))return m;if(g>h)return-m;if(l>(d-=q*l)+d){if(h<g+g)return-m}else{if(h>g+g)return m;d=l-d;g=h-g;m=-m}if(0===g)return 0===d?0:m;if(0===d)return-m}};var Ed=function(d){this._crossingCount=0;this._isPointOnSegment=!1;this._p=d};Ed.prototype.countSegment=function(d,g){if(d.x<this._p.x&&g.x<this._p.x)return null;if(this._p.x===g.x&&this._p.y===g.y)return this._isPointOnSegment=!0,null;
if(d.y===this._p.y&&g.y===this._p.y){var l=d.x,h=g.x;return l>h&&(l=g.x,h=d.x),this._p.x>=l&&this._p.x<=h&&(this._isPointOnSegment=!0),null}if(d.y>this._p.y&&g.y<=this._p.y||g.y>this._p.y&&d.y<=this._p.y){l=d.y-this._p.y;h=g.y-this._p.y;d=qf.signOfDet2x2(d.x-this._p.x,l,g.x-this._p.x,h);if(0===d)return this._isPointOnSegment=!0,null;h<l&&(d=-d);0<d&&this._crossingCount++}};Ed.prototype.isPointInPolygon=function(){return this.getLocation()!==ua.EXTERIOR};Ed.prototype.getLocation=function(){return this._isPointOnSegment?
ua.BOUNDARY:1==this._crossingCount%2?ua.INTERIOR:ua.EXTERIOR};Ed.prototype.isOnSegment=function(){return this._isPointOnSegment};Ed.prototype.interfaces_=function(){return[]};Ed.prototype.getClass=function(){return Ed};Ed.locatePointInRing=function(d,g){if(d instanceof sa&&Va(g,db)){d=new Ed(d);for(var l=new sa,h=new sa,m=1;m<g.size()&&(g.getCoordinate(m,l),g.getCoordinate(m-1,h),d.countSegment(l,h),!d.isOnSegment());m++);return d.getLocation()}if(d instanceof sa&&g instanceof Array){d=new Ed(d);
for(l=1;l<g.length&&(d.countSegment(g[l],g[l-1]),!d.isOnSegment());l++);return d.getLocation()}};var Da=function(){},rf={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};Da.orientationIndex=function(d,g,l){return Xc.orientationIndex(d,g,l)};Da.signedArea=function(d){if(d instanceof Array){if(3>
d.length)return 0;for(var g=0,l=d[0].x,h=1;h<d.length-1;h++)g+=(d[h].x-l)*(d[h-1].y-d[h+1].y);return g/2}if(Va(d,db)){g=d.size();if(3>g)return 0;l=new sa;h=new sa;var m=new sa;d.getCoordinate(0,h);d.getCoordinate(1,m);var q=h.x;m.x-=q;for(var p=0,r=1;r<g-1;r++)l.y=h.y,h.x=m.x,h.y=m.y,d.getCoordinate(r+1,m),m.x-=q,p+=h.x*(l.y-m.y);return p/2}};Da.distanceLineLine=function(d,g,l,h){if(d.equals(g))return Da.distancePointLine(d,l,h);if(l.equals(h))return Da.distancePointLine(h,d,g);var m=!1;if(Ia.intersects(d,
g,l,h)){var q=(g.x-d.x)*(h.y-l.y)-(g.y-d.y)*(h.x-l.x);if(0===q)m=!0;else{var p=((d.y-l.y)*(g.x-d.x)-(d.x-l.x)*(g.y-d.y))/q;q=((d.y-l.y)*(h.x-l.x)-(d.x-l.x)*(h.y-l.y))/q;(0>q||1<q||0>p||1<p)&&(m=!0)}}else m=!0;return m?cd.min(Da.distancePointLine(d,l,h),Da.distancePointLine(g,l,h),Da.distancePointLine(l,d,g),Da.distancePointLine(h,d,g)):0};Da.isPointInRing=function(d,g){return Da.locatePointInRing(d,g)!==ua.EXTERIOR};Da.computeLength=function(d){var g=d.size();if(1>=g)return 0;var l=0,h=new sa;d.getCoordinate(0,
h);for(var m=h.x,q=h.y,p=1;p<g;p++){d.getCoordinate(p,h);var r=h.x,v=h.y;m=r-m;q=v-q;l+=Math.sqrt(m*m+q*q);m=r;q=v}return l};Da.isCCW=function(d){var g=d.length-1;if(3>g)throw new ac("Ring has fewer than 4 points, so orientation cannot be determined");for(var l=d[0],h=0,m=1;m<=g;m++){var q=d[m];q.y>l.y&&(l=q,h=m)}q=h;do 0>--q&&(q=g);while(d[q].equals2D(l)&&q!==h);m=h;do m=(m+1)%g;while(d[m].equals2D(l)&&m!==h);g=d[q];d=d[m];if(g.equals2D(l)||d.equals2D(l)||g.equals2D(d))return!1;l=Da.computeOrientation(g,
l,d);h=!1;return h=0===l?g.x>d.x:0<l,h};Da.locatePointInRing=function(d,g){return Ed.locatePointInRing(d,g)};Da.distancePointLinePerpendicular=function(d,g,l){var h=(l.x-g.x)*(l.x-g.x)+(l.y-g.y)*(l.y-g.y);return Math.abs(((g.y-d.y)*(l.x-g.x)-(g.x-d.x)*(l.y-g.y))/h)*Math.sqrt(h)};Da.computeOrientation=function(d,g,l){return Da.orientationIndex(d,g,l)};Da.distancePointLine=function(){if(2===arguments.length){var d=arguments[0],g=arguments[1];if(0===g.length)throw new ac("Line array must contain at least one vertex");
for(var l=d.distance(g[0]),h=0;h<g.length-1;h++){var m=Da.distancePointLine(d,g[h],g[h+1]);m<l&&(l=m)}return l}if(3===arguments.length){d=arguments[0];g=arguments[1];l=arguments[2];if(g.x===l.x&&g.y===l.y)return d.distance(g);h=(l.x-g.x)*(l.x-g.x)+(l.y-g.y)*(l.y-g.y);m=((d.x-g.x)*(l.x-g.x)+(d.y-g.y)*(l.y-g.y))/h;return 0>=m?d.distance(g):1<=m?d.distance(l):Math.abs(((g.y-d.y)*(l.x-g.x)-(g.x-d.x)*(l.y-g.y))/h)*Math.sqrt(h)}};Da.isOnLine=function(d,g){for(var l=new Te,h=1;h<g.length;h++)if(l.computeIntersection(d,
g[h-1],g[h]),l.hasIntersection())return!0;return!1};rf.CLOCKWISE.get=function(){return-1};rf.RIGHT.get=function(){return Da.CLOCKWISE};rf.COUNTERCLOCKWISE.get=function(){return 1};rf.LEFT.get=function(){return Da.COUNTERCLOCKWISE};rf.COLLINEAR.get=function(){return 0};rf.STRAIGHT.get=function(){return Da.COLLINEAR};Object.defineProperties(Da,rf);var se=function(){};se.prototype.filter=function(d){};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};var Ra=function(d){this._userData=
this._SRID=this._envelope=null;this._factory=d;this._SRID=d.getSRID()},Vd={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Ra.prototype.isGeometryCollection=
function(){return this.getSortIndex()===Ra.SORTINDEX_GEOMETRYCOLLECTION};Ra.prototype.getFactory=function(){return this._factory};Ra.prototype.getGeometryN=function(d){return this};Ra.prototype.getArea=function(){return 0};Ra.prototype.isRectangle=function(){return!1};Ra.prototype.equals=function(d){if(d instanceof Ra)return null!==d&&this.equalsTopo(d);if(d instanceof Object)return d instanceof Ra?this.equalsExact(d):!1};Ra.prototype.equalsExact=function(d){return this===d||this.equalsExact(d,0)};
Ra.prototype.geometryChanged=function(){this.apply(Ra.geometryChangedFilter)};Ra.prototype.geometryChangedAction=function(){this._envelope=null};Ra.prototype.equalsNorm=function(d){return null!==d&&this.norm().equalsExact(d.norm())};Ra.prototype.getLength=function(){return 0};Ra.prototype.getNumGeometries=function(){return 1};Ra.prototype.compareTo=function(){if(1===arguments.length){var d=arguments[0];return this.getSortIndex()!==d.getSortIndex()?this.getSortIndex()-d.getSortIndex():this.isEmpty()&&
d.isEmpty()?0:this.isEmpty()?-1:d.isEmpty()?1:this.compareToSameClass(d)}if(2===arguments.length){d=arguments[0];var g=arguments[1];return this.getSortIndex()!==d.getSortIndex()?this.getSortIndex()-d.getSortIndex():this.isEmpty()&&d.isEmpty()?0:this.isEmpty()?-1:d.isEmpty()?1:this.compareToSameClass(d,g)}};Ra.prototype.getUserData=function(){return this._userData};Ra.prototype.getSRID=function(){return this._SRID};Ra.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};
Ra.prototype.checkNotGeometryCollection=function(d){if(d.getSortIndex()===Ra.SORTINDEX_GEOMETRYCOLLECTION)throw new ac("This method does not support GeometryCollection arguments");};Ra.prototype.equal=function(d,g,l){return 0===l?d.equals(g):d.distance(g)<=l};Ra.prototype.norm=function(){var d=this.copy();return d.normalize(),d};Ra.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Ra.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=
this.computeEnvelopeInternal()),new Ia(this._envelope)};Ra.prototype.setSRID=function(d){this._SRID=d};Ra.prototype.setUserData=function(d){this._userData=d};Ra.prototype.compare=function(d,g){d=d.iterator();for(g=g.iterator();d.hasNext()&&g.hasNext();){var l=d.next(),h=g.next();l=l.compareTo(h);if(0!==l)return l}return d.hasNext()?1:g.hasNext()?-1:0};Ra.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Ra.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===
Ra.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Ra.SORTINDEX_MULTIPOINT||this.getSortIndex()===Ra.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Ra.SORTINDEX_MULTIPOLYGON};Ra.prototype.interfaces_=function(){return[Xh,jd,id]};Ra.prototype.getClass=function(){return Ra};Ra.hasNonEmptyElements=function(d){for(var g=0;g<d.length;g++)if(!d[g].isEmpty())return!0;return!1};Ra.hasNullElements=function(d){for(var g=0;g<d.length;g++)if(null===d[g])return!0;return!1};Vd.serialVersionUID.get=function(){return 0x799ea46522854c00};
Vd.SORTINDEX_POINT.get=function(){return 0};Vd.SORTINDEX_MULTIPOINT.get=function(){return 1};Vd.SORTINDEX_LINESTRING.get=function(){return 2};Vd.SORTINDEX_LINEARRING.get=function(){return 3};Vd.SORTINDEX_MULTILINESTRING.get=function(){return 4};Vd.SORTINDEX_POLYGON.get=function(){return 5};Vd.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Vd.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Vd.geometryChangedFilter.get=function(){return Gj};Object.defineProperties(Ra,Vd);var Gj=function(){};
Gj.interfaces_=function(){return[se]};Gj.filter=function(d){d.geometryChangedAction()};var Ee=function(){};Ee.prototype.filter=function(d){};Ee.prototype.interfaces_=function(){return[]};Ee.prototype.getClass=function(){return Ee};var kd=function(){},te={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},
MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};kd.prototype.isInBoundary=function(d){};kd.prototype.interfaces_=function(){return[]};kd.prototype.getClass=function(){return kd};te.Mod2BoundaryNodeRule.get=function(){return Vf};te.EndPointBoundaryNodeRule.get=function(){return Wf};te.MultiValentEndPointBoundaryNodeRule.get=function(){return Xf};te.MonoValentEndPointBoundaryNodeRule.get=function(){return Yf};
te.MOD2_BOUNDARY_RULE.get=function(){return new Vf};te.ENDPOINT_BOUNDARY_RULE.get=function(){return new Wf};te.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Xf};te.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Yf};te.OGC_SFS_BOUNDARY_RULE.get=function(){return kd.MOD2_BOUNDARY_RULE};Object.defineProperties(kd,te);var Vf=function(){};Vf.prototype.isInBoundary=function(d){return 1==d%2};Vf.prototype.interfaces_=function(){return[kd]};Vf.prototype.getClass=function(){return Vf};
var Wf=function(){};Wf.prototype.isInBoundary=function(d){return 0<d};Wf.prototype.interfaces_=function(){return[kd]};Wf.prototype.getClass=function(){return Wf};var Xf=function(){};Xf.prototype.isInBoundary=function(d){return 1<d};Xf.prototype.interfaces_=function(){return[kd]};Xf.prototype.getClass=function(){return Xf};var Yf=function(){};Yf.prototype.isInBoundary=function(d){return 1===d};Yf.prototype.interfaces_=function(){return[kd]};Yf.prototype.getClass=function(){return Yf};var kc=function(){};
kc.prototype.add=function(){};kc.prototype.addAll=function(){};kc.prototype.isEmpty=function(){};kc.prototype.iterator=function(){};kc.prototype.size=function(){};kc.prototype.toArray=function(){};kc.prototype.remove=function(){};hj.prototype=Error();hj.prototype.name="IndexOutOfBoundsException";var Zf=function(){};Zf.prototype.hasNext=function(){};Zf.prototype.next=function(){};Zf.prototype.remove=function(){};var ue=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),g.prototype=
Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.get=function(){},g.prototype.set=function(){},g.prototype.isEmpty=function(){},g}(kc);Mf.prototype=Error();Mf.prototype.name="NoSuchElementException";var Fa=function(d){function g(l){d.call(this);this.array_=[];l instanceof kc&&this.addAll(l)}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.ensureCapacity=function(){},g.prototype.interfaces_=function(){return[d,kc]},g.prototype.add=
function(l){return 1===arguments.length?this.array_.push(l):this.array_.splice(arguments[0],arguments[1]),!0},g.prototype.clear=function(){this.array_=[]},g.prototype.addAll=function(l){for(l=l.iterator();l.hasNext();)this.add(l.next());return!0},g.prototype.set=function(l,h){var m=this.array_[l];return this.array_[l]=h,m},g.prototype.iterator=function(){return new wp(this)},g.prototype.get=function(l){if(0>l||l>=this.size())throw new hj;return this.array_[l]},g.prototype.isEmpty=function(){return 0===
this.array_.length},g.prototype.size=function(){return this.array_.length},g.prototype.toArray=function(){for(var l=[],h=0,m=this.array_.length;h<m;h++)l.push(this.array_[h]);return l},g.prototype.remove=function(l){for(var h=!1,m=0,q=this.array_.length;m<q;m++)if(this.array_[m]===l){this.array_.splice(m,1);h=!0;break}return h},g}(ue),wp=function(d){function g(l){d.call(this);this.arrayList_=l;this.position_=0}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=
g,g.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Mf;return this.arrayList_.get(this.position_++)},g.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},g.prototype.set=function(l){return this.arrayList_.set(this.position_-1,l)},g.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},g}(Zf),Tg=function(d){function g(){if(d.call(this),0!==arguments.length)if(1===arguments.length){var h=arguments[0];this.ensureCapacity(h.length);
this.add(h,!0)}else if(2===arguments.length){h=arguments[0];var m=arguments[1];this.ensureCapacity(h.length);this.add(h,m)}}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={coordArrayType:{configurable:!0}};return l.coordArrayType.get=function(){return[].fill(null)},g.prototype.getCoordinate=function(h){return this.get(h)},g.prototype.addAll=function(){if(2===arguments.length){for(var h=arguments[1],m=!1,q=arguments[0].iterator();q.hasNext();)this.add(q.next(),
h),m=!0;return m}return d.prototype.addAll.apply(this,arguments)},g.prototype.clone=function(){for(var h=d.prototype.clone.call(this),m=0;m<this.size();m++)h.add(m,this.get(m).copy());return h},g.prototype.toCoordinateArray=function(){return this.toArray(g.coordArrayType)},g.prototype.add=function(){if(1===arguments.length)d.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],
!0),!0;if(arguments[0]instanceof sa&&"boolean"==typeof arguments[1]){var h=arguments[0];if(!arguments[1]&&1<=this.size()&&this.get(this.size()-1).equals2D(h))return null;d.prototype.add.call(this,h)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){h=arguments[0];var m=arguments[1];if(arguments[2])for(var q=
0;q<h.length;q++)this.add(h[q],m);else for(q=h.length-1;0<=q;q--)this.add(h[q],m);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof sa){h=arguments[0];m=arguments[1];if(!arguments[2]&&(q=this.size(),0<q&&(0<h&&this.get(h-1).equals2D(m)||h<q&&this.get(h).equals2D(m))))return null;d.prototype.add.call(this,h,m)}}else if(4===arguments.length){h=arguments[0];m=arguments[1];var p=arguments[2];q=arguments[3];var r=1;for(p>q&&(r=-1);p!==q;p+=r)this.add(h[p],
m);return!0}},g.prototype.closeRing=function(){0<this.size()&&this.add(new sa(this.get(0)),!1)},g.prototype.interfaces_=function(){return[]},g.prototype.getClass=function(){return g},Object.defineProperties(g,l),g}(Fa),ab=function(){},ai={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};ai.ForwardComparator.get=function(){return Ug};ai.BidirectionalComparator.get=function(){return $f};ai.coordArrayType.get=function(){return[].fill(null)};
ab.prototype.interfaces_=function(){return[]};ab.prototype.getClass=function(){return ab};ab.isRing=function(d){return!(4>d.length)&&!!d[0].equals2D(d[d.length-1])};ab.ptNotInList=function(d,g){for(var l=0;l<d.length;l++){var h=d[l];if(0>ab.indexOf(h,g))return h}return null};ab.scroll=function(d,g){g=ab.indexOf(g,d);if(0>g)return null;var l=Array(d.length).fill(null);Oc.arraycopy(d,g,l,0,d.length-g);Oc.arraycopy(d,0,l,d.length-g,g);Oc.arraycopy(l,0,d,0,d.length)};ab.equals=function(){if(2===arguments.length){var d=
arguments[0],g=arguments[1];if(d===g)return!0;if(null===d||null===g||d.length!==g.length)return!1;for(var l=0;l<d.length;l++)if(!d[l].equals(g[l]))return!1;return!0}if(3===arguments.length){d=arguments[0];g=arguments[1];l=arguments[2];if(d===g)return!0;if(null===d||null===g||d.length!==g.length)return!1;for(var h=0;h<d.length;h++)if(0!==l.compare(d[h],g[h]))return!1;return!0}};ab.intersection=function(d,g){for(var l=new Tg,h=0;h<d.length;h++)g.intersects(d[h])&&l.add(d[h],!0);return l.toCoordinateArray()};
ab.hasRepeatedPoints=function(d){for(var g=1;g<d.length;g++)if(d[g-1].equals(d[g]))return!0;return!1};ab.removeRepeatedPoints=function(d){return ab.hasRepeatedPoints(d)?(new Tg(d,!1)).toCoordinateArray():d};ab.reverse=function(d){for(var g=d.length-1,l=Math.trunc(g/2),h=0;h<=l;h++){var m=d[h];d[h]=d[g-h];d[g-h]=m}};ab.removeNull=function(d){for(var g=0,l=0;l<d.length;l++)null!==d[l]&&g++;l=Array(g).fill(null);if(0===g)return l;for(var h=g=0;h<d.length;h++)null!==d[h]&&(l[g++]=d[h]);return l};ab.copyDeep=
function(){if(1===arguments.length){for(var d=arguments[0],g=Array(d.length).fill(null),l=0;l<d.length;l++)g[l]=new sa(d[l]);return g}if(5===arguments.length){d=arguments[0];g=arguments[1];l=arguments[2];for(var h=arguments[3],m=arguments[4],q=0;q<m;q++)l[h+q]=new sa(d[g+q])}};ab.isEqualReversed=function(d,g){for(var l=0;l<d.length;l++)if(0!==d[l].compareTo(g[d.length-l-1]))return!1;return!0};ab.envelope=function(d){for(var g=new Ia,l=0;l<d.length;l++)g.expandToInclude(d[l]);return g};ab.toCoordinateArray=
function(d){return d.toArray(ab.coordArrayType)};ab.atLeastNCoordinatesOrNothing=function(d,g){return g.length>=d?g:[]};ab.indexOf=function(d,g){for(var l=0;l<g.length;l++)if(d.equals(g[l]))return l;return-1};ab.increasingDirection=function(d){for(var g=0;g<Math.trunc(d.length/2);g++){var l=d[g].compareTo(d[d.length-1-g]);if(0!==l)return l}return 1};ab.compare=function(d,g){for(var l=0;l<d.length&&l<g.length;){var h=d[l].compareTo(g[l]);if(0!==h)return h;l++}return l<g.length?-1:l<d.length?1:0};ab.minCoordinate=
function(d){for(var g=null,l=0;l<d.length;l++)(null===g||0<g.compareTo(d[l]))&&(g=d[l]);return g};ab.extract=function(d,g,l){g=cd.clamp(g,0,d.length);var h=(l=cd.clamp(l,-1,d.length))-g+1;0>l&&(h=0);g>=d.length&&(h=0);l<g&&(h=0);var m=Array(h).fill(null);if(0===h)return m;for(h=0;g<=l;g++)m[h++]=d[g];return m};Object.defineProperties(ab,ai);var Ug=function(){};Ug.prototype.compare=function(d,g){return ab.compare(d,g)};Ug.prototype.interfaces_=function(){return[Rf]};Ug.prototype.getClass=function(){return Ug};
var $f=function(){};$f.prototype.compare=function(d,g){if(d.length<g.length)return-1;if(d.length>g.length)return 1;if(0===d.length)return 0;var l=ab.compare(d,g);return ab.isEqualReversed(d,g)?0:l};$f.prototype.OLDcompare=function(d,g){if(d.length<g.length)return-1;if(d.length>g.length)return 1;if(0===d.length)return 0;for(var l=ab.increasingDirection(d),h=ab.increasingDirection(g),m=0<l?0:d.length-1,q=0<h?0:d.length-1,p=0;p<d.length;p++){var r=d[m].compareTo(g[q]);if(0!==r)return r;m+=l;q+=h}return 0};
$f.prototype.interfaces_=function(){return[Rf]};$f.prototype.getClass=function(){return $f};var sf=function(){};sf.prototype.get=function(){};sf.prototype.put=function(){};sf.prototype.size=function(){};sf.prototype.values=function(){};sf.prototype.entrySet=function(){};var xp=function(d){function g(){d.apply(this,arguments)}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g}(sf);Hg.prototype=Error();Hg.prototype.name="OperationNotSupported";Lh.prototype=
new kc;Lh.prototype.contains=function(){};var Hj=function(d){function g(l){d.call(this);this.array_=[];l instanceof kc&&this.addAll(l)}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.contains=function(l){for(var h=0,m=this.array_.length;h<m;h++)if(this.array_[h]===l)return!0;return!1},g.prototype.add=function(l){return!this.contains(l)&&(this.array_.push(l),!0)},g.prototype.addAll=function(l){for(l=l.iterator();l.hasNext();)this.add(l.next());
return!0},g.prototype.remove=function(l){throw Error();},g.prototype.size=function(){return this.array_.length},g.prototype.isEmpty=function(){return 0===this.array_.length},g.prototype.toArray=function(){for(var l=[],h=0,m=this.array_.length;h<m;h++)l.push(this.array_[h]);return l},g.prototype.iterator=function(){return new yp(this)},g}(Lh),yp=function(d){function g(l){d.call(this);this.hashSet_=l;this.position_=0}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=
g,g.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Mf;return this.hashSet_.array_[this.position_++]},g.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},g.prototype.remove=function(){throw new Hg;},g}(Zf);Ac.prototype=new xp;Ac.prototype.get=function(d){for(var g=this.root_;null!==g;){var l=d.compareTo(g.key);if(0>l)g=g.left;else{if(!(0<l))return g.value;g=g.right}}return null};Ac.prototype.put=function(d,g){if(null===this.root_)return this.root_=
{key:d,value:g,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var l,h,m=this.root_;do if(l=m,0>(h=d.compareTo(m.key)))m=m.left;else{if(!(0<h))return l=m.value,m.value=g,l;m=m.right}while(null!==m);g={key:d,left:null,right:null,value:g,parent:l,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return 0>h?l.left=g:l.right=g,this.fixAfterInsertion(g),this.size_++,null};Ac.prototype.fixAfterInsertion=
function(d){for(d.color=1;null!=d&&d!==this.root_&&1===d.parent.color;)if(Pb(d)===ij(Pb(Pb(d)))){var g=bm(Pb(Pb(d)));1===(null===g?0:g.color)?(le(Pb(d),0),le(g,0),le(Pb(Pb(d)),1),d=Pb(Pb(d))):(d===bm(Pb(d))&&(d=Pb(d),this.rotateLeft(d)),le(Pb(d),0),le(Pb(Pb(d)),1),this.rotateRight(Pb(Pb(d))))}else g=ij(Pb(Pb(d))),1===(null===g?0:g.color)?(le(Pb(d),0),le(g,0),le(Pb(Pb(d)),1),d=Pb(Pb(d))):(d===ij(Pb(d))&&(d=Pb(d),this.rotateRight(d)),le(Pb(d),0),le(Pb(Pb(d)),1),this.rotateLeft(Pb(Pb(d))));this.root_.color=
0};Ac.prototype.values=function(){var d=new Fa,g=this.getFirstEntry();if(null!==g)for(d.add(g.value);null!==(g=Ac.successor(g));)d.add(g.value);return d};Ac.prototype.entrySet=function(){var d=new Hj,g=this.getFirstEntry();if(null!==g)for(d.add(g);null!==(g=Ac.successor(g));)d.add(g);return d};Ac.prototype.rotateLeft=function(d){if(null!=d){var g=d.right;d.right=g.left;null!=g.left&&(g.left.parent=d);g.parent=d.parent;null===d.parent?this.root_=g:d.parent.left===d?d.parent.left=g:d.parent.right=g;
g.left=d;d.parent=g}};Ac.prototype.rotateRight=function(d){if(null!=d){var g=d.left;d.left=g.right;null!=g.right&&(g.right.parent=d);g.parent=d.parent;null===d.parent?this.root_=g:d.parent.right===d?d.parent.right=g:d.parent.left=g;g.right=d;d.parent=g}};Ac.prototype.getFirstEntry=function(){var d=this.root_;if(null!=d)for(;null!=d.left;)d=d.left;return d};Ac.successor=function(d){if(null===d)return null;if(null!==d.right){for(var g=d.right;null!==g.left;)g=g.left;return g}for(g=d.parent;null!==g&&
d===g.right;)d=g,g=g.parent;return g};Ac.prototype.size=function(){return this.size_};var Vg=function(){};Vg.prototype.interfaces_=function(){return[]};Vg.prototype.getClass=function(){return Vg};cm.prototype=new Lh;zd.prototype=new cm;zd.prototype.contains=function(d){for(var g=0,l=this.array_.length;g<l;g++)if(0===this.array_[g].compareTo(d))return!0;return!1};zd.prototype.add=function(d){if(this.contains(d))return!1;for(var g=0,l=this.array_.length;g<l;g++)if(1===this.array_[g].compareTo(d))return this.array_.splice(g,
0,d),!0;return this.array_.push(d),!0};zd.prototype.addAll=function(d){for(d=d.iterator();d.hasNext();)this.add(d.next());return!0};zd.prototype.remove=function(d){throw new Hg;};zd.prototype.size=function(){return this.array_.length};zd.prototype.isEmpty=function(){return 0===this.array_.length};zd.prototype.toArray=function(){for(var d=[],g=0,l=this.array_.length;g<l;g++)d.push(this.array_[g]);return d};zd.prototype.iterator=function(){return new bi(this)};var bi=function(d){this.treeSet_=d;this.position_=
0};bi.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Mf;return this.treeSet_.array_[this.position_++]};bi.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};bi.prototype.remove=function(){throw new Hg;};var Ue=function(){};Ue.sort=function(){var d,g=arguments[0];if(1===arguments.length){var l=function(m,q){return m.compareTo(q)};g.sort(l)}else if(2===arguments.length){var h=arguments[1];l=function(m,q){return h.compare(m,q)};g.sort(l)}else if(3===
arguments.length)for((d=g.slice(arguments[1],arguments[2])).sort(),l=g.slice(0,arguments[1]).concat(d,g.slice(arguments[2],g.length)),g.splice(0,g.length),d=0;d<l.length;d++)g.push(l[d]);else if(4===arguments.length)for(d=g.slice(arguments[1],arguments[2]),h=arguments[3],l=function(m,q){return h.compare(m,q)},d.sort(l),l=g.slice(0,arguments[1]).concat(d,g.slice(arguments[2],g.length)),g.splice(0,g.length),d=0;d<l.length;d++)g.push(l[d])};Ue.asList=function(d){for(var g=new Fa,l=0,h=d.length;l<h;l++)g.add(d[l]);
return g};var Eb=function(){},td={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};td.P.get=function(){return 0};td.L.get=function(){return 1};td.A.get=function(){return 2};td.FALSE.get=function(){return-1};td.TRUE.get=function(){return-2};td.DONTCARE.get=function(){return-3};
td.SYM_FALSE.get=function(){return"F"};td.SYM_TRUE.get=function(){return"T"};td.SYM_DONTCARE.get=function(){return"*"};td.SYM_P.get=function(){return"0"};td.SYM_L.get=function(){return"1"};td.SYM_A.get=function(){return"2"};Eb.prototype.interfaces_=function(){return[]};Eb.prototype.getClass=function(){return Eb};Eb.toDimensionSymbol=function(d){switch(d){case Eb.FALSE:return Eb.SYM_FALSE;case Eb.TRUE:return Eb.SYM_TRUE;case Eb.DONTCARE:return Eb.SYM_DONTCARE;case Eb.P:return Eb.SYM_P;case Eb.L:return Eb.SYM_L;
case Eb.A:return Eb.SYM_A}throw new ac("Unknown dimension value: "+d);};Eb.toDimensionValue=function(d){switch(Rg.toUpperCase(d)){case Eb.SYM_FALSE:return Eb.FALSE;case Eb.SYM_TRUE:return Eb.TRUE;case Eb.SYM_DONTCARE:return Eb.DONTCARE;case Eb.SYM_P:return Eb.P;case Eb.SYM_L:return Eb.L;case Eb.SYM_A:return Eb.A}throw new ac("Unknown dimension symbol: "+d);};Object.defineProperties(Eb,td);var Ve=function(){};Ve.prototype.filter=function(d){};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=
function(){return Ve};var Wd=function(){};Wd.prototype.filter=function(d,g){};Wd.prototype.isDone=function(){};Wd.prototype.isGeometryChanged=function(){};Wd.prototype.interfaces_=function(){return[]};Wd.prototype.getClass=function(){return Wd};var ud=function(d){function g(h,m){if(d.call(this,m),this._geometries=h||[],d.hasNullElements(this._geometries))throw new ac("geometries must not contain null elements");}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=
g;var l={serialVersionUID:{configurable:!0}};return g.prototype.computeEnvelopeInternal=function(){for(var h=new Ia,m=0;m<this._geometries.length;m++)h.expandToInclude(this._geometries[m].getEnvelopeInternal());return h},g.prototype.getGeometryN=function(h){return this._geometries[h]},g.prototype.getSortIndex=function(){return d.SORTINDEX_GEOMETRYCOLLECTION},g.prototype.getCoordinates=function(){for(var h=Array(this.getNumPoints()).fill(null),m=-1,q=0;q<this._geometries.length;q++)for(var p=this._geometries[q].getCoordinates(),
r=0;r<p.length;r++)h[++m]=p[r];return h},g.prototype.getArea=function(){for(var h=0,m=0;m<this._geometries.length;m++)h+=this._geometries[m].getArea();return h},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];if(!this.isEquivalentClass(h)||this._geometries.length!==h._geometries.length)return!1;for(var q=0;q<this._geometries.length;q++)if(!this._geometries[q].equalsExact(h._geometries[q],m))return!1;return!0}return d.prototype.equalsExact.apply(this,arguments)},
g.prototype.normalize=function(){for(var h=0;h<this._geometries.length;h++)this._geometries[h].normalize();Ue.sort(this._geometries)},g.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},g.prototype.getBoundaryDimension=function(){for(var h=Eb.FALSE,m=0;m<this._geometries.length;m++)h=Math.max(h,this._geometries[m].getBoundaryDimension());return h},g.prototype.getDimension=function(){for(var h=Eb.FALSE,m=0;m<this._geometries.length;m++)h=Math.max(h,
this._geometries[m].getDimension());return h},g.prototype.getLength=function(){for(var h=0,m=0;m<this._geometries.length;m++)h+=this._geometries[m].getLength();return h},g.prototype.getNumPoints=function(){for(var h=0,m=0;m<this._geometries.length;m++)h+=this._geometries[m].getNumPoints();return h},g.prototype.getNumGeometries=function(){return this._geometries.length},g.prototype.reverse=function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<this._geometries.length;m++)h[m]=this._geometries[m].reverse();
return this.getFactory().createGeometryCollection(h)},g.prototype.compareToSameClass=function(){if(1===arguments.length){var h=arguments[0],m=new zd(Ue.asList(this._geometries));h=new zd(Ue.asList(h._geometries));return this.compare(m,h)}if(2===arguments.length){m=arguments[1];h=arguments[0];for(var q=this.getNumGeometries(),p=h.getNumGeometries(),r=0;r<q&&r<p;){var v=this.getGeometryN(r),A=h.getGeometryN(r);v=v.compareToSameClass(A,m);if(0!==v)return v;r++}return r<q?1:r<p?-1:0}},g.prototype.apply=
function(h){if(Va(h,Ee))for(var m=0;m<this._geometries.length;m++)this._geometries[m].apply(h);else if(Va(h,Wd)){if(0===this._geometries.length)return null;for(m=0;m<this._geometries.length&&(this._geometries[m].apply(h),!h.isDone());m++);h.isGeometryChanged()&&this.geometryChanged()}else if(Va(h,Ve))for(h.filter(this),m=0;m<this._geometries.length;m++)this._geometries[m].apply(h);else if(Va(h,se))for(h.filter(this),m=0;m<this._geometries.length;m++)this._geometries[m].apply(h)},g.prototype.getBoundary=
function(){return this.checkNotGeometryCollection(this),Xa.shouldNeverReachHere(),null},g.prototype.clone=function(){var h=d.prototype.clone.call(this);h._geometries=Array(this._geometries.length).fill(null);for(var m=0;m<this._geometries.length;m++)h._geometries[m]=this._geometries[m].clone();return h},g.prototype.getGeometryType=function(){return"GeometryCollection"},g.prototype.copy=function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<h.length;m++)h[m]=this._geometries[m].copy();
return new g(h,this._factory)},g.prototype.isEmpty=function(){for(var h=0;h<this._geometries.length;h++)if(!this._geometries[h].isEmpty())return!1;return!0},g.prototype.interfaces_=function(){return[]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(g,l),g}(Ra),We=function(d){function g(){d.apply(this,arguments)}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};
return g.prototype.getSortIndex=function(){return Ra.SORTINDEX_MULTILINESTRING},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];return!!this.isEquivalentClass(h)&&d.prototype.equalsExact.call(this,h,m)}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.getBoundaryDimension=function(){return this.isClosed()?Eb.FALSE:0},g.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var h=0;h<this._geometries.length;h++)if(!this._geometries[h].isClosed())return!1;
return!0},g.prototype.getDimension=function(){return 1},g.prototype.reverse=function(){for(var h=this._geometries.length,m=Array(h).fill(null),q=0;q<this._geometries.length;q++)m[h-1-q]=this._geometries[q].reverse();return this.getFactory().createMultiLineString(m)},g.prototype.getBoundary=function(){return(new ld(this)).getBoundary()},g.prototype.getGeometryType=function(){return"MultiLineString"},g.prototype.copy=function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<h.length;m++)h[m]=
this._geometries[m].copy();return new g(h,this._factory)},g.prototype.interfaces_=function(){return[Vg]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(g,l),g}(ud),ld=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var d=arguments[0],g=kd.MOD2_BOUNDARY_RULE;this._geom=d;this._geomFact=d.getFactory();this._bnRule=g}else 2===arguments.length&&(d=arguments[0],
g=arguments[1],this._geom=d,this._geomFact=d.getFactory(),this._bnRule=g)};ld.prototype.boundaryMultiLineString=function(d){if(this._geom.isEmpty())return this.getEmptyMultiPoint();d=this.computeBoundaryCoordinates(d);return 1===d.length?this._geomFact.createPoint(d[0]):this._geomFact.createMultiPointFromCoords(d)};ld.prototype.getBoundary=function(){return this._geom instanceof Hc?this.boundaryLineString(this._geom):this._geom instanceof We?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};
ld.prototype.boundaryLineString=function(d){return this._geom.isEmpty()?this.getEmptyMultiPoint():d.isClosed()?this._bnRule.isInBoundary(2)?d.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([d.getStartPoint(),d.getEndPoint()])};ld.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ld.prototype.computeBoundaryCoordinates=function(d){var g=new Fa;this._endpointMap=new Ac;for(var l=0;l<d.getNumGeometries();l++){var h=d.getGeometryN(l);
0!==h.getNumPoints()&&(this.addEndpoint(h.getCoordinateN(0)),this.addEndpoint(h.getCoordinateN(h.getNumPoints()-1)))}for(d=this._endpointMap.entrySet().iterator();d.hasNext();)l=d.next(),h=l.getValue().count,this._bnRule.isInBoundary(h)&&g.add(l.getKey());return ab.toCoordinateArray(g)};ld.prototype.addEndpoint=function(d){var g=this._endpointMap.get(d);null===g&&(g=new ci,this._endpointMap.put(d,g));g.count++};ld.prototype.interfaces_=function(){return[]};ld.prototype.getClass=function(){return ld};
ld.getBoundary=function(){if(1===arguments.length)return(new ld(arguments[0])).getBoundary();if(2===arguments.length)return(new ld(arguments[0],arguments[1])).getBoundary()};var ci=function(){this.count=null};ci.prototype.interfaces_=function(){return[]};ci.prototype.getClass=function(){return ci};var zp=function(){},md=function(){},Ij={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};md.prototype.interfaces_=function(){return[]};md.prototype.getClass=function(){return md};md.chars=
function(d,g){for(var l=Array(g).fill(null),h=0;h<g;h++)l[h]=d;return String(l)};md.getStackTrace=function(){if(1===arguments.length){var d=arguments[0],g=new Ho,l=new Fo(g);return d.printStackTrace(l),g.toString()}if(2===arguments.length){d=arguments[1];g="";l=new Go(md.getStackTrace(arguments[0]));l=new Io(l);for(var h=0;h<d;h++)try{g+=l.readLine()+md.NEWLINE}catch(m){throw m;}return g}};md.split=function(d,g){var l=g.length,h=new Fa;d=""+d;for(var m=d.indexOf(g);0<=m;){var q=d.substring(0,m);h.add(q);
m=(d=d.substring(m+l)).indexOf(g)}0<d.length&&h.add(d);g=Array(h.size()).fill(null);for(l=0;l<g.length;l++)g[l]=h.get(l);return g};md.toString=function(){if(1===arguments.length)return md.SIMPLE_ORDINATE_FORMAT.format(arguments[0])};md.spaces=function(d){return md.chars(" ",d)};Ij.NEWLINE.get=function(){return Oc.getProperty("line.separator")};Ij.SIMPLE_ORDINATE_FORMAT.get=function(){return new zp("0.#")};Object.defineProperties(md,Ij);var dc=function(){};dc.prototype.interfaces_=function(){return[]};
dc.prototype.getClass=function(){return dc};dc.copyCoord=function(d,g,l,h){for(var m=Math.min(d.getDimension(),l.getDimension()),q=0;q<m;q++)l.setOrdinate(h,q,d.getOrdinate(g,q))};dc.isRing=function(d){var g=d.size();return 0===g||!(3>=g)&&d.getOrdinate(0,db.X)===d.getOrdinate(g-1,db.X)&&d.getOrdinate(0,db.Y)===d.getOrdinate(g-1,db.Y)};dc.isEqual=function(d,g){var l=d.size();if(l!==g.size())return!1;for(var h=Math.min(d.getDimension(),g.getDimension()),m=0;m<l;m++)for(var q=0;q<h;q++){var p=d.getOrdinate(m,
q),r=g.getOrdinate(m,q);if(!(d.getOrdinate(m,q)===g.getOrdinate(m,q)||Wa.isNaN(p)&&Wa.isNaN(r)))return!1}return!0};dc.extend=function(d,g,l){d=d.create(l,g.getDimension());var h=g.size();if(dc.copy(g,0,d,0,h),0<h)for(var m=h;m<l;m++)dc.copy(g,h-1,d,m,1);return d};dc.reverse=function(d){for(var g=d.size()-1,l=Math.trunc(g/2),h=0;h<=l;h++)dc.swap(d,h,g-h)};dc.swap=function(d,g,l){if(g===l)return null;for(var h=0;h<d.getDimension();h++){var m=d.getOrdinate(g,h);d.setOrdinate(g,h,d.getOrdinate(l,h));
d.setOrdinate(l,h,m)}};dc.copy=function(d,g,l,h,m){for(var q=0;q<m;q++)dc.copyCoord(d,g+q,l,h+q)};dc.toString=function(){if(1===arguments.length){var d=arguments[0],g=d.size();if(0===g)return"()";var l=d.getDimension(),h=new Cd;h.append("(");for(var m=0;m<g;m++){0<m&&h.append(" ");for(var q=0;q<l;q++)0<q&&h.append(","),h.append(md.toString(d.getOrdinate(m,q)))}return h.append(")"),h.toString()}};dc.ensureValidRing=function(d,g){var l=g.size();return 0===l?g:3>=l?dc.createClosedRing(d,g,4):g.getOrdinate(0,
db.X)===g.getOrdinate(l-1,db.X)&&g.getOrdinate(0,db.Y)===g.getOrdinate(l-1,db.Y)?g:dc.createClosedRing(d,g,l+1)};dc.createClosedRing=function(d,g,l){d=d.create(l,g.getDimension());var h=g.size();for(dc.copy(g,0,d,0,h);h<l;h++)dc.copy(g,0,d,h,1);return d};var Hc=function(d){function g(h,m){d.call(this,m);this._points=null;this.init(h)}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};return g.prototype.computeEnvelopeInternal=
function(){return this.isEmpty()?new Ia:this._points.expandEnvelope(new Ia)},g.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},g.prototype.getSortIndex=function(){return d.SORTINDEX_LINESTRING},g.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];if(!this.isEquivalentClass(h)||this._points.size()!==h._points.size())return!1;for(var q=0;q<this._points.size();q++)if(!this.equal(this._points.getCoordinate(q),
h._points.getCoordinate(q),m))return!1;return!0}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.normalize=function(){for(var h=0;h<Math.trunc(this._points.size()/2);h++){var m=this._points.size()-1-h;if(!this._points.getCoordinate(h).equals(this._points.getCoordinate(m)))return 0<this._points.getCoordinate(h).compareTo(this._points.getCoordinate(m))&&dc.reverse(this._points),null}},g.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},g.prototype.getBoundaryDimension=
function(){return this.isClosed()?Eb.FALSE:0},g.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},g.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},g.prototype.getDimension=function(){return 1},g.prototype.getLength=function(){return Da.computeLength(this._points)},g.prototype.getNumPoints=function(){return this._points.size()},g.prototype.reverse=function(){var h=this._points.copy();
return dc.reverse(h),this.getFactory().createLineString(h)},g.prototype.compareToSameClass=function(){if(1===arguments.length){for(var h=arguments[0],m=0,q=0;m<this._points.size()&&q<h._points.size();){var p=this._points.getCoordinate(m).compareTo(h._points.getCoordinate(q));if(0!==p)return p;m++;q++}return m<this._points.size()?1:q<h._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},g.prototype.apply=function(h){if(Va(h,Ee))for(var m=0;m<
this._points.size();m++)h.filter(this._points.getCoordinate(m));else if(Va(h,Wd)){if(0===this._points.size())return null;for(m=0;m<this._points.size()&&(h.filter(this._points,m),!h.isDone());m++);h.isGeometryChanged()&&this.geometryChanged()}else Va(h,Ve)?h.filter(this):Va(h,se)&&h.filter(this)},g.prototype.getBoundary=function(){return(new ld(this)).getBoundary()},g.prototype.isEquivalentClass=function(h){return h instanceof g},g.prototype.clone=function(){var h=d.prototype.clone.call(this);return h._points=
this._points.clone(),h},g.prototype.getCoordinateN=function(h){return this._points.getCoordinate(h)},g.prototype.getGeometryType=function(){return"LineString"},g.prototype.copy=function(){return new g(this._points.copy(),this._factory)},g.prototype.getCoordinateSequence=function(){return this._points},g.prototype.isEmpty=function(){return 0===this._points.size()},g.prototype.init=function(h){if(null===h&&(h=this.getFactory().getCoordinateSequenceFactory().create([])),1===h.size())throw new ac("Invalid number of points in LineString (found "+
h.size()+" - must be 0 or >= 2)");this._points=h},g.prototype.isCoordinate=function(h){for(var m=0;m<this._points.size();m++)if(this._points.getCoordinate(m).equals(h))return!0;return!1},g.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},g.prototype.getPointN=function(h){return this.getFactory().createPoint(this._points.getCoordinate(h))},g.prototype.interfaces_=function(){return[Vg]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},
Object.defineProperties(g,l),g}(Ra),Wg=function(){};Wg.prototype.interfaces_=function(){return[]};Wg.prototype.getClass=function(){return Wg};var Xd=function(d){function g(h,m){d.call(this,m);this._coordinates=h||null;this.init(this._coordinates)}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};return g.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Ia;var h=new Ia;return h.expandToInclude(this._coordinates.getX(0),
this._coordinates.getY(0)),h},g.prototype.getSortIndex=function(){return d.SORTINDEX_POINT},g.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];return!!this.isEquivalentClass(h)&&(!(!this.isEmpty()||!h.isEmpty())||this.isEmpty()===h.isEmpty()&&this.equal(h.getCoordinate(),this.getCoordinate(),m))}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.normalize=
function(){},g.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},g.prototype.getBoundaryDimension=function(){return Eb.FALSE},g.prototype.getDimension=function(){return 0},g.prototype.getNumPoints=function(){return this.isEmpty()?0:1},g.prototype.reverse=function(){return this.copy()},g.prototype.getX=function(){if(null===this.getCoordinate())throw Error("getX called on empty Point");return this.getCoordinate().x},g.prototype.compareToSameClass=
function(){if(1===arguments.length){var h=arguments[0];return this.getCoordinate().compareTo(h.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},g.prototype.apply=function(h){if(Va(h,Ee)){if(this.isEmpty())return null;h.filter(this.getCoordinate())}else if(Va(h,Wd)){if(this.isEmpty())return null;h.filter(this._coordinates,0);h.isGeometryChanged()&&this.geometryChanged()}else Va(h,Ve)?h.filter(this):Va(h,se)&&h.filter(this)},g.prototype.getBoundary=
function(){return this.getFactory().createGeometryCollection(null)},g.prototype.clone=function(){var h=d.prototype.clone.call(this);return h._coordinates=this._coordinates.clone(),h},g.prototype.getGeometryType=function(){return"Point"},g.prototype.copy=function(){return new g(this._coordinates.copy(),this._factory)},g.prototype.getCoordinateSequence=function(){return this._coordinates},g.prototype.getY=function(){if(null===this.getCoordinate())throw Error("getY called on empty Point");return this.getCoordinate().y},
g.prototype.isEmpty=function(){return 0===this._coordinates.size()},g.prototype.init=function(h){null===h&&(h=this.getFactory().getCoordinateSequenceFactory().create([]));Xa.isTrue(1>=h.size());this._coordinates=h},g.prototype.isSimple=function(){return!0},g.prototype.interfaces_=function(){return[Wg]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(g,l),g}(Ra),Xe=function(){};Xe.prototype.interfaces_=function(){return[]};
Xe.prototype.getClass=function(){return Xe};var Fd=function(d){function g(h,m,q){if(d.call(this,q),this._shell=null,this._holes=null,null===h&&(h=this.getFactory().createLinearRing()),null===m&&(m=[]),d.hasNullElements(m))throw new ac("holes must not contain null elements");if(h.isEmpty()&&d.hasNonEmptyElements(m))throw new ac("shell is empty but holes are not");this._shell=h;this._holes=m}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};
return g.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},g.prototype.getSortIndex=function(){return d.SORTINDEX_POLYGON},g.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var h=Array(this.getNumPoints()).fill(null),m=-1,q=this._shell.getCoordinates(),p=0;p<q.length;p++)h[++m]=q[p];for(q=0;q<this._holes.length;q++){p=this._holes[q].getCoordinates();for(var r=0;r<p.length;r++)h[++m]=p[r]}return h},g.prototype.getArea=function(){var h=0+Math.abs(Da.signedArea(this._shell.getCoordinateSequence()));
for(var m=0;m<this._holes.length;m++)h-=Math.abs(Da.signedArea(this._holes[m].getCoordinateSequence()));return h},g.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var h=this._shell.getCoordinateSequence(),m=this.getEnvelopeInternal(),q=0;5>q;q++){var p=h.getX(q);if(p!==m.getMinX()&&p!==m.getMaxX())return!1;p=h.getY(q);if(p!==m.getMinY()&&p!==m.getMaxY())return!1}m=h.getX(0);q=h.getY(0);for(p=1;4>=p;p++){var r=h.getX(p),
v=h.getY(p);if(r!==m===(v!==q))return!1;m=r;q=v}return!0},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];if(!this.isEquivalentClass(h)||!this._shell.equalsExact(h._shell,m)||this._holes.length!==h._holes.length)return!1;for(var q=0;q<this._holes.length;q++)if(!this._holes[q].equalsExact(h._holes[q],m))return!1;return!0}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,
!0);for(var h=0;h<this._holes.length;h++)this.normalize(this._holes[h],!1);Ue.sort(this._holes)}else if(2===arguments.length){h=arguments[0];var m=arguments[1];if(h.isEmpty())return null;var q=Array(h.getCoordinates().length-1).fill(null);Oc.arraycopy(h.getCoordinates(),0,q,0,q.length);var p=ab.minCoordinate(h.getCoordinates());ab.scroll(q,p);Oc.arraycopy(q,0,h.getCoordinates(),0,q.length);h.getCoordinates()[q.length]=q[0];Da.isCCW(h.getCoordinates())===m&&ab.reverse(h.getCoordinates())}},g.prototype.getCoordinate=
function(){return this._shell.getCoordinate()},g.prototype.getNumInteriorRing=function(){return this._holes.length},g.prototype.getBoundaryDimension=function(){return 1},g.prototype.getDimension=function(){return 2},g.prototype.getLength=function(){var h=0+this._shell.getLength();for(var m=0;m<this._holes.length;m++)h+=this._holes[m].getLength();return h},g.prototype.getNumPoints=function(){for(var h=this._shell.getNumPoints(),m=0;m<this._holes.length;m++)h+=this._holes[m].getNumPoints();return h},
g.prototype.reverse=function(){var h=this.copy();h._shell=this._shell.copy().reverse();h._holes=Array(this._holes.length).fill(null);for(var m=0;m<this._holes.length;m++)h._holes[m]=this._holes[m].copy().reverse();return h},g.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},g.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var h=arguments[1],m=arguments[0],q=this._shell.compareToSameClass(m._shell,
h);if(0!==q)return q;q=this.getNumInteriorRing();for(var p=m.getNumInteriorRing(),r=0;r<q&&r<p;){var v=this.getInteriorRingN(r),A=m.getInteriorRingN(r);v=v.compareToSameClass(A,h);if(0!==v)return v;r++}return r<q?1:r<p?-1:0}},g.prototype.apply=function(h){if(Va(h,Ee)){this._shell.apply(h);for(var m=0;m<this._holes.length;m++)this._holes[m].apply(h)}else if(Va(h,Wd)){if(this._shell.apply(h),!h.isDone())for(m=0;m<this._holes.length&&(this._holes[m].apply(h),!h.isDone());m++);h.isGeometryChanged()&&
this.geometryChanged()}else if(Va(h,Ve))h.filter(this);else if(Va(h,se))for(h.filter(this),this._shell.apply(h),m=0;m<this._holes.length;m++)this._holes[m].apply(h)},g.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var h=Array(this._holes.length+1).fill(null);h[0]=this._shell;for(var m=0;m<this._holes.length;m++)h[m+1]=this._holes[m];return 1>=h.length?this.getFactory().createLinearRing(h[0].getCoordinateSequence()):this.getFactory().createMultiLineString(h)},
g.prototype.clone=function(){var h=d.prototype.clone.call(this);h._shell=this._shell.clone();h._holes=Array(this._holes.length).fill(null);for(var m=0;m<this._holes.length;m++)h._holes[m]=this._holes[m].clone();return h},g.prototype.getGeometryType=function(){return"Polygon"},g.prototype.copy=function(){for(var h=this._shell.copy(),m=Array(this._holes.length).fill(null),q=0;q<m.length;q++)m[q]=this._holes[q].copy();return new g(h,m,this._factory)},g.prototype.getExteriorRing=function(){return this._shell},
g.prototype.isEmpty=function(){return this._shell.isEmpty()},g.prototype.getInteriorRingN=function(h){return this._holes[h]},g.prototype.interfaces_=function(){return[Xe]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(g,l),g}(Ra),ag=function(d){function g(){d.apply(this,arguments)}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};return g.prototype.getSortIndex=
function(){return Ra.SORTINDEX_MULTIPOINT},g.prototype.isValid=function(){return!0},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];return!!this.isEquivalentClass(h)&&d.prototype.equalsExact.call(this,h,m)}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():d.prototype.getCoordinate.apply(this,arguments)},g.prototype.getBoundaryDimension=function(){return Eb.FALSE},
g.prototype.getDimension=function(){return 0},g.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},g.prototype.getGeometryType=function(){return"MultiPoint"},g.prototype.copy=function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<h.length;m++)h[m]=this._geometries[m].copy();return new g(h,this._factory)},g.prototype.interfaces_=function(){return[Wg]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},
Object.defineProperties(g,l),g}(ud),Yd=function(d){function g(h,m){h instanceof sa&&m instanceof bb&&(h=m.getCoordinateSequenceFactory().create(h));d.call(this,h,m);this.validateConstruction()}d&&(g.__proto__=d);g.prototype=Object.create(d&&d.prototype);g.prototype.constructor=g;var l={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return g.prototype.getSortIndex=function(){return Ra.SORTINDEX_LINEARRING},g.prototype.getBoundaryDimension=function(){return Eb.FALSE},g.prototype.isClosed=
function(){return!!this.isEmpty()||d.prototype.isClosed.call(this)},g.prototype.reverse=function(){var h=this._points.copy();return dc.reverse(h),this.getFactory().createLinearRing(h)},g.prototype.validateConstruction=function(){if(!this.isEmpty()&&!d.prototype.isClosed.call(this))throw new ac("Points of LinearRing do not form a closed linestring");if(1<=this.getCoordinateSequence().size()&&this.getCoordinateSequence().size()<g.MINIMUM_VALID_SIZE)throw new ac("Invalid number of points in LinearRing (found "+
this.getCoordinateSequence().size()+" - must be 0 or >= 4)");},g.prototype.getGeometryType=function(){return"LinearRing"},g.prototype.copy=function(){return new g(this._points.copy(),this._factory)},g.prototype.interfaces_=function(){return[]},g.prototype.getClass=function(){return g},l.MINIMUM_VALID_SIZE.get=function(){return 4},l.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(g,l),g}(Hc),Fe=function(d){function g(){d.apply(this,arguments)}d&&(g.__proto__=d);g.prototype=
Object.create(d&&d.prototype);g.prototype.constructor=g;var l={serialVersionUID:{configurable:!0}};return g.prototype.getSortIndex=function(){return Ra.SORTINDEX_MULTIPOLYGON},g.prototype.equalsExact=function(){if(2===arguments.length){var h=arguments[0],m=arguments[1];return!!this.isEquivalentClass(h)&&d.prototype.equalsExact.call(this,h,m)}return d.prototype.equalsExact.apply(this,arguments)},g.prototype.getBoundaryDimension=function(){return 1},g.prototype.getDimension=function(){return 2},g.prototype.reverse=
function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<this._geometries.length;m++)h[m]=this._geometries[m].reverse();return this.getFactory().createMultiPolygon(h)},g.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var h=new Fa,m=0;m<this._geometries.length;m++)for(var q=this._geometries[m].getBoundary(),p=0;p<q.getNumGeometries();p++)h.add(q.getGeometryN(p));m=Array(h.size()).fill(null);return this.getFactory().createMultiLineString(h.toArray(m))},
g.prototype.getGeometryType=function(){return"MultiPolygon"},g.prototype.copy=function(){for(var h=Array(this._geometries.length).fill(null),m=0;m<h.length;m++)h[m]=this._geometries[m].copy();return new g(h,this._factory)},g.prototype.interfaces_=function(){return[Xe]},g.prototype.getClass=function(){return g},l.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(g,l),g}(ud),nd=function(d){this._factory=d||null;this._isUserDataCopied=!1},di={NoOpGeometryOperation:{configurable:!0},
CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};nd.prototype.setCopyUserData=function(d){this._isUserDataCopied=d};nd.prototype.edit=function(d,g){if(null===d)return null;g=this.editInternal(d,g);return this._isUserDataCopied&&g.setUserData(d.getUserData()),g};nd.prototype.editInternal=function(d,g){return null===this._factory&&(this._factory=d.getFactory()),d instanceof ud?this.editGeometryCollection(d,g):d instanceof Fd?this.editPolygon(d,g):d instanceof Xd||
d instanceof Hc?g.edit(d,this._factory):(Xa.shouldNeverReachHere("Unsupported Geometry class: "+d.getClass().getName()),null)};nd.prototype.editGeometryCollection=function(d,g){d=g.edit(d,this._factory);for(var l=new Fa,h=0;h<d.getNumGeometries();h++){var m=this.edit(d.getGeometryN(h),g);null===m||m.isEmpty()||l.add(m)}return d.getClass()===ag?this._factory.createMultiPoint(l.toArray([])):d.getClass()===We?this._factory.createMultiLineString(l.toArray([])):d.getClass()===Fe?this._factory.createMultiPolygon(l.toArray([])):
this._factory.createGeometryCollection(l.toArray([]))};nd.prototype.editPolygon=function(d,g){d=g.edit(d,this._factory);if(null===d&&(d=this._factory.createPolygon(null)),d.isEmpty())return d;var l=this.edit(d.getExteriorRing(),g);if(null===l||l.isEmpty())return this._factory.createPolygon();for(var h=new Fa,m=0;m<d.getNumInteriorRing();m++){var q=this.edit(d.getInteriorRingN(m),g);null===q||q.isEmpty()||h.add(q)}return this._factory.createPolygon(l,h.toArray([]))};nd.prototype.interfaces_=function(){return[]};
nd.prototype.getClass=function(){return nd};nd.GeometryEditorOperation=function(){};di.NoOpGeometryOperation.get=function(){return Xg};di.CoordinateOperation.get=function(){return Yg};di.CoordinateSequenceOperation.get=function(){return Zg};Object.defineProperties(nd,di);var Xg=function(){};Xg.prototype.edit=function(d,g){return d};Xg.prototype.interfaces_=function(){return[nd.GeometryEditorOperation]};Xg.prototype.getClass=function(){return Xg};var Yg=function(){};Yg.prototype.edit=function(d,g){var l=
this.editCoordinates(d.getCoordinates(),d);return null===l?d:d instanceof Yd?g.createLinearRing(l):d instanceof Hc?g.createLineString(l):d instanceof Xd?0<l.length?g.createPoint(l[0]):g.createPoint():d};Yg.prototype.interfaces_=function(){return[nd.GeometryEditorOperation]};Yg.prototype.getClass=function(){return Yg};var Zg=function(){};Zg.prototype.edit=function(d,g){return d instanceof Yd?g.createLinearRing(this.edit(d.getCoordinateSequence(),d)):d instanceof Hc?g.createLineString(this.edit(d.getCoordinateSequence(),
d)):d instanceof Xd?g.createPoint(this.edit(d.getCoordinateSequence(),d)):d};Zg.prototype.interfaces_=function(){return[nd.GeometryEditorOperation]};Zg.prototype.getClass=function(){return Zg};var hc=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length)if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var d=arguments[0];this._coordinates=Array(d).fill(null);for(var g=0;g<d;g++)this._coordinates[g]=new sa}else{if(Va(arguments[0],
db)){d=arguments[0];if(null===d)return this._coordinates=[].fill(null),null;this._dimension=d.getDimension();this._coordinates=Array(d.size()).fill(null);for(g=0;g<this._coordinates.length;g++)this._coordinates[g]=d.getCoordinateCopy(g)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1]))d=arguments[0],g=arguments[1],this._coordinates=d,this._dimension=g,null===d&&(this._coordinates=[].fill(null));else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1]))for(d=
arguments[0],g=arguments[1],this._coordinates=Array(d).fill(null),this._dimension=g,g=0;g<d;g++)this._coordinates[g]=new sa},kn={serialVersionUID:{configurable:!0}};hc.prototype.setOrdinate=function(d,g,l){switch(g){case db.X:this._coordinates[d].x=l;break;case db.Y:this._coordinates[d].y=l;break;case db.Z:this._coordinates[d].z=l;break;default:throw new ac("invalid ordinateIndex");}};hc.prototype.size=function(){return this._coordinates.length};hc.prototype.getOrdinate=function(d,g){switch(g){case db.X:return this._coordinates[d].x;
case db.Y:return this._coordinates[d].y;case db.Z:return this._coordinates[d].z}return Wa.NaN};hc.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var d=arguments[0],g=arguments[1];g.x=this._coordinates[d].x;g.y=this._coordinates[d].y;g.z=this._coordinates[d].z}};hc.prototype.getCoordinateCopy=function(d){return new sa(this._coordinates[d])};hc.prototype.getDimension=function(){return this._dimension};hc.prototype.getX=function(d){return this._coordinates[d].x};
hc.prototype.clone=function(){for(var d=Array(this.size()).fill(null),g=0;g<this._coordinates.length;g++)d[g]=this._coordinates[g].clone();return new hc(d,this._dimension)};hc.prototype.expandEnvelope=function(d){for(var g=0;g<this._coordinates.length;g++)d.expandToInclude(this._coordinates[g]);return d};hc.prototype.copy=function(){for(var d=Array(this.size()).fill(null),g=0;g<this._coordinates.length;g++)d[g]=this._coordinates[g].copy();return new hc(d,this._dimension)};hc.prototype.toString=function(){if(0<
this._coordinates.length){var d=new Cd(17*this._coordinates.length);d.append("(");d.append(this._coordinates[0]);for(var g=1;g<this._coordinates.length;g++)d.append(", "),d.append(this._coordinates[g]);return d.append(")"),d.toString()}return"()"};hc.prototype.getY=function(d){return this._coordinates[d].y};hc.prototype.toCoordinateArray=function(){return this._coordinates};hc.prototype.interfaces_=function(){return[db,id]};hc.prototype.getClass=function(){return hc};kn.serialVersionUID.get=function(){return-0xcb44a778db18e00};
Object.defineProperties(hc,kn);var Zd=function(){},Jj={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Zd.prototype.readResolve=function(){return Zd.instance()};Zd.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array||Va(arguments[0],db))return new hc(arguments[0])}else if(2===arguments.length){var d=arguments[0],g=arguments[1];return 3<g&&(g=3),2>g?new hc(d):new hc(d,g)}};Zd.prototype.interfaces_=function(){return[Sf,id]};Zd.prototype.getClass=
function(){return Zd};Zd.instance=function(){return Zd.instanceObject};Jj.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};Jj.instanceObject.get=function(){return new Zd};Object.defineProperties(Zd,Jj);var ln=function(d){function g(){d.call(this);this.map_=new Map}return d&&(g.__proto__=d),g.prototype=Object.create(d&&d.prototype),g.prototype.constructor=g,g.prototype.get=function(l){return this.map_.get(l)||null},g.prototype.put=function(l,h){return this.map_.set(l,h),h},g.prototype.values=
function(){for(var l=new Fa,h=this.map_.values(),m=h.next();!m.done;)l.add(m.value),m=h.next();return l},g.prototype.entrySet=function(){var l=new Hj;return this.map_.entries().forEach(function(h){return l.add(h)}),l},g.prototype.size=function(){return this.map_.size()},g}(sf),Fb=function g(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=g.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Gd){var l=arguments[0];this._modelType=l;l===g.FIXED&&this.setScale(1)}else"number"==
typeof arguments[0]?(l=arguments[0],this._modelType=g.FIXED,this.setScale(l)):arguments[0]instanceof g&&(l=arguments[0],this._modelType=l._modelType,this._scale=l._scale)},Kj={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Fb.prototype.equals=function(g){return g instanceof Fb?this._modelType===g._modelType&&this._scale===g._scale:!1};Fb.prototype.compareTo=function(g){var l=this.getMaximumSignificantDigits();g=g.getMaximumSignificantDigits();return(new Dd(l)).compareTo(new Dd(g))};
Fb.prototype.getScale=function(){return this._scale};Fb.prototype.isFloating=function(){return this._modelType===Fb.FLOATING||this._modelType===Fb.FLOATING_SINGLE};Fb.prototype.getType=function(){return this._modelType};Fb.prototype.toString=function(){var g="UNKNOWN";return this._modelType===Fb.FLOATING?g="Floating":this._modelType===Fb.FLOATING_SINGLE?g="Floating-Single":this._modelType===Fb.FIXED&&(g="Fixed (Scale="+this.getScale()+")"),g};Fb.prototype.makePrecise=function(g){if("number"==typeof g)return Wa.isNaN(g)||
this._modelType===Fb.FLOATING_SINGLE?g:this._modelType===Fb.FIXED?Math.round(g*this._scale)/this._scale:g;if(g instanceof sa){if(this._modelType===Fb.FLOATING)return null;g.x=this.makePrecise(g.x);g.y=this.makePrecise(g.y)}};Fb.prototype.getMaximumSignificantDigits=function(){var g=16;return this._modelType===Fb.FLOATING?g=16:this._modelType===Fb.FLOATING_SINGLE?g=6:this._modelType===Fb.FIXED&&(g=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),g};Fb.prototype.setScale=function(g){this._scale=
Math.abs(g)};Fb.prototype.interfaces_=function(){return[id,jd]};Fb.prototype.getClass=function(){return Fb};Fb.mostPrecise=function(g,l){return 0<=g.compareTo(l)?g:l};Kj.serialVersionUID.get=function(){return 0x6bee6404e9a25c00};Kj.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(Fb,Kj);var Gd=function h(l){this._name=l||null;h.nameToTypeMap.put(l,this)},Lj={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Gd.prototype.readResolve=function(){return Gd.nameToTypeMap.get(this._name)};
Gd.prototype.toString=function(){return this._name};Gd.prototype.interfaces_=function(){return[id]};Gd.prototype.getClass=function(){return Gd};Lj.serialVersionUID.get=function(){return-0x4cb98acd40a6b400};Lj.nameToTypeMap.get=function(){return new ln};Object.defineProperties(Gd,Lj);Fb.Type=Gd;Fb.FIXED=new Gd("FIXED");Fb.FLOATING=new Gd("FLOATING");Fb.FLOATING_SINGLE=new Gd("FLOATING SINGLE");var bb=function h(){this._precisionModel=new Fb;this._SRID=0;this._coordinateSequenceFactory=h.getDefaultCoordinateSequenceFactory();
0===arguments.length||(1===arguments.length?Va(arguments[0],Sf)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Fb&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},mn={serialVersionUID:{configurable:!0}};bb.prototype.toGeometry=function(h){return h.isNull()?this.createPoint(null):h.getMinX()===
h.getMaxX()&&h.getMinY()===h.getMaxY()?this.createPoint(new sa(h.getMinX(),h.getMinY())):h.getMinX()===h.getMaxX()||h.getMinY()===h.getMaxY()?this.createLineString([new sa(h.getMinX(),h.getMinY()),new sa(h.getMaxX(),h.getMaxY())]):this.createPolygon(this.createLinearRing([new sa(h.getMinX(),h.getMinY()),new sa(h.getMinX(),h.getMaxY()),new sa(h.getMaxX(),h.getMaxY()),new sa(h.getMaxX(),h.getMinY()),new sa(h.getMinX(),h.getMinY())]),null)};bb.prototype.createLineString=function(h){return h?h instanceof
Array?new Hc(this.getCoordinateSequenceFactory().create(h),this):Va(h,db)?new Hc(h,this):void 0:new Hc(this.getCoordinateSequenceFactory().create([]),this)};bb.prototype.createMultiLineString=function(){if(0===arguments.length)return new We(null,this);if(1===arguments.length)return new We(arguments[0],this)};bb.prototype.buildGeometry=function(h){for(var m=null,q=!1,p=!1,r=h.iterator();r.hasNext();){var v=r.next(),A=v.getClass();null===m&&(m=A);A!==m&&(q=!0);v.isGeometryCollectionOrDerived()&&(p=
!0)}if(null===m)return this.createGeometryCollection();if(q||p)return this.createGeometryCollection(bb.toGeometryArray(h));m=h.iterator().next();if(1<h.size()){if(m instanceof Fd)return this.createMultiPolygon(bb.toPolygonArray(h));if(m instanceof Hc)return this.createMultiLineString(bb.toLineStringArray(h));if(m instanceof Xd)return this.createMultiPoint(bb.toPointArray(h));Xa.shouldNeverReachHere("Unhandled class: "+m.getClass().getName())}return m};bb.prototype.createMultiPointFromCoords=function(h){return this.createMultiPoint(null!==
h?this.getCoordinateSequenceFactory().create(h):null)};bb.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof sa){var h=arguments[0];return this.createPoint(null!==h?this.getCoordinateSequenceFactory().create([h]):null)}if(Va(arguments[0],db))return new Xd(arguments[0],this)}};bb.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};bb.prototype.createPolygon=
function(){if(0===arguments.length)return new Fd(null,null,this);if(1===arguments.length){if(Va(arguments[0],db)||arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Yd)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new Fd(arguments[0],arguments[1],this)};bb.prototype.getSRID=function(){return this._SRID};bb.prototype.createGeometryCollection=function(){if(0===arguments.length)return new ud(null,this);
if(1===arguments.length)return new ud(arguments[0],this)};bb.prototype.createGeometry=function(h){return(new nd(this)).edit(h,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})};bb.prototype.getPrecisionModel=function(){return this._precisionModel};bb.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var h=
arguments[0];return this.createLinearRing(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(Va(arguments[0],db))return new Yd(arguments[0],this)}};bb.prototype.createMultiPolygon=function(){if(0===arguments.length)return new Fe(null,this);if(1===arguments.length)return new Fe(arguments[0],this)};bb.prototype.createMultiPoint=function(){if(0===arguments.length)return new ag(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new ag(arguments[0],this);if(arguments[0]instanceof
Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(Va(arguments[0],db)){h=arguments[0];if(null===h)return this.createMultiPoint([].fill(null));for(var m=Array(h.size()).fill(null),q=0;q<h.size();q++){var p=this.getCoordinateSequenceFactory().create(1,h.getDimension());dc.copy(h,q,p,0,1);m[q]=this.createPoint(p)}return this.createMultiPoint(m)}}};bb.prototype.interfaces_=function(){return[id]};bb.prototype.getClass=function(){return bb};
bb.toMultiPolygonArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.toGeometryArray=function(h){if(null===h)return null;var m=Array(h.size()).fill(null);return h.toArray(m)};bb.getDefaultCoordinateSequenceFactory=function(){return Zd.instance()};bb.toMultiLineStringArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.toLineStringArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.toMultiPointArray=function(h){var m=Array(h.size()).fill(null);
return h.toArray(m)};bb.toLinearRingArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.toPointArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.toPolygonArray=function(h){var m=Array(h.size()).fill(null);return h.toArray(m)};bb.createPointFromInternalCoord=function(h,m){return m.getPrecisionModel().makePrecise(h),m.getFactory().createPoint(h)};mn.serialVersionUID.get=function(){return-0x5ea75f2051eeb400};Object.defineProperties(bb,mn);var Ap="Point MultiPoint LineString MultiLineString Polygon MultiPolygon".split(" "),
ei=function(h){this.geometryFactory=h||new bb};ei.prototype.read=function(h){var m=(h="string"==typeof h?JSON.parse(h):h).type;if(!Hd[m])throw Error("Unknown GeoJSON type: "+h.type);return-1!==Ap.indexOf(m)?Hd[m].apply(this,[h.coordinates]):"GeometryCollection"===m?Hd[m].apply(this,[h.geometries]):Hd[m].apply(this,[h])};ei.prototype.write=function(h){var m=h.getGeometryType();if(!ve[m])throw Error("Geometry is not supported");return ve[m].apply(this,[h])};var Hd={Feature:function(h){var m={},q;for(q in h)m[q]=
h[q];if(h.geometry){if(!Hd[h.geometry.type])throw Error("Unknown GeoJSON type: "+h.type);m.geometry=this.read(h.geometry)}return h.bbox&&(m.bbox=Hd.bbox.apply(this,[h.bbox])),m},FeatureCollection:function(h){var m={};if(h.features){m.features=[];for(var q=0;q<h.features.length;++q)m.features.push(this.read(h.features[q]))}return h.bbox&&(m.bbox=this.parse.bbox.apply(this,[h.bbox])),m},coordinates:function(h){for(var m=[],q=0;q<h.length;++q){var p=h[q];m.push(new sa(p[0],p[1]))}return m},bbox:function(h){return this.geometryFactory.createLinearRing([new sa(h[0],
h[1]),new sa(h[2],h[1]),new sa(h[2],h[3]),new sa(h[0],h[3]),new sa(h[0],h[1])])},Point:function(h){h=new sa(h[0],h[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(h){for(var m=[],q=0;q<h.length;++q)m.push(Hd.Point.apply(this,[h[q]]));return this.geometryFactory.createMultiPoint(m)},LineString:function(h){h=Hd.coordinates.apply(this,[h]);return this.geometryFactory.createLineString(h)},MultiLineString:function(h){for(var m=[],q=0;q<h.length;++q)m.push(Hd.LineString.apply(this,[h[q]]));
return this.geometryFactory.createMultiLineString(m)},Polygon:function(h){var m=Hd.coordinates.apply(this,[h[0]]);m=this.geometryFactory.createLinearRing(m);for(var q=[],p=1;p<h.length;++p){var r=Hd.coordinates.apply(this,[h[p]]);r=this.geometryFactory.createLinearRing(r);q.push(r)}return this.geometryFactory.createPolygon(m,q)},MultiPolygon:function(h){for(var m=[],q=0;q<h.length;++q)m.push(Hd.Polygon.apply(this,[h[q]]));return this.geometryFactory.createMultiPolygon(m)},GeometryCollection:function(h){for(var m=
[],q=0;q<h.length;++q)m.push(this.read(h[q]));return this.geometryFactory.createGeometryCollection(m)}},ve={coordinate:function(h){return[h.x,h.y]},Point:function(h){return{type:"Point",coordinates:ve.coordinate.apply(this,[h.getCoordinate()])}},MultiPoint:function(h){for(var m=[],q=0;q<h._geometries.length;++q){var p=ve.Point.apply(this,[h._geometries[q]]);m.push(p.coordinates)}return{type:"MultiPoint",coordinates:m}},LineString:function(h){var m=[];h=h.getCoordinates();for(var q=0;q<h.length;++q)m.push(ve.coordinate.apply(this,
[h[q]]));return{type:"LineString",coordinates:m}},MultiLineString:function(h){for(var m=[],q=0;q<h._geometries.length;++q){var p=ve.LineString.apply(this,[h._geometries[q]]);m.push(p.coordinates)}return{type:"MultiLineString",coordinates:m}},Polygon:function(h){var m=[],q=ve.LineString.apply(this,[h._shell]);m.push(q.coordinates);for(q=0;q<h._holes.length;++q){var p=ve.LineString.apply(this,[h._holes[q]]);m.push(p.coordinates)}return{type:"Polygon",coordinates:m}},MultiPolygon:function(h){for(var m=
[],q=0;q<h._geometries.length;++q){var p=ve.Polygon.apply(this,[h._geometries[q]]);m.push(p.coordinates)}return{type:"MultiPolygon",coordinates:m}},GeometryCollection:function(h){for(var m=[],q=0;q<h._geometries.length;++q){var p=h._geometries[q],r=p.getGeometryType();m.push(ve[r].apply(this,[p]))}return{type:"GeometryCollection",geometries:m}}},qj=function(h){this.geometryFactory=h||new bb;this.precisionModel=this.geometryFactory.getPrecisionModel();this.parser=new ei(this.geometryFactory)};qj.prototype.read=
function(h){h=this.parser.read(h);return this.precisionModel.getType()===Fb.FIXED&&this.reducePrecision(h),h};qj.prototype.reducePrecision=function(h){var m;if(h.coordinate)this.precisionModel.makePrecise(h.coordinate);else if(h.points){var q=0;for(m=h.points.length;q<m;q++)this.precisionModel.makePrecise(h.points[q])}else if(h.geometries)for(q=0,m=h.geometries.length;q<m;q++)this.reducePrecision(h.geometries[q])};var Cm=function(){this.parser=new ei(this.geometryFactory)};Cm.prototype.write=function(h){return this.parser.write(h)};
var Aa=function(){},fi={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Aa.prototype.interfaces_=function(){return[]};Aa.prototype.getClass=function(){return Aa};Aa.opposite=function(h){return h===Aa.LEFT?Aa.RIGHT:h===Aa.RIGHT?Aa.LEFT:h};fi.ON.get=function(){return 0};fi.LEFT.get=function(){return 1};fi.RIGHT.get=function(){return 2};Object.defineProperties(Aa,fi);Mh.prototype=Error();Mh.prototype.name="EmptyStackException";Ad.prototype=new ue;Ad.prototype.add=function(h){return this.array_.push(h),
!0};Ad.prototype.get=function(h){if(0>h||h>=this.size())throw Error();return this.array_[h]};Ad.prototype.push=function(h){return this.array_.push(h),h};Ad.prototype.pop=function(h){if(0===this.array_.length)throw new Mh;return this.array_.pop()};Ad.prototype.peek=function(){if(0===this.array_.length)throw new Mh;return this.array_[this.array_.length-1]};Ad.prototype.empty=function(){return 0===this.array_.length};Ad.prototype.isEmpty=function(){return this.empty()};Ad.prototype.search=function(h){return this.array_.indexOf(h)};
Ad.prototype.size=function(){return this.array_.length};Ad.prototype.toArray=function(){for(var h=[],m=0,q=this.array_.length;m<q;m++)h.push(this.array_[m]);return h};var Id=function(){this._minIndex=-1;this._orientedDe=this._minDe=this._minCoord=null};Id.prototype.getCoordinate=function(){return this._minCoord};Id.prototype.getRightmostSide=function(h,m){var q=this.getRightmostSideOfSegment(h,m);return 0>q&&(q=this.getRightmostSideOfSegment(h,m-1)),0>q&&(this._minCoord=null,this.checkForRightmostCoordinate(h)),
q};Id.prototype.findRightmostEdgeAtVertex=function(){var h=this._minDe.getEdge().getCoordinates();Xa.isTrue(0<this._minIndex&&this._minIndex<h.length,"rightmost point expected to be interior vertex of edge");var m=h[this._minIndex-1];h=h[this._minIndex+1];var q=Da.computeOrientation(this._minCoord,h,m),p=!1;(m.y<this._minCoord.y&&h.y<this._minCoord.y&&q===Da.COUNTERCLOCKWISE||m.y>this._minCoord.y&&h.y>this._minCoord.y&&q===Da.CLOCKWISE)&&(p=!0);p&&--this._minIndex};Id.prototype.getRightmostSideOfSegment=
function(h,m){h=h.getEdge().getCoordinates();if(0>m||m+1>=h.length||h[m].y===h[m+1].y)return-1;var q=Aa.LEFT;return h[m].y<h[m+1].y&&(q=Aa.RIGHT),q};Id.prototype.getEdge=function(){return this._orientedDe};Id.prototype.checkForRightmostCoordinate=function(h){for(var m=h.getEdge().getCoordinates(),q=0;q<m.length-1;q++)(null===this._minCoord||m[q].x>this._minCoord.x)&&(this._minDe=h,this._minIndex=q,this._minCoord=m[q])};Id.prototype.findRightmostEdgeAtNode=function(){this._minDe=this._minDe.getNode().getEdges().getRightmostEdge();
this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Id.prototype.findEdge=function(h){for(h=h.iterator();h.hasNext();){var m=h.next();m.isForward()&&this.checkForRightmostCoordinate(m)}Xa.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing");0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex();this._orientedDe=this._minDe;this.getRightmostSide(this._minDe,
this._minIndex)===Aa.LEFT&&(this._orientedDe=this._minDe.getSym())};Id.prototype.interfaces_=function(){return[]};Id.prototype.getClass=function(){return Id};var we=function(h){function m(q,p){h.call(this,m.msgWithCoord(q,p));this.pt=p?new sa(p):null;this.name="TopologyException"}return h&&(m.__proto__=h),m.prototype=Object.create(h&&h.prototype),m.prototype.constructor=m,m.prototype.getCoordinate=function(){return this.pt},m.prototype.interfaces_=function(){return[]},m.prototype.getClass=function(){return m},
m.msgWithCoord=function(q,p){return p?q:q+" [ "+p+" ]"},m}(re),gi=function(){this.array_=[]};gi.prototype.addLast=function(h){this.array_.push(h)};gi.prototype.removeFirst=function(){return this.array_.shift()};gi.prototype.isEmpty=function(){return 0===this.array_.length};var Ic=function(){this._finder=null;this._dirEdgeList=new Fa;this._nodes=new Fa;this._env=this._rightMostCoord=null;this._finder=new Id};Ic.prototype.clearVisitedEdges=function(){for(var h=this._dirEdgeList.iterator();h.hasNext();)h.next().setVisited(!1)};
Ic.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ic.prototype.computeNodeDepth=function(h){for(var m=null,q=h.getEdges().iterator();q.hasNext();){var p=q.next();if(p.isVisited()||p.getSym().isVisited()){m=p;break}}if(null===m)throw new we("unable to find edge to compute depths at "+h.getCoordinate());h.getEdges().computeDepths(m);for(h=h.getEdges().iterator();h.hasNext();)m=h.next(),m.setVisited(!0),this.copySymDepths(m)};Ic.prototype.computeDepth=function(h){this.clearVisitedEdges();
var m=this._finder.getEdge();m.setEdgeDepths(Aa.RIGHT,h);this.copySymDepths(m);this.computeDepths(m)};Ic.prototype.create=function(h){this.addReachable(h);this._finder.findEdge(this._dirEdgeList);this._rightMostCoord=this._finder.getCoordinate()};Ic.prototype.findResultEdges=function(){for(var h=this._dirEdgeList.iterator();h.hasNext();){var m=h.next();1<=m.getDepth(Aa.RIGHT)&&0>=m.getDepth(Aa.LEFT)&&!m.isInteriorAreaEdge()&&m.setInResult(!0)}};Ic.prototype.computeDepths=function(h){var m=new Hj,
q=new gi,p=h.getNode();q.addLast(p);m.add(p);for(h.setVisited(!0);!q.isEmpty();)for(h=q.removeFirst(),m.add(h),this.computeNodeDepth(h),h=h.getEdges().iterator();h.hasNext();)p=h.next().getSym(),p.isVisited()||(p=p.getNode(),m.contains(p)||(q.addLast(p),m.add(p)))};Ic.prototype.compareTo=function(h){return this._rightMostCoord.x<h._rightMostCoord.x?-1:this._rightMostCoord.x>h._rightMostCoord.x?1:0};Ic.prototype.getEnvelope=function(){if(null===this._env){for(var h=new Ia,m=this._dirEdgeList.iterator();m.hasNext();)for(var q=
m.next().getEdge().getCoordinates(),p=0;p<q.length-1;p++)h.expandToInclude(q[p]);this._env=h}return this._env};Ic.prototype.addReachable=function(h){var m=new Ad;for(m.add(h);!m.empty();)h=m.pop(),this.add(h,m)};Ic.prototype.copySymDepths=function(h){var m=h.getSym();m.setDepth(Aa.LEFT,h.getDepth(Aa.RIGHT));m.setDepth(Aa.RIGHT,h.getDepth(Aa.LEFT))};Ic.prototype.add=function(h,m){h.setVisited(!0);this._nodes.add(h);for(h=h.getEdges().iterator();h.hasNext();){var q=h.next();this._dirEdgeList.add(q);
q=q.getSym().getNode();q.isVisited()||m.push(q)}};Ic.prototype.getNodes=function(){return this._nodes};Ic.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ic.prototype.interfaces_=function(){return[jd]};Ic.prototype.getClass=function(){return Ic};var Qb=function m(){if(this.location=null,1===arguments.length)if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var q=arguments[0];this.init(1);this.location[Aa.ON]=q}else{if(arguments[0]instanceof
m&&(q=arguments[0],this.init(q.location.length),null!==q))for(var p=0;p<this.location.length;p++)this.location[p]=q.location[p]}else if(3===arguments.length){q=arguments[0];p=arguments[1];var r=arguments[2];this.init(3);this.location[Aa.ON]=q;this.location[Aa.LEFT]=p;this.location[Aa.RIGHT]=r}};Qb.prototype.setAllLocations=function(m){for(var q=0;q<this.location.length;q++)this.location[q]=m};Qb.prototype.isNull=function(){for(var m=0;m<this.location.length;m++)if(this.location[m]!==ua.NONE)return!1;
return!0};Qb.prototype.setAllLocationsIfNull=function(m){for(var q=0;q<this.location.length;q++)this.location[q]===ua.NONE&&(this.location[q]=m)};Qb.prototype.isLine=function(){return 1===this.location.length};Qb.prototype.merge=function(m){if(m.location.length>this.location.length){var q=Array(3).fill(null);q[Aa.ON]=this.location[Aa.ON];q[Aa.LEFT]=ua.NONE;q[Aa.RIGHT]=ua.NONE;this.location=q}for(q=0;q<this.location.length;q++)this.location[q]===ua.NONE&&q<m.location.length&&(this.location[q]=m.location[q])};
Qb.prototype.getLocations=function(){return this.location};Qb.prototype.flip=function(){if(1>=this.location.length)return null;var m=this.location[Aa.LEFT];this.location[Aa.LEFT]=this.location[Aa.RIGHT];this.location[Aa.RIGHT]=m};Qb.prototype.toString=function(){var m=new Cd;return 1<this.location.length&&m.append(ua.toLocationSymbol(this.location[Aa.LEFT])),m.append(ua.toLocationSymbol(this.location[Aa.ON])),1<this.location.length&&m.append(ua.toLocationSymbol(this.location[Aa.RIGHT])),m.toString()};
Qb.prototype.setLocations=function(m,q,p){this.location[Aa.ON]=m;this.location[Aa.LEFT]=q;this.location[Aa.RIGHT]=p};Qb.prototype.get=function(m){return m<this.location.length?this.location[m]:ua.NONE};Qb.prototype.isArea=function(){return 1<this.location.length};Qb.prototype.isAnyNull=function(){for(var m=0;m<this.location.length;m++)if(this.location[m]===ua.NONE)return!0;return!1};Qb.prototype.setLocation=function(){1===arguments.length?this.setLocation(Aa.ON,arguments[0]):2===arguments.length&&
(this.location[arguments[0]]=arguments[1])};Qb.prototype.init=function(m){this.location=Array(m).fill(null);this.setAllLocations(ua.NONE)};Qb.prototype.isEqualOnSide=function(m,q){return this.location[q]===m.location[q]};Qb.prototype.allPositionsEqual=function(m){for(var q=0;q<this.location.length;q++)if(this.location[q]!==m)return!1;return!0};Qb.prototype.interfaces_=function(){return[]};Qb.prototype.getClass=function(){return Qb};var Jb=function q(){if(this.elt=Array(2).fill(null),1===arguments.length)if(Number.isInteger(arguments[0])){var p=
arguments[0];this.elt[0]=new Qb(p);this.elt[1]=new Qb(p)}else arguments[0]instanceof q&&(p=arguments[0],this.elt[0]=new Qb(p.elt[0]),this.elt[1]=new Qb(p.elt[1]));else if(2===arguments.length){p=arguments[0];var r=arguments[1];this.elt[0]=new Qb(ua.NONE);this.elt[1]=new Qb(ua.NONE);this.elt[p].setLocation(r)}else if(3===arguments.length){p=arguments[0];r=arguments[1];var v=arguments[2];this.elt[0]=new Qb(p,r,v);this.elt[1]=new Qb(p,r,v)}else if(4===arguments.length){p=arguments[0];r=arguments[1];
v=arguments[2];var A=arguments[3];this.elt[0]=new Qb(ua.NONE,ua.NONE,ua.NONE);this.elt[1]=new Qb(ua.NONE,ua.NONE,ua.NONE);this.elt[p].setLocations(r,v,A)}};Jb.prototype.getGeometryCount=function(){var q=0;return this.elt[0].isNull()||q++,this.elt[1].isNull()||q++,q};Jb.prototype.setAllLocations=function(q,p){this.elt[q].setAllLocations(p)};Jb.prototype.isNull=function(q){return this.elt[q].isNull()};Jb.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var q=arguments[0];this.setAllLocationsIfNull(0,
q);this.setAllLocationsIfNull(1,q)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])};Jb.prototype.isLine=function(q){return this.elt[q].isLine()};Jb.prototype.merge=function(q){for(var p=0;2>p;p++)null===this.elt[p]&&null!==q.elt[p]?this.elt[p]=new Qb(q.elt[p]):this.elt[p].merge(q.elt[p])};Jb.prototype.flip=function(){this.elt[0].flip();this.elt[1].flip()};Jb.prototype.getLocation=function(){if(1===arguments.length)return this.elt[arguments[0]].get(Aa.ON);if(2===
arguments.length)return this.elt[arguments[0]].get(arguments[1])};Jb.prototype.toString=function(){var q=new Cd;return null!==this.elt[0]&&(q.append("A:"),q.append(this.elt[0].toString())),null!==this.elt[1]&&(q.append(" B:"),q.append(this.elt[1].toString())),q.toString()};Jb.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length)return this.elt[arguments[0]].isArea()};Jb.prototype.isAnyNull=function(q){return this.elt[q].isAnyNull()};
Jb.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(Aa.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])};Jb.prototype.isEqualOnSide=function(q,p){return this.elt[0].isEqualOnSide(q.elt[0],p)&&this.elt[1].isEqualOnSide(q.elt[1],p)};Jb.prototype.allPositionsEqual=function(q,p){return this.elt[q].allPositionsEqual(p)};Jb.prototype.toLine=function(q){this.elt[q].isArea()&&(this.elt[q]=new Qb(this.elt[q].location[0]))};
Jb.prototype.interfaces_=function(){return[]};Jb.prototype.getClass=function(){return Jb};Jb.toLineLabel=function(q){for(var p=new Jb(ua.NONE),r=0;2>r;r++)p.setLocation(r,q.getLocation(r));return p};var ic=function(q,p){this._startDe=null;this._maxNodeDegree=-1;this._edges=new Fa;this._pts=new Fa;this._label=new Jb(ua.NONE);this._shell=this._isHole=this._ring=null;this._holes=new Fa;this._geometryFactory=p;this.computePoints(q);this.computeRing()};ic.prototype.computeRing=function(){if(null!==this._ring)return null;
for(var q=Array(this._pts.size()).fill(null),p=0;p<this._pts.size();p++)q[p]=this._pts.get(p);this._ring=this._geometryFactory.createLinearRing(q);this._isHole=Da.isCCW(this._ring.getCoordinates())};ic.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()};ic.prototype.computePoints=function(q){this._startDe=q;var p=!0;do{if(null===q)throw new we("Found null DirectedEdge");if(q.getEdgeRing()===this)throw new we("Directed Edge visited twice during ring-building at "+q.getCoordinate());
this._edges.add(q);var r=q.getLabel();Xa.isTrue(r.isArea());this.mergeLabel(r);this.addPoints(q.getEdge(),q.isForward(),p);p=!1;this.setEdgeRing(q,this);q=this.getNext(q)}while(q!==this._startDe)};ic.prototype.getLinearRing=function(){return this._ring};ic.prototype.getCoordinate=function(q){return this._pts.get(q)};ic.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var q=this._startDe;do{var p=q.getNode().getEdges().getOutgoingDegree(this);p>this._maxNodeDegree&&(this._maxNodeDegree=
p);q=this.getNext(q)}while(q!==this._startDe);this._maxNodeDegree*=2};ic.prototype.addPoints=function(q,p,r){q=q.getCoordinates();if(p)for(p=1,r&&(p=0),r=p;r<q.length;r++)this._pts.add(q[r]);else for(p=q.length-2,r&&(p=q.length-1),r=p;0<=r;r--)this._pts.add(q[r])};ic.prototype.isHole=function(){return this._isHole};ic.prototype.setInResult=function(){var q=this._startDe;do q.getEdge().setInResult(!0),q=q.getNext();while(q!==this._startDe)};ic.prototype.containsPoint=function(q){var p=this.getLinearRing();
if(!p.getEnvelopeInternal().contains(q)||!Da.isPointInRing(q,p.getCoordinates()))return!1;for(p=this._holes.iterator();p.hasNext();)if(p.next().containsPoint(q))return!1;return!0};ic.prototype.addHole=function(q){this._holes.add(q)};ic.prototype.isShell=function(){return null===this._shell};ic.prototype.getLabel=function(){return this._label};ic.prototype.getEdges=function(){return this._edges};ic.prototype.getMaxNodeDegree=function(){return 0>this._maxNodeDegree&&this.computeMaxNodeDegree(),this._maxNodeDegree};
ic.prototype.getShell=function(){return this._shell};ic.prototype.mergeLabel=function(){if(1===arguments.length){var q=arguments[0];this.mergeLabel(q,0);this.mergeLabel(q,1)}else if(2===arguments.length){q=arguments[1];var p=arguments[0].getLocation(q,Aa.RIGHT);if(p===ua.NONE)return null;if(this._label.getLocation(q)===ua.NONE)return this._label.setLocation(q,p),null}};ic.prototype.setShell=function(q){this._shell=q;null!==q&&q.addHole(this)};ic.prototype.toPolygon=function(q){for(var p=Array(this._holes.size()).fill(null),
r=0;r<this._holes.size();r++)p[r]=this._holes.get(r).getLinearRing();return q.createPolygon(this.getLinearRing(),p)};ic.prototype.interfaces_=function(){return[]};ic.prototype.getClass=function(){return ic};var Bp=function(q){function p(r,v){q.call(this,r,v)}return q&&(p.__proto__=q),p.prototype=Object.create(q&&q.prototype),p.prototype.constructor=p,p.prototype.setEdgeRing=function(r,v){r.setMinEdgeRing(v)},p.prototype.getNext=function(r){return r.getNextMin()},p.prototype.interfaces_=function(){return[]},
p.prototype.getClass=function(){return p},p}(ic),Cp=function(q){function p(r,v){q.call(this,r,v)}return q&&(p.__proto__=q),p.prototype=Object.create(q&&q.prototype),p.prototype.constructor=p,p.prototype.buildMinimalRings=function(){var r=new Fa,v=this._startDe;do{if(null===v.getMinEdgeRing()){var A=new Bp(v,this._geometryFactory);r.add(A)}v=v.getNext()}while(v!==this._startDe);return r},p.prototype.setEdgeRing=function(r,v){r.setEdgeRing(v)},p.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var r=
this._startDe;do r.getNode().getEdges().linkMinimalDirectedEdges(this),r=r.getNext();while(r!==this._startDe)},p.prototype.getNext=function(r){return r.getNext()},p.prototype.interfaces_=function(){return[]},p.prototype.getClass=function(){return p},p}(ic),dd=function(){(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length)&&1===arguments.length&&(this._label=arguments[0])};dd.prototype.setVisited=function(q){this._isVisited=q};dd.prototype.setInResult=
function(q){this._isInResult=q};dd.prototype.isCovered=function(){return this._isCovered};dd.prototype.isCoveredSet=function(){return this._isCoveredSet};dd.prototype.setLabel=function(q){this._label=q};dd.prototype.getLabel=function(){return this._label};dd.prototype.setCovered=function(q){this._isCovered=q;this._isCoveredSet=!0};dd.prototype.updateIM=function(q){Xa.isTrue(2<=this._label.getGeometryCount(),"found partial label");this.computeIM(q)};dd.prototype.isInResult=function(){return this._isInResult};
dd.prototype.isVisited=function(){return this._isVisited};dd.prototype.interfaces_=function(){return[]};dd.prototype.getClass=function(){return dd};var hi=function(q){function p(r,v){q.call(this);this._coord=r;this._edges=v;this._label=new Jb(0,ua.NONE)}return q&&(p.__proto__=q),p.prototype=Object.create(q&&q.prototype),p.prototype.constructor=p,p.prototype.isIncidentEdgeInResult=function(){for(var r=this.getEdges().getEdges().iterator();r.hasNext();)if(r.next().getEdge().isInResult())return!0;return!1},
p.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},p.prototype.getCoordinate=function(){return this._coord},p.prototype.print=function(r){r.println("node "+this._coord+" lbl: "+this._label)},p.prototype.computeIM=function(r){},p.prototype.computeMergedLocation=function(r,v){var A;(A=this._label.getLocation(v),r.isNull(v))||(r=r.getLocation(v),A!==ua.BOUNDARY&&(A=r));return A},p.prototype.setLabel=function(){if(2!==arguments.length)return q.prototype.setLabel.apply(this,arguments);
var r=arguments[0],v=arguments[1];null===this._label?this._label=new Jb(r,v):this._label.setLocation(r,v)},p.prototype.getEdges=function(){return this._edges},p.prototype.mergeLabel=function(r){if(r instanceof p)this.mergeLabel(r._label);else if(r instanceof Jb)for(var v=0;2>v;v++){var A=this.computeMergedLocation(r,v);this._label.getLocation(v)===ua.NONE&&this._label.setLocation(v,A)}},p.prototype.add=function(r){this._edges.insert(r);r.setNode(this)},p.prototype.setLabelBoundary=function(r){if(null===
this._label)return null;var v=ua.NONE;null!==this._label&&(v=this._label.getLocation(r));switch(v){case ua.BOUNDARY:v=ua.INTERIOR;break;default:v=ua.BOUNDARY}this._label.setLocation(r,v)},p.prototype.interfaces_=function(){return[]},p.prototype.getClass=function(){return p},p}(dd),Jd=function(q){this.nodeMap=new Ac;this.nodeFact=q};Jd.prototype.find=function(q){return this.nodeMap.get(q)};Jd.prototype.addNode=function(q){if(q instanceof sa){var p=this.nodeMap.get(q);return null===p&&(p=this.nodeFact.createNode(q),
this.nodeMap.put(q,p)),p}if(q instanceof hi)return p=this.nodeMap.get(q.getCoordinate()),null===p?(this.nodeMap.put(q.getCoordinate(),q),q):(p.mergeLabel(q),p)};Jd.prototype.print=function(q){for(var p=this.iterator();p.hasNext();)p.next().print(q)};Jd.prototype.iterator=function(){return this.nodeMap.values().iterator()};Jd.prototype.values=function(){return this.nodeMap.values()};Jd.prototype.getBoundaryNodes=function(q){for(var p=new Fa,r=this.iterator();r.hasNext();){var v=r.next();v.getLabel().getLocation(q)===
ua.BOUNDARY&&p.add(v)}return p};Jd.prototype.add=function(q){var p=q.getCoordinate();this.addNode(p).add(q)};Jd.prototype.interfaces_=function(){return[]};Jd.prototype.getClass=function(){return Jd};var Mb=function(){},$g={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Mb.prototype.interfaces_=function(){return[]};Mb.prototype.getClass=function(){return Mb};Mb.isNorthern=function(q){return q===Mb.NE||q===Mb.NW};Mb.isOpposite=function(q,p){return q!==p&&2===(q-
p+4)%4};Mb.commonHalfPlane=function(q,p){if(q===p)return q;if(2===(q-p+4)%4)return-1;var r=q<p?q:p;return 0===r&&3===(q>p?q:p)?3:r};Mb.isInHalfPlane=function(q,p){return p===Mb.SE?q===Mb.SE||q===Mb.SW:q===p||q===p+1};Mb.quadrant=function(q,p){if("number"==typeof q&&"number"==typeof p){if(0===q&&0===p)throw new ac("Cannot compute the quadrant for point ( "+q+", "+p+" )");return 0<=q?0<=p?Mb.NE:Mb.SE:0<=p?Mb.NW:Mb.SW}if(q instanceof sa&&p instanceof sa){if(p.x===q.x&&p.y===q.y)throw new ac("Cannot compute the quadrant for two identical points "+
q);return p.x>=q.x?p.y>=q.y?Mb.NE:Mb.SE:p.y>=q.y?Mb.NW:Mb.SW}};$g.NE.get=function(){return 0};$g.NW.get=function(){return 1};$g.SW.get=function(){return 2};$g.SE.get=function(){return 3};Object.defineProperties(Mb,$g);var Bc=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var q=arguments[1],p=arguments[2];this._edge=arguments[0];this.init(q,
p);this._label=null}else if(4===arguments.length){q=arguments[1];p=arguments[2];var r=arguments[3];this._edge=arguments[0];this.init(q,p);this._label=r}};Bc.prototype.compareDirection=function(q){return this._dx===q._dx&&this._dy===q._dy?0:this._quadrant>q._quadrant?1:this._quadrant<q._quadrant?-1:Da.computeOrientation(q._p0,q._p1,this._p1)};Bc.prototype.getDy=function(){return this._dy};Bc.prototype.getCoordinate=function(){return this._p0};Bc.prototype.setNode=function(q){this._node=q};Bc.prototype.print=
function(q){var p=Math.atan2(this._dy,this._dx),r=this.getClass().getName(),v=r.lastIndexOf(".");r=r.substring(v+1);q.print("  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+p+"   "+this._label)};Bc.prototype.compareTo=function(q){return this.compareDirection(q)};Bc.prototype.getDirectedCoordinate=function(){return this._p1};Bc.prototype.getDx=function(){return this._dx};Bc.prototype.getLabel=function(){return this._label};Bc.prototype.getEdge=function(){return this._edge};Bc.prototype.getQuadrant=
function(){return this._quadrant};Bc.prototype.getNode=function(){return this._node};Bc.prototype.toString=function(){var q=Math.atan2(this._dy,this._dx),p=this.getClass().getName(),r=p.lastIndexOf(".");return"  "+p.substring(r+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+q+"   "+this._label};Bc.prototype.computeLabel=function(q){};Bc.prototype.init=function(q,p){this._p0=q;this._p1=p;this._dx=p.x-q.x;this._dy=p.y-q.y;this._quadrant=Mb.quadrant(this._dx,this._dy);Xa.isTrue(!(0===this._dx&&
0===this._dy),"EdgeEnd with identical endpoints found")};Bc.prototype.interfaces_=function(){return[jd]};Bc.prototype.getClass=function(){return Bc};var Mj=function(q){function p(r,v){(q.call(this,r),this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=v,v)?this.init(r.getCoordinate(0),r.getCoordinate(1)):(v=r.getNumPoints()-1,this.init(r.getCoordinate(v),r.getCoordinate(v-1)));
this.computeDirectedLabel()}return q&&(p.__proto__=q),p.prototype=Object.create(q&&q.prototype),p.prototype.constructor=p,p.prototype.getNextMin=function(){return this._nextMin},p.prototype.getDepth=function(r){return this._depth[r]},p.prototype.setVisited=function(r){this._isVisited=r},p.prototype.computeDirectedLabel=function(){this._label=new Jb(this._edge.getLabel());this._isForward||this._label.flip()},p.prototype.getNext=function(){return this._next},p.prototype.setDepth=function(r,v){if(-999!==
this._depth[r]&&this._depth[r]!==v)throw new we("assigned depths do not match",this.getCoordinate());this._depth[r]=v},p.prototype.isInteriorAreaEdge=function(){for(var r=!0,v=0;2>v;v++)this._label.isArea(v)&&this._label.getLocation(v,Aa.LEFT)===ua.INTERIOR&&this._label.getLocation(v,Aa.RIGHT)===ua.INTERIOR||(r=!1);return r},p.prototype.setNextMin=function(r){this._nextMin=r},p.prototype.print=function(r){q.prototype.print.call(this,r);r.print(" "+this._depth[Aa.LEFT]+"/"+this._depth[Aa.RIGHT]);r.print(" ("+
this.getDepthDelta()+")");this._isInResult&&r.print(" inResult")},p.prototype.setMinEdgeRing=function(r){this._minEdgeRing=r},p.prototype.isLineEdge=function(){var r=this._label.isLine(0)||this._label.isLine(1),v=!this._label.isArea(0)||this._label.allPositionsEqual(0,ua.EXTERIOR),A=!this._label.isArea(1)||this._label.allPositionsEqual(1,ua.EXTERIOR);return r&&v&&A},p.prototype.setEdgeRing=function(r){this._edgeRing=r},p.prototype.getMinEdgeRing=function(){return this._minEdgeRing},p.prototype.getDepthDelta=
function(){var r=this._edge.getDepthDelta();return this._isForward||(r=-r),r},p.prototype.setInResult=function(r){this._isInResult=r},p.prototype.getSym=function(){return this._sym},p.prototype.isForward=function(){return this._isForward},p.prototype.getEdge=function(){return this._edge},p.prototype.printEdge=function(r){this.print(r);r.print(" ");this._isForward?this._edge.print(r):this._edge.printReverse(r)},p.prototype.setSym=function(r){this._sym=r},p.prototype.setVisitedEdge=function(r){this.setVisited(r);
this._sym.setVisited(r)},p.prototype.setEdgeDepths=function(r,v){var A=this.getEdge().getDepthDelta();this._isForward||(A=-A);var u=1;r===Aa.LEFT&&(u=-1);var y=Aa.opposite(r);A=v+A*u;this.setDepth(r,v);this.setDepth(y,A)},p.prototype.getEdgeRing=function(){return this._edgeRing},p.prototype.isInResult=function(){return this._isInResult},p.prototype.setNext=function(r){this._next=r},p.prototype.isVisited=function(){return this._isVisited},p.prototype.interfaces_=function(){return[]},p.prototype.getClass=
function(){return p},p.depthFactor=function(r,v){return r===ua.EXTERIOR&&v===ua.INTERIOR?1:r===ua.INTERIOR&&v===ua.EXTERIOR?-1:0},p}(Bc),bg=function(){};bg.prototype.createNode=function(q){return new hi(q,null)};bg.prototype.interfaces_=function(){return[]};bg.prototype.getClass=function(){return bg};var Yb=function(){(this._edges=new Fa,this._nodes=null,this._edgeEndList=new Fa,0===arguments.length)?this._nodes=new Jd(new bg):1===arguments.length&&(this._nodes=new Jd(arguments[0]))};Yb.prototype.printEdges=
function(q){q.println("Edges:");for(var p=0;p<this._edges.size();p++){q.println("edge "+p+":");var r=this._edges.get(p);r.print(q);r.eiList.print(q)}};Yb.prototype.find=function(q){return this._nodes.find(q)};Yb.prototype.addNode=function(q){if(q instanceof hi||q instanceof sa)return this._nodes.addNode(q)};Yb.prototype.getNodeIterator=function(){return this._nodes.iterator()};Yb.prototype.linkResultDirectedEdges=function(){for(var q=this._nodes.iterator();q.hasNext();)q.next().getEdges().linkResultDirectedEdges()};
Yb.prototype.debugPrintln=function(q){Oc.out.println(q)};Yb.prototype.isBoundaryNode=function(q,p){p=this._nodes.find(p);if(null===p)return!1;p=p.getLabel();return null!==p&&p.getLocation(q)===ua.BOUNDARY};Yb.prototype.linkAllDirectedEdges=function(){for(var q=this._nodes.iterator();q.hasNext();)q.next().getEdges().linkAllDirectedEdges()};Yb.prototype.matchInSameDirection=function(q,p,r,v){return!!q.equals(r)&&Da.computeOrientation(q,p,v)===Da.COLLINEAR&&Mb.quadrant(q,p)===Mb.quadrant(r,v)};Yb.prototype.getEdgeEnds=
function(){return this._edgeEndList};Yb.prototype.debugPrint=function(q){Oc.out.print(q)};Yb.prototype.getEdgeIterator=function(){return this._edges.iterator()};Yb.prototype.findEdgeInSameDirection=function(q,p){for(var r=0;r<this._edges.size();r++){var v=this._edges.get(r),A=v.getCoordinates();if(this.matchInSameDirection(q,p,A[0],A[1])||this.matchInSameDirection(q,p,A[A.length-1],A[A.length-2]))return v}return null};Yb.prototype.insertEdge=function(q){this._edges.add(q)};Yb.prototype.findEdgeEnd=
function(q){for(var p=this.getEdgeEnds().iterator();p.hasNext();){var r=p.next();if(r.getEdge()===q)return r}return null};Yb.prototype.addEdges=function(q){for(q=q.iterator();q.hasNext();){var p=q.next();this._edges.add(p);var r=new Mj(p,!0);p=new Mj(p,!1);r.setSym(p);p.setSym(r);this.add(r);this.add(p)}};Yb.prototype.add=function(q){this._nodes.add(q);this._edgeEndList.add(q)};Yb.prototype.getNodes=function(){return this._nodes.values()};Yb.prototype.findEdge=function(q,p){for(var r=0;r<this._edges.size();r++){var v=
this._edges.get(r),A=v.getCoordinates();if(q.equals(A[0])&&p.equals(A[1]))return v}return null};Yb.prototype.interfaces_=function(){return[]};Yb.prototype.getClass=function(){return Yb};Yb.linkResultDirectedEdges=function(q){for(q=q.iterator();q.hasNext();)q.next().getEdges().linkResultDirectedEdges()};var Yc=function(q){this._geometryFactory=null;this._shellList=new Fa;this._geometryFactory=q};Yc.prototype.sortShellsAndHoles=function(q,p,r){for(q=q.iterator();q.hasNext();){var v=q.next();v.isHole()?
r.add(v):p.add(v)}};Yc.prototype.computePolygons=function(q){var p=new Fa;for(q=q.iterator();q.hasNext();){var r=q.next().toPolygon(this._geometryFactory);p.add(r)}return p};Yc.prototype.placeFreeHoles=function(q,p){for(p=p.iterator();p.hasNext();){var r=p.next();if(null===r.getShell()){var v=this.findEdgeRingContaining(r,q);if(null===v)throw new we("unable to assign hole to a shell",r.getCoordinate(0));r.setShell(v)}}};Yc.prototype.buildMinimalEdgeRings=function(q,p,r){var v=new Fa;for(q=q.iterator();q.hasNext();){var A=
q.next();if(2<A.getMaxNodeDegree()){A.linkDirectedEdgesForMinimalEdgeRings();A=A.buildMinimalRings();var u=this.findShell(A);null!==u?(this.placePolygonHoles(u,A),p.add(u)):r.addAll(A)}else v.add(A)}return v};Yc.prototype.containsPoint=function(q){for(var p=this._shellList.iterator();p.hasNext();)if(p.next().containsPoint(q))return!0;return!1};Yc.prototype.buildMaximalEdgeRings=function(q){var p=new Fa;for(q=q.iterator();q.hasNext();){var r=q.next();r.isInResult()&&r.getLabel().isArea()&&null===r.getEdgeRing()&&
(r=new Cp(r,this._geometryFactory),p.add(r),r.setInResult())}return p};Yc.prototype.placePolygonHoles=function(q,p){for(p=p.iterator();p.hasNext();){var r=p.next();r.isHole()&&r.setShell(q)}};Yc.prototype.getPolygons=function(){return this.computePolygons(this._shellList)};Yc.prototype.findEdgeRingContaining=function(q,p){var r=q.getLinearRing();q=r.getEnvelopeInternal();r=r.getCoordinateN(0);var v=null,A=null;for(p=p.iterator();p.hasNext();){var u=p.next(),y=u.getLinearRing(),C=y.getEnvelopeInternal();
null!==v&&(A=v.getLinearRing().getEnvelopeInternal());var w=!1;C.contains(q)&&Da.isPointInRing(r,y.getCoordinates())&&(w=!0);w&&(null===v||A.contains(C))&&(v=u)}return v};Yc.prototype.findShell=function(q){var p=0,r=null;for(q=q.iterator();q.hasNext();){var v=q.next();v.isHole()||(r=v,p++)}return Xa.isTrue(1>=p,"found two shells in MinimalEdgeRing list"),r};Yc.prototype.add=function(){if(1===arguments.length){var q=arguments[0];this.add(q.getEdgeEnds(),q.getNodes())}else if(2===arguments.length){q=
arguments[0];Yb.linkResultDirectedEdges(arguments[1]);var p=this.buildMaximalEdgeRings(q);q=new Fa;p=this.buildMinimalEdgeRings(p,this._shellList,q);this.sortShellsAndHoles(p,this._shellList,q);this.placeFreeHoles(this._shellList,q)}};Yc.prototype.interfaces_=function(){return[]};Yc.prototype.getClass=function(){return Yc};var cg=function(){};cg.prototype.getBounds=function(){};cg.prototype.interfaces_=function(){return[]};cg.prototype.getClass=function(){return cg};var vd=function(q,p){this._bounds=
q;this._item=p};vd.prototype.getItem=function(){return this._item};vd.prototype.getBounds=function(){return this._bounds};vd.prototype.interfaces_=function(){return[cg,id]};vd.prototype.getClass=function(){return vd};var xe=function(){this._items=null;this._size=0;this._items=new Fa;this._items.add(null)};xe.prototype.poll=function(){if(this.isEmpty())return null;var q=this._items.get(1);return this._items.set(1,this._items.get(this._size)),--this._size,this.reorder(1),q};xe.prototype.size=function(){return this._size};
xe.prototype.reorder=function(q){for(var p=null,r=this._items.get(q);2*q<=this._size&&((p=2*q)!==this._size&&0>this._items.get(p+1).compareTo(this._items.get(p))&&p++,0>this._items.get(p).compareTo(r));q=p)this._items.set(q,this._items.get(p));this._items.set(q,r)};xe.prototype.clear=function(){this._size=0;this._items.clear()};xe.prototype.isEmpty=function(){return 0===this._size};xe.prototype.add=function(q){this._items.add(null);var p=this._size+=1;for(this._items.set(0,q);0>q.compareTo(this._items.get(Math.trunc(p/
2)));p/=2)this._items.set(p,this._items.get(Math.trunc(p/2)));this._items.set(p,q)};xe.prototype.interfaces_=function(){return[]};xe.prototype.getClass=function(){return xe};var Ge=function(){};Ge.prototype.visitItem=function(q){};Ge.prototype.interfaces_=function(){return[]};Ge.prototype.getClass=function(){return Ge};var tf=function(){};tf.prototype.insert=function(q,p){};tf.prototype.remove=function(q,p){};tf.prototype.query=function(){};tf.prototype.interfaces_=function(){return[]};tf.prototype.getClass=
function(){return tf};var oc=function(){(this._childBoundables=new Fa,this._bounds=null,this._level=null,0!==arguments.length)&&1===arguments.length&&(this._level=arguments[0])},nn={serialVersionUID:{configurable:!0}};oc.prototype.getLevel=function(){return this._level};oc.prototype.size=function(){return this._childBoundables.size()};oc.prototype.getChildBoundables=function(){return this._childBoundables};oc.prototype.addChildBoundable=function(q){Xa.isTrue(null===this._bounds);this._childBoundables.add(q)};
oc.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};oc.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds};oc.prototype.interfaces_=function(){return[cg,id]};oc.prototype.getClass=function(){return oc};nn.serialVersionUID.get=function(){return 0x5a1e55ec41369800};Object.defineProperties(oc,nn);var Kd=function(){};Kd.reverseOrder=function(){return{compare:function(q,p){return p.compareTo(q)}}};Kd.min=function(q){return Kd.sort(q),
q.get(0)};Kd.sort=function(q,p){var r=q.toArray();p?Ue.sort(r,p):Ue.sort(r);q=q.iterator();p=0;for(var v=r.length;p<v;p++)q.next(),q.set(r[p])};Kd.singletonList=function(q){var p=new Fa;return p.add(q),p};var jc=function(q,p,r){this._distance=null;this._boundable1=q;this._boundable2=p;this._itemDistance=r;this._distance=this.distance()};jc.prototype.expandToQueue=function(q,p){var r=jc.isComposite(this._boundable1),v=jc.isComposite(this._boundable2);if(r&&v)return jc.area(this._boundable1)>jc.area(this._boundable2)?
(this.expand(this._boundable1,this._boundable2,q,p),null):(this.expand(this._boundable2,this._boundable1,q,p),null);if(r)return this.expand(this._boundable1,this._boundable2,q,p),null;if(v)return this.expand(this._boundable2,this._boundable1,q,p),null;throw new ac("neither boundable is composite");};jc.prototype.isLeaves=function(){return!(jc.isComposite(this._boundable1)||jc.isComposite(this._boundable2))};jc.prototype.compareTo=function(q){return this._distance<q._distance?-1:this._distance>q._distance?
1:0};jc.prototype.expand=function(q,p,r,v){for(q=q.getChildBoundables().iterator();q.hasNext();){var A=q.next();A=new jc(A,p,this._itemDistance);A.getDistance()<v&&r.add(A)}};jc.prototype.getBoundable=function(q){return 0===q?this._boundable1:this._boundable2};jc.prototype.getDistance=function(){return this._distance};jc.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};
jc.prototype.interfaces_=function(){return[jd]};jc.prototype.getClass=function(){return jc};jc.area=function(q){return q.getBounds().getArea()};jc.isComposite=function(q){return q instanceof oc};var rc=function p(){if(this._root=null,this._built=!1,this._itemBoundables=new Fa,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=p.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var r=arguments[0];Xa.isTrue(1<r,"Node capacity must be greater than 1");this._nodeCapacity=r}},ii={IntersectsOp:{configurable:!0},
serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};rc.prototype.getNodeCapacity=function(){return this._nodeCapacity};rc.prototype.lastNode=function(p){return p.get(p.size()-1)};rc.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var p=0,r=arguments[0].getChildBoundables().iterator();r.hasNext();){var v=r.next();v instanceof oc?p+=this.size(v):v instanceof vd&&(p+=1)}return p}};rc.prototype.removeItem=
function(p,r){for(var v=null,A=p.getChildBoundables().iterator();A.hasNext();){var u=A.next();u instanceof vd&&u.getItem()===r&&(v=u)}return null!==v&&(p.getChildBoundables().remove(v),!0)};rc.prototype.itemsTree=function(){if(0===arguments.length){this.build();var p=this.itemsTree(this._root);return null===p?new Fa:p}if(1===arguments.length){var r=arguments[0];p=new Fa;for(r=r.getChildBoundables().iterator();r.hasNext();){var v=r.next();v instanceof oc?(v=this.itemsTree(v),null!==v&&p.add(v)):v instanceof
vd?p.add(v.getItem()):Xa.shouldNeverReachHere()}return 0>=p.size()?null:p}};rc.prototype.insert=function(p,r){Xa.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built.");this._itemBoundables.add(new vd(p,r))};rc.prototype.boundablesAtLevel=function(){if(1===arguments.length){var p=arguments[0],r=new Fa;return this.boundablesAtLevel(p,this._root,r),r}if(3===arguments.length){p=arguments[0];var v=arguments[1];r=arguments[2];if(Xa.isTrue(-2<p),v.getLevel()===p)return r.add(v),
null;for(v=v.getChildBoundables().iterator();v.hasNext();){var A=v.next();A instanceof oc?this.boundablesAtLevel(p,A,r):(Xa.isTrue(A instanceof vd),-1===p&&r.add(A))}return null}};rc.prototype.query=function(){if(1===arguments.length){var p=arguments[0];this.build();var r=new Fa;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.query(p,this._root,r),r}if(2===arguments.length){p=arguments[0];r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),
p)&&this.query(p,this._root,r)}else if(3===arguments.length)if(Va(arguments[2],Ge)&&arguments[0]instanceof Object&&arguments[1]instanceof oc){p=arguments[0];r=arguments[2];for(var v=arguments[1].getChildBoundables(),A=0;A<v.size();A++){var u=v.get(A);this.getIntersectsOp().intersects(u.getBounds(),p)&&(u instanceof oc?this.query(p,u,r):u instanceof vd?r.visitItem(u.getItem()):Xa.shouldNeverReachHere())}}else if(Va(arguments[2],ue)&&arguments[0]instanceof Object&&arguments[1]instanceof oc)for(p=arguments[0],
r=arguments[2],v=arguments[1].getChildBoundables(),A=0;A<v.size();A++)u=v.get(A),this.getIntersectsOp().intersects(u.getBounds(),p)&&(u instanceof oc?this.query(p,u,r):u instanceof vd?r.add(u.getItem()):Xa.shouldNeverReachHere())};rc.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1);this._itemBoundables=null;this._built=!0};rc.prototype.getRoot=function(){return this.build(),this._root};
rc.prototype.remove=function(){if(2===arguments.length){var p=arguments[0],r=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),p)&&this.remove(p,this._root,r)}if(3===arguments.length){p=arguments[0];r=arguments[1];var v=arguments[2],A=this.removeItem(r,v);if(A)return!0;for(var u=null,y=r.getChildBoundables().iterator();y.hasNext();){var C=y.next();if(this.getIntersectsOp().intersects(C.getBounds(),p)&&C instanceof oc&&(A=this.remove(p,C,v))){u=C;break}}return null!==
u&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),A}};rc.prototype.createHigherLevels=function(p,r){Xa.isTrue(!p.isEmpty());p=this.createParentBoundables(p,r+1);return 1===p.size()?p.get(0):this.createHigherLevels(p,r+1)};rc.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var p=0,r=arguments[0].getChildBoundables().iterator();r.hasNext();){var v=r.next();v instanceof oc&&(v=this.depth(v),
v>p&&(p=v))}return p+1}};rc.prototype.createParentBoundables=function(p,r){Xa.isTrue(!p.isEmpty());var v=new Fa;v.add(this.createNode(r));p=new Fa(p);Kd.sort(p,this.getComparator());for(p=p.iterator();p.hasNext();){var A=p.next();this.lastNode(v).getChildBoundables().size()===this.getNodeCapacity()&&v.add(this.createNode(r));this.lastNode(v).addChildBoundable(A)}return v};rc.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};rc.prototype.interfaces_=
function(){return[id]};rc.prototype.getClass=function(){return rc};rc.compareDoubles=function(p,r){return p>r?1:p<r?-1:0};ii.IntersectsOp.get=function(){return Dp};ii.serialVersionUID.get=function(){return-0x35ef64c82d4c5400};ii.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(rc,ii);var Dp=function(){},dg=function(){};dg.prototype.distance=function(p,r){};dg.prototype.interfaces_=function(){return[]};dg.prototype.getClass=function(){return dg};var Ep=function(p){function r(A){A=
A||r.DEFAULT_NODE_CAPACITY;p.call(this,A)}p&&(r.__proto__=p);r.prototype=Object.create(p&&p.prototype);r.prototype.constructor=r;var v={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return r.prototype.createParentBoundablesFromVerticalSlices=function(A,u){Xa.isTrue(0<A.length);for(var y=new Fa,C=0;C<A.length;C++)y.addAll(this.createParentBoundablesFromVerticalSlice(A[C],
u));return y},r.prototype.createNode=function(A){return new on(A)},r.prototype.size=function(){return 0===arguments.length?p.prototype.size.call(this):p.prototype.size.apply(this,arguments)},r.prototype.insert=function(){if(2!==arguments.length)return p.prototype.insert.apply(this,arguments);var A=arguments[0],u=arguments[1];if(A.isNull())return null;p.prototype.insert.call(this,A,u)},r.prototype.getIntersectsOp=function(){return r.intersectsOp},r.prototype.verticalSlices=function(A,u){var y=Math.trunc(Math.ceil(A.size()/
u)),C=Array(u).fill(null);A=A.iterator();for(var w=0;w<u;w++){C[w]=new Fa;for(var x=0;A.hasNext()&&x<y;){var B=A.next();C[w].add(B);x++}}return C},r.prototype.query=function(){if(1===arguments.length)return p.prototype.query.call(this,arguments[0]);2===arguments.length?p.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(Va(arguments[2],Ge)&&arguments[0]instanceof Object&&arguments[1]instanceof oc?p.prototype.query.call(this,arguments[0],arguments[1],arguments[2]):Va(arguments[2],
ue)&&arguments[0]instanceof Object&&arguments[1]instanceof oc&&p.prototype.query.call(this,arguments[0],arguments[1],arguments[2]))},r.prototype.getComparator=function(){return r.yComparator},r.prototype.createParentBoundablesFromVerticalSlice=function(A,u){return p.prototype.createParentBoundables.call(this,A,u)},r.prototype.remove=function(){return 2===arguments.length?p.prototype.remove.call(this,arguments[0],arguments[1]):p.prototype.remove.apply(this,arguments)},r.prototype.depth=function(){return 0===
arguments.length?p.prototype.depth.call(this):p.prototype.depth.apply(this,arguments)},r.prototype.createParentBoundables=function(A,u){Xa.isTrue(!A.isEmpty());var y=Math.trunc(Math.ceil(A.size()/this.getNodeCapacity()));A=new Fa(A);Kd.sort(A,r.xComparator);y=this.verticalSlices(A,Math.trunc(Math.ceil(Math.sqrt(y))));return this.createParentBoundablesFromVerticalSlices(y,u)},r.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Va(arguments[0],dg)){var A=arguments[0];A=new jc(this.getRoot(),
this.getRoot(),A);return this.nearestNeighbour(A)}if(arguments[0]instanceof jc)return this.nearestNeighbour(arguments[0],Wa.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof r&&Va(arguments[1],dg)){A=arguments[0];var u=arguments[1];A=new jc(this.getRoot(),A.getRoot(),u);return this.nearestNeighbour(A)}if(arguments[0]instanceof jc&&"number"==typeof arguments[1]){var y=arguments[0];A=arguments[1];u=null;var C=new xe;for(C.add(y);!C.isEmpty()&&0<A;){y=C.poll();var w=y.getDistance();
if(w>=A)break;y.isLeaves()?(A=w,u=y):y.expandToQueue(C,A)}return[u.getBoundable(0).getItem(),u.getBoundable(1).getItem()]}}else if(3===arguments.length)return A=arguments[2],u=new vd(arguments[0],arguments[1]),A=new jc(this.getRoot(),u,A),this.nearestNeighbour(A)[0]},r.prototype.interfaces_=function(){return[tf,id]},r.prototype.getClass=function(){return r},r.centreX=function(A){return r.avg(A.getMinX(),A.getMaxX())},r.avg=function(A,u){return(A+u)/2},r.centreY=function(A){return r.avg(A.getMinY(),
A.getMaxY())},v.STRtreeNode.get=function(){return on},v.serialVersionUID.get=function(){return 0x39920f7d5f261e0},v.xComparator.get=function(){return{interfaces_:function(){return[Rf]},compare:function(A,u){return p.compareDoubles(r.centreX(A.getBounds()),r.centreX(u.getBounds()))}}},v.yComparator.get=function(){return{interfaces_:function(){return[Rf]},compare:function(A,u){return p.compareDoubles(r.centreY(A.getBounds()),r.centreY(u.getBounds()))}}},v.intersectsOp.get=function(){return{interfaces_:function(){return[p.IntersectsOp]},
intersects:function(A,u){return A.intersects(u)}}},v.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(r,v),r}(rc),on=function(p){function r(v){p.call(this,v)}return p&&(r.__proto__=p),r.prototype=Object.create(p&&p.prototype),r.prototype.constructor=r,r.prototype.computeBounds=function(){for(var v=null,A=this.getChildBoundables().iterator();A.hasNext();){var u=A.next();null===v?v=new Ia(u.getBounds()):v.expandToInclude(u.getBounds())}return v},r.prototype.interfaces_=function(){return[]},
r.prototype.getClass=function(){return r},r}(oc),Pc=function(){};Pc.prototype.interfaces_=function(){return[]};Pc.prototype.getClass=function(){return Pc};Pc.relativeSign=function(p,r){return p<r?-1:p>r?1:0};Pc.compare=function(p,r,v){if(r.equals2D(v))return 0;var A=Pc.relativeSign(r.x,v.x);r=Pc.relativeSign(r.y,v.y);switch(p){case 0:return Pc.compareValue(A,r);case 1:return Pc.compareValue(r,A);case 2:return Pc.compareValue(r,-A);case 3:return Pc.compareValue(-A,r);case 4:return Pc.compareValue(-A,
-r);case 5:return Pc.compareValue(-r,-A);case 6:return Pc.compareValue(-r,A);case 7:return Pc.compareValue(A,-r)}return Xa.shouldNeverReachHere("invalid octant value"),0};Pc.compareValue=function(p,r){return 0>p?-1:0<p?1:0>r?-1:0<r?1:0};var He=function(p,r,v,A){this._isInterior=this._segmentOctant=this.segmentIndex=this.coord=null;this._segString=p;this.coord=new sa(r);this.segmentIndex=v;this._segmentOctant=A;this._isInterior=!r.equals2D(p.getCoordinate(v))};He.prototype.getCoordinate=function(){return this.coord};
He.prototype.print=function(p){p.print(this.coord);p.print(" seg # = "+this.segmentIndex)};He.prototype.compareTo=function(p){return this.segmentIndex<p.segmentIndex?-1:this.segmentIndex>p.segmentIndex?1:this.coord.equals2D(p.coord)?0:Pc.compare(this._segmentOctant,this.coord,p.coord)};He.prototype.isEndPoint=function(p){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===p};He.prototype.isInterior=function(){return this._isInterior};He.prototype.interfaces_=function(){return[jd]};
He.prototype.getClass=function(){return He};var Jc=function(p){this._nodeMap=new Ac;this._edge=p};Jc.prototype.getSplitCoordinates=function(){var p=new Tg;this.addEndpoints();for(var r=this.iterator(),v=r.next();r.hasNext();){var A=r.next();this.addEdgeCoordinates(v,A,p);v=A}return p.toCoordinateArray()};Jc.prototype.addCollapsedNodes=function(){var p=new Fa;this.findCollapsesFromInsertedNodes(p);this.findCollapsesFromExistingVertices(p);for(p=p.iterator();p.hasNext();){var r=p.next().intValue();
this.add(this._edge.getCoordinate(r),r)}};Jc.prototype.print=function(p){p.println("Intersections:");for(var r=this.iterator();r.hasNext();)r.next().print(p)};Jc.prototype.findCollapsesFromExistingVertices=function(p){for(var r=0;r<this._edge.size()-2;r++){var v=this._edge.getCoordinate(r),A=this._edge.getCoordinate(r+2);v.equals2D(A)&&p.add(new Dd(r+1))}};Jc.prototype.addEdgeCoordinates=function(p,r,v){var A=this._edge.getCoordinate(r.segmentIndex);A=r.isInterior()||!r.coord.equals2D(A);v.add(new sa(p.coord),
!1);for(p=p.segmentIndex+1;p<=r.segmentIndex;p++)v.add(this._edge.getCoordinate(p));A&&v.add(new sa(r.coord))};Jc.prototype.iterator=function(){return this._nodeMap.values().iterator()};Jc.prototype.addSplitEdges=function(p){this.addEndpoints();this.addCollapsedNodes();for(var r=this.iterator(),v=r.next();r.hasNext();){var A=r.next();v=this.createSplitEdge(v,A);p.add(v);v=A}};Jc.prototype.findCollapseIndex=function(p,r,v){if(!p.coord.equals2D(r.coord))return!1;var A=r.segmentIndex-p.segmentIndex;
return r.isInterior()||A--,1===A&&(v[0]=p.segmentIndex+1,!0)};Jc.prototype.findCollapsesFromInsertedNodes=function(p){for(var r=Array(1).fill(null),v=this.iterator(),A=v.next();v.hasNext();){var u=v.next();this.findCollapseIndex(A,u,r)&&p.add(new Dd(r[0]));A=u}};Jc.prototype.getEdge=function(){return this._edge};Jc.prototype.addEndpoints=function(){var p=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0);this.add(this._edge.getCoordinate(p),p)};Jc.prototype.createSplitEdge=function(p,r){var v=
r.segmentIndex-p.segmentIndex+2,A=this._edge.getCoordinate(r.segmentIndex);(A=r.isInterior()||!r.coord.equals2D(A))||v--;v=Array(v).fill(null);var u=0;v[u++]=new sa(p.coord);for(p=p.segmentIndex+1;p<=r.segmentIndex;p++)v[u++]=this._edge.getCoordinate(p);return A&&(v[u]=new sa(r.coord)),new ec(v,this._edge.getData())};Jc.prototype.add=function(p,r){r=new He(this._edge,p,r,this._edge.getSegmentOctant(r));var v=this._nodeMap.get(r);return null!==v?(Xa.isTrue(v.coord.equals2D(p),"Found equal nodes with different coordinates"),
v):(this._nodeMap.put(r,r),r)};Jc.prototype.checkSplitEdgesCorrectness=function(p){var r=this._edge.getCoordinates(),v=p.get(0).getCoordinate(0);if(!v.equals2D(r[0]))throw new re("bad split edge start point at "+v);p=p.get(p.size()-1).getCoordinates();p=p[p.length-1];if(!p.equals2D(r[r.length-1]))throw new re("bad split edge end point at "+p);};Jc.prototype.interfaces_=function(){return[]};Jc.prototype.getClass=function(){return Jc};var uf=function(){};uf.prototype.interfaces_=function(){return[]};
uf.prototype.getClass=function(){return uf};uf.octant=function(p,r){if("number"==typeof p&&"number"==typeof r){if(0===p&&0===r)throw new ac("Cannot compute the octant for point ( "+p+", "+r+" )");var v=Math.abs(p),A=Math.abs(r);return 0<=p?0<=r?v>=A?0:1:v>=A?7:6:0<=r?v>=A?3:2:v>=A?4:5}if(p instanceof sa&&r instanceof sa){v=r.x-p.x;r=r.y-p.y;if(0===v&&0===r)throw new ac("Cannot compute the octant for two identical points "+p);return uf.octant(v,r)}};var $d=function(){};$d.prototype.getCoordinates=
function(){};$d.prototype.size=function(){};$d.prototype.getCoordinate=function(p){};$d.prototype.isClosed=function(){};$d.prototype.setData=function(p){};$d.prototype.getData=function(){};$d.prototype.interfaces_=function(){return[]};$d.prototype.getClass=function(){return $d};var ah=function(){};ah.prototype.addIntersection=function(p,r){};ah.prototype.interfaces_=function(){return[$d]};ah.prototype.getClass=function(){return ah};var ec=function(p,r){this._nodeList=new Jc(this);this._pts=p;this._data=
r};ec.prototype.getCoordinates=function(){return this._pts};ec.prototype.size=function(){return this._pts.length};ec.prototype.getCoordinate=function(p){return this._pts[p]};ec.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ec.prototype.getSegmentOctant=function(p){return p===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(p),this.getCoordinate(p+1))};ec.prototype.setData=function(p){this._data=p};ec.prototype.safeOctant=function(p,r){return p.equals2D(r)?
0:uf.octant(p,r)};ec.prototype.getData=function(){return this._data};ec.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var p=arguments[1],r=new sa(arguments[0].getIntersection(arguments[3]));this.addIntersection(r,p)}};ec.prototype.toString=function(){return qe.toLineString(new hc(this._pts))};ec.prototype.getNodeList=function(){return this._nodeList};ec.prototype.addIntersectionNode=function(p,r){var v=
r+1;v<this._pts.length&&p.equals2D(this._pts[v])&&(r=v);return this._nodeList.add(p,r)};ec.prototype.addIntersections=function(p,r,v){for(var A=0;A<p.getIntersectionNum();A++)this.addIntersection(p,r,v,A)};ec.prototype.interfaces_=function(){return[ah]};ec.prototype.getClass=function(){return ec};ec.getNodedSubstrings=function(){if(1===arguments.length){var p=arguments[0],r=new Fa;return ec.getNodedSubstrings(p,r),r}if(2===arguments.length)for(p=arguments[1],r=arguments[0].iterator();r.hasNext();)r.next().getNodeList().addSplitEdges(p)};
var Na=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new sa,this.p1=new sa;else if(1===arguments.length){var p=arguments[0];this.p0=new sa(p.p0);this.p1=new sa(p.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){p=arguments[2];var r=arguments[3];this.p0=new sa(arguments[0],arguments[1]);this.p1=new sa(p,r)}},pn={serialVersionUID:{configurable:!0}};Na.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Na.prototype.orientationIndex=
function(p){if(p instanceof Na){var r=Da.orientationIndex(this.p0,this.p1,p.p0);p=Da.orientationIndex(this.p0,this.p1,p.p1);return 0<=r&&0<=p||0>=r&&0>=p?Math.max(r,p):0}if(p instanceof sa)return Da.orientationIndex(this.p0,this.p1,p)};Na.prototype.toGeometry=function(p){return p.createLineString([this.p0,this.p1])};Na.prototype.isVertical=function(){return this.p0.x===this.p1.x};Na.prototype.equals=function(p){return p instanceof Na?this.p0.equals(p.p0)&&this.p1.equals(p.p1):!1};Na.prototype.intersection=
function(p){var r=new Te;return r.computeIntersection(this.p0,this.p1,p.p0,p.p1),r.hasIntersection()?r.getIntersection(0):null};Na.prototype.project=function(p){if(p instanceof sa){if(p.equals(this.p0)||p.equals(this.p1))return new sa(p);var r=this.projectionFactor(p),v=new sa;return v.x=this.p0.x+r*(this.p1.x-this.p0.x),v.y=this.p0.y+r*(this.p1.y-this.p0.y),v}if(p instanceof Na){var A=this.projectionFactor(p.p0);r=this.projectionFactor(p.p1);if(1<=A&&1<=r||0>=A&&0>=r)return null;v=this.project(p.p0);
0>A&&(v=this.p0);1<A&&(v=this.p1);p=this.project(p.p1);return 0>r&&(p=this.p0),1<r&&(p=this.p1),new Na(v,p)}};Na.prototype.normalize=function(){0>this.p1.compareTo(this.p0)&&this.reverse()};Na.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Na.prototype.getCoordinate=function(p){return 0===p?this.p0:this.p1};Na.prototype.distancePerpendicular=function(p){return Da.distancePointLinePerpendicular(p,this.p0,this.p1)};Na.prototype.minY=function(){return Math.min(this.p0.y,
this.p1.y)};Na.prototype.midPoint=function(){return Na.midPoint(this.p0,this.p1)};Na.prototype.projectionFactor=function(p){if(p.equals(this.p0))return 0;if(p.equals(this.p1))return 1;var r=this.p1.x-this.p0.x,v=this.p1.y-this.p0.y,A=r*r+v*v;return 0>=A?Wa.NaN:((p.x-this.p0.x)*r+(p.y-this.p0.y)*v)/A};Na.prototype.closestPoints=function(p){var r=this.intersection(p);if(null!==r)return[r,r];r=Array(2).fill(null);var v=null,A=this.closestPoint(p.p0);var u=A.distance(p.p0);r[0]=A;r[1]=p.p0;A=this.closestPoint(p.p1);
(v=A.distance(p.p1))<u&&(u=v,r[0]=A,r[1]=p.p1);A=p.closestPoint(this.p0);(v=A.distance(this.p0))<u&&(u=v,r[0]=this.p0,r[1]=A);p=p.closestPoint(this.p1);return p.distance(this.p1)<u&&(r[0]=this.p1,r[1]=p),r};Na.prototype.closestPoint=function(p){var r=this.projectionFactor(p);return 0<r&&1>r?this.project(p):this.p0.distance(p)<this.p1.distance(p)?this.p0:this.p1};Na.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Na.prototype.getLength=function(){return this.p0.distance(this.p1)};Na.prototype.compareTo=
function(p){var r=this.p0.compareTo(p.p0);return 0!==r?r:this.p1.compareTo(p.p1)};Na.prototype.reverse=function(){var p=this.p0;this.p0=this.p1;this.p1=p};Na.prototype.equalsTopo=function(p){return this.p0.equals(p.p0)&&(this.p1.equals(p.p1)||this.p0.equals(p.p1))&&this.p1.equals(p.p0)};Na.prototype.lineIntersection=function(p){try{return sd.intersection(this.p0,this.p1,p.p0,p.p1)}catch(r){if(!(r instanceof Tf))throw r;}return null};Na.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};
Na.prototype.pointAlongOffset=function(p,r){var v=this.p0.x+p*(this.p1.x-this.p0.x);p=this.p0.y+p*(this.p1.y-this.p0.y);var A=this.p1.x-this.p0.x,u=this.p1.y-this.p0.y,y=Math.sqrt(A*A+u*u),C=0,w=0;if(0!==r){if(0>=y)throw Error("Cannot compute offset from zero-length line segment");C=r*A/y;w=r*u/y}return new sa(v-w,p+C)};Na.prototype.setCoordinates=function(){if(1===arguments.length){var p=arguments[0];this.setCoordinates(p.p0,p.p1)}else if(2===arguments.length){p=arguments[0];var r=arguments[1];this.p0.x=
p.x;this.p0.y=p.y;this.p1.x=r.x;this.p1.y=r.y}};Na.prototype.segmentFraction=function(p){p=this.projectionFactor(p);return 0>p?p=0:(1<p||Wa.isNaN(p))&&(p=1),p};Na.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Na.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Na.prototype.distance=function(p){if(p instanceof Na)return Da.distanceLineLine(this.p0,this.p1,p.p0,p.p1);if(p instanceof sa)return Da.distancePointLine(p,this.p0,
this.p1)};Na.prototype.pointAlong=function(p){var r=new sa;return r.x=this.p0.x+p*(this.p1.x-this.p0.x),r.y=this.p0.y+p*(this.p1.y-this.p0.y),r};Na.prototype.hashCode=function(){var p=Wa.doubleToLongBits(this.p0.x);p^=31*Wa.doubleToLongBits(this.p0.y);p=Math.trunc(p)^Math.trunc(p>>32);var r=Wa.doubleToLongBits(this.p1.x);return r^=31*Wa.doubleToLongBits(this.p1.y),p^Math.trunc(r)^Math.trunc(r>>32)};Na.prototype.interfaces_=function(){return[jd,id]};Na.prototype.getClass=function(){return Na};Na.midPoint=
function(p,r){return new sa((p.x+r.x)/2,(p.y+r.y)/2)};pn.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Na,pn);var bh=function(){this.tempEnv1=new Ia;this.tempEnv2=new Ia;this._overlapSeg1=new Na;this._overlapSeg2=new Na};bh.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var p=arguments[2],r=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1);p.getLineSegment(r,this._overlapSeg2);this.overlap(this._overlapSeg1,this._overlapSeg2)}};
bh.prototype.interfaces_=function(){return[]};bh.prototype.getClass=function(){return bh};var Zc=function(p,r,v,A){this._id=this._env=null;this._pts=p;this._start=r;this._end=v;this._context=A};Zc.prototype.getLineSegment=function(p,r){r.p0=this._pts[p];r.p1=this._pts[p+1]};Zc.prototype.computeSelect=function(p,r,v,A){if(A.tempEnv1.init(this._pts[r],this._pts[v]),1==v-r)return A.select(this,r),null;if(!p.intersects(A.tempEnv1))return null;var u=Math.trunc((r+v)/2);r<u&&this.computeSelect(p,r,u,A);
u<v&&this.computeSelect(p,u,v,A)};Zc.prototype.getCoordinates=function(){for(var p=Array(this._end-this._start+1).fill(null),r=0,v=this._start;v<=this._end;v++)p[r++]=this._pts[v];return p};Zc.prototype.computeOverlaps=function(p,r){this.computeOverlapsInternal(this._start,this._end,p,p._start,p._end,r)};Zc.prototype.setId=function(p){this._id=p};Zc.prototype.select=function(p,r){this.computeSelect(p,this._start,this._end,r)};Zc.prototype.getEnvelope=function(){null===this._env&&(this._env=new Ia(this._pts[this._start],
this._pts[this._end]));return this._env};Zc.prototype.getEndIndex=function(){return this._end};Zc.prototype.getStartIndex=function(){return this._start};Zc.prototype.getContext=function(){return this._context};Zc.prototype.getId=function(){return this._id};Zc.prototype.computeOverlapsInternal=function(p,r,v,A,u,y){var C=this._pts[p],w=this._pts[r],x=v._pts[A],B=v._pts[u];if(1==r-p&&1==u-A)return y.overlap(this,p,v,A),null;if(y.tempEnv1.init(C,w),y.tempEnv2.init(x,B),!y.tempEnv1.intersects(y.tempEnv2))return null;
C=Math.trunc((p+r)/2);w=Math.trunc((A+u)/2);p<C&&(A<w&&this.computeOverlapsInternal(p,C,v,A,w,y),w<u&&this.computeOverlapsInternal(p,C,v,w,u,y));C<r&&(A<w&&this.computeOverlapsInternal(C,r,v,A,w,y),w<u&&this.computeOverlapsInternal(C,r,v,w,u,y))};Zc.prototype.interfaces_=function(){return[]};Zc.prototype.getClass=function(){return Zc};var Ld=function(){};Ld.prototype.interfaces_=function(){return[]};Ld.prototype.getClass=function(){return Ld};Ld.getChainStartIndices=function(p){var r=0,v=new Fa;v.add(new Dd(r));
do r=Ld.findChainEnd(p,r),v.add(new Dd(r));while(r<p.length-1);return Ld.toIntArray(v)};Ld.findChainEnd=function(p,r){for(var v=r;v<p.length-1&&p[v].equals2D(p[v+1]);)v++;if(v>=p.length-1)return p.length-1;v=Mb.quadrant(p[v],p[v+1]);for(r+=1;r<p.length&&(p[r-1].equals2D(p[r])||Mb.quadrant(p[r-1],p[r])===v);)r++;return r-1};Ld.getChains=function(){if(1===arguments.length)return Ld.getChains(arguments[0],null);if(2===arguments.length){for(var p=arguments[0],r=arguments[1],v=new Fa,A=Ld.getChainStartIndices(p),
u=0;u<A.length-1;u++){var y=new Zc(p,A[u],A[u+1],r);v.add(y)}return v}};Ld.toIntArray=function(p){for(var r=Array(p.size()).fill(null),v=0;v<r.length;v++)r[v]=p.get(v).intValue();return r};var Ye=function(){};Ye.prototype.computeNodes=function(p){};Ye.prototype.getNodedSubstrings=function(){};Ye.prototype.interfaces_=function(){return[]};Ye.prototype.getClass=function(){return Ye};var ch=function(){(this._segInt=null,0!==arguments.length)&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};
ch.prototype.setSegmentIntersector=function(p){this._segInt=p};ch.prototype.interfaces_=function(){return[Ye]};ch.prototype.getClass=function(){return ch};var Nj=function(p){function r(A){A?p.call(this,A):p.call(this);this._monoChains=new Fa;this._index=new Ep;this._idCounter=0;this._nodedSegStrings=null;this._nOverlaps=0}p&&(r.__proto__=p);r.prototype=Object.create(p&&p.prototype);r.prototype.constructor=r;var v={SegmentOverlapAction:{configurable:!0}};return r.prototype.getMonotoneChains=function(){return this._monoChains},
r.prototype.getNodedSubstrings=function(){return ec.getNodedSubstrings(this._nodedSegStrings)},r.prototype.getIndex=function(){return this._index},r.prototype.add=function(A){for(A=Ld.getChains(A.getCoordinates(),A).iterator();A.hasNext();){var u=A.next();u.setId(this._idCounter++);this._index.insert(u.getEnvelope(),u);this._monoChains.add(u)}},r.prototype.computeNodes=function(A){this._nodedSegStrings=A;for(A=A.iterator();A.hasNext();)this.add(A.next());this.intersectChains()},r.prototype.intersectChains=
function(){for(var A=new qn(this._segInt),u=this._monoChains.iterator();u.hasNext();)for(var y=u.next(),C=this._index.query(y.getEnvelope()).iterator();C.hasNext();){var w=C.next();if(w.getId()>y.getId()&&(y.computeOverlaps(w,A),this._nOverlaps++),this._segInt.isDone())return null}},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},v.SegmentOverlapAction.get=function(){return qn},Object.defineProperties(r,v),r}(ch),qn=function(p){function r(v){p.call(this);this._si=
v}return p&&(r.__proto__=p),r.prototype=Object.create(p&&p.prototype),r.prototype.constructor=r,r.prototype.overlap=function(){if(4!==arguments.length)return p.prototype.overlap.apply(this,arguments);var v=arguments[1],A=arguments[2],u=arguments[3],y=arguments[0].getContext();A=A.getContext();this._si.processIntersections(y,v,A,u)},r.prototype.interfaces_=function(){return[]},r.prototype.getClass=function(){return r},r}(bh),Gb=function r(){if(this._quadrantSegments=r.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=
r.CAP_ROUND,this._joinStyle=r.JOIN_ROUND,this._mitreLimit=r.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=r.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var v=arguments[1];this.setQuadrantSegments(arguments[0]);this.setEndCapStyle(v)}else if(4===arguments.length){v=arguments[1];var A=arguments[2],u=arguments[3];this.setQuadrantSegments(arguments[0]);this.setEndCapStyle(v);this.setJoinStyle(A);
this.setMitreLimit(u)}},ye={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Gb.prototype.getEndCapStyle=function(){return this._endCapStyle};Gb.prototype.isSingleSided=function(){return this._isSingleSided};Gb.prototype.setQuadrantSegments=function(r){this._quadrantSegments=
r;0===this._quadrantSegments&&(this._joinStyle=Gb.JOIN_BEVEL);0>this._quadrantSegments&&(this._joinStyle=Gb.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments));0>=r&&(this._quadrantSegments=1);this._joinStyle!==Gb.JOIN_ROUND&&(this._quadrantSegments=Gb.DEFAULT_QUADRANT_SEGMENTS)};Gb.prototype.getJoinStyle=function(){return this._joinStyle};Gb.prototype.setJoinStyle=function(r){this._joinStyle=r};Gb.prototype.setSimplifyFactor=function(r){this._simplifyFactor=0>r?0:r};Gb.prototype.getSimplifyFactor=
function(){return this._simplifyFactor};Gb.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Gb.prototype.setEndCapStyle=function(r){this._endCapStyle=r};Gb.prototype.getMitreLimit=function(){return this._mitreLimit};Gb.prototype.setMitreLimit=function(r){this._mitreLimit=r};Gb.prototype.setSingleSided=function(r){this._isSingleSided=r};Gb.prototype.interfaces_=function(){return[]};Gb.prototype.getClass=function(){return Gb};Gb.bufferDistanceError=function(r){return 1-Math.cos(Math.PI/
2/r/2)};ye.CAP_ROUND.get=function(){return 1};ye.CAP_FLAT.get=function(){return 2};ye.CAP_SQUARE.get=function(){return 3};ye.JOIN_ROUND.get=function(){return 1};ye.JOIN_MITRE.get=function(){return 2};ye.JOIN_BEVEL.get=function(){return 3};ye.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};ye.DEFAULT_MITRE_LIMIT.get=function(){return 5};ye.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01};Object.defineProperties(Gb,ye);var bc=function(r){this._isDeleted=this._distanceTol=null;this._angleOrientation=
Da.COUNTERCLOCKWISE;this._inputLine=r||null},dh={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};bc.prototype.isDeletable=function(r,v,A,u){var y=this._inputLine[r];v=this._inputLine[v];var C=this._inputLine[A];return!!this.isConcave(y,v,C)&&!!this.isShallow(y,v,C,u)&&this.isShallowSampled(y,v,r,A,u)};bc.prototype.deleteShallowConcavities=function(){for(var r=1,v=this.findNextNonDeletedIndex(r),A=this.findNextNonDeletedIndex(v),u=!1;A<this._inputLine.length;){var y=
!1;this.isDeletable(r,v,A,this._distanceTol)&&(this._isDeleted[v]=bc.DELETE,y=!0,u=!0);r=y?A:v;v=this.findNextNonDeletedIndex(r);A=this.findNextNonDeletedIndex(v)}return u};bc.prototype.isShallowConcavity=function(r,v,A,u){return Da.computeOrientation(r,v,A)===this._angleOrientation&&Da.distancePointLine(v,r,A)<u};bc.prototype.isShallowSampled=function(r,v,A,u,y){var C=Math.trunc((u-A)/bc.NUM_PTS_TO_CHECK);for(0>=C&&(C=1);A<u;A+=C)if(!this.isShallow(r,v,this._inputLine[A],y))return!1;return!0};bc.prototype.isConcave=
function(r,v,A){return Da.computeOrientation(r,v,A)===this._angleOrientation};bc.prototype.simplify=function(r){this._distanceTol=Math.abs(r);0>r&&(this._angleOrientation=Da.CLOCKWISE);this._isDeleted=Array(this._inputLine.length).fill(null);do r=this.deleteShallowConcavities();while(r);return this.collapseLine()};bc.prototype.findNextNonDeletedIndex=function(r){for(r+=1;r<this._inputLine.length&&this._isDeleted[r]===bc.DELETE;)r++;return r};bc.prototype.isShallow=function(r,v,A,u){return Da.distancePointLine(v,
r,A)<u};bc.prototype.collapseLine=function(){for(var r=new Tg,v=0;v<this._inputLine.length;v++)this._isDeleted[v]!==bc.DELETE&&r.add(this._inputLine[v]);return r.toCoordinateArray()};bc.prototype.interfaces_=function(){return[]};bc.prototype.getClass=function(){return bc};bc.simplify=function(r,v){return(new bc(r)).simplify(v)};dh.INIT.get=function(){return 0};dh.DELETE.get=function(){return 1};dh.KEEP.get=function(){return 1};dh.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(bc,
dh);var ed=function(){this._precisionModel=this._ptList=null;this._minimimVertexDistance=0;this._ptList=new Fa},rn={COORDINATE_ARRAY_TYPE:{configurable:!0}};ed.prototype.getCoordinates=function(){return this._ptList.toArray(ed.COORDINATE_ARRAY_TYPE)};ed.prototype.setPrecisionModel=function(r){this._precisionModel=r};ed.prototype.addPt=function(r){r=new sa(r);if(this._precisionModel.makePrecise(r),this.isRedundant(r))return null;this._ptList.add(r)};ed.prototype.revere=function(){};ed.prototype.addPts=
function(r,v){if(v)for(v=0;v<r.length;v++)this.addPt(r[v]);else for(v=r.length-1;0<=v;v--)this.addPt(r[v])};ed.prototype.isRedundant=function(r){if(1>this._ptList.size())return!1;var v=this._ptList.get(this._ptList.size()-1);return r.distance(v)<this._minimimVertexDistance};ed.prototype.toString=function(){return(new bb).createLineString(this.getCoordinates()).toString()};ed.prototype.closeRing=function(){if(1>this._ptList.size())return null;var r=new sa(this._ptList.get(0)),v=this._ptList.get(this._ptList.size()-
1);if(r.equals(v))return null;this._ptList.add(r)};ed.prototype.setMinimumVertexDistance=function(r){this._minimimVertexDistance=r};ed.prototype.interfaces_=function(){return[]};ed.prototype.getClass=function(){return ed};rn.COORDINATE_ARRAY_TYPE.get=function(){return[].fill(null)};Object.defineProperties(ed,rn);var cb=function(){},vf={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};
cb.prototype.interfaces_=function(){return[]};cb.prototype.getClass=function(){return cb};cb.toDegrees=function(r){return 180*r/Math.PI};cb.normalize=function(r){for(;r>Math.PI;)r-=cb.PI_TIMES_2;for(;r<=-Math.PI;)r+=cb.PI_TIMES_2;return r};cb.angle=function(){if(1===arguments.length){var r=arguments[0];return Math.atan2(r.y,r.x)}if(2===arguments.length){r=arguments[0];var v=arguments[1];return Math.atan2(v.y-r.y,v.x-r.x)}};cb.isAcute=function(r,v,A){return 0<(r.x-v.x)*(A.x-v.x)+(r.y-v.y)*(A.y-v.y)};
cb.isObtuse=function(r,v,A){return 0>(r.x-v.x)*(A.x-v.x)+(r.y-v.y)*(A.y-v.y)};cb.interiorAngle=function(r,v,A){r=cb.angle(v,r);v=cb.angle(v,A);return Math.abs(v-r)};cb.normalizePositive=function(r){if(0>r){for(;0>r;)r+=cb.PI_TIMES_2;r>=cb.PI_TIMES_2&&(r=0)}else{for(;r>=cb.PI_TIMES_2;)r-=cb.PI_TIMES_2;0>r&&(r=0)}return r};cb.angleBetween=function(r,v,A){r=cb.angle(v,r);v=cb.angle(v,A);return cb.diff(r,v)};cb.diff=function(r,v){var A=null;return(A=r<v?v-r:r-v)>Math.PI&&(A=2*Math.PI-A),A};cb.toRadians=
function(r){return r*Math.PI/180};cb.getTurn=function(r,v){r=Math.sin(v-r);return 0<r?cb.COUNTERCLOCKWISE:0>r?cb.CLOCKWISE:cb.NONE};cb.angleBetweenOriented=function(r,v,A){r=cb.angle(v,r);v=cb.angle(v,A)-r;return v<=-Math.PI?v+cb.PI_TIMES_2:v>Math.PI?v-cb.PI_TIMES_2:v};vf.PI_TIMES_2.get=function(){return 2*Math.PI};vf.PI_OVER_2.get=function(){return Math.PI/2};vf.PI_OVER_4.get=function(){return Math.PI/4};vf.COUNTERCLOCKWISE.get=function(){return Da.COUNTERCLOCKWISE};vf.CLOCKWISE.get=function(){return Da.CLOCKWISE};
vf.NONE.get=function(){return Da.COLLINEAR};Object.defineProperties(cb,vf);var Ub=function y(v,A,u){this._maxCurveSegmentError=0;this._filletAngleQuantum=null;this._closingSegLengthFactor=1;this._segList=null;this._distance=0;this._s2=this._s1=this._s0=this._li=this._bufParams=this._precisionModel=null;this._seg0=new Na;this._seg1=new Na;this._offset0=new Na;this._offset1=new Na;this._side=0;this._hasNarrowConcaveAngle=!1;this._precisionModel=v;this._bufParams=A;this._li=new Te;this._filletAngleQuantum=
Math.PI/2/A.getQuadrantSegments();8<=A.getQuadrantSegments()&&A.getJoinStyle()===Gb.JOIN_ROUND&&(this._closingSegLengthFactor=y.MAX_CLOSING_SEG_LEN_FACTOR);this.init(u)},eh={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ub.prototype.addNextSegment=function(v,A){if(this._s0=this._s1,this._s1=this._s2,this._s2=v,this._seg0.setCoordinates(this._s0,
this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;v=Da.computeOrientation(this._s0,this._s1,this._s2);var u=v===Da.CLOCKWISE&&this._side===Aa.LEFT||v===Da.COUNTERCLOCKWISE&&this._side===Aa.RIGHT;0===v?this.addCollinear(A):u?this.addOutsideTurn(v,A):this.addInsideTurn(v,A)};Ub.prototype.addLineEndCap=function(v,
A){var u=new Na(v,A),y=new Na;this.computeOffsetSegment(u,Aa.LEFT,this._distance,y);var C=new Na;this.computeOffsetSegment(u,Aa.RIGHT,this._distance,C);v=Math.atan2(A.y-v.y,A.x-v.x);switch(this._bufParams.getEndCapStyle()){case Gb.CAP_ROUND:this._segList.addPt(y.p1);this.addFilletArc(A,v+Math.PI/2,v-Math.PI/2,Da.CLOCKWISE,this._distance);this._segList.addPt(C.p1);break;case Gb.CAP_FLAT:this._segList.addPt(y.p1);this._segList.addPt(C.p1);break;case Gb.CAP_SQUARE:A=new sa,A.x=Math.abs(this._distance)*
Math.cos(v),A.y=Math.abs(this._distance)*Math.sin(v),y=new sa(y.p1.x+A.x,y.p1.y+A.y),C=new sa(C.p1.x+A.x,C.p1.y+A.y),this._segList.addPt(y),this._segList.addPt(C)}};Ub.prototype.getCoordinates=function(){return this._segList.getCoordinates()};Ub.prototype.addMitreJoin=function(v,A,u,y){var C=!0,w=null;try{w=sd.intersection(A.p0,A.p1,u.p0,u.p1),(0>=y?1:w.distance(v)/Math.abs(y))>this._bufParams.getMitreLimit()&&(C=!1)}catch(x){if(!(x instanceof Tf))throw x;w=new sa(0,0);C=!1}C?this._segList.addPt(w):
this.addLimitedMitreJoin(A,u,y,this._bufParams.getMitreLimit())};Ub.prototype.addFilletCorner=function(v,A,u,y,C){var w=Math.atan2(A.y-v.y,A.x-v.x),x=Math.atan2(u.y-v.y,u.x-v.x);y===Da.CLOCKWISE?w<=x&&(w+=2*Math.PI):w>=x&&(w-=2*Math.PI);this._segList.addPt(A);this.addFilletArc(v,w,x,y,C);this._segList.addPt(u)};Ub.prototype.addOutsideTurn=function(v,A){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ub.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;
this._bufParams.getJoinStyle()===Gb.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Gb.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(A&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,v,this._distance),this._segList.addPt(this._offset1.p0))};Ub.prototype.createSquare=function(v){this._segList.addPt(new sa(v.x+this._distance,v.y+this._distance));this._segList.addPt(new sa(v.x+
this._distance,v.y-this._distance));this._segList.addPt(new sa(v.x-this._distance,v.y-this._distance));this._segList.addPt(new sa(v.x-this._distance,v.y+this._distance));this._segList.closeRing()};Ub.prototype.addSegments=function(v,A){this._segList.addPts(v,A)};Ub.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Ub.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Ub.prototype.initSideSegments=function(v,A,u){this._s1=v;this._s2=A;this._side=u;
this._seg1.setCoordinates(v,A);this.computeOffsetSegment(this._seg1,u,this._distance,this._offset1)};Ub.prototype.addLimitedMitreJoin=function(v,A,u,y){v=this._seg0.p1;var C=cb.angle(v,this._seg0.p0);A=cb.angleBetweenOriented(this._seg0.p0,v,this._seg1.p1)/2;C=cb.normalize(C+A);C=cb.normalize(C+Math.PI);y*=u;u-=y*Math.abs(Math.sin(A));y=new sa(v.x+y*Math.cos(C),v.y+y*Math.sin(C));y=new Na(v,y);v=y.pointAlongOffset(1,u);u=y.pointAlongOffset(1,-u);this._side===Aa.LEFT?(this._segList.addPt(v),this._segList.addPt(u)):
(this._segList.addPt(u),this._segList.addPt(v))};Ub.prototype.computeOffsetSegment=function(v,A,u,y){A=A===Aa.LEFT?1:-1;var C=v.p1.x-v.p0.x,w=v.p1.y-v.p0.y,x=Math.sqrt(C*C+w*w);C=A*u*C/x;u=A*u*w/x;y.p0.x=v.p0.x-u;y.p0.y=v.p0.y+C;y.p1.x=v.p1.x-u;y.p1.y=v.p1.y+C};Ub.prototype.addFilletArc=function(v,A,u,y,C){y=y===Da.CLOCKWISE?-1:1;u=Math.abs(A-u);var w=Math.trunc(u/this._filletAngleQuantum+.5);if(1>w)return null;w=u/w;for(var x=0,B=new sa;x<u;){var E=A+y*x;B.x=v.x+C*Math.cos(E);B.y=v.y+C*Math.sin(E);
this._segList.addPt(B);x+=w}};Ub.prototype.addInsideTurn=function(v,A){(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())?this._segList.addPt(this._li.getIntersection(0)):(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ub.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)?this._segList.addPt(this._offset0.p1):((this._segList.addPt(this._offset0.p1),0<this._closingSegLengthFactor)?(v=new sa((this._closingSegLengthFactor*
this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1)),this._segList.addPt(v),v=new sa((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1)),this._segList.addPt(v)):this._segList.addPt(this._s1),this._segList.addPt(this._offset1.p0))};Ub.prototype.createCircle=function(v){var A=
new sa(v.x+this._distance,v.y);this._segList.addPt(A);this.addFilletArc(v,0,2*Math.PI,-1,this._distance);this._segList.closeRing()};Ub.prototype.addBevelJoin=function(v,A){this._segList.addPt(v.p1);this._segList.addPt(A.p0)};Ub.prototype.init=function(v){this._distance=v;this._maxCurveSegmentError=v*(1-Math.cos(this._filletAngleQuantum/2));this._segList=new ed;this._segList.setPrecisionModel(this._precisionModel);this._segList.setMinimumVertexDistance(v*Ub.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Ub.prototype.addCollinear=
function(v){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);2<=this._li.getIntersectionNum()&&(this._bufParams.getJoinStyle()===Gb.JOIN_BEVEL||this._bufParams.getJoinStyle()===Gb.JOIN_MITRE?(v&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Da.CLOCKWISE,this._distance))};Ub.prototype.closeRing=function(){this._segList.closeRing()};Ub.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};
Ub.prototype.interfaces_=function(){return[]};Ub.prototype.getClass=function(){return Ub};eh.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001};eh.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001};eh.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1E-6};eh.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Ub,eh);var Qc=function(v,A){this._distance=0;this._precisionModel=v;this._bufParams=A};Qc.prototype.getOffsetCurve=function(v,A){if(this._distance=
A,0===A)return null;var u=0>A;A=this.getSegGen(Math.abs(A));1>=v.length?this.computePointCurve(v[0],A):this.computeOffsetCurve(v,u,A);v=A.getCoordinates();return u&&ab.reverse(v),v};Qc.prototype.computeSingleSidedBufferCurve=function(v,A,u){var y=this.simplifyTolerance(this._distance);if(A)for(u.addSegments(v,!0),v=bc.simplify(v,-y),A=v.length-1,u.initSideSegments(v[A],v[A-1],Aa.LEFT),u.addFirstSegment(),A-=2;0<=A;A--)u.addNextSegment(v[A],!0);else for(u.addSegments(v,!1),v=bc.simplify(v,y),A=v.length-
1,u.initSideSegments(v[0],v[1],Aa.LEFT),u.addFirstSegment(),y=2;y<=A;y++)u.addNextSegment(v[y],!0);u.addLastSegment();u.closeRing()};Qc.prototype.computeRingBufferCurve=function(v,A,u){var y=this.simplifyTolerance(this._distance);A===Aa.RIGHT&&(y=-y);v=bc.simplify(v,y);y=v.length-1;u.initSideSegments(v[y-1],v[0],A);for(A=1;A<=y;A++)u.addNextSegment(v[A],1!==A);u.closeRing()};Qc.prototype.computeLineBufferCurve=function(v,A){var u=this.simplifyTolerance(this._distance),y=bc.simplify(v,u),C=y.length-
1;A.initSideSegments(y[0],y[1],Aa.LEFT);for(var w=2;w<=C;w++)A.addNextSegment(y[w],!0);A.addLastSegment();A.addLineEndCap(y[C-1],y[C]);v=bc.simplify(v,-u);u=v.length-1;A.initSideSegments(v[u],v[u-1],Aa.LEFT);for(u-=2;0<=u;u--)A.addNextSegment(v[u],!0);A.addLastSegment();A.addLineEndCap(v[1],v[0]);A.closeRing()};Qc.prototype.computePointCurve=function(v,A){switch(this._bufParams.getEndCapStyle()){case Gb.CAP_ROUND:A.createCircle(v);break;case Gb.CAP_SQUARE:A.createSquare(v)}};Qc.prototype.getLineCurve=
function(v,A){if((this._distance=A,0>A&&!this._bufParams.isSingleSided())||0===A)return null;var u=this.getSegGen(Math.abs(A));1>=v.length?this.computePointCurve(v[0],u):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(v,0>A,u):this.computeLineBufferCurve(v,u);return u.getCoordinates()};Qc.prototype.getBufferParameters=function(){return this._bufParams};Qc.prototype.simplifyTolerance=function(v){return v*this._bufParams.getSimplifyFactor()};Qc.prototype.getRingCurve=function(v,A,
u){if(this._distance=u,2>=v.length)return this.getLineCurve(v,u);if(0===u)return Qc.copyCoordinates(v);u=this.getSegGen(u);return this.computeRingBufferCurve(v,A,u),u.getCoordinates()};Qc.prototype.computeOffsetCurve=function(v,A,u){var y=this.simplifyTolerance(this._distance);if(A)for(v=bc.simplify(v,-y),A=v.length-1,u.initSideSegments(v[A],v[A-1],Aa.LEFT),u.addFirstSegment(),A-=2;0<=A;A--)u.addNextSegment(v[A],!0);else for(v=bc.simplify(v,y),A=v.length-1,u.initSideSegments(v[0],v[1],Aa.LEFT),u.addFirstSegment(),
y=2;y<=A;y++)u.addNextSegment(v[y],!0);u.addLastSegment()};Qc.prototype.getSegGen=function(v){return new Ub(this._precisionModel,this._bufParams,v)};Qc.prototype.interfaces_=function(){return[]};Qc.prototype.getClass=function(){return Qc};Qc.copyCoordinates=function(v){for(var A=Array(v.length).fill(null),u=0;u<A.length;u++)A[u]=new sa(v[u]);return A};var wf=function(v){this._subgraphs=null;this._seg=new Na;this._cga=new Da;this._subgraphs=v},sn={DepthSegment:{configurable:!0}};wf.prototype.findStabbedSegments=
function(){if(1===arguments.length){for(var v=arguments[0],A=new Fa,u=this._subgraphs.iterator();u.hasNext();){var y=u.next(),C=y.getEnvelope();v.y<C.getMinY()||v.y>C.getMaxY()||this.findStabbedSegments(v,y.getDirectedEdges(),A)}return A}if(3===arguments.length)if(Va(arguments[2],ue)&&arguments[0]instanceof sa&&arguments[1]instanceof Mj)for(v=arguments[0],A=arguments[1],u=arguments[2],y=A.getEdge().getCoordinates(),C=0;C<y.length-1;C++){if(this._seg.p0=y[C],this._seg.p1=y[C+1],this._seg.p0.y>this._seg.p1.y&&
this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<v.x||this._seg.isHorizontal()||v.y<this._seg.p0.y||v.y>this._seg.p1.y||Da.computeOrientation(this._seg.p0,this._seg.p1,v)===Da.RIGHT)){var w=A.getDepth(Aa.LEFT);this._seg.p0.equals(y[C])||(w=A.getDepth(Aa.RIGHT));w=new Ze(this._seg,w);u.add(w)}}else if(Va(arguments[2],ue)&&arguments[0]instanceof sa&&Va(arguments[1],ue))for(v=arguments[0],A=arguments[2],u=arguments[1].iterator();u.hasNext();)y=u.next(),y.isForward()&&this.findStabbedSegments(v,
y,A)};wf.prototype.getDepth=function(v){v=this.findStabbedSegments(v);return 0===v.size()?0:Kd.min(v)._leftDepth};wf.prototype.interfaces_=function(){return[]};wf.prototype.getClass=function(){return wf};sn.DepthSegment.get=function(){return Ze};Object.defineProperties(wf,sn);var Ze=function(v,A){this._leftDepth=this._upwardSeg=null;this._upwardSeg=new Na(v);this._leftDepth=A};Ze.prototype.compareTo=function(v){if(this._upwardSeg.minX()>=v._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=v._upwardSeg.minX())return-1;
var A=this._upwardSeg.orientationIndex(v._upwardSeg);return 0!==A||0!==(A=-1*v._upwardSeg.orientationIndex(this._upwardSeg))?A:this._upwardSeg.compareTo(v._upwardSeg)};Ze.prototype.compareX=function(v,A){var u=v.p0.compareTo(A.p0);return 0!==u?u:v.p1.compareTo(A.p1)};Ze.prototype.toString=function(){return this._upwardSeg.toString()};Ze.prototype.interfaces_=function(){return[jd]};Ze.prototype.getClass=function(){return Ze};var Hb=function(v,A,u){this.p0=v||null;this.p1=A||null;this.p2=u||null};Hb.prototype.area=
function(){return Hb.area(this.p0,this.p1,this.p2)};Hb.prototype.signedArea=function(){return Hb.signedArea(this.p0,this.p1,this.p2)};Hb.prototype.interpolateZ=function(v){if(null===v)throw new ac("Supplied point is null.");return Hb.interpolateZ(v,this.p0,this.p1,this.p2)};Hb.prototype.longestSideLength=function(){return Hb.longestSideLength(this.p0,this.p1,this.p2)};Hb.prototype.isAcute=function(){return Hb.isAcute(this.p0,this.p1,this.p2)};Hb.prototype.circumcentre=function(){return Hb.circumcentre(this.p0,
this.p1,this.p2)};Hb.prototype.area3D=function(){return Hb.area3D(this.p0,this.p1,this.p2)};Hb.prototype.centroid=function(){return Hb.centroid(this.p0,this.p1,this.p2)};Hb.prototype.inCentre=function(){return Hb.inCentre(this.p0,this.p1,this.p2)};Hb.prototype.interfaces_=function(){return[]};Hb.prototype.getClass=function(){return Hb};Hb.area=function(v,A,u){return Math.abs(((u.x-v.x)*(A.y-v.y)-(A.x-v.x)*(u.y-v.y))/2)};Hb.signedArea=function(v,A,u){return((u.x-v.x)*(A.y-v.y)-(A.x-v.x)*(u.y-v.y))/
2};Hb.det=function(v,A,u,y){return v*y-A*u};Hb.interpolateZ=function(v,A,u,y){var C=A.x,w=A.y,x=u.x-C,B=y.x-C,E=u.y-w,H=y.y-w,P=x*H-B*E;C=v.x-C;v=v.y-w;return A.z+(H*C-B*v)/P*(u.z-A.z)+(-E*C+x*v)/P*(y.z-A.z)};Hb.longestSideLength=function(v,A,u){var y=v.distance(A);A=A.distance(u);v=u.distance(v);return A>y&&(y=A),v>y&&(y=v),y};Hb.isAcute=function(v,A,u){return!!cb.isAcute(v,A,u)&&!!cb.isAcute(A,u,v)&&!!cb.isAcute(u,v,A)};Hb.circumcentre=function(v,A,u){var y=u.x;u=u.y;var C=v.x-y;v=v.y-u;var w=A.x-
y,x=A.y-u;A=2*Hb.det(C,v,w,x);var B=Hb.det(v,C*C+v*v,x,w*w+x*x);C=Hb.det(C,C*C+v*v,w,w*w+x*x);return new sa(y-B/A,u+C/A)};Hb.perpendicularBisector=function(v,A){var u=A.x-v.x,y=A.y-v.y;A=new sd(v.x+u/2,v.y+y/2,1);v=new sd(v.x-y+u/2,v.y+u+y/2,1);return new sd(A,v)};Hb.angleBisector=function(v,A,u){var y=A.distance(v);A=y/(y+A.distance(u));return new sa(v.x+A*(u.x-v.x),v.y+A*(u.y-v.y))};Hb.area3D=function(v,A,u){var y=A.x-v.x,C=A.y-v.y,w=A.z-v.z;A=u.x-v.x;var x=u.y-v.y;u=u.z-v.z;v=C*u-w*x;w=w*A-y*u;
y=y*x-C*A;return Math.sqrt(v*v+w*w+y*y)/2};Hb.centroid=function(v,A,u){return new sa((v.x+A.x+u.x)/3,(v.y+A.y+u.y)/3)};Hb.inCentre=function(v,A,u){var y=A.distance(u),C=v.distance(u),w=v.distance(A),x=y+C+w;return new sa((y*v.x+C*A.x+w*u.x)/x,(y*v.y+C*A.y+w*u.y)/x)};var od=function(v,A,u){this._curveBuilder=this._distance=this._inputGeom=null;this._curveList=new Fa;this._inputGeom=v;this._distance=A;this._curveBuilder=u};od.prototype.addPoint=function(v){if(0>=this._distance)return null;v=v.getCoordinates();
v=this._curveBuilder.getLineCurve(v,this._distance);this.addCurve(v,ua.EXTERIOR,ua.INTERIOR)};od.prototype.addPolygon=function(v){var A=this._distance,u=Aa.LEFT;0>this._distance&&(A=-this._distance,u=Aa.RIGHT);var y=v.getExteriorRing(),C=ab.removeRepeatedPoints(y.getCoordinates());if(0>this._distance&&this.isErodedCompletely(y,this._distance)||0>=this._distance&&3>C.length)return null;this.addPolygonRing(C,A,u,ua.EXTERIOR,ua.INTERIOR);for(y=0;y<v.getNumInteriorRing();y++){C=v.getInteriorRingN(y);
var w=ab.removeRepeatedPoints(C.getCoordinates());0<this._distance&&this.isErodedCompletely(C,-this._distance)||this.addPolygonRing(w,A,Aa.opposite(u),ua.INTERIOR,ua.EXTERIOR)}};od.prototype.isTriangleErodedCompletely=function(v,A){v=new Hb(v[0],v[1],v[2]);var u=v.inCentre();return Da.distancePointLine(u,v.p0,v.p1)<Math.abs(A)};od.prototype.addLineString=function(v){if(0>=this._distance&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;v=ab.removeRepeatedPoints(v.getCoordinates());
v=this._curveBuilder.getLineCurve(v,this._distance);this.addCurve(v,ua.EXTERIOR,ua.INTERIOR)};od.prototype.addCurve=function(v,A,u){if(null===v||2>v.length)return null;v=new ec(v,new Jb(0,ua.BOUNDARY,A,u));this._curveList.add(v)};od.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};od.prototype.addPolygonRing=function(v,A,u,y,C){if(0===A&&v.length<Yd.MINIMUM_VALID_SIZE)return null;var w=y,x=C;v.length>=Yd.MINIMUM_VALID_SIZE&&Da.isCCW(v)&&(w=C,x=y,u=Aa.opposite(u));v=
this._curveBuilder.getRingCurve(v,u,A);this.addCurve(v,w,x)};od.prototype.add=function(v){if(v.isEmpty())return null;v instanceof Fd?this.addPolygon(v):v instanceof Hc?this.addLineString(v):v instanceof Xd?this.addPoint(v):(v instanceof ag||v instanceof We||v instanceof Fe||v instanceof ud)&&this.addCollection(v)};od.prototype.isErodedCompletely=function(v,A){var u=v.getCoordinates();if(4>u.length)return 0>A;if(4===u.length)return this.isTriangleErodedCompletely(u,A);v=v.getEnvelopeInternal();v=Math.min(v.getHeight(),
v.getWidth());return 0>A&&2*Math.abs(A)>v};od.prototype.addCollection=function(v){for(var A=0;A<v.getNumGeometries();A++){var u=v.getGeometryN(A);this.add(u)}};od.prototype.interfaces_=function(){return[]};od.prototype.getClass=function(){return od};var eg=function(){};eg.prototype.locate=function(v){};eg.prototype.interfaces_=function(){return[]};eg.prototype.getClass=function(){return eg};var ae=function(v){this._subcollectionIterator=this._max=null;this._parent=v;this._atStart=!0;this._index=0;
this._max=v.getNumGeometries()};ae.prototype.next=function(){if(this._atStart)return this._atStart=!1,ae.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Mf;var v=this._parent.getGeometryN(this._index++);return v instanceof ud?(this._subcollectionIterator=new ae(v),this._subcollectionIterator.next()):v};ae.prototype.remove=
function(){throw Error(this.getClass().getName());};ae.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ae.prototype.interfaces_=function(){return[Zf]};ae.prototype.getClass=function(){return ae};ae.isAtomic=function(v){return!(v instanceof ud)};var fd=function(v){this._geom=v};fd.prototype.locate=function(v){return fd.locate(v,this._geom)};
fd.prototype.interfaces_=function(){return[eg]};fd.prototype.getClass=function(){return fd};fd.isPointInRing=function(v,A){return!!A.getEnvelopeInternal().intersects(v)&&Da.isPointInRing(v,A.getCoordinates())};fd.containsPointInPolygon=function(v,A){if(A.isEmpty())return!1;var u=A.getExteriorRing();if(!fd.isPointInRing(v,u))return!1;for(u=0;u<A.getNumInteriorRing();u++){var y=A.getInteriorRingN(u);if(fd.isPointInRing(v,y))return!1}return!0};fd.containsPoint=function(v,A){if(A instanceof Fd)return fd.containsPointInPolygon(v,
A);if(A instanceof ud)for(var u=new ae(A);u.hasNext();){var y=u.next();if(y!==A&&fd.containsPoint(v,y))return!0}return!1};fd.locate=function(v,A){return A.isEmpty()?ua.EXTERIOR:fd.containsPoint(v,A)?ua.INTERIOR:ua.EXTERIOR};var Cc=function(){this._edgeMap=new Ac;this._edgeList=null;this._ptInAreaLocation=[ua.NONE,ua.NONE]};Cc.prototype.getNextCW=function(v){this.getEdges();v=this._edgeList.indexOf(v);var A=v-1;return 0===v&&(A=this._edgeList.size()-1),this._edgeList.get(A)};Cc.prototype.propagateSideLabels=
function(v){for(var A=ua.NONE,u=this.iterator();u.hasNext();){var y=u.next().getLabel();y.isArea(v)&&y.getLocation(v,Aa.LEFT)!==ua.NONE&&(A=y.getLocation(v,Aa.LEFT))}if(A===ua.NONE)return null;for(u=this.iterator();u.hasNext();){y=u.next();var C=y.getLabel();if(C.getLocation(v,Aa.ON)===ua.NONE&&C.setLocation(v,Aa.ON,A),C.isArea(v)){var w=C.getLocation(v,Aa.LEFT),x=C.getLocation(v,Aa.RIGHT);if(x!==ua.NONE){if(x!==A)throw new we("side location conflict",y.getCoordinate());w===ua.NONE&&Xa.shouldNeverReachHere("found single null side (at "+
y.getCoordinate()+")");A=w}else Xa.isTrue(C.getLocation(v,Aa.LEFT)===ua.NONE,"found single null side"),C.setLocation(v,Aa.RIGHT,A),C.setLocation(v,Aa.LEFT,A)}}};Cc.prototype.getCoordinate=function(){var v=this.iterator();return v.hasNext()?v.next().getCoordinate():null};Cc.prototype.print=function(v){Oc.out.println("EdgeEndStar:   "+this.getCoordinate());for(var A=this.iterator();A.hasNext();)A.next().print(v)};Cc.prototype.isAreaLabelsConsistent=function(v){return this.computeEdgeEndLabels(v.getBoundaryNodeRule()),
this.checkAreaLabelsConsistent(0)};Cc.prototype.checkAreaLabelsConsistent=function(v){var A=this.getEdges();if(0>=A.size())return!0;var u=A.size()-1;A=A.get(u).getLabel().getLocation(v,Aa.LEFT);Xa.isTrue(A!==ua.NONE,"Found unlabelled area edge");for(u=this.iterator();u.hasNext();){var y=u.next().getLabel();Xa.isTrue(y.isArea(v),"Found non-area edge");var C=y.getLocation(v,Aa.LEFT);y=y.getLocation(v,Aa.RIGHT);if(C===y||y!==A)return!1;A=C}return!0};Cc.prototype.findIndex=function(v){this.iterator();
for(var A=0;A<this._edgeList.size();A++)if(this._edgeList.get(A)===v)return A;return-1};Cc.prototype.iterator=function(){return this.getEdges().iterator()};Cc.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Fa(this._edgeMap.values())),this._edgeList};Cc.prototype.getLocation=function(v,A,u){return this._ptInAreaLocation[v]===ua.NONE&&(this._ptInAreaLocation[v]=fd.locate(A,u[v].getGeometry())),this._ptInAreaLocation[v]};Cc.prototype.toString=function(){var v=new Cd;
v.append("EdgeEndStar:   "+this.getCoordinate());v.append("\n");for(var A=this.iterator();A.hasNext();){var u=A.next();v.append(u);v.append("\n")}return v.toString()};Cc.prototype.computeEdgeEndLabels=function(v){for(var A=this.iterator();A.hasNext();)A.next().computeLabel(v)};Cc.prototype.computeLabelling=function(v){this.computeEdgeEndLabels(v[0].getBoundaryNodeRule());this.propagateSideLabels(0);this.propagateSideLabels(1);for(var A=[!1,!1],u=this.iterator();u.hasNext();)for(var y=u.next().getLabel(),
C=0;2>C;C++)y.isLine(C)&&y.getLocation(C)===ua.BOUNDARY&&(A[C]=!0);for(u=this.iterator();u.hasNext();){y=u.next();C=y.getLabel();for(var w=0;2>w;w++)if(C.isAnyNull(w)){if(A[w])var x=ua.EXTERIOR;else x=y.getCoordinate(),x=this.getLocation(w,x,v);C.setAllLocationsIfNull(w,x)}}};Cc.prototype.getDegree=function(){return this._edgeMap.size()};Cc.prototype.insertEdgeEnd=function(v,A){this._edgeMap.put(v,A);this._edgeList=null};Cc.prototype.interfaces_=function(){return[]};Cc.prototype.getClass=function(){return Cc};
var Fp=function(v){function A(){v.call(this);this._label=this._resultAreaEdgeList=null;this._SCANNING_FOR_INCOMING=1;this._LINKING_TO_OUTGOING=2}return v&&(A.__proto__=v),A.prototype=Object.create(v&&v.prototype),A.prototype.constructor=A,A.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var u=null,y=null,C=this._SCANNING_FOR_INCOMING,w=0;w<this._resultAreaEdgeList.size();w++){var x=this._resultAreaEdgeList.get(w),B=x.getSym();if(x.getLabel().isArea())switch(null===u&&x.isInResult()&&
(u=x),C){case this._SCANNING_FOR_INCOMING:if(!B.isInResult())continue;y=B;C=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:x.isInResult()&&(y.setNext(x),C=this._SCANNING_FOR_INCOMING)}}if(C===this._LINKING_TO_OUTGOING){if(null===u)throw new we("no outgoing dirEdge found",this.getCoordinate());Xa.isTrue(u.isInResult(),"unable to link last incoming dirEdge");y.setNext(u)}},A.prototype.insert=function(u){this.insertEdgeEnd(u,u)},A.prototype.getRightmostEdge=function(){var u=this.getEdges(),
y=u.size();if(1>y)return null;var C=u.get(0);if(1===y)return C;u=u.get(y-1);y=C.getQuadrant();var w=u.getQuadrant();return Mb.isNorthern(y)&&Mb.isNorthern(w)?C:Mb.isNorthern(y)||Mb.isNorthern(w)?0!==C.getDy()?C:0!==u.getDy()?u:(Xa.shouldNeverReachHere("found two horizontal edges incident on node"),null):u},A.prototype.print=function(u){Oc.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var y=this.iterator();y.hasNext();){var C=y.next();u.print("out ");C.print(u);u.println();u.print("in ");
C.getSym().print(u);u.println()}},A.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Fa;for(var u=this.iterator();u.hasNext();){var y=u.next();(y.isInResult()||y.getSym().isInResult())&&this._resultAreaEdgeList.add(y)}return this._resultAreaEdgeList},A.prototype.updateLabelling=function(u){for(var y=this.iterator();y.hasNext();){var C=y.next().getLabel();C.setAllLocationsIfNull(0,u.getLocation(0));C.setAllLocationsIfNull(1,
u.getLocation(1))}},A.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var u=null,y=null,C=this._edgeList.size()-1;0<=C;C--){var w=this._edgeList.get(C),x=w.getSym();null===y&&(y=x);null!==u&&x.setNext(u);u=w}y.setNext(u)},A.prototype.computeDepths=function(){if(1===arguments.length){var u=arguments[0],y=this.findIndex(u),C=u.getDepth(Aa.LEFT),w=u.getDepth(Aa.RIGHT);C=this.computeDepths(y+1,this._edgeList.size(),C);if(this.computeDepths(0,y,C)!==w)throw new we("depth mismatch at "+u.getCoordinate());
}else if(3===arguments.length){u=arguments[1];y=arguments[2];for(w=arguments[0];w<u;w++)C=this._edgeList.get(w),C.setEdgeDepths(Aa.RIGHT,y),y=C.getDepth(Aa.LEFT);return y}},A.prototype.mergeSymLabels=function(){for(var u=this.iterator();u.hasNext();){var y=u.next();y.getLabel().merge(y.getSym().getLabel())}},A.prototype.linkMinimalDirectedEdges=function(u){for(var y=null,C=null,w=this._SCANNING_FOR_INCOMING,x=this._resultAreaEdgeList.size()-1;0<=x;x--){var B=this._resultAreaEdgeList.get(x),E=B.getSym();
switch(null===y&&B.getEdgeRing()===u&&(y=B),w){case this._SCANNING_FOR_INCOMING:if(E.getEdgeRing()!==u)continue;C=E;w=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:B.getEdgeRing()===u&&(C.setNextMin(B),w=this._SCANNING_FOR_INCOMING)}}w===this._LINKING_TO_OUTGOING&&(Xa.isTrue(null!==y,"found null for first outgoing dirEdge"),Xa.isTrue(y.getEdgeRing()===u,"unable to link last incoming dirEdge"),C.setNextMin(y))},A.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var u=
0,y=this.iterator();y.hasNext();)y.next().isInResult()&&u++;return u}if(1===arguments.length){u=arguments[0];y=0;for(var C=this.iterator();C.hasNext();)C.next().getEdgeRing()===u&&y++;return y}},A.prototype.getLabel=function(){return this._label},A.prototype.findCoveredLineEdges=function(){for(var u=ua.NONE,y=this.iterator();y.hasNext();){var C=y.next(),w=C.getSym();if(!C.isLineEdge()){if(C.isInResult()){u=ua.INTERIOR;break}if(w.isInResult()){u=ua.EXTERIOR;break}}}if(u===ua.NONE)return null;for(y=
this.iterator();y.hasNext();)C=y.next(),w=C.getSym(),C.isLineEdge()?C.getEdge().setCovered(u===ua.INTERIOR):(C.isInResult()&&(u=ua.EXTERIOR),w.isInResult()&&(u=ua.INTERIOR))},A.prototype.computeLabelling=function(u){v.prototype.computeLabelling.call(this,u);this._label=new Jb(ua.NONE);for(u=this.iterator();u.hasNext();)for(var y=u.next().getEdge().getLabel(),C=0;2>C;C++){var w=y.getLocation(C);w!==ua.INTERIOR&&w!==ua.BOUNDARY||this._label.setLocation(C,ua.INTERIOR)}},A.prototype.interfaces_=function(){return[]},
A.prototype.getClass=function(){return A},A}(Cc),tn=function(v){function A(){v.apply(this,arguments)}return v&&(A.__proto__=v),A.prototype=Object.create(v&&v.prototype),A.prototype.constructor=A,A.prototype.createNode=function(u){return new hi(u,new Fp)},A.prototype.interfaces_=function(){return[]},A.prototype.getClass=function(){return A},A}(bg),Ie=function u(A){this._orientation=null;this._pts=A;this._orientation=u.orientation(A)};Ie.prototype.compareTo=function(A){return Ie.compareOriented(this._pts,
this._orientation,A._pts,A._orientation)};Ie.prototype.interfaces_=function(){return[jd]};Ie.prototype.getClass=function(){return Ie};Ie.orientation=function(A){return 1===ab.increasingDirection(A)};Ie.compareOriented=function(A,u,y,C){var w=u?1:-1,x=C?1:-1,B=u?A.length:-1,E=C?y.length:-1;u=u?0:A.length-1;for(C=C?0:y.length-1;;){var H=A[u].compareTo(y[C]);if(0!==H)return H;H=(u+=w)===B;var P=(C+=x)===E;if(H&&!P)return-1;if(!H&&P)return 1;if(H&&P)return 0}};var wd=function(){this._edges=new Fa;this._ocaMap=
new Ac};wd.prototype.print=function(A){A.print("MULTILINESTRING ( ");for(var u=0;u<this._edges.size();u++){var y=this._edges.get(u);0<u&&A.print(",");A.print("(");y=y.getCoordinates();for(var C=0;C<y.length;C++)0<C&&A.print(","),A.print(y[C].x+" "+y[C].y);A.println(")")}A.print(")  ")};wd.prototype.addAll=function(A){for(A=A.iterator();A.hasNext();)this.add(A.next())};wd.prototype.findEdgeIndex=function(A){for(var u=0;u<this._edges.size();u++)if(this._edges.get(u).equals(A))return u;return-1};wd.prototype.iterator=
function(){return this._edges.iterator()};wd.prototype.getEdges=function(){return this._edges};wd.prototype.get=function(A){return this._edges.get(A)};wd.prototype.findEqualEdge=function(A){A=new Ie(A.getCoordinates());return this._ocaMap.get(A)};wd.prototype.add=function(A){this._edges.add(A);var u=new Ie(A.getCoordinates());this._ocaMap.put(u,A)};wd.prototype.interfaces_=function(){return[]};wd.prototype.getClass=function(){return wd};var $e=function(){};$e.prototype.processIntersections=function(A,
u,y,C){};$e.prototype.isDone=function(){};$e.prototype.interfaces_=function(){return[]};$e.prototype.getClass=function(){return $e};var gd=function(A){this._hasInterior=this._hasProperInterior=this._hasProper=this._hasIntersection=!1;this._isSelfIntersection=this._properIntersectionPoint=null;this.numTests=this.numProperIntersections=this.numInteriorIntersections=this.numIntersections=0;this._li=A};gd.prototype.isTrivialIntersection=function(A,u,y,C){return A===y&&1===this._li.getIntersectionNum()&&
(gd.isAdjacentSegments(u,C)||A.isClosed()&&(A=A.size()-1,0===u&&C===A||0===C&&u===A))?!0:!1};gd.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};gd.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};gd.prototype.getLineIntersector=function(){return this._li};gd.prototype.hasProperIntersection=function(){return this._hasProper};gd.prototype.processIntersections=function(A,u,y,C){if(A===y&&u===C)return null;this.numTests++;var w=A.getCoordinates()[u],
x=A.getCoordinates()[u+1],B=y.getCoordinates()[C],E=y.getCoordinates()[C+1];this._li.computeIntersection(w,x,B,E);this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(A,u,y,C)||(this._hasIntersection=!0,A.addIntersections(this._li,u,0),y.addIntersections(this._li,C,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};gd.prototype.hasIntersection=
function(){return this._hasIntersection};gd.prototype.isDone=function(){return!1};gd.prototype.hasInteriorIntersection=function(){return this._hasInterior};gd.prototype.interfaces_=function(){return[$e]};gd.prototype.getClass=function(){return gd};gd.isAdjacentSegments=function(A,u){return 1===Math.abs(A-u)};var Md=function(A,u,y){this.dist=this.segmentIndex=this.coord=null;this.coord=new sa(A);this.segmentIndex=u;this.dist=y};Md.prototype.getSegmentIndex=function(){return this.segmentIndex};Md.prototype.getCoordinate=
function(){return this.coord};Md.prototype.print=function(A){A.print(this.coord);A.print(" seg # = "+this.segmentIndex);A.println(" dist = "+this.dist)};Md.prototype.compareTo=function(A){return this.compare(A.segmentIndex,A.dist)};Md.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===A};Md.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Md.prototype.getDistance=function(){return this.dist};Md.prototype.compare=
function(A,u){return this.segmentIndex<A?-1:this.segmentIndex>A?1:this.dist<u?-1:this.dist>u?1:0};Md.prototype.interfaces_=function(){return[jd]};Md.prototype.getClass=function(){return Md};var be=function(A){this._nodeMap=new Ac;this.edge=A};be.prototype.print=function(A){A.println("Intersections:");for(var u=this.iterator();u.hasNext();)u.next().print(A)};be.prototype.iterator=function(){return this._nodeMap.values().iterator()};be.prototype.addSplitEdges=function(A){this.addEndpoints();for(var u=
this.iterator(),y=u.next();u.hasNext();){var C=u.next();y=this.createSplitEdge(y,C);A.add(y);y=C}};be.prototype.addEndpoints=function(){var A=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0);this.add(this.edge.pts[A],A,0)};be.prototype.createSplitEdge=function(A,u){var y=u.segmentIndex-A.segmentIndex+2,C=this.edge.pts[u.segmentIndex];(C=0<u.dist||!u.coord.equals2D(C))||y--;y=Array(y).fill(null);var w=0;y[w++]=new sa(A.coord);for(A=A.segmentIndex+1;A<=u.segmentIndex;A++)y[w++]=this.edge.pts[A];
return C&&(y[w]=u.coord),new ji(y,new Jb(this.edge._label))};be.prototype.add=function(A,u,y){A=new Md(A,u,y);u=this._nodeMap.get(A);return null!==u?u:(this._nodeMap.put(A,A),A)};be.prototype.isIntersection=function(A){for(var u=this.iterator();u.hasNext();)if(u.next().coord.equals(A))return!0;return!1};be.prototype.interfaces_=function(){return[]};be.prototype.getClass=function(){return be};var af=function(){};af.prototype.getChainStartIndices=function(A){var u=0,y=new Fa;y.add(new Dd(u));do u=this.findChainEnd(A,
u),y.add(new Dd(u));while(u<A.length-1);return af.toIntArray(y)};af.prototype.findChainEnd=function(A,u){var y=Mb.quadrant(A[u],A[u+1]);for(u+=1;u<A.length&&Mb.quadrant(A[u-1],A[u])===y;)u++;return u-1};af.prototype.interfaces_=function(){return[]};af.prototype.getClass=function(){return af};af.toIntArray=function(A){for(var u=Array(A.size()).fill(null),y=0;y<u.length;y++)u[y]=A.get(y).intValue();return u};var ze=function(A){this.startIndex=this.pts=this.e=null;this.env1=new Ia;this.env2=new Ia;this.e=
A;this.pts=A.getCoordinates();this.startIndex=(new af).getChainStartIndices(this.pts)};ze.prototype.getCoordinates=function(){return this.pts};ze.prototype.getMaxX=function(A){var u=this.pts[this.startIndex[A]].x;A=this.pts[this.startIndex[A+1]].x;return u>A?u:A};ze.prototype.getMinX=function(A){var u=this.pts[this.startIndex[A]].x;A=this.pts[this.startIndex[A+1]].x;return u<A?u:A};ze.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var A=arguments[0],u=arguments[1],y=arguments[2];
this.computeIntersectsForChain(this.startIndex[A],this.startIndex[A+1],u,u.startIndex[y],u.startIndex[y+1],arguments[3])}else if(6===arguments.length){A=arguments[0];u=arguments[1];y=arguments[2];var C=arguments[3],w=arguments[4],x=arguments[5],B=this.pts[A],E=this.pts[u],H=y.pts[C],P=y.pts[w];if(1==u-A&&1==w-C)return x.addIntersections(this.e,A,y.e,C),null;if(this.env1.init(B,E),this.env2.init(H,P),!this.env1.intersects(this.env2))return null;B=Math.trunc((A+u)/2);E=Math.trunc((C+w)/2);A<B&&(C<E&&
this.computeIntersectsForChain(A,B,y,C,E,x),E<w&&this.computeIntersectsForChain(A,B,y,E,w,x));B<u&&(C<E&&this.computeIntersectsForChain(B,u,y,C,E,x),E<w&&this.computeIntersectsForChain(B,u,y,E,w,x))}};ze.prototype.getStartIndexes=function(){return this.startIndex};ze.prototype.computeIntersects=function(A,u){for(var y=0;y<this.startIndex.length-1;y++)for(var C=0;C<A.startIndex.length-1;C++)this.computeIntersectsForChain(y,A,C,u)};ze.prototype.interfaces_=function(){return[]};ze.prototype.getClass=
function(){return ze};var yc=function u(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var y=0;2>y;y++)for(var C=0;3>C;C++)this._depth[y][C]=u.NULL_VALUE},un={NULL_VALUE:{configurable:!0}};yc.prototype.getDepth=function(u,y){return this._depth[u][y]};yc.prototype.setDepth=function(u,y,C){this._depth[u][y]=C};yc.prototype.isNull=function(){if(0===arguments.length){for(var u=0;2>u;u++)for(var y=0;3>y;y++)if(this._depth[u][y]!==yc.NULL_VALUE)return!1;return!0}if(1===arguments.length)return this._depth[arguments[0]][1]===
yc.NULL_VALUE;if(2===arguments.length)return this._depth[arguments[0]][arguments[1]]===yc.NULL_VALUE};yc.prototype.normalize=function(){for(var u=0;2>u;u++)if(!this.isNull(u)){var y=this._depth[u][1];this._depth[u][2]<y&&(y=this._depth[u][2]);0>y&&(y=0);for(var C=1;3>C;C++){var w=0;this._depth[u][C]>y&&(w=1);this._depth[u][C]=w}}};yc.prototype.getDelta=function(u){return this._depth[u][Aa.RIGHT]-this._depth[u][Aa.LEFT]};yc.prototype.getLocation=function(u,y){return 0>=this._depth[u][y]?ua.EXTERIOR:
ua.INTERIOR};yc.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};yc.prototype.add=function(){if(1===arguments.length)for(var u=arguments[0],y=0;2>y;y++)for(var C=1;3>C;C++){var w=u.getLocation(y,C);w!==ua.EXTERIOR&&w!==ua.INTERIOR||(this.isNull(y,C)?this._depth[y][C]=yc.depthAtLocation(w):this._depth[y][C]+=yc.depthAtLocation(w))}else 3===arguments.length&&(u=arguments[0],y=arguments[1],arguments[2]===ua.INTERIOR&&this._depth[u][y]++)};
yc.prototype.interfaces_=function(){return[]};yc.prototype.getClass=function(){return yc};yc.depthAtLocation=function(u){return u===ua.EXTERIOR?0:u===ua.INTERIOR?1:yc.NULL_VALUE};un.NULL_VALUE.get=function(){return-1};Object.defineProperties(yc,un);var ji=function(u){function y(){if(u.call(this),this.pts=null,this._env=null,this.eiList=new be(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new yc,this._depthDelta=0,1===arguments.length)y.call(this,arguments[0],null);else if(2===
arguments.length){var C=arguments[1];this.pts=arguments[0];this._label=C}}return u&&(y.__proto__=u),y.prototype=Object.create(u&&u.prototype),y.prototype.constructor=y,y.prototype.getDepth=function(){return this._depth},y.prototype.getCollapsedEdge=function(){var C=Array(2).fill(null);return C[0]=this.pts[0],C[1]=this.pts[1],new y(C,Jb.toLineLabel(this._label))},y.prototype.isIsolated=function(){return this._isIsolated},y.prototype.getCoordinates=function(){return this.pts},y.prototype.setIsolated=
function(C){this._isIsolated=C},y.prototype.setName=function(C){this._name=C},y.prototype.equals=function(C){if(!(C instanceof y)||this.pts.length!==C.pts.length)return!1;for(var w=!0,x=!0,B=this.pts.length,E=0;E<this.pts.length;E++)if(this.pts[E].equals2D(C.pts[E])||(w=!1),this.pts[E].equals2D(C.pts[--B])||(x=!1),!w&&!x)return!1;return!0},y.prototype.getCoordinate=function(){if(0===arguments.length)return 0<this.pts.length?this.pts[0]:null;if(1===arguments.length)return this.pts[arguments[0]]},y.prototype.print=
function(C){C.print("edge "+this._name+": ");C.print("LINESTRING (");for(var w=0;w<this.pts.length;w++)0<w&&C.print(","),C.print(this.pts[w].x+" "+this.pts[w].y);C.print(")  "+this._label+" "+this._depthDelta)},y.prototype.computeIM=function(C){y.updateIM(this._label,C)},y.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},y.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},y.prototype.getMaximumSegmentIndex=
function(){return this.pts.length-1},y.prototype.getDepthDelta=function(){return this._depthDelta},y.prototype.getNumPoints=function(){return this.pts.length},y.prototype.printReverse=function(C){C.print("edge "+this._name+": ");for(var w=this.pts.length-1;0<=w;w--)C.print(this.pts[w]+" ");C.println("")},y.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new ze(this)),this._mce},y.prototype.getEnvelope=function(){if(null===this._env){this._env=new Ia;for(var C=0;C<this.pts.length;C++)this._env.expandToInclude(this.pts[C])}return this._env},
y.prototype.addIntersection=function(C,w,x,B){var E=new sa(C.getIntersection(B));C=C.getEdgeDistance(x,B);x=w+1;x<this.pts.length&&E.equals2D(this.pts[x])&&(w=x,C=0);this.eiList.add(E,w,C)},y.prototype.toString=function(){var C=new Cd;C.append("edge "+this._name+": ");C.append("LINESTRING (");for(var w=0;w<this.pts.length;w++)0<w&&C.append(","),C.append(this.pts[w].x+" "+this.pts[w].y);return C.append(")  "+this._label+" "+this._depthDelta),C.toString()},y.prototype.isPointwiseEqual=function(C){if(this.pts.length!==
C.pts.length)return!1;for(var w=0;w<this.pts.length;w++)if(!this.pts[w].equals2D(C.pts[w]))return!1;return!0},y.prototype.setDepthDelta=function(C){this._depthDelta=C},y.prototype.getEdgeIntersectionList=function(){return this.eiList},y.prototype.addIntersections=function(C,w,x){for(var B=0;B<C.getIntersectionNum();B++)this.addIntersection(C,w,x,B)},y.prototype.interfaces_=function(){return[]},y.prototype.getClass=function(){return y},y.updateIM=function(){if(2!==arguments.length)return u.prototype.updateIM.apply(this,
arguments);var C=arguments[0],w=arguments[1];w.setAtLeastIfValid(C.getLocation(0,Aa.ON),C.getLocation(1,Aa.ON),1);C.isArea()&&(w.setAtLeastIfValid(C.getLocation(0,Aa.LEFT),C.getLocation(1,Aa.LEFT),2),w.setAtLeastIfValid(C.getLocation(0,Aa.RIGHT),C.getLocation(1,Aa.RIGHT),2))},y}(dd),Kc=function(u){this._graph=this._geomFact=this._workingNoder=this._workingPrecisionModel=null;this._edgeList=new wd;this._bufParams=u||null};Kc.prototype.setWorkingPrecisionModel=function(u){this._workingPrecisionModel=
u};Kc.prototype.insertUniqueEdge=function(u){var y=this._edgeList.findEqualEdge(u);if(null!==y){var C=y.getLabel(),w=u.getLabel();y.isPointwiseEqual(u)||(w=new Jb(u.getLabel())).flip();C.merge(w);u=Kc.depthDelta(w);u=y.getDepthDelta()+u;y.setDepthDelta(u)}else this._edgeList.add(u),u.setDepthDelta(Kc.depthDelta(u.getLabel()))};Kc.prototype.buildSubgraphs=function(u,y){var C=new Fa;for(u=u.iterator();u.hasNext();){var w=u.next(),x=w.getRightmostCoordinate();x=(new wf(C)).getDepth(x);w.computeDepth(x);
w.findResultEdges();C.add(w);y.add(w.getDirectedEdges(),w.getNodes())}};Kc.prototype.createSubgraphs=function(u){var y=new Fa;for(u=u.getNodes().iterator();u.hasNext();){var C=u.next();if(!C.isVisited()){var w=new Ic;w.create(C);y.add(w)}}return Kd.sort(y,Kd.reverseOrder()),y};Kc.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()};Kc.prototype.getNoder=function(u){if(null!==this._workingNoder)return this._workingNoder;var y=new Nj,C=new Te;return C.setPrecisionModel(u),
y.setSegmentIntersector(new gd(C)),y};Kc.prototype.buffer=function(u,y){var C=this._workingPrecisionModel;null===C&&(C=u.getPrecisionModel());this._geomFact=u.getFactory();var w=new Qc(C,this._bufParams);u=(new od(u,y,w)).getCurves();if(0>=u.size())return this.createEmptyResultGeometry();this.computeNodedEdges(u,C);this._graph=new Yb(new tn);this._graph.addEdges(this._edgeList.getEdges());C=this.createSubgraphs(this._graph);u=new Yc(this._geomFact);this.buildSubgraphs(C,u);C=u.getPolygons();return 0>=
C.size()?this.createEmptyResultGeometry():this._geomFact.buildGeometry(C)};Kc.prototype.computeNodedEdges=function(u,y){y=this.getNoder(y);y.computeNodes(u);for(u=y.getNodedSubstrings().iterator();u.hasNext();){y=u.next();var C=y.getCoordinates();2===C.length&&C[0].equals2D(C[1])||(C=y.getData(),y=new ji(y.getCoordinates(),new Jb(C)),this.insertUniqueEdge(y))}};Kc.prototype.setNoder=function(u){this._workingNoder=u};Kc.prototype.interfaces_=function(){return[]};Kc.prototype.getClass=function(){return Kc};
Kc.depthDelta=function(u){var y=u.getLocation(0,Aa.LEFT);u=u.getLocation(0,Aa.RIGHT);return y===ua.INTERIOR&&u===ua.EXTERIOR?1:y===ua.EXTERIOR&&u===ua.INTERIOR?-1:0};Kc.convertSegStrings=function(u){for(var y=new bb,C=new Fa;u.hasNext();){var w=u.next();w=y.createLineString(w.getCoordinates());C.add(w)}return y.buildGeometry(C)};var Je=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var u=arguments[1];this._noder=
arguments[0];this._scaleFactor=u;this._offsetY=this._offsetX=0;this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){u=arguments[1];var y=arguments[2],C=arguments[3];this._noder=arguments[0];this._scaleFactor=u;this._offsetX=y;this._offsetY=C;this._isScaled=!this.isIntegerPrecision()}};Je.prototype.rescale=function(u){if(Va(u,kc))for(u=u.iterator();u.hasNext();){var y=u.next();this.rescale(y.getCoordinates())}else if(u instanceof Array){for(y=0;y<u.length;y++)u[y].x=u[y].x/this._scaleFactor+
this._offsetX,u[y].y=u[y].y/this._scaleFactor+this._offsetY;2===u.length&&u[0].equals2D(u[1])&&Oc.out.println(u)}};Je.prototype.scale=function(u){if(Va(u,kc)){var y=new Fa;for(u=u.iterator();u.hasNext();){var C=u.next();y.add(new ec(this.scale(C.getCoordinates()),C.getData()))}return y}if(u instanceof Array){y=Array(u.length).fill(null);for(C=0;C<u.length;C++)y[C]=new sa(Math.round((u[C].x-this._offsetX)*this._scaleFactor),Math.round((u[C].y-this._offsetY)*this._scaleFactor),u[C].z);return ab.removeRepeatedPoints(y)}};
Je.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor};Je.prototype.getNodedSubstrings=function(){var u=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(u),u};Je.prototype.computeNodes=function(u){var y=u;this._isScaled&&(y=this.scale(u));this._noder.computeNodes(y)};Je.prototype.interfaces_=function(){return[Ye]};Je.prototype.getClass=function(){return Je};var Nd=function(u){this._li=new Te;this._segStrings=u},vn={fact:{configurable:!0}};Nd.prototype.checkEndPtVertexIntersections=
function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var y=u.next().getCoordinates();this.checkEndPtVertexIntersections(y[0],this._segStrings);this.checkEndPtVertexIntersections(y[y.length-1],this._segStrings)}else if(2===arguments.length)for(u=arguments[0],y=arguments[1].iterator();y.hasNext();)for(var C=y.next().getCoordinates(),w=1;w<C.length-1;w++)if(C[w].equals(u))throw new re("found endpt/interior pt intersection at index "+w+" :pt "+u);};Nd.prototype.checkInteriorIntersections=
function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();)for(var y=u.next(),C=this._segStrings.iterator();C.hasNext();){var w=C.next();this.checkInteriorIntersections(y,w)}else if(2===arguments.length){u=arguments[0];y=arguments[1];C=u.getCoordinates();w=y.getCoordinates();for(var x=0;x<C.length-1;x++)for(var B=0;B<w.length-1;B++)this.checkInteriorIntersections(u,x,y,B)}else if(4===arguments.length){w=arguments[0];x=arguments[1];y=arguments[2];C=arguments[3];if(w===y&&
x===C)return null;u=w.getCoordinates()[x];w=w.getCoordinates()[x+1];x=y.getCoordinates()[C];y=y.getCoordinates()[C+1];if(this._li.computeIntersection(u,w,x,y),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,u,w)||this.hasInteriorIntersection(this._li,x,y)))throw new re("found non-noded intersection at "+u+"-"+w+" and "+x+"-"+y);}};Nd.prototype.checkValid=function(){this.checkEndPtVertexIntersections();this.checkInteriorIntersections();this.checkCollapses()};
Nd.prototype.checkCollapses=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var y=u.next();this.checkCollapses(y)}else if(1===arguments.length)for(u=arguments[0].getCoordinates(),y=0;y<u.length-2;y++)this.checkCollapse(u[y],u[y+1],u[y+2])};Nd.prototype.hasInteriorIntersection=function(u,y,C){for(var w=0;w<u.getIntersectionNum();w++){var x=u.getIntersection(w);if(!x.equals(y)&&!x.equals(C))return!0}return!1};Nd.prototype.checkCollapse=function(u,y,C){if(u.equals(C))throw new re("found non-noded collapse at "+
Nd.fact.createLineString([u,y,C]));};Nd.prototype.interfaces_=function(){return[]};Nd.prototype.getClass=function(){return Nd};vn.fact.get=function(){return new bb};Object.defineProperties(Nd,vn);var Rc=function(u,y,C){this._maxy=this._miny=this._maxx=this._minx=this._scaleFactor=this._p1Scaled=this._p0Scaled=this._ptScaled=this._originalPt=this._pt=this._li=null;this._corner=Array(4).fill(null);this._safeEnv=null;if(this._originalPt=u,this._pt=u,this._scaleFactor=y,this._li=C,0>=y)throw new ac("Scale factor must be non-zero");
1!==y&&(this._pt=new sa(this.scale(u.x),this.scale(u.y)),this._p0Scaled=new sa,this._p1Scaled=new sa);this.initCorners(this._pt)},wn={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Rc.prototype.intersectsScaled=function(u,y){var C=Math.max(u.x,y.x),w=Math.min(u.y,y.y),x=Math.max(u.y,y.y);if(C=this._maxx<Math.min(u.x,y.x)||this._minx>C||this._maxy<w||this._miny>x)return!1;u=this.intersectsToleranceSquare(u,y);return Xa.isTrue(!(C&&u),"Found bad envelope test"),u};Rc.prototype.initCorners=function(u){this._minx=
u.x-.5;this._maxx=u.x+.5;this._miny=u.y-.5;this._maxy=u.y+.5;this._corner[0]=new sa(this._maxx,this._maxy);this._corner[1]=new sa(this._minx,this._maxy);this._corner[2]=new sa(this._minx,this._miny);this._corner[3]=new sa(this._maxx,this._miny)};Rc.prototype.intersects=function(u,y){return 1===this._scaleFactor?this.intersectsScaled(u,y):(this.copyScaled(u,this._p0Scaled),this.copyScaled(y,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Rc.prototype.scale=function(u){return Math.round(u*
this._scaleFactor)};Rc.prototype.getCoordinate=function(){return this._originalPt};Rc.prototype.copyScaled=function(u,y){y.x=this.scale(u.x);y.y=this.scale(u.y)};Rc.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var u=Rc.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Ia(this._originalPt.x-u,this._originalPt.x+u,this._originalPt.y-u,this._originalPt.y+u)}return this._safeEnv};Rc.prototype.intersectsPixelClosure=function(u,y){return this._li.computeIntersection(u,y,this._corner[0],
this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(u,y,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(u,y,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(u,y,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))};Rc.prototype.intersectsToleranceSquare=function(u,y){var C=!1,w=!1;return this._li.computeIntersection(u,y,this._corner[0],this._corner[1]),!!this._li.isProper()||
(this._li.computeIntersection(u,y,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(C=!0),this._li.computeIntersection(u,y,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(w=!0),this._li.computeIntersection(u,y,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!C||!w)||!!u.equals(this._pt)||!!y.equals(this._pt))))};Rc.prototype.addSnappedNode=function(u,y){var C=u.getCoordinate(y),w=u.getCoordinate(y+1);return!!this.intersects(C,
w)&&(u.addIntersection(this.getCoordinate(),y),!0)};Rc.prototype.interfaces_=function(){return[]};Rc.prototype.getClass=function(){return Rc};wn.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75};Object.defineProperties(Rc,wn);var fh=function(){this.tempEnv1=new Ia;this.selectedSegment=new Na};fh.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))};fh.prototype.interfaces_=function(){return[]};
fh.prototype.getClass=function(){return fh};var fg=function(u){this._index=u},xn={HotPixelSnapAction:{configurable:!0}};fg.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var u=arguments[0],y=arguments[1],C=arguments[2],w=u.getSafeEnvelope(),x=new yn(u,y,C);return this._index.query(w,{interfaces_:function(){return[Ge]},visitItem:function(B){B.select(w,x)}}),x.isNodeAdded()}};fg.prototype.interfaces_=function(){return[]};fg.prototype.getClass=
function(){return fg};xn.HotPixelSnapAction.get=function(){return yn};Object.defineProperties(fg,xn);var yn=function(u){function y(C,w,x){u.call(this);this._isNodeAdded=!1;this._hotPixel=C;this._parentEdge=w;this._hotPixelVertexIndex=x}return u&&(y.__proto__=u),y.prototype=Object.create(u&&u.prototype),y.prototype.constructor=y,y.prototype.isNodeAdded=function(){return this._isNodeAdded},y.prototype.select=function(){if(2!==arguments.length)return u.prototype.select.apply(this,arguments);var C=arguments[1],
w=arguments[0].getContext();if(null!==this._parentEdge&&w===this._parentEdge&&C===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(w,C)},y.prototype.interfaces_=function(){return[]},y.prototype.getClass=function(){return y},y}(fh),xf=function(u){this._interiorIntersections=null;this._li=u;this._interiorIntersections=new Fa};xf.prototype.processIntersections=function(u,y,C,w){if(u===C&&y===w)return null;var x=u.getCoordinates()[y],B=u.getCoordinates()[y+1],E=C.getCoordinates()[w],
H=C.getCoordinates()[w+1];if(this._li.computeIntersection(x,B,E,H),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(x=0;x<this._li.getIntersectionNum();x++)this._interiorIntersections.add(this._li.getIntersection(x));u.addIntersections(this._li,y,0);C.addIntersections(this._li,w,1)}};xf.prototype.isDone=function(){return!1};xf.prototype.getInteriorIntersections=function(){return this._interiorIntersections};xf.prototype.interfaces_=function(){return[$e]};xf.prototype.getClass=function(){return xf};
var ce=function(u){this._nodedSegStrings=this._pointSnapper=this._noder=this._scaleFactor=this._li=null;this._pm=u;this._li=new Te;this._li.setPrecisionModel(u);this._scaleFactor=u.getScale()};ce.prototype.checkCorrectness=function(u){u=ec.getNodedSubstrings(u);u=new Nd(u);try{u.checkValid()}catch(y){if(!(y instanceof gn))throw y;y.printStackTrace()}};ce.prototype.getNodedSubstrings=function(){return ec.getNodedSubstrings(this._nodedSegStrings)};ce.prototype.snapRound=function(u,y){y=this.findInteriorIntersections(u,
y);this.computeIntersectionSnaps(y);this.computeVertexSnaps(u)};ce.prototype.findInteriorIntersections=function(u,y){y=new xf(y);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(u),y.getInteriorIntersections()};ce.prototype.computeVertexSnaps=function(u){if(Va(u,kc))for(u=u.iterator();u.hasNext();){var y=u.next();this.computeVertexSnaps(y)}else if(u instanceof ec){y=u.getCoordinates();for(var C=0;C<y.length;C++){var w=new Rc(y[C],this._scaleFactor,this._li);this._pointSnapper.snap(w,
u,C)&&u.addIntersection(y[C],C)}}};ce.prototype.computeNodes=function(u){this._nodedSegStrings=u;this._noder=new Nj;this._pointSnapper=new fg(this._noder.getIndex());this.snapRound(u,this._li)};ce.prototype.computeIntersectionSnaps=function(u){for(u=u.iterator();u.hasNext();){var y=u.next();y=new Rc(y,this._scaleFactor,this._li);this._pointSnapper.snap(y)}};ce.prototype.interfaces_=function(){return[Ye]};ce.prototype.getClass=function(){return ce};var xc=function(){if(this._argGeom=null,this._distance=
null,this._bufParams=new Gb,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var u=arguments[1];this._argGeom=arguments[0];this._bufParams=u}},gg={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};xc.prototype.bufferFixedPrecision=function(u){var y=new Je(new ce(new Fb(1)),u.getScale()),C=new Kc(this._bufParams);C.setWorkingPrecisionModel(u);
C.setNoder(y);this._resultGeometry=C.buffer(this._argGeom,this._distance)};xc.prototype.bufferReducedPrecision=function(){if(0===arguments.length){for(var u=xc.MAX_PRECISION_DIGITS;0<=u;u--){try{this.bufferReducedPrecision(u)}catch(y){if(!(y instanceof we))throw y;this._saveException=y}if(null!==this._resultGeometry)return null}throw this._saveException;}1===arguments.length&&(u=xc.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),u=new Fb(u),this.bufferFixedPrecision(u))};xc.prototype.computeGeometry=
function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var u=this._argGeom.getFactory().getPrecisionModel();u.getType()===Fb.FIXED?this.bufferFixedPrecision(u):this.bufferReducedPrecision()};xc.prototype.setQuadrantSegments=function(u){this._bufParams.setQuadrantSegments(u)};xc.prototype.bufferOriginalPrecision=function(){try{this._resultGeometry=(new Kc(this._bufParams)).buffer(this._argGeom,this._distance)}catch(u){if(!(u instanceof re))throw u;this._saveException=
u}};xc.prototype.getResultGeometry=function(u){return this._distance=u,this.computeGeometry(),this._resultGeometry};xc.prototype.setEndCapStyle=function(u){this._bufParams.setEndCapStyle(u)};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};xc.bufferOp=function(){if(2===arguments.length){var u=arguments[1];return(new xc(arguments[0])).getResultGeometry(u)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ra&&"number"==typeof arguments[1]){u=
arguments[1];var y=arguments[2],C=new xc(arguments[0]);C.setQuadrantSegments(y);return C.getResultGeometry(u)}if(arguments[2]instanceof Gb&&arguments[0]instanceof Ra&&"number"==typeof arguments[1])return u=arguments[1],(new xc(arguments[0],arguments[2])).getResultGeometry(u)}else if(4===arguments.length){u=arguments[1];y=arguments[2];C=arguments[3];var w=new xc(arguments[0]);w.setQuadrantSegments(y);w.setEndCapStyle(C);return w.getResultGeometry(u)}};xc.precisionScaleFactor=function(u,y,C){u=u.getEnvelopeInternal();
y=cd.max(Math.abs(u.getMaxX()),Math.abs(u.getMaxY()),Math.abs(u.getMinX()),Math.abs(u.getMinY()))+2*(0<y?y:0);return Math.pow(10,C-Math.trunc(Math.log(y)/Math.log(10)+1))};gg.CAP_ROUND.get=function(){return Gb.CAP_ROUND};gg.CAP_BUTT.get=function(){return Gb.CAP_FLAT};gg.CAP_FLAT.get=function(){return Gb.CAP_FLAT};gg.CAP_SQUARE.get=function(){return Gb.CAP_SQUARE};gg.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(xc,gg);var $c=function(){if(this._lines=null,this._isForcedToLineString=
!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var u=arguments[1];this._lines=arguments[0];this._isForcedToLineString=u}};$c.prototype.filter=function(u){if(this._isForcedToLineString&&u instanceof Yd)return u=u.getFactory().createLineString(u.getCoordinateSequence()),this._lines.add(u),null;u instanceof Hc&&this._lines.add(u)};$c.prototype.setForceToLineString=function(u){this._isForcedToLineString=u};$c.prototype.interfaces_=function(){return[se]};$c.prototype.getClass=
function(){return $c};$c.getGeometry=function(){if(1===arguments.length){var u=arguments[0];return u.getFactory().buildGeometry($c.getLines(u))}if(2===arguments.length){u=arguments[0];var y=arguments[1];return u.getFactory().buildGeometry($c.getLines(u,y))}};$c.getLines=function(){if(1===arguments.length)return $c.getLines(arguments[0],!1);if(2===arguments.length){if(Va(arguments[0],kc)&&Va(arguments[1],kc)){for(var u=arguments[1],y=arguments[0].iterator();y.hasNext();){var C=y.next();$c.getLines(C,
u)}return u}if(arguments[0]instanceof Ra&&"boolean"==typeof arguments[1])return u=arguments[0],y=arguments[1],C=new Fa,u.apply(new $c(C,y)),C;if(arguments[0]instanceof Ra&&Va(arguments[1],kc))return u=arguments[0],y=arguments[1],u instanceof Hc?y.add(u):u.apply(new $c(y)),y}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Va(arguments[0],kc)&&Va(arguments[1],kc)){u=arguments[1];y=arguments[2];for(C=arguments[0].iterator();C.hasNext();){var w=C.next();$c.getLines(w,u,y)}return u}if("boolean"==
typeof arguments[2]&&arguments[0]instanceof Ra&&Va(arguments[1],kc))return u=arguments[1],arguments[0].apply(new $c(u,arguments[2])),u}};var de=function(){if((this._boundaryRule=kd.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length)&&1===arguments.length){var u=arguments[0];if(null===u)throw new ac("Rule must be non-null");this._boundaryRule=u}};de.prototype.locateInternal=function(u,y){if(u instanceof sa&&y instanceof Fd){if(y.isEmpty())return ua.EXTERIOR;var C=y.getExteriorRing();
C=this.locateInPolygonRing(u,C);if(C===ua.EXTERIOR)return ua.EXTERIOR;if(C===ua.BOUNDARY)return ua.BOUNDARY;for(C=0;C<y.getNumInteriorRing();C++){var w=y.getInteriorRingN(C);w=this.locateInPolygonRing(u,w);if(w===ua.INTERIOR)return ua.EXTERIOR;if(w===ua.BOUNDARY)return ua.BOUNDARY}return ua.INTERIOR}if(u instanceof sa&&y instanceof Hc){if(!y.getEnvelopeInternal().intersects(u))return ua.EXTERIOR;C=y.getCoordinates();return y.isClosed()||!u.equals(C[0])&&!u.equals(C[C.length-1])?Da.isOnLine(u,C)?ua.INTERIOR:
ua.EXTERIOR:ua.BOUNDARY}if(u instanceof sa&&y instanceof Xd)return y.getCoordinate().equals2D(u)?ua.INTERIOR:ua.EXTERIOR};de.prototype.locateInPolygonRing=function(u,y){return y.getEnvelopeInternal().intersects(u)?Da.locatePointInRing(u,y.getCoordinates()):ua.EXTERIOR};de.prototype.intersects=function(u,y){return this.locate(u,y)!==ua.EXTERIOR};de.prototype.updateLocationInfo=function(u){u===ua.INTERIOR&&(this._isIn=!0);u===ua.BOUNDARY&&this._numBoundaries++};de.prototype.computeLocation=function(u,
y){if(y instanceof Xd&&this.updateLocationInfo(this.locateInternal(u,y)),y instanceof Hc)this.updateLocationInfo(this.locateInternal(u,y));else if(y instanceof Fd)this.updateLocationInfo(this.locateInternal(u,y));else if(y instanceof We)for(var C=0;C<y.getNumGeometries();C++){var w=y.getGeometryN(C);this.updateLocationInfo(this.locateInternal(u,w))}else if(y instanceof Fe)for(C=0;C<y.getNumGeometries();C++)w=y.getGeometryN(C),this.updateLocationInfo(this.locateInternal(u,w));else if(y instanceof ud)for(C=
new ae(y);C.hasNext();)w=C.next(),w!==y&&this.computeLocation(u,w)};de.prototype.locate=function(u,y){return y.isEmpty()?ua.EXTERIOR:y instanceof Hc||y instanceof Fd?this.locateInternal(u,y):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(u,y),this._boundaryRule.isInBoundary(this._numBoundaries)?ua.BOUNDARY:0<this._numBoundaries||this._isIn?ua.INTERIOR:ua.EXTERIOR)};de.prototype.interfaces_=function(){return[]};de.prototype.getClass=function(){return de};var Od=function(u,y){this._pts=u;
this._data=y};Od.prototype.getCoordinates=function(){return this._pts};Od.prototype.size=function(){return this._pts.length};Od.prototype.getCoordinate=function(u){return this._pts[u]};Od.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Od.prototype.getSegmentOctant=function(u){return u===this._pts.length-1?-1:uf.octant(this.getCoordinate(u),this.getCoordinate(u+1))};Od.prototype.setData=function(u){this._data=u};Od.prototype.getData=function(){return this._data};
Od.prototype.toString=function(){return qe.toLineString(new hc(this._pts))};Od.prototype.interfaces_=function(){return[$d]};Od.prototype.getClass=function(){return Od};var sc=function(u){this._isCheckEndSegmentsOnly=this._findAllIntersections=!1;this._intSegments=this._interiorIntersection=this._li=null;this._intersections=new Fa;this._intersectionCount=0;this._keepIntersections=!0;this._li=u;this._interiorIntersection=null};sc.prototype.getInteriorIntersection=function(){return this._interiorIntersection};
sc.prototype.setCheckEndSegmentsOnly=function(u){this._isCheckEndSegmentsOnly=u};sc.prototype.getIntersectionSegments=function(){return this._intSegments};sc.prototype.count=function(){return this._intersectionCount};sc.prototype.getIntersections=function(){return this._intersections};sc.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u};sc.prototype.setKeepIntersections=function(u){this._keepIntersections=u};sc.prototype.processIntersections=function(u,y,C,w){if(!this._findAllIntersections&&
this.hasIntersection()||u===C&&y===w||this._isCheckEndSegmentsOnly&&!this.isEndSegment(u,y)&&!this.isEndSegment(C,w))return null;var x=u.getCoordinates()[y];u=u.getCoordinates()[y+1];y=C.getCoordinates()[w];C=C.getCoordinates()[w+1];this._li.computeIntersection(x,u,y,C);this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=Array(4).fill(null),this._intSegments[0]=x,this._intSegments[1]=u,this._intSegments[2]=y,this._intSegments[3]=C,this._interiorIntersection=this._li.getIntersection(0),
this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};sc.prototype.isEndSegment=function(u,y){return 0===y||y>=u.size()-2};sc.prototype.hasIntersection=function(){return null!==this._interiorIntersection};sc.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection};sc.prototype.interfaces_=function(){return[$e]};sc.prototype.getClass=function(){return sc};sc.createAllIntersectionsFinder=function(u){u=new sc(u);
return u.setFindAllIntersections(!0),u};sc.createAnyIntersectionFinder=function(u){return new sc(u)};sc.createIntersectionCounter=function(u){u=new sc(u);return u.setFindAllIntersections(!0),u.setKeepIntersections(!1),u};var xd=function(u){this._li=new Te;this._findAllIntersections=!1;this._segInt=null;this._isValid=!0;this._segStrings=u};xd.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()};xd.prototype.getIntersections=function(){return this._segInt.getIntersections()};
xd.prototype.isValid=function(){return this.execute(),this._isValid};xd.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u};xd.prototype.checkInteriorIntersections=function(){this._isValid=!0;this._segInt=new sc(this._li);this._segInt.setFindAllIntersections(this._findAllIntersections);var u=new Nj;if(u.setSegmentIntersector(this._segInt),u.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};xd.prototype.checkValid=function(){if(this.execute(),
!this._isValid)throw new we(this.getErrorMessage(),this._segInt.getInteriorIntersection());};xd.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var u=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+qe.toLineString(u[0],u[1])+" and "+qe.toLineString(u[2],u[3])};xd.prototype.interfaces_=function(){return[]};xd.prototype.getClass=function(){return xd};xd.computeIntersections=function(u){u=new xd(u);return u.setFindAllIntersections(!0),
u.isValid(),u.getIntersections()};var bf=function C(y){this._nv=null;this._nv=new xd(C.toSegmentStrings(y))};bf.prototype.checkValid=function(){this._nv.checkValid()};bf.prototype.interfaces_=function(){return[]};bf.prototype.getClass=function(){return bf};bf.toSegmentStrings=function(y){var C=new Fa;for(y=y.iterator();y.hasNext();){var w=y.next();C.add(new Od(w.getCoordinates(),w))}return C};bf.checkValid=function(y){(new bf(y)).checkValid()};var yf=function(y){this._mapOp=y};yf.prototype.map=function(y){for(var C=
new Fa,w=0;w<y.getNumGeometries();w++){var x=this._mapOp.map(y.getGeometryN(w));x.isEmpty()||C.add(x)}return y.getFactory().createGeometryCollection(bb.toGeometryArray(C))};yf.prototype.interfaces_=function(){return[]};yf.prototype.getClass=function(){return yf};yf.map=function(y,C){return(new yf(C)).map(y)};var Pd=function(y,C,w){this._ptLocator=this._geometryFactory=this._op=null;this._lineEdgesList=new Fa;this._resultLineList=new Fa;this._op=y;this._geometryFactory=C;this._ptLocator=w};Pd.prototype.collectLines=
function(y){for(var C=this._op.getGraph().getEdgeEnds().iterator();C.hasNext();){var w=C.next();this.collectLineEdge(w,y,this._lineEdgesList);this.collectBoundaryTouchEdge(w,y,this._lineEdgesList)}};Pd.prototype.labelIsolatedLine=function(y,C){var w=this._ptLocator.locate(y.getCoordinate(),this._op.getArgGeometry(C));y.getLabel().setLocation(C,w)};Pd.prototype.build=function(y){return this.findCoveredLineEdges(),this.collectLines(y),this.buildLines(y),this._resultLineList};Pd.prototype.collectLineEdge=
function(y,C,w){var x=y.getLabel(),B=y.getEdge();y.isLineEdge()&&(y.isVisited()||!Za.isResultOfOp(x,C)||B.isCovered()||(w.add(B),y.setVisitedEdge(!0)))};Pd.prototype.findCoveredLineEdges=function(){for(var y=this._op.getGraph().getNodes().iterator();y.hasNext();)y.next().getEdges().findCoveredLineEdges();for(y=this._op.getGraph().getEdgeEnds().iterator();y.hasNext();){var C=y.next(),w=C.getEdge();C.isLineEdge()&&!w.isCoveredSet()&&(C=this._op.isCoveredByA(C.getCoordinate()),w.setCovered(C))}};Pd.prototype.labelIsolatedLines=
function(y){for(y=y.iterator();y.hasNext();){var C=y.next(),w=C.getLabel();C.isIsolated()&&(w.isNull(0)?this.labelIsolatedLine(C,0):this.labelIsolatedLine(C,1))}};Pd.prototype.buildLines=function(y){for(y=this._lineEdgesList.iterator();y.hasNext();){var C=y.next(),w=this._geometryFactory.createLineString(C.getCoordinates());this._resultLineList.add(w);C.setInResult(!0)}};Pd.prototype.collectBoundaryTouchEdge=function(y,C,w){var x=y.getLabel();return y.isLineEdge()||y.isVisited()||y.isInteriorAreaEdge()||
y.getEdge().isInResult()?null:(Xa.isTrue(!(y.isInResult()||y.getSym().isInResult())||!y.getEdge().isInResult()),void(Za.isResultOfOp(x,C)&&C===Za.INTERSECTION&&(w.add(y.getEdge()),y.setVisitedEdge(!0))))};Pd.prototype.interfaces_=function(){return[]};Pd.prototype.getClass=function(){return Pd};var zf=function(y,C){this._geometryFactory=this._op=null;this._resultPointList=new Fa;this._op=y;this._geometryFactory=C};zf.prototype.filterCoveredNodeToPoint=function(y){y=y.getCoordinate();this._op.isCoveredByLA(y)||
(y=this._geometryFactory.createPoint(y),this._resultPointList.add(y))};zf.prototype.extractNonCoveredResultNodes=function(y){for(var C=this._op.getGraph().getNodes().iterator();C.hasNext();){var w=C.next();if(!(w.isInResult()||w.isIncidentEdgeInResult()||0!==w.getEdges().getDegree()&&y!==Za.INTERSECTION)){var x=w.getLabel();Za.isResultOfOp(x,y)&&this.filterCoveredNodeToPoint(w)}}};zf.prototype.build=function(y){return this.extractNonCoveredResultNodes(y),this._resultPointList};zf.prototype.interfaces_=
function(){return[]};zf.prototype.getClass=function(){return zf};var Sc=function(){this._factory=this._inputGeom=null;this._preserveGeometryCollectionType=this._pruneEmptyGeometry=!0;this._preserveType=this._preserveCollections=!1};Sc.prototype.transformPoint=function(y,C){return this._factory.createPoint(this.transformCoordinates(y.getCoordinateSequence(),y))};Sc.prototype.transformPolygon=function(y,C){var w=!0;C=this.transformLinearRing(y.getExteriorRing(),y);null!==C&&C instanceof Yd&&!C.isEmpty()||
(w=!1);for(var x=new Fa,B=0;B<y.getNumInteriorRing();B++){var E=this.transformLinearRing(y.getInteriorRingN(B),y);null===E||E.isEmpty()||(E instanceof Yd||(w=!1),x.add(E))}if(w)return this._factory.createPolygon(C,x.toArray([]));y=new Fa;return null!==C&&y.add(C),y.addAll(x),this._factory.buildGeometry(y)};Sc.prototype.createCoordinateSequence=function(y){return this._factory.getCoordinateSequenceFactory().create(y)};Sc.prototype.getInputGeometry=function(){return this._inputGeom};Sc.prototype.transformMultiLineString=
function(y,C){C=new Fa;for(var w=0;w<y.getNumGeometries();w++){var x=this.transformLineString(y.getGeometryN(w),y);null!==x&&(x.isEmpty()||C.add(x))}return this._factory.buildGeometry(C)};Sc.prototype.transformCoordinates=function(y,C){return this.copy(y)};Sc.prototype.transformLineString=function(y,C){return this._factory.createLineString(this.transformCoordinates(y.getCoordinateSequence(),y))};Sc.prototype.transformMultiPoint=function(y,C){C=new Fa;for(var w=0;w<y.getNumGeometries();w++){var x=
this.transformPoint(y.getGeometryN(w),y);null!==x&&(x.isEmpty()||C.add(x))}return this._factory.buildGeometry(C)};Sc.prototype.transformMultiPolygon=function(y,C){C=new Fa;for(var w=0;w<y.getNumGeometries();w++){var x=this.transformPolygon(y.getGeometryN(w),y);null!==x&&(x.isEmpty()||C.add(x))}return this._factory.buildGeometry(C)};Sc.prototype.copy=function(y){return y.copy()};Sc.prototype.transformGeometryCollection=function(y,C){C=new Fa;for(var w=0;w<y.getNumGeometries();w++){var x=this.transform(y.getGeometryN(w));
null!==x&&(this._pruneEmptyGeometry&&x.isEmpty()||C.add(x))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(bb.toGeometryArray(C)):this._factory.buildGeometry(C)};Sc.prototype.transform=function(y){if(this._inputGeom=y,this._factory=y.getFactory(),y instanceof Xd)return this.transformPoint(y,null);if(y instanceof ag)return this.transformMultiPoint(y,null);if(y instanceof Yd)return this.transformLinearRing(y,null);if(y instanceof Hc)return this.transformLineString(y,
null);if(y instanceof We)return this.transformMultiLineString(y,null);if(y instanceof Fd)return this.transformPolygon(y,null);if(y instanceof Fe)return this.transformMultiPolygon(y,null);if(y instanceof ud)return this.transformGeometryCollection(y,null);throw new ac("Unknown Geometry subtype: "+y.getClass().getName());};Sc.prototype.transformLinearRing=function(y,C){y=this.transformCoordinates(y.getCoordinateSequence(),y);if(null===y)return this._factory.createLinearRing(null);C=y.size();return 0<
C&&4>C&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)};Sc.prototype.interfaces_=function(){return[]};Sc.prototype.getClass=function(){return Sc};var ee=function x(C,w){(this._snapTolerance=0,this._srcPts=null,this._seg=new Na,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,C instanceof Hc&&"number"==typeof w)?x.call(this,C.getCoordinates(),w):C instanceof Array&&"number"==typeof w&&(this._srcPts=C,this._isClosed=x.isClosed(C),this._snapTolerance=
w)};ee.prototype.snapVertices=function(C,w){for(var x=this._isClosed?C.size()-1:C.size(),B=0;B<x;B++){var E=C.get(B);E=this.findSnapForVertex(E,w);null!==E&&(C.set(B,new sa(E)),0===B&&this._isClosed&&C.set(C.size()-1,new sa(E)))}};ee.prototype.findSnapForVertex=function(C,w){for(var x=0;x<w.length&&!C.equals2D(w[x]);x++)if(C.distance(w[x])<this._snapTolerance)return w[x];return null};ee.prototype.snapTo=function(C){var w=new Tg(this._srcPts);return this.snapVertices(w,C),this.snapSegments(w,C),w.toCoordinateArray()};
ee.prototype.snapSegments=function(C,w){if(0===w.length)return null;var x=w.length;w[0].equals2D(w[w.length-1])&&(x=w.length-1);for(var B=0;B<x;B++){var E=w[B],H=this.findSegmentIndexToSnap(E,C);0<=H&&C.add(H+1,new sa(E),!1)}};ee.prototype.findSegmentIndexToSnap=function(C,w){for(var x=Wa.MAX_VALUE,B=-1,E=0;E<w.size()-1;E++){if(this._seg.p0=w.get(E),this._seg.p1=w.get(E+1),this._seg.p0.equals2D(C)||this._seg.p1.equals2D(C)){if(this._allowSnappingToSourceVertices)continue;return-1}var H=this._seg.distance(C);
H<this._snapTolerance&&H<x&&(x=H,B=E)}return B};ee.prototype.setAllowSnappingToSourceVertices=function(C){this._allowSnappingToSourceVertices=C};ee.prototype.interfaces_=function(){return[]};ee.prototype.getClass=function(){return ee};ee.isClosed=function(C){return!(1>=C.length)&&C[0].equals2D(C[C.length-1])};var pc=function(C){this._srcGeom=C||null},zn={SNAP_PRECISION_FACTOR:{configurable:!0}};pc.prototype.snapTo=function(C,w){C=this.extractTargetCoordinates(C);return(new An(w,C)).transform(this._srcGeom)};
pc.prototype.snapToSelf=function(C,w){var x=this.extractTargetCoordinates(this._srcGeom);x=C=(new An(C,x,!0)).transform(this._srcGeom);return w&&Va(x,Xe)&&(x=C.buffer(0)),x};pc.prototype.computeSnapTolerance=function(C){return this.computeMinimumSegmentLength(C)/10};pc.prototype.extractTargetCoordinates=function(C){var w=new zd;C=C.getCoordinates();for(var x=0;x<C.length;x++)w.add(C[x]);return w.toArray([].fill(null))};pc.prototype.computeMinimumSegmentLength=function(C){for(var w=Wa.MAX_VALUE,x=
0;x<C.length-1;x++){var B=C[x].distance(C[x+1]);B<w&&(w=B)}return w};pc.prototype.interfaces_=function(){return[]};pc.prototype.getClass=function(){return pc};pc.snap=function(C,w,x){var B=Array(2).fill(null);C=new pc(C);B[0]=C.snapTo(w,x);w=new pc(w);return B[1]=w.snapTo(B[0],x),B};pc.computeOverlaySnapTolerance=function(){if(1===arguments.length){var C=arguments[0],w=pc.computeSizeBasedSnapTolerance(C);C=C.getPrecisionModel();C.getType()===Fb.FIXED&&(C=1/C.getScale()*2/1.415,C>w&&(w=C));return w}if(2===
arguments.length)return w=arguments[1],Math.min(pc.computeOverlaySnapTolerance(arguments[0]),pc.computeOverlaySnapTolerance(w))};pc.computeSizeBasedSnapTolerance=function(C){C=C.getEnvelopeInternal();return Math.min(C.getHeight(),C.getWidth())*pc.SNAP_PRECISION_FACTOR};pc.snapToSelf=function(C,w,x){return(new pc(C)).snapToSelf(w,x)};zn.SNAP_PRECISION_FACTOR.get=function(){return 1E-9};Object.defineProperties(pc,zn);var An=function(C){function w(x,B,E){C.call(this);this._snapTolerance=x||null;this._snapPts=
B||null;this._isSelfSnap=void 0!==E&&E}return C&&(w.__proto__=C),w.prototype=Object.create(C&&C.prototype),w.prototype.constructor=w,w.prototype.snapLine=function(x,B){x=new ee(x,this._snapTolerance);return x.setAllowSnappingToSourceVertices(this._isSelfSnap),x.snapTo(B)},w.prototype.transformCoordinates=function(x,B){x=x.toCoordinateArray();x=this.snapLine(x,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(x)},w.prototype.interfaces_=function(){return[]},w.prototype.getClass=
function(){return w},w}(Sc),Lc=function(){this._isFirst=!0;this._commonMantissaBitsCount=53;this._commonBits=0;this._commonSignExp=null};Lc.prototype.getCommon=function(){return Wa.longBitsToDouble(this._commonBits)};Lc.prototype.add=function(C){C=Wa.doubleToLongBits(C);return this._isFirst?(this._commonBits=C,this._commonSignExp=Lc.signExpBits(this._commonBits),this._isFirst=!1,null):Lc.signExpBits(C)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Lc.numCommonMostSigMantissaBits(this._commonBits,
C),void(this._commonBits=Lc.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))};Lc.prototype.toString=function(){if(1===arguments.length){var C=arguments[0],w=Wa.longBitsToDouble(C);C="0000000000000000000000000000000000000000000000000000000000000000"+Wa.toBinaryString(C);C=C.substring(C.length-64);return C.substring(0,1)+"  "+C.substring(1,12)+"(exp) "+C.substring(12)+" [ "+w+" ]"}};Lc.prototype.interfaces_=function(){return[]};Lc.prototype.getClass=function(){return Lc};Lc.getBit=
function(C,w){return 0!=(C&1<<w)?1:0};Lc.signExpBits=function(C){return C>>52};Lc.zeroLowerBits=function(C,w){return C&~((1<<w)-1)};Lc.numCommonMostSigMantissaBits=function(C,w){for(var x=0,B=52;0<=B;B--){if(Lc.getBit(C,B)!==Lc.getBit(w,B))return x;x++}return 52};var Ke=function(){this._commonCoord=null;this._ccFilter=new Af},Oj={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Ke.prototype.addCommonBits=function(C){var w=new Le(this._commonCoord);C.apply(w);C.geometryChanged()};
Ke.prototype.removeCommonBits=function(C){if(0===this._commonCoord.x&&0===this._commonCoord.y)return C;var w=new sa(this._commonCoord);w.x=-w.x;w.y=-w.y;w=new Le(w);return C.apply(w),C.geometryChanged(),C};Ke.prototype.getCommonCoordinate=function(){return this._commonCoord};Ke.prototype.add=function(C){C.apply(this._ccFilter);this._commonCoord=this._ccFilter.getCommonCoordinate()};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};Oj.CommonCoordinateFilter.get=
function(){return Af};Oj.Translater.get=function(){return Le};Object.defineProperties(Ke,Oj);var Af=function(){this._commonBitsX=new Lc;this._commonBitsY=new Lc};Af.prototype.filter=function(C){this._commonBitsX.add(C.x);this._commonBitsY.add(C.y)};Af.prototype.getCommonCoordinate=function(){return new sa(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};Af.prototype.interfaces_=function(){return[Ee]};Af.prototype.getClass=function(){return Af};var Le=function(C){this.trans=C};Le.prototype.filter=
function(C,w){var x=C.getOrdinate(w,0)+this.trans.x,B=C.getOrdinate(w,1)+this.trans.y;C.setOrdinate(w,0,x);C.setOrdinate(w,1,B)};Le.prototype.isDone=function(){return!1};Le.prototype.isGeometryChanged=function(){return!0};Le.prototype.interfaces_=function(){return[Wd]};Le.prototype.getClass=function(){return Le};var tc=function(C,w){this._geom=Array(2).fill(null);this._cbr=this._snapTolerance=null;this._geom[0]=C;this._geom[1]=w;this.computeSnapTolerance()};tc.prototype.selfSnap=function(C){return(new pc(C)).snapTo(C,
this._snapTolerance)};tc.prototype.removeCommonBits=function(C){this._cbr=new Ke;this._cbr.add(C[0]);this._cbr.add(C[1]);var w=Array(2).fill(null);return w[0]=this._cbr.removeCommonBits(C[0].copy()),w[1]=this._cbr.removeCommonBits(C[1].copy()),w};tc.prototype.prepareResult=function(C){return this._cbr.addCommonBits(C),C};tc.prototype.getResultGeometry=function(C){var w=this.snap(this._geom);C=Za.overlayOp(w[0],w[1],C);return this.prepareResult(C)};tc.prototype.checkValid=function(C){C.isValid()||
Oc.out.println("Snapped geometry is invalid")};tc.prototype.computeSnapTolerance=function(){this._snapTolerance=pc.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};tc.prototype.snap=function(C){C=this.removeCommonBits(C);return pc.snap(C[0],C[1],this._snapTolerance)};tc.prototype.interfaces_=function(){return[]};tc.prototype.getClass=function(){return tc};tc.overlayOp=function(C,w,x){return(new tc(C,w)).getResultGeometry(x)};tc.union=function(C,w){return tc.overlayOp(C,w,Za.UNION)};tc.intersection=
function(C,w){return tc.overlayOp(C,w,Za.INTERSECTION)};tc.symDifference=function(C,w){return tc.overlayOp(C,w,Za.SYMDIFFERENCE)};tc.difference=function(C,w){return tc.overlayOp(C,w,Za.DIFFERENCE)};var Tc=function(C,w){this._geom=Array(2).fill(null);this._geom[0]=C;this._geom[1]=w};Tc.prototype.getResultGeometry=function(C){var w=null,x=!1,B=null;try{w=Za.overlayOp(this._geom[0],this._geom[1],C),x=!0}catch(E){if(!(E instanceof re))throw E;B=E}if(!x)try{w=tc.overlayOp(this._geom[0],this._geom[1],C)}catch(E){throw E instanceof
re?B:E;}return w};Tc.prototype.interfaces_=function(){return[]};Tc.prototype.getClass=function(){return Tc};Tc.overlayOp=function(C,w,x){return(new Tc(C,w)).getResultGeometry(x)};Tc.union=function(C,w){return Tc.overlayOp(C,w,Za.UNION)};Tc.intersection=function(C,w){return Tc.overlayOp(C,w,Za.INTERSECTION)};Tc.symDifference=function(C,w){return Tc.overlayOp(C,w,Za.SYMDIFFERENCE)};Tc.difference=function(C,w){return Tc.overlayOp(C,w,Za.DIFFERENCE)};var gh=function(C,w){this.mce=C;this.chainIndex=w};
gh.prototype.computeIntersections=function(C,w){this.mce.computeIntersectsForChain(this.chainIndex,C.mce,C.chainIndex,w)};gh.prototype.interfaces_=function(){return[]};gh.prototype.getClass=function(){return gh};var ad=function w(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var x=arguments[0],B=arguments[1];this._eventType=w.DELETE;this._xValue=x;this._insertEvent=B}else if(3===arguments.length){x=
arguments[0];B=arguments[1];var E=arguments[2];this._eventType=w.INSERT;this._label=x;this._xValue=B;this._obj=E}},Pj={INSERT:{configurable:!0},DELETE:{configurable:!0}};ad.prototype.isDelete=function(){return this._eventType===ad.DELETE};ad.prototype.setDeleteEventIndex=function(w){this._deleteEventIndex=w};ad.prototype.getObject=function(){return this._obj};ad.prototype.compareTo=function(w){return this._xValue<w._xValue?-1:this._xValue>w._xValue?1:this._eventType<w._eventType?-1:this._eventType>
w._eventType?1:0};ad.prototype.getInsertEvent=function(){return this._insertEvent};ad.prototype.isInsert=function(){return this._eventType===ad.INSERT};ad.prototype.isSameLabel=function(w){return null!==this._label&&this._label===w._label};ad.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ad.prototype.interfaces_=function(){return[jd]};ad.prototype.getClass=function(){return ad};Pj.INSERT.get=function(){return 1};Pj.DELETE.get=function(){return 2};Object.defineProperties(ad,
Pj);var ki=function(){};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};var zc=function(w,x,B){this._hasProperInterior=this._hasProper=this._hasIntersection=!1;this._isSelfIntersection=this._properIntersectionPoint=null;this.numTests=this._numIntersections=0;this._bdyNodes=null;this._isDoneWhenProperInt=this._isDone=!1;this._li=w;this._includeProper=x;this._recordIsolated=B};zc.prototype.isTrivialIntersection=function(w,x,B,E){return w===B&&1===this._li.getIntersectionNum()&&
(zc.isAdjacentSegments(x,E)||w.isClosed()&&(w=w.getNumPoints()-1,0===x&&E===w||0===E&&x===w))?!0:!1};zc.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};zc.prototype.setIsDoneIfProperInt=function(w){this._isDoneWhenProperInt=w};zc.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};zc.prototype.isBoundaryPointInternal=function(w,x){for(x=x.iterator();x.hasNext();){var B=x.next().getCoordinate();if(w.isIntersection(B))return!0}return!1};
zc.prototype.hasProperIntersection=function(){return this._hasProper};zc.prototype.hasIntersection=function(){return this._hasIntersection};zc.prototype.isDone=function(){return this._isDone};zc.prototype.isBoundaryPoint=function(w,x){return null!==x&&(!!this.isBoundaryPointInternal(w,x[0])||!!this.isBoundaryPointInternal(w,x[1]))};zc.prototype.setBoundaryNodes=function(w,x){this._bdyNodes=Array(2).fill(null);this._bdyNodes[0]=w;this._bdyNodes[1]=x};zc.prototype.addIntersections=function(w,x,B,E){if(w===
B&&x===E)return null;this.numTests++;var H=w.getCoordinates()[x],P=w.getCoordinates()[x+1],T=B.getCoordinates()[E],W=B.getCoordinates()[E+1];this._li.computeIntersection(H,P,T,W);this._li.hasIntersection()&&(this._recordIsolated&&(w.setIsolated(!1),B.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(w,x,B,E)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(w.addIntersections(this._li,x,0),B.addIntersections(this._li,E,1)),this._li.isProper()&&(this._properIntersectionPoint=
this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};zc.prototype.interfaces_=function(){return[]};zc.prototype.getClass=function(){return zc};zc.isAdjacentSegments=function(w,x){return 1===Math.abs(w-x)};var Gp=function(w){function x(){w.call(this);this.events=new Fa;this.nOverlaps=null}return w&&(x.__proto__=w),x.prototype=Object.create(w&&w.prototype),x.prototype.constructor=
x,x.prototype.prepareEvents=function(){Kd.sort(this.events);for(var B=0;B<this.events.size();B++){var E=this.events.get(B);E.isDelete()&&E.getInsertEvent().setDeleteEventIndex(B)}},x.prototype.computeIntersections=function(){if(1===arguments.length){var B=arguments[0];this.nOverlaps=0;this.prepareEvents();for(var E=0;E<this.events.size();E++){var H=this.events.get(E);if(H.isInsert()&&this.processOverlaps(E,H.getDeleteEventIndex(),H,B),B.isDone())break}}else 3===arguments.length&&(arguments[2]instanceof
zc&&Va(arguments[0],ue)&&Va(arguments[1],ue)?(B=arguments[0],E=arguments[1],H=arguments[2],this.addEdges(B,B),this.addEdges(E,E),this.computeIntersections(H)):"boolean"==typeof arguments[2]&&Va(arguments[0],ue)&&arguments[1]instanceof zc&&(B=arguments[0],E=arguments[1],arguments[2]?this.addEdges(B,null):this.addEdges(B),this.computeIntersections(E)))},x.prototype.addEdge=function(B,E){B=B.getMonotoneChainEdge();for(var H=B.getStartIndexes(),P=0;P<H.length-1;P++){var T=new gh(B,P);T=new ad(E,B.getMinX(P),
T);this.events.add(T);this.events.add(new ad(B.getMaxX(P),T))}},x.prototype.processOverlaps=function(B,E,H,P){for(var T=H.getObject();B<E;B++){var W=this.events.get(B);if(W.isInsert()){var aa=W.getObject();H.isSameLabel(W)||(T.computeIntersections(aa,P),this.nOverlaps++)}}},x.prototype.addEdges=function(){if(1===arguments.length)for(var B=arguments[0].iterator();B.hasNext();){var E=B.next();this.addEdge(E,E)}else if(2===arguments.length)for(B=arguments[1],E=arguments[0].iterator();E.hasNext();){var H=
E.next();this.addEdge(H,B)}},x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x}(ki),fe=function(){this._min=Wa.POSITIVE_INFINITY;this._max=Wa.NEGATIVE_INFINITY},Bn={NodeComparator:{configurable:!0}};fe.prototype.getMin=function(){return this._min};fe.prototype.intersects=function(w,x){return!(this._min>x||this._max<w)};fe.prototype.getMax=function(){return this._max};fe.prototype.toString=function(){return qe.toLineString(new sa(this._min,0),new sa(this._max,
0))};fe.prototype.interfaces_=function(){return[]};fe.prototype.getClass=function(){return fe};Bn.NodeComparator.get=function(){return hh};Object.defineProperties(fe,Bn);var hh=function(){};hh.prototype.compare=function(w,x){w=(w._min+w._max)/2;x=(x._min+x._max)/2;return w<x?-1:w>x?1:0};hh.prototype.interfaces_=function(){return[Rf]};hh.prototype.getClass=function(){return hh};var Hp=function(w){function x(B,E,H){w.call(this);this._min=B;this._max=E;this._item=H}return w&&(x.__proto__=w),x.prototype=
Object.create(w&&w.prototype),x.prototype.constructor=x,x.prototype.query=function(B,E,H){if(!this.intersects(B,E))return null;H.visitItem(this._item)},x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x}(fe),Ip=function(w){function x(B,E){w.call(this);this._node1=B;this._node2=E;this.buildExtent(this._node1,this._node2)}return w&&(x.__proto__=w),x.prototype=Object.create(w&&w.prototype),x.prototype.constructor=x,x.prototype.buildExtent=function(B,E){this._min=
Math.min(B._min,E._min);this._max=Math.max(B._max,E._max)},x.prototype.query=function(B,E,H){if(!this.intersects(B,E))return null;null!==this._node1&&this._node1.query(B,E,H);null!==this._node2&&this._node2.query(B,E,H)},x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x}(fe),ge=function(){this._leaves=new Fa;this._root=null;this._level=0};ge.prototype.buildTree=function(){Kd.sort(this._leaves,new fe.NodeComparator);for(var w=this._leaves,x,B=new Fa;;){if(this.buildLevel(w,
B),1===B.size())return B.get(0);x=w;w=B;B=x}};ge.prototype.insert=function(w,x,B){if(null!==this._root)throw Error("Index cannot be added to once it has been queried");this._leaves.add(new Hp(w,x,B))};ge.prototype.query=function(w,x,B){this.init();this._root.query(w,x,B)};ge.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()};ge.prototype.printNode=function(w){Oc.out.println(qe.toLineString(new sa(w._min,this._level),new sa(w._max,this._level)))};ge.prototype.init=
function(){if(null!==this._root)return null;this.buildRoot()};ge.prototype.buildLevel=function(w,x){this._level++;x.clear();for(var B=0;B<w.size();B+=2){var E=w.get(B);null===(B+1<w.size()?w.get(B):null)?x.add(E):(E=new Ip(w.get(B),w.get(B+1)),x.add(E))}};ge.prototype.interfaces_=function(){return[]};ge.prototype.getClass=function(){return ge};var hg=function(){this._items=new Fa};hg.prototype.visitItem=function(w){this._items.add(w)};hg.prototype.getItems=function(){return this._items};hg.prototype.interfaces_=
function(){return[Ge]};hg.prototype.getClass=function(){return hg};var ig=function(w){this._index=null;if(!Va(w,Xe))throw new ac("Argument must be Polygonal");this._index=new cf(w)},Qj={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};ig.prototype.locate=function(w){var x=new Ed(w),B=new jg(x);return this._index.query(w.y,w.y,B),x.getLocation()};ig.prototype.interfaces_=function(){return[eg]};ig.prototype.getClass=function(){return ig};Qj.SegmentVisitor.get=function(){return jg};
Qj.IntervalIndexedGeometry.get=function(){return cf};Object.defineProperties(ig,Qj);var jg=function(w){this._counter=w};jg.prototype.visitItem=function(w){this._counter.countSegment(w.getCoordinate(0),w.getCoordinate(1))};jg.prototype.interfaces_=function(){return[Ge]};jg.prototype.getClass=function(){return jg};var cf=function(w){this._index=new ge;this.init(w)};cf.prototype.init=function(w){for(w=$c.getLines(w).iterator();w.hasNext();){var x=w.next().getCoordinates();this.addLine(x)}};cf.prototype.addLine=
function(w){for(var x=1;x<w.length;x++){var B=new Na(w[x-1],w[x]);this._index.insert(Math.min(B.p0.y,B.p1.y),Math.max(B.p0.y,B.p1.y),B)}};cf.prototype.query=function(){if(2===arguments.length){var w=arguments[0],x=arguments[1],B=new hg;return this._index.query(w,x,B),B.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])};cf.prototype.interfaces_=function(){return[]};cf.prototype.getClass=function(){return cf};var ih=function(w){function x(){if(w.call(this),this._parentGeom=
null,this._lineEdgeMap=new ln,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new de,2===arguments.length){var B=arguments[1],E=kd.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0];this._parentGeom=B;this._boundaryNodeRule=E;null!==B&&this.add(B)}else 3===arguments.length&&(B=arguments[1],E=arguments[2],this._argIndex=arguments[0],this._parentGeom=
B,this._boundaryNodeRule=E,null!==B&&this.add(B))}return w&&(x.__proto__=w),x.prototype=Object.create(w&&w.prototype),x.prototype.constructor=x,x.prototype.insertBoundaryPoint=function(B,E){E=this._nodes.addNode(E).getLabel();var H=1;E.getLocation(B,Aa.ON)===ua.BOUNDARY&&H++;H=x.determineBoundary(this._boundaryNodeRule,H);E.setLocation(B,H)},x.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var B=arguments[1],
E=arguments[2],H=new zc(arguments[0],!0,!1);H.setIsDoneIfProperInt(E);E=this.createEdgeSetIntersector();var P=this._parentGeom instanceof Yd||this._parentGeom instanceof Fd||this._parentGeom instanceof Fe;return E.computeIntersections(this._edges,H,B||!P),this.addSelfIntersectionNodes(this._argIndex),H}},x.prototype.computeSplitEdges=function(B){for(var E=this._edges.iterator();E.hasNext();)E.next().eiList.addSplitEdges(B)},x.prototype.computeEdgeIntersections=function(B,E,H){E=new zc(E,H,!0);return E.setBoundaryNodes(this.getBoundaryNodes(),
B.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,B._edges,E),E},x.prototype.getGeometry=function(){return this._parentGeom},x.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},x.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},x.prototype.addPoint=function(B){B instanceof Xd?(B=B.getCoordinate(),this.insertPoint(this._argIndex,B,ua.INTERIOR)):B instanceof sa&&this.insertPoint(this._argIndex,B,ua.INTERIOR)},x.prototype.addPolygon=
function(B){this.addPolygonRing(B.getExteriorRing(),ua.EXTERIOR,ua.INTERIOR);for(var E=0;E<B.getNumInteriorRing();E++){var H=B.getInteriorRingN(E);this.addPolygonRing(H,ua.INTERIOR,ua.EXTERIOR)}},x.prototype.addEdge=function(B){this.insertEdge(B);B=B.getCoordinates();this.insertPoint(this._argIndex,B[0],ua.BOUNDARY);this.insertPoint(this._argIndex,B[B.length-1],ua.BOUNDARY)},x.prototype.addLineString=function(B){var E=ab.removeRepeatedPoints(B.getCoordinates());if(2>E.length)return this._hasTooFewPoints=
!0,this._invalidPoint=E[0],null;var H=new ji(E,new Jb(this._argIndex,ua.INTERIOR));this._lineEdgeMap.put(B,H);this.insertEdge(H);Xa.isTrue(2<=E.length,"found LineString with single point");this.insertBoundaryPoint(this._argIndex,E[0]);this.insertBoundaryPoint(this._argIndex,E[E.length-1])},x.prototype.getInvalidPoint=function(){return this._invalidPoint},x.prototype.getBoundaryPoints=function(){var B=this.getBoundaryNodes(),E=Array(B.size()).fill(null),H=0;for(B=B.iterator();B.hasNext();){var P=B.next();
E[H++]=P.getCoordinate().copy()}return E},x.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},x.prototype.addSelfIntersectionNode=function(B,E,H){if(this.isBoundaryNode(B,E))return null;H===ua.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(B,E):this.insertPoint(B,E,H)},x.prototype.addPolygonRing=function(B,E,H){if(B.isEmpty())return null;var P=ab.removeRepeatedPoints(B.getCoordinates());
if(4>P.length)return this._hasTooFewPoints=!0,this._invalidPoint=P[0],null;var T=E,W=H;Da.isCCW(P)&&(T=H,W=E);E=new ji(P,new Jb(this._argIndex,ua.BOUNDARY,T,W));this._lineEdgeMap.put(B,E);this.insertEdge(E);this.insertPoint(this._argIndex,P[0],ua.BOUNDARY)},x.prototype.insertPoint=function(B,E,H){E=this._nodes.addNode(E);var P=E.getLabel();null===P?E._label=new Jb(B,H):P.setLocation(B,H)},x.prototype.createEdgeSetIntersector=function(){return new Gp},x.prototype.addSelfIntersectionNodes=function(B){for(var E=
this._edges.iterator();E.hasNext();){var H=E.next(),P=H.getLabel().getLocation(B);for(H=H.eiList.iterator();H.hasNext();){var T=H.next();this.addSelfIntersectionNode(B,T.coord,P)}}},x.prototype.add=function(){if(1!==arguments.length)return w.prototype.add.apply(this,arguments);var B=arguments[0];if(B.isEmpty())return null;if(B instanceof Fe&&(this._useBoundaryDeterminationRule=!1),B instanceof Fd)this.addPolygon(B);else if(B instanceof Hc)this.addLineString(B);else if(B instanceof Xd)this.addPoint(B);
else{if(!(B instanceof ag||B instanceof We||B instanceof Fe||B instanceof ud))throw Error(B.getClass().getName());this.addCollection(B)}},x.prototype.addCollection=function(B){for(var E=0;E<B.getNumGeometries();E++){var H=B.getGeometryN(E);this.add(H)}},x.prototype.locate=function(B){return Va(this._parentGeom,Xe)&&50<this._parentGeom.getNumGeometries()?(null===this._areaPtLocator&&(this._areaPtLocator=new ig(this._parentGeom)),this._areaPtLocator.locate(B)):this._ptLocator.locate(B,this._parentGeom)},
x.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):w.prototype.findEdge.apply(this,arguments)},x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x.determineBoundary=function(B,E){return B.isInBoundary(E)?ua.BOUNDARY:ua.INTERIOR},x}(Yb),kg=function(){if(this._li=new Te,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var w=arguments[0];this.setComputationPrecision(w.getPrecisionModel());this._arg=
Array(1).fill(null);this._arg[0]=new ih(0,w)}else if(2===arguments.length){w=arguments[0];var x=arguments[1],B=kd.OGC_SFS_BOUNDARY_RULE;0<=w.getPrecisionModel().compareTo(x.getPrecisionModel())?this.setComputationPrecision(w.getPrecisionModel()):this.setComputationPrecision(x.getPrecisionModel());this._arg=Array(2).fill(null);this._arg[0]=new ih(0,w,B);this._arg[1]=new ih(1,x,B)}else 3===arguments.length&&(w=arguments[0],x=arguments[1],B=arguments[2],0<=w.getPrecisionModel().compareTo(x.getPrecisionModel())?
this.setComputationPrecision(w.getPrecisionModel()):this.setComputationPrecision(x.getPrecisionModel()),this._arg=Array(2).fill(null),this._arg[0]=new ih(0,w,B),this._arg[1]=new ih(1,x,B))};kg.prototype.getArgGeometry=function(w){return this._arg[w].getGeometry()};kg.prototype.setComputationPrecision=function(w){this._resultPrecisionModel=w;this._li.setPrecisionModel(this._resultPrecisionModel)};kg.prototype.interfaces_=function(){return[]};kg.prototype.getClass=function(){return kg};var df=function(){};
df.prototype.interfaces_=function(){return[]};df.prototype.getClass=function(){return df};df.map=function(w,x){if(w instanceof Ra&&Va(x,df.MapOp)){for(var B=new Fa,E=0;E<w.getNumGeometries();E++){var H=x.map(w.getGeometryN(E));null!==H&&B.add(H)}return w.getFactory().buildGeometry(B)}if(Va(w,kc)&&Va(x,df.MapOp)){B=new Fa;for(w=w.iterator();w.hasNext();)E=w.next(),E=x.map(E),null!==E&&B.add(E);return B}};df.MapOp=function(){};var Za=function(w){function x(B,E){w.call(this,B,E);this._ptLocator=new de;
this._graph=this._resultGeom=this._geomFact=null;this._edgeList=new wd;this._resultPolyList=new Fa;this._resultLineList=new Fa;this._resultPointList=new Fa;this._graph=new Yb(new tn);this._geomFact=B.getFactory()}return w&&(x.__proto__=w),x.prototype=Object.create(w&&w.prototype),x.prototype.constructor=x,x.prototype.insertUniqueEdge=function(B){var E=this._edgeList.findEqualEdge(B);if(null!==E){var H=E.getLabel(),P=B.getLabel();E.isPointwiseEqual(B)||(P=new Jb(B.getLabel())).flip();B=E.getDepth();
B.isNull()&&B.add(H);B.add(P);H.merge(P)}else this._edgeList.add(B)},x.prototype.getGraph=function(){return this._graph},x.prototype.cancelDuplicateResultEdges=function(){for(var B=this._graph.getEdgeEnds().iterator();B.hasNext();){var E=B.next(),H=E.getSym();E.isInResult()&&H.isInResult()&&(E.setInResult(!1),H.setInResult(!1))}},x.prototype.isCoveredByLA=function(B){return!!this.isCovered(B,this._resultLineList)||!!this.isCovered(B,this._resultPolyList)},x.prototype.computeGeometry=function(B,E,
H,P){var T=new Fa;return T.addAll(B),T.addAll(E),T.addAll(H),T.isEmpty()?x.createEmptyResult(P,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(T)},x.prototype.mergeSymLabels=function(){for(var B=this._graph.getNodes().iterator();B.hasNext();)B.next().getEdges().mergeSymLabels()},x.prototype.isCovered=function(B,E){for(E=E.iterator();E.hasNext();){var H=E.next();if(this._ptLocator.locate(B,H)!==ua.EXTERIOR)return!0}return!1},x.prototype.replaceCollapsedEdges=
function(){for(var B=new Fa,E=this._edgeList.iterator();E.hasNext();){var H=E.next();H.isCollapsed()&&(E.remove(),B.add(H.getCollapsedEdge()))}this._edgeList.addAll(B)},x.prototype.updateNodeLabelling=function(){for(var B=this._graph.getNodes().iterator();B.hasNext();){var E=B.next(),H=E.getEdges().getLabel();E.getLabel().merge(H)}},x.prototype.getResultGeometry=function(B){return this.computeOverlay(B),this._resultGeom},x.prototype.insertUniqueEdges=function(B){for(B=B.iterator();B.hasNext();){var E=
B.next();this.insertUniqueEdge(E)}},x.prototype.computeOverlay=function(B){this.copyPoints(0);this.copyPoints(1);this._arg[0].computeSelfNodes(this._li,!1);this._arg[1].computeSelfNodes(this._li,!1);this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var E=new Fa;this._arg[0].computeSplitEdges(E);this._arg[1].computeSplitEdges(E);this.insertUniqueEdges(E);this.computeLabelsFromDepths();this.replaceCollapsedEdges();bf.checkValid(this._edgeList.getEdges());this._graph.addEdges(this._edgeList.getEdges());
this.computeLabelling();this.labelIncompleteNodes();this.findResultAreaEdges(B);this.cancelDuplicateResultEdges();E=new Yc(this._geomFact);E.add(this._graph);this._resultPolyList=E.getPolygons();this._resultLineList=(new Pd(this,this._geomFact,this._ptLocator)).build(B);this._resultPointList=(new zf(this,this._geomFact,this._ptLocator)).build(B);this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,B)},x.prototype.labelIncompleteNode=function(B,E){var H=
this._ptLocator.locate(B.getCoordinate(),this._arg[E].getGeometry());B.getLabel().setLocation(E,H)},x.prototype.copyPoints=function(B){for(var E=this._arg[B].getNodeIterator();E.hasNext();){var H=E.next();this._graph.addNode(H.getCoordinate()).setLabel(B,H.getLabel().getLocation(B))}},x.prototype.findResultAreaEdges=function(B){for(var E=this._graph.getEdgeEnds().iterator();E.hasNext();){var H=E.next(),P=H.getLabel();P.isArea()&&!H.isInteriorAreaEdge()&&x.isResultOfOp(P.getLocation(0,Aa.RIGHT),P.getLocation(1,
Aa.RIGHT),B)&&H.setInResult(!0)}},x.prototype.computeLabelsFromDepths=function(){for(var B=this._edgeList.iterator();B.hasNext();){var E=B.next(),H=E.getLabel();E=E.getDepth();if(!E.isNull()){E.normalize();for(var P=0;2>P;P++)H.isNull(P)||!H.isArea()||E.isNull(P)||(0===E.getDelta(P)?H.toLine(P):(Xa.isTrue(!E.isNull(P,Aa.LEFT),"depth of LEFT side has not been initialized"),H.setLocation(P,Aa.LEFT,E.getLocation(P,Aa.LEFT)),Xa.isTrue(!E.isNull(P,Aa.RIGHT),"depth of RIGHT side has not been initialized"),
H.setLocation(P,Aa.RIGHT,E.getLocation(P,Aa.RIGHT))))}}},x.prototype.computeLabelling=function(){for(var B=this._graph.getNodes().iterator();B.hasNext();)B.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels();this.updateNodeLabelling()},x.prototype.labelIncompleteNodes=function(){for(var B=this._graph.getNodes().iterator();B.hasNext();){var E=B.next(),H=E.getLabel();E.isIsolated()&&(H.isNull(0)?this.labelIncompleteNode(E,0):this.labelIncompleteNode(E,1));E.getEdges().updateLabelling(H)}},
x.prototype.isCoveredByA=function(B){return!!this.isCovered(B,this._resultPolyList)},x.prototype.interfaces_=function(){return[]},x.prototype.getClass=function(){return x},x}(kg);Za.overlayOp=function(w,x,B){return(new Za(w,x)).getResultGeometry(B)};Za.intersection=function(w,x){return w.isEmpty()||x.isEmpty()?Za.createEmptyResult(Za.INTERSECTION,w,x,w.getFactory()):w.isGeometryCollection()?yf.map(w,{interfaces_:function(){return[df.MapOp]},map:function(B){return B.intersection(x)}}):(w.checkNotGeometryCollection(w),
w.checkNotGeometryCollection(x),Tc.overlayOp(w,x,Za.INTERSECTION))};Za.symDifference=function(w,x){if(w.isEmpty()||x.isEmpty()){if(w.isEmpty()&&x.isEmpty())return Za.createEmptyResult(Za.SYMDIFFERENCE,w,x,w.getFactory());if(w.isEmpty())return x.copy();if(x.isEmpty())return w.copy()}return w.checkNotGeometryCollection(w),w.checkNotGeometryCollection(x),Tc.overlayOp(w,x,Za.SYMDIFFERENCE)};Za.resultDimension=function(w,x,B){x=x.getDimension();B=B.getDimension();var E=-1;switch(w){case Za.INTERSECTION:E=
Math.min(x,B);break;case Za.UNION:E=Math.max(x,B);break;case Za.DIFFERENCE:E=x;break;case Za.SYMDIFFERENCE:E=Math.max(x,B)}return E};Za.createEmptyResult=function(w,x,B,E){var H=null;switch(Za.resultDimension(w,x,B)){case -1:H=E.createGeometryCollection([].fill(null));break;case 0:H=E.createPoint();break;case 1:H=E.createLineString();break;case 2:H=E.createPolygon()}return H};Za.difference=function(w,x){return w.isEmpty()?Za.createEmptyResult(Za.DIFFERENCE,w,x,w.getFactory()):x.isEmpty()?w.copy():
(w.checkNotGeometryCollection(w),w.checkNotGeometryCollection(x),Tc.overlayOp(w,x,Za.DIFFERENCE))};Za.isResultOfOp=function(){if(2===arguments.length){var w=arguments[0],x=arguments[1],B=w.getLocation(0);w=w.getLocation(1);return Za.isResultOfOp(B,w,x)}if(3===arguments.length){x=arguments[0];B=arguments[1];w=arguments[2];switch(x===ua.BOUNDARY&&(x=ua.INTERIOR),B===ua.BOUNDARY&&(B=ua.INTERIOR),w){case Za.INTERSECTION:return x===ua.INTERIOR&&B===ua.INTERIOR;case Za.UNION:return x===ua.INTERIOR||B===
ua.INTERIOR;case Za.DIFFERENCE:return x===ua.INTERIOR&&B!==ua.INTERIOR;case Za.SYMDIFFERENCE:return x===ua.INTERIOR&&B!==ua.INTERIOR||x!==ua.INTERIOR&&B===ua.INTERIOR}return!1}};Za.INTERSECTION=1;Za.UNION=2;Za.DIFFERENCE=3;Za.SYMDIFFERENCE=4;Sd.prototype={constructor:Sd,reset:function(){this.s=this.t=0},add:function(w){dm(li,w,this.t);dm(this,li.s,this.s);this.s?this.t+=li.t:this.s=li.t},valueOf:function(){return this.s}};var li=new Sd,Nb=Math.PI,me=Nb/2,sm=Nb/4,ne=2*Nb,Re=180/Nb,Bd=Nb/180,Fc=Math.abs,
Jp=Math.atan,Of=Math.atan2,lc=Math.cos,mc=Math.sin,Jg=Math.sqrt,wm={Feature:function(w,x){Nh(w.geometry,x)},FeatureCollection:function(w,x){w=w.features;for(var B=-1,E=w.length;++B<E;)Nh(w[B].geometry,x)}},fm={Sphere:function(w,x){x.sphere()},Point:function(w,x){w=w.coordinates;x.point(w[0],w[1],w[2])},MultiPoint:function(w,x){for(var B=w.coordinates,E=-1,H=B.length;++E<H;)w=B[E],x.point(w[0],w[1],w[2])},LineString:function(w,x){jj(w.coordinates,x,0)},MultiLineString:function(w,x){w=w.coordinates;
for(var B=-1,E=w.length;++B<E;)jj(w[B],x,0)},Polygon:function(w,x){gm(w.coordinates,x)},MultiPolygon:function(w,x){w=w.coordinates;for(var B=-1,E=w.length;++B<E;)gm(w[B],x)},GeometryCollection:function(w,x){w=w.geometries;for(var B=-1,E=w.length;++B<E;)Nh(w[B],x)}};new Sd;new Sd;new Sd;nj.invert=nj;var oj=new Sd;new Sd;new Sd;new Sd;var lg=1/0,mi=lg,jh=-lg,ni=jh,vm={point:function(w,x){w<lg&&(lg=w);w>jh&&(jh=w);x<mi&&(mi=x);x>ni&&(ni=x)},lineStart:Ig,lineEnd:Ig,polygonStart:Ig,polygonEnd:Ig,result:function(){var w=
[[lg,mi],[jh,ni]];return jh=ni=-(mi=lg=1/0),w}};new Sd;var ym=rm(function(){return!0},function(w){var x,B=NaN,E=NaN,H=NaN;return{lineStart:function(){w.lineStart();x=1},point:function(P,T){var W=0<P?Nb:-Nb,aa=Fc(P-B);if(1E-6>Fc(aa-Nb))w.point(B,E=0<(E+T)/2?me:-me),w.point(H,E),w.lineEnd(),w.lineStart(),w.point(W,E),w.point(P,E),x=0;else if(H!==W&&aa>=Nb){1E-6>Fc(B-H)&&(B-=1E-6*H);1E-6>Fc(P-W)&&(P-=1E-6*W);aa=B;var X=E,fa=P,na,qa,ia=mc(aa-fa);E=1E-6<Fc(ia)?Jp((mc(X)*(qa=lc(T))*mc(fa)-mc(T)*(na=lc(X))*
mc(aa))/(na*qa*ia)):(X+T)/2;w.point(H,E);w.lineEnd();w.lineStart();w.point(W,E);x=0}w.point(B=P,E=T);H=W},lineEnd:function(){w.lineEnd();B=E=NaN},clean:function(){return 2-x}}},function(w,x,B,E){null==w?(B*=me,E.point(-Nb,B),E.point(0,B),E.point(Nb,B),E.point(Nb,0),E.point(Nb,-B),E.point(0,-B),E.point(-Nb,-B),E.point(-Nb,0),E.point(-Nb,B)):1E-6<Fc(w[0]-x[0])?(w=w[0]<x[0]?Nb:-Nb,B=B*w/2,E.point(-w,B),E.point(0,B),E.point(w,B)):E.point(x[0],x[1])},[-Nb,-me]);pj.prototype={constructor:pj,point:function(w,
x){this.stream.point(w,x)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var No=lc(30*Bd),Po=tm({point:function(w,x){this.stream.point(w*Bd,x*Bd)}}),zm=function(w){return function(x,B){var E=lc(x),H=lc(B);E=w(E*H);return[E*H*mc(x),E*mc(B)]}}(function(w){return(w=em(w))&&w/mc(w)});zm.invert=function(w){return function(x,
B){var E=Jg(x*x+B*B),H=w(E),P=mc(H);H=lc(H);return[Of(x*P,E*H),Nf(E&&B*P/E)]}}(function(w){return w});a.along=function(w,x,B){void 0===B&&(B={});w=Ib(w).coordinates;for(var E=0,H=0;H<w.length&&!(x>=E&&H===w.length-1);H++){if(E>=x)return(x-=E)?(E=Ae(w[H],w[H-1])-180,je(w[H],x,E,B)):t(w[H]);E+=Lb(w[H],w[H+1],B)}return t(w[w.length-1])};a.angle=function(w,x,B,E){if(void 0===E&&(E={}),!ta(E))throw Error("options is invalid");if(!w)throw Error("startPoint is required");if(!x)throw Error("midPoint is required");
if(!B)throw Error("endPoint is required");w=ba(!0!==E.mercator?Ae(w,x):lf(w,x));x=ba(!0!==E.mercator?Ae(B,x):lf(B,x));x=Math.abs(w-x);return!0===E.explementary?360-x:x};a.applyFilter=Kh;a.area=Li;a.areaFactors=nh;a.bbox=ya;a.bboxClip=function(w,x){var B=Ib(w),E=B.type;w="Feature"===w.type?w.properties:{};B=B.coordinates;switch(E){case "LineString":case "MultiLineString":var H=[];return"LineString"===E&&(B=[B]),B.forEach(function(P){var T=H,W,aa,X,fa,na=P.length,qa=Ff(P[0],x),ia=[];T||=[];for(W=1;W<
na;W++){var ra=P[W-1];for(aa=X=Ff(fa=P[W],x);;){if(!(qa|aa)){ia.push(ra);aa!==X?(ia.push(fa),W<na-1&&(T.push(ia),ia=[])):W===na-1&&ia.push(fa);break}if(qa&aa)break;qa?qa=Ff(ra=Ri(ra,fa,qa,x),x):aa=Ff(fa=Ri(ra,fa,aa,x),x)}qa=X}ia.length&&T.push(ia);!0}),1===H.length?J(H[0],w):I(H,w);case "Polygon":return D(al(B,x),w);case "MultiPolygon":return Q(B.map(function(P){return al(P,x)}),w);default:throw Error("geometry "+E+" not supported");}};a.bboxPolygon=Ci;a.bearing=Ae;a.bearingToAngle=ba;a.bearingToAzimuth=
ba;a.bezier=qk;a.bezierSpline=qk;a.booleanClockwise=Dh;a.booleanContains=function(w,x){w=Ib(w);x=Ib(x);var B=w.type,E=x.type,H=w.coordinates,P=x.coordinates;switch(B){case "Point":switch(E){case "Point":return Vi(H,P);default:throw Error("feature2 "+E+" geometry not supported");}case "MultiPoint":switch(E){case "Point":return function(T,W){var aa,X=!1;for(aa=0;aa<T.coordinates.length;aa++)if(Vi(T.coordinates[aa],W.coordinates)){X=!0;break}return X}(w,x);case "MultiPoint":return function(T,W){var aa=
0;for(W=W.coordinates;aa<W.length;aa++){for(var X=W[aa],fa=!1,na=0,qa=T.coordinates;na<qa.length;na++)if(Vi(X,qa[na])){fa=!0;break}if(!fa)return!1}return!0}(w,x);default:throw Error("feature2 "+E+" geometry not supported");}case "LineString":switch(E){case "Point":return hd(x,w,{ignoreEndVertices:!0});case "LineString":return function(T,W){var aa=!1,X=0;for(W=W.coordinates;X<W.length;X++){var fa=W[X];if(hd({type:"Point",coordinates:fa},T,{ignoreEndVertices:!0})&&(aa=!0),!hd({type:"Point",coordinates:fa},
T,{ignoreEndVertices:!1}))return!1}return aa}(w,x);case "MultiPoint":return function(T,W){var aa=!1,X=0;for(W=W.coordinates;X<W.length;X++){var fa=W[X];if(hd(fa,T,{ignoreEndVertices:!0})&&(aa=!0),!hd(fa,T))return!1}return aa?!0:!1}(w,x);default:throw Error("feature2 "+E+" geometry not supported");}case "Polygon":switch(E){case "Point":return Tb(x,w,{ignoreBoundary:!0});case "LineString":return function(T,W){var aa=!1,X=0,fa=ya(T),na=ya(W);if(!rl(fa,na))return!1;for(;X<W.coordinates.length-1;X++)if(fa=
W.coordinates[X],na=W.coordinates[X+1],Tb({type:"Point",coordinates:[(fa[0]+na[0])/2,(fa[1]+na[1])/2]},T,{ignoreBoundary:!0})){aa=!0;break}return aa}(w,x);case "Polygon":return function(T,W){if("Feature"===T.type&&null===T.geometry||"Feature"===W.type&&null===W.geometry)return!1;var aa=ya(T),X=ya(W);if(!rl(aa,X))return!1;aa=0;for(W=Ib(W).coordinates;aa<W.length;aa++){X=0;for(var fa=W[aa];X<fa.length;X++)if(!Tb(fa[X],T))return!1}return!0}(w,x);case "MultiPoint":return function(T,W){var aa=0;for(W=
W.coordinates;aa<W.length;aa++)if(!Tb(W[aa],T,{ignoreBoundary:!0}))return!1;return!0}(w,x);default:throw Error("feature2 "+E+" geometry not supported");}default:throw Error("feature1 "+B+" geometry not supported");}};a.booleanCrosses=function(w,x){w=Ib(w);x=Ib(x);var B=w.type,E=x.type;switch(B){case "MultiPoint":switch(E){case "LineString":return sl(w,x);case "Polygon":return ul(w,x);default:throw Error("feature2 "+E+" geometry not supported");}case "LineString":switch(E){case "MultiPoint":return sl(x,
w);case "LineString":a:{if(0<ke(w,x).features.length)for(B=0;B<w.coordinates.length-1;B++)for(E=0;E<x.coordinates.length-1;E++){var H=!0;if(0!==E&&E!==x.coordinates.length-2||(H=!1),tl(w.coordinates[B],w.coordinates[B+1],x.coordinates[E],H)){w=!0;break a}}w=!1}return w;case "Polygon":return 0<ke(w,Qi(x)).features.length;default:throw Error("feature2 "+E+" geometry not supported");}case "Polygon":switch(E){case "MultiPoint":return ul(x,w);case "LineString":return 0<ke(x,Qi(w)).features.length;default:throw Error("feature2 "+
E+" geometry not supported");}default:throw Error("feature1 "+B+" geometry not supported");}};a.booleanDisjoint=ol;a.booleanEqual=function(w,x){return Ib(w).type===Ib(x).type&&(new Td({precision:6})).compare(hf(w),hf(x))};a.booleanIntersects=xl;a.booleanOverlap=function(w,x){var B=Ib(w),E=Ib(x),H=B.type,P=E.type;if("MultiPoint"===H&&"MultiPoint"!==P||("LineString"===H||"MultiLineString"===H)&&"LineString"!==P&&"MultiLineString"!==P||("Polygon"===H||"MultiPolygon"===H)&&"Polygon"!==P&&"MultiPolygon"!==
P)throw Error("features must be of the same type");if("Point"===H)throw Error("Point geometry not supported");if((new Td({precision:6})).compare(w,x))return!1;var T=0;switch(H){case "MultiPoint":for(w=0;w<B.coordinates.length;w++)for(H=0;H<E.coordinates.length;H++){P=B.coordinates[w];var W=E.coordinates[H];if(P[0]===W[0]&&P[1]===W[1])return!0}return!1;case "LineString":case "MultiLineString":N(w,function(aa){N(x,function(X){bl(aa,X).features.length&&T++})});break;case "Polygon":case "MultiPolygon":N(w,
function(aa){N(x,function(X){ke(aa,X).features.length&&T++})})}return 0<T};a.booleanParallel=function(w,x){if(!w)throw Error("line1 is required");if(!x)throw Error("line2 is required");if("LineString"!==zl(w,"line1"))throw Error("line1 must be a LineString");if("LineString"!==zl(x,"line2"))throw Error("line2 must be a LineString");w=kf(hf(w)).features;x=kf(hf(x)).features;for(var B=0;B<w.length;B++){var E=w[B].geometry.coordinates;if(!x[B])break;var H=x[B].geometry.coordinates;if(ba(lf(E[0],E[1]))!==
ba(lf(H[0],H[1])))return!1}return!0};a.booleanPointInPolygon=Tb;a.booleanPointOnLine=hd;a.booleanWithin=Mk;a.buffer=function(w,x,B){var E=(B=B||{}).units||"kilometers",H=B.steps||8;if(!w)throw Error("geojson is required");if("object"!=typeof B)throw Error("options must be an object");if("number"!=typeof H)throw Error("steps must be an number");if(void 0===x)throw Error("radius is required");if(0>=H)throw Error("steps must be greater than 0");var P=[];switch(w.type){case "GeometryCollection":return Zb(w,
function(T){(T=Th(T,x,E,H))&&P.push(T)}),K(P);case "FeatureCollection":return Sa(w,function(T){(T=Th(T,x,E,H))&&Sa(T,function(W){W&&P.push(W)})}),K(P)}return Th(w,x,E,H)};a.center=wh;a.centerMean=Zi;a.centerMedian=function(w,x){if(void 0===x&&(x={}),!ta(x=x||{}))throw Error("options is invalid");var B=x.counter||10;if(!la(B))throw Error("counter must be a number");var E=x.weight,H=Zi(w,{weight:x.weight}),P=K([]);Sa(w,function(T){var W;P.features.push(Ne(T,{properties:{weight:null===(W=T.properties)||
void 0===W?void 0:W[E]}}))});return Kl(H.geometry.coordinates,[0,0],P,{tolerance:x.tolerance,medianCandidates:[]},B)};a.centerOfMass=function E(x,B){switch(void 0===B&&(B={}),qc(x)){case "Point":return t(ca(x),B.properties);case "Polygon":var H=[];Ca(x,function(Ma){H.push(Ma)});var P,T,W,aa,X=Ne(x,{properties:B.properties}),fa=X.geometry.coordinates,na=x=0,qa=0,ia=H.map(function(Ma){return[Ma[0]-fa[0],Ma[1]-fa[1]]});for(P=0;P<H.length-1;P++){var ra=(T=ia[P])[0];var ja=T[1];T=(W=ia[P+1])[0];qa+=aa=
ra*(W=W[1])-T*ja;x+=(ra+T)*aa;na+=(ja+W)*aa}if(0===qa)return X;P=1/(3*qa);return t([fa[0]+P*x,fa[1]+P*na],B.properties);default:return(na=bk(x))?E(na,{properties:B.properties}):Ne(x,{properties:B.properties})}};a.centroid=Ne;a.circle=Di;a.cleanCoords=hf;a.clone=Dc;a.clusterEach=$i;a.clusterReduce=Yl;a.clusters=kp;a.clustersDbscan=function(x,B,E){void 0===E&&(E={});!0!==E.mutate&&(x=Dc(x));E.minPoints=E.minPoints||3;var H=new ep.DBSCAN,P=-1;return H.run(uc(x),ka(B,E.units),E.minPoints,Lb).forEach(function(T){P++;
T.forEach(function(W){W=x.features[W];W.properties||(W.properties={});W.properties.cluster=P;W.properties.dbscan="core"})}),H.noise.forEach(function(T){T=x.features[T];T.properties||(T.properties={});T.properties.cluster?T.properties.dbscan="edge":T.properties.dbscan="noise"}),x};a.clustersKmeans=function(x,B){void 0===B&&(B={});var E=x.features.length;B.numberOfClusters=B.numberOfClusters||Math.round(Math.sqrt(E/2));B.numberOfClusters>E&&(B.numberOfClusters=E);!0!==B.mutate&&(x=Dc(x));E=uc(x);var H=
E.slice(0,B.numberOfClusters),P=hp(E,B.numberOfClusters,H),T={};return P.centroids.forEach(function(W,aa){T[aa]=W}),Sa(x,function(W,aa){aa=P.idxs[aa];W.properties.cluster=aa;W.properties.centroid=T[aa]}),x};a.collect=function(x,B,E,H){var P=Uc(6);B=B.features.map(function(T){var W;return{minX:T.geometry.coordinates[0],minY:T.geometry.coordinates[1],maxX:T.geometry.coordinates[0],maxY:T.geometry.coordinates[1],property:null===(W=T.properties)||void 0===W?void 0:W[E]}});return P.load(B),x.features.forEach(function(T){T.properties||
(T.properties={});var W=ya(T),aa=[];P.search({minX:W[0],minY:W[1],maxX:W[2],maxY:W[3]}).forEach(function(X){Tb([X.minX,X.minY],T)&&aa.push(X.property)});T.properties[H]=aa}),x};a.collectionOf=Ka;a.combine=function(x){var B={MultiPoint:{coordinates:[],properties:[]},MultiLineString:{coordinates:[],properties:[]},MultiPolygon:{coordinates:[],properties:[]}};return Sa(x,function(E){var H,P,T,W;switch(null===(W=E.geometry)||void 0===W?void 0:W.type){case "Point":B.MultiPoint.coordinates.push(E.geometry.coordinates);
B.MultiPoint.properties.push(E.properties);break;case "MultiPoint":(H=B.MultiPoint.coordinates).push.apply(H,E.geometry.coordinates);B.MultiPoint.properties.push(E.properties);break;case "LineString":B.MultiLineString.coordinates.push(E.geometry.coordinates);B.MultiLineString.properties.push(E.properties);break;case "MultiLineString":(P=B.MultiLineString.coordinates).push.apply(P,E.geometry.coordinates);B.MultiLineString.properties.push(E.properties);break;case "Polygon":B.MultiPolygon.coordinates.push(E.geometry.coordinates);
B.MultiPolygon.properties.push(E.properties);break;case "MultiPolygon":(T=B.MultiPolygon.coordinates).push.apply(T,E.geometry.coordinates),B.MultiPolygon.properties.push(E.properties)}}),K(Object.keys(B).filter(function(E){return B[E].coordinates.length}).sort().map(function(E){return e({type:E,coordinates:B[E].coordinates},{collectedProperties:B[E].properties})}))};a.concave=function(x,B){void 0===B&&(B={});var E=B.maxEdge||1/0;x=ek(function(H){var P=[],T={};return Sa(H,function(W){if(W.geometry){var aa=
W.geometry.coordinates.join("-");Object.prototype.hasOwnProperty.call(T,aa)||(P.push(W),T[aa]=!0)}}),K(P)}(x));if(x.features=x.features.filter(function(H){var P=H.geometry.coordinates[0][0],T=H.geometry.coordinates[0][1],W=H.geometry.coordinates[0][2];H=Lb(P,T,B);T=Lb(T,W,B);P=Lb(P,W,B);return H<=E&&T<=E&&P<=E}),1>x.features.length)return null;x=Tn(x);return 1===x.coordinates.length&&(x.coordinates=x.coordinates[0],x.type="Polygon"),e(x)};a.containsNumber=xa;a.convertArea=pa;a.convertDistance=ka;
a.convertLength=ka;a.convex=bk;a.coordAll=uc;a.coordEach=Ca;a.coordReduce=Vb;a.createBins=aj;a.degrees2radians=ma;a.degreesToRadians=ma;a.destination=je;a.difference=function(x,B){var E=Ib(x);B=Ib(B);x=x.properties||{};E=Ce.difference(E.coordinates,B.coordinates);return 0===E.length?null:1===E.length?D(E[0],x):Q(E,x)};a.dissolve=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");var E=B.propertyName;Ka(x,"Polygon","dissolve");var H=[];if(!B.propertyName)return Ni(Q(Ce.union.apply(null,
x.features.map(function(W){return W.geometry.coordinates}))));var P={};Sa(x,function(W){Object.prototype.hasOwnProperty.call(P,W.properties[E])||(P[W.properties[E]]=[]);P[W.properties[E]].push(W)});x=Object.keys(P);for(B=0;B<x.length;B++){var T=Q(Ce.union.apply(null,P[x[B]].map(function(W){return W.geometry.coordinates})));T.properties[E]=x[B];H.push(T)}return Ni(K(H))};a.distance=Lb;a.distanceToDegrees=R;a.distanceToRadians=da;a.distanceWeight=Ml;a.earthRadius=6371008.8;a.ellipse=Jl;a.envelope=rk;
a.explode=xh;a.factors=mh;a.feature=e;a.featureCollection=K;a.featureEach=Sa;a.featureOf=Ob;a.featureReduce=Ya;a.filterProperties=Zl;a.findPoint=Ba;a.findSegment=oa;a.flatten=Ni;a.flattenEach=Rb;a.flattenReduce=Me;a.flip=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");B=B.mutate;if(!x)throw Error("geojson is required");return!1!==B&&void 0!==B||(x=Dc(x)),Ca(x,function(E){var H=E[0];E[0]=E[1];E[1]=H}),x};a.geojsonType=Oa;a.geomEach=Zb;a.geomReduce=pd;a.geometry=n;a.geometryCollection=
M;a.getCluster=Xl;a.getCoord=ca;a.getCoords=Y;a.getGeom=Ib;a.getType=qc;a.greatCircle=function(x,B,E){if("object"!=typeof(E=E||{}))throw Error("options is invalid");var H=E.properties,P=E.npoints;E=E.offset;return x=ca(x),B=ca(B),H=H||{},P=P||100,E=E||10,(new tj({x:x[0],y:x[1]},{x:B[0],y:B[1]},H)).Arc(P,{offset:E}).json()};a.helpers=So;a.hexGrid=Em;a.inside=Tb;a.interpolate=function(x,B,E){if("object"!=typeof(E=E||{}))throw Error("options is invalid");var H=E.gridType,P=E.property,T=E.weight;if(!x)throw Error("points is required");
if(Ka(x,"Point","input must contain Points"),!B)throw Error("cellSize is required");if(void 0!==T&&"number"!=typeof T)throw Error("weight must be a number");P=P||"elevation";H=H||"square";T=T||1;var W=ya(x);switch(H){case "point":case "points":B=Pk(W,B,E);break;case "square":case "squares":B=Fm(W,B,E);break;case "hex":case "hexes":B=Em(W,B,E);break;case "triangle":case "triangles":B=Gm(W,B,E);break;default:throw Error("invalid gridType");}var aa=[];return Sa(B,function(X){var fa=0,na=0;Sa(x,function(ia){var ra,
ja=Lb("point"===H?X:Ne(X),ia,E);if(void 0!==P&&(ra=ia.properties[P]),void 0===ra&&(ra=ia.geometry.coordinates[2]),void 0===ra)throw Error("zValue is missing");0===ja&&(fa=ra);ia=1/Math.pow(ja,T);na+=ia;fa+=ia*ra});var qa=Dc(X);qa.properties[P]=fa/na;aa.push(qa)}),K(aa)};a.intersect=Kg;a.invariant=Uo;a.isNumber=la;a.isObject=ta;a.isobands=function(x,B,E){if(!ta(E=E||{}))throw Error("options is invalid");var H=E.zProperty||"elevation",P=E.commonProperties||{},T=E.breaksProperties||[];if(Ka(x,"Point",
"Input must contain Points"),!B)throw Error("breaks is required");if(!Array.isArray(B))throw Error("breaks is not an Array");if(!ta(P))throw Error("commonProperties is not an Object");if(!Array.isArray(T))throw Error("breaksProperties is not an Array");E=bo(x,{zProperty:H,flip:!0});B=function(W,aa,X){for(var fa=[],na=1;na<aa.length;na++){var qa=+aa[na-1],ia=+aa[na],ra=io(ho(co(W,qa,ia-qa))),ja={};ja.groupedRings=ra;ja[X]=qa+"-"+ia;fa.push(ja)}return fa}(E,B,H);return K((B=function(W,aa,X){X=ya(X);
var fa=X[0],na=X[1],qa=(X[2]-X[0])/(aa[0].length-1),ia=(X[3]-X[1])/(aa.length-1),ra=function(ja){ja[0]=ja[0]*qa+fa;ja[1]=ja[1]*ia+na};return W.forEach(function(ja){ja.groupedRings.forEach(function(Ma){Ma.forEach(function(Pa){Pa.forEach(ra)})})}),W}(B,E,x)).map(function(W,aa){if(T[aa]&&!ta(T[aa]))throw Error("Each mappedProperty is required to be an Object");aa=rj({},P,T[aa]);return aa[H]=W[H],Q(W.groupedRings,aa)}))};a.isolines=function(x,B,E){if(!ta(E=E||{}))throw Error("options is invalid");var H=
E.zProperty||"elevation",P=E.commonProperties||{};E=E.breaksProperties||[];if(Ka(x,"Point","Input must contain Points"),!B)throw Error("breaks is required");if(!Array.isArray(B))throw Error("breaks must be an Array");if(!ta(P))throw Error("commonProperties must be an Object");if(!Array.isArray(E))throw Error("breaksProperties must be an Array");var T=lh(x,{zProperty:H,flip:!0});return K(function(W,aa,X){X=ya(X);var fa=X[0],na=X[1],qa=(X[2]-X[0])/(aa[0].length-1),ia=(X[3]-X[1])/(aa.length-1),ra=function(ja){ja[0]=
ja[0]*qa+fa;ja[1]=ja[1]*ia+na};return W.forEach(function(ja){Ca(ja,ra)}),W}(function(W,aa,X,fa,na){for(var qa=[],ia=1;ia<aa.length;ia++){var ra=+aa[ia],ja=rj({},fa,na[ia]);ja[X]=ra;ra=I(ff(W,ra),ja);qa.push(ra)}return qa}(T,B,H,P,E),T,x))};a.kinks=function(x){var B={type:"FeatureCollection",features:[]};if("LineString"===(x="Feature"===x.type?x.geometry:x).type)var E=[x.coordinates];else if("MultiLineString"===x.type)E=x.coordinates;else if("MultiPolygon"===x.type)E=[].concat.apply([],x.coordinates);
else{if("Polygon"!==x.type)throw Error("Input must be a LineString, MultiLineString, Polygon, or MultiPolygon Feature or Geometry");E=x.coordinates}return E.forEach(function(H){E.forEach(function(P){for(var T=0;T<H.length-1;T++)for(var W=T;W<P.length-1;W++){if(H===P){if(1===Math.abs(T-W))continue;if(0===T&&W===H.length-2&&H[T][0]===H[H.length-1][0]&&H[T][1]===H[H.length-1][1])continue}var aa,X=void 0,fa=void 0,na=void 0,qa=void 0,ia=H[T][0],ra=H[T][1],ja=H[T+1][0],Ma=H[T+1][1],Pa=P[W][0],Sb=P[W][1],
Qa=P[W+1][0],Wc=P[W+1][1],fc={x:null,y:null,onLine1:!1,onLine2:!1};(aa=0===(qa=(Wc-Sb)*(ja-ia)-(Qa-Pa)*(Ma-ra))?null!==fc.x&&null!==fc.y&&fc:(X=(ja-ia)*(na=ra-Sb)-(Ma-ra)*(fa=ia-Pa),na=((Qa-Pa)*na-(Wc-Sb)*fa)/qa,fa=X/qa,fc.x=ia+na*(ja-ia),fc.y=ra+na*(Ma-ra),0<=na&&1>=na&&(fc.onLine1=!0),0<=fa&&1>=fa&&(fc.onLine2=!0),!(!fc.onLine1||!fc.onLine2)&&[fc.x,fc.y]))&&B.features.push(t([aa[0],aa[1]]))}})}),B};a.length=Mi;a.lengthToDegrees=R;a.lengthToRadians=da;a.lineArc=Vk;a.lineChunk=function(x,B,E){if(!ta(E=
E||{}))throw Error("options is invalid");var H=E.units,P=E.reverse;if(!x)throw Error("geojson is required");if(0>=B)throw Error("segmentLength must be greater than 0");var T=[];return Rb(x,function(W){P&&(W.geometry.coordinates=W.geometry.coordinates.reverse());(function(aa,X,fa,na){var qa=Mi(aa,{units:fa});if(qa<=X)return na(aa);qa/=X;Number.isInteger(qa)||(qa=Math.floor(qa)+1);for(var ia=0;ia<qa;ia++)na(Lk(aa,X*ia,X*(ia+1),{units:fa}),ia)})(W,B,H,function(aa){T.push(aa)})}),K(T)};a.lineDistance=
Mi;a.lineEach=S;a.lineIntersect=ke;a.lineOffset=function(x,B,E){if(!ta(E=E||{}))throw Error("options is invalid");var H=E.units;if(!x)throw Error("geojson is required");if(null==B||isNaN(B))throw Error("distance is required");E=qc(x);var P=x.properties;switch(E){case "LineString":return ml(x,B,H);case "MultiLineString":var T=[];return Rb(x,function(W){T.push(ml(W,B,H).geometry.coordinates)}),I(T,P);default:throw Error("geometry "+E+" is not supported");}};a.lineOverlap=bl;a.lineReduce=ea;a.lineSegment=
kf;a.lineSlice=function(x,B,E){var H=Y(E);if("LineString"!==qc(E))throw Error("line must be a LineString");x=Be(E,x);B=Be(E,B);x=[(B=x.properties.index<=B.properties.index?[x,B]:[B,x])[0].geometry.coordinates];for(var P=B[0].properties.index+1;P<B[1].properties.index+1;P++)x.push(H[P]);return x.push(B[1].geometry.coordinates),J(x,E.properties)};a.lineSliceAlong=Lk;a.lineSplit=function(x,B){if(!x)throw Error("line is required");if(!B)throw Error("splitter is required");var E=qc(x),H=qc(B);if("LineString"!==
E)throw Error("line must be LineString");if("FeatureCollection"===H)throw Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===H)throw Error("splitter cannot be a GeometryCollection");B=Qk(B,{precision:7});switch(H){case "Point":return Oi(x,B);case "MultiPoint":return Tk(x,B);case "LineString":case "MultiLineString":case "Polygon":case "MultiPolygon":return Tk(x,ke(x,B))}};a.lineString=J;a.lineStringToPolygon=Yk;a.lineStrings=G;a.lineToPolygon=Yk;a.mask=function(x,B){var E=D(B&&
B.geometry.coordinates||[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]);B=null;return"FeatureCollection"===x.type?B=Q(2===x.features.length?Ce.union(x.features[0].geometry.coordinates,x.features[1].geometry.coordinates):Ce.union.apply(Ce,x.features.map(function(H){return H.geometry.coordinates}))):B=Q(Ce.union(x.geometry.coordinates)),B.geometry.coordinates.forEach(function(H){E.geometry.coordinates.push(H[0])}),E};a.meta=To;a.midpoint=function(x,B){return je(x,Lb(x,B)/2,Ae(x,B))};a.moranIndex=
function(x,B){var E=B.inputField,H=Ml(x,{alpha:B.alpha||-1,binary:B.binary||!1,p:B.p||2,standardization:B.standardization||!0,threshold:B.threshold||1E5}),P=[];Sa(x,function(ra){P.push((ra.properties||{})[E])});for(var T=Nl(P),W=function(ra){for(var ja=Nl(ra),Ma=0,Pa=0;Pa<ra.length;Pa++)Ma+=Math.pow(ra[Pa]-ja,2);return Ma/ra.length}(P),aa=0,X=B=x=0,fa=H.length,na=0;na<fa;na++){for(var qa=0,ia=0;ia<fa;ia++)aa+=H[na][ia]*(P[na]-T)*(P[ia]-T),x+=H[na][ia],B+=Math.pow(H[na][ia]+H[ia][na],2),qa+=H[na][ia]+
H[ia][na];X+=Math.pow(qa,2)}H=aa/x/W;T=-1/(fa-1);W=(fa*fa*(B*=.5)-fa*X+x*x*3)/((fa-1)*(fa+1)*x*x)-T*T;x=Math.sqrt(W);return{expectedMoranIndex:T,moranIndex:H,stdNorm:x,zNorm:(H-T)/x}};a.multiLineString=I;a.multiPoint=L;a.multiPolygon=Q;a.nearest=zh;a.nearestPoint=zh;a.nearestPointOnLine=Be;a.nearestPointToLine=function(x,B,E){void 0===E&&(E={});var H=E.units;E=E.properties||{};x=function(W){var aa=[];switch(W.geometry?W.geometry.type:W.type){case "GeometryCollection":return Zb(W,function(X){"Point"===
X.type&&aa.push({type:"Feature",properties:{},geometry:X})}),{type:"FeatureCollection",features:aa};case "FeatureCollection":return W.features=W.features.filter(function(X){return"Point"===X.geometry.type}),W;default:throw Error("points must be a Point Collection");}}(x);if(!x.features.length)throw Error("points must contain features");if(!B)throw Error("line is required");if("LineString"!==qc(B))throw Error("line must be a LineString");var P=1/0,T=null;return Sa(x,function(W){var aa=Gk(W,B,{units:H});
aa<P&&(P=aa,T=W)}),T&&(T.properties=rj({dist:P},T.properties,E)),T};a.planepoint=function(x,B){var E=ca(x);x=Ib(B).coordinates[0];if(4>x.length)throw Error("OuterRing of a Polygon must have 4 or more Positions.");B=B.properties||{};var H=B.a,P=B.b,T=B.c;B=E[0];E=E[1];var W=x[0][0],aa=x[0][1];H=void 0!==H?H:x[0][2];var X=x[1][0],fa=x[1][1];P=void 0!==P?P:x[1][2];var na=x[2][0],qa=x[2][1];x=void 0!==T?T:x[2][2];return(x*(B-W)*(E-fa)+H*(B-X)*(E-qa)+P*(B-na)*(E-aa)-P*(B-W)*(E-qa)-x*(B-X)*(E-aa)-H*(B-
na)*(E-fa))/((B-W)*(E-fa)+(B-X)*(E-qa)+(B-na)*(E-aa)-(B-W)*(E-qa)-(B-X)*(E-aa)-(B-na)*(E-fa))};a.point=t;a.pointGrid=Pk;a.pointOnFeature=Hk;a.pointOnLine=Be;a.pointOnSurface=Hk;a.pointToLineDistance=Gk;a.points=z;a.pointsWithinPolygon=ti;a.polygon=D;a.polygonSmooth=function(x,B){var E=[],H=B.iterations||1;if(!x)throw Error("inputPolys is required");return Zb(x,function(P,T,W){switch(P.type){case "Polygon":T=[[]];for(var aa=0;aa<H;aa++){var X=[[]];var fa=P;0<aa&&(fa=D(T).geometry);Ao(fa,X);T=X.slice(0)}E.push(D(T,
W));break;case "MultiPolygon":T=[[[]]];for(aa=0;aa<H;aa++)X=[[[]]],fa=P,0<aa&&(fa=Q(T).geometry),Bo(fa,X),T=X.slice(0);E.push(Q(T,W));break;default:throw Error("geometry is invalid, must be Polygon or MultiPolygon");}}),K(E)};a.polygonTangents=function(x,B){var E=Y(x),H=Y(B),P=ya(B),T=0,W=null;switch(E[0]>P[0]&&E[0]<P[2]&&E[1]>P[1]&&E[1]<P[3]&&(T=(W=zh(x,xh(B))).properties.featureIndex),qc(B)){case "Polygon":var aa=H[0][T];var X=H[0][0];null!==W&&W.geometry.coordinates[1]<E[1]&&(X=H[0][T]);var fa=
Ag(H[0][0],H[0][H[0].length-1],E);H=fl(H[0],E,fa,void 0,aa,X);aa=H[0];X=H[1];break;case "MultiPolygon":for(W=P=B=x=0;W<H[0].length;W++){x=W;for(var na=!1,qa=0;qa<H[0][W].length;qa++){if(B=qa,P===T){na=!0;break}P++}if(na)break}aa=H[0][x][B];X=H[0][x][B];fa=Ag(H[0][0][0],H[0][0][H[0][0].length-1],E);H.forEach(function(ia){ia=fl(ia[0],E,fa,void 0,aa,X);aa=ia[0];X=ia[1]})}return K([t(aa),t(X)])};a.polygonToLine=zg;a.polygonToLineString=zg;a.polygonize=function(x){x=ap.fromGeoJson(x);x.deleteDangles();
x.deleteCutEdges();var B=[],E=[];return x.getEdgeRings().filter(function(H){return H.isValid()}).forEach(function(H){H.isHole()?B.push(H):E.push(H)}),B.forEach(function(H){Tm.findEdgeRingContaining(H,E)&&E.push(H)}),K(E.map(function(H){return H.toPolygon()}))};a.polygons=F;a.projection=ip;a.propEach=Kb;a.propReduce=Qd;a.propertiesContainsFilter=bj;a.radians2degrees=ha;a.radiansToDegrees=ha;a.radiansToDistance=Z;a.radiansToLength=Z;a.random=jp;a.randomLineString=Wl;a.randomPoint=Ul;a.randomPolygon=
Vl;a.randomPosition=Gg;a.rewind=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");var E=B.reverse||!1;B=B.mutate||!1;if(!x)throw Error("<geojson> is required");if("boolean"!=typeof E)throw Error("<reverse> must be a boolean");if("boolean"!=typeof B)throw Error("<mutate> must be a boolean");!1===B&&(x=Dc(x));var H=[];switch(x.type){case "GeometryCollection":return Zb(x,function(P){Eh(P,E)}),x;case "FeatureCollection":return Sa(x,function(P){Sa(Eh(P,E),function(T){H.push(T)})}),K(H)}return Eh(x,
E)};a.rhumbBearing=lf;a.rhumbDestination=Hf;a.rhumbDistance=Bh;a.round=U;a.sample=function(x,B){if(!x)throw Error("featurecollection is required");if(null==B)throw Error("num is required");if("number"!=typeof B)throw Error("num must be a number");var E=x.features,H;x=E.slice(0);E=E.length;for(var P=E-B;E-- >P;)B=x[H=Math.floor((E+1)*Math.random())],x[H]=x[E],x[E]=B;x=x.slice(P);return K(x)};a.sector=function(x,B,E,H,P){if(!ta(P=P||{}))throw Error("options is invalid");var T=P.properties;if(!x)throw Error("center is required");
if(null==E)throw Error("bearing1 is required");if(null==H)throw Error("bearing2 is required");if(!B)throw Error("radius is required");if("object"!=typeof P)throw Error("options must be an object");if(dl(E)===dl(H))return Di(x,B,P);var W=Y(x);x=Vk(x,B,E,H,P);var aa=[[W]];return Ca(x,function(X){aa[0].push(X)}),aa[0].push(W),D(aa,T)};a.segmentEach=N;a.segmentReduce=O;a.shortestPath=function(x,B,E){if(!ta(E=E||{}))throw Error("options is invalid");var H=E.resolution,P=E.minDistance,T=E.obstacles||K([]);
if(!x)throw Error("start is required");if(!B)throw Error("end is required");if(H&&!la(H)||0>=H)throw Error("options.resolution must be a number, greater than 0");if(P)throw Error("options.minDistance is not yet implemented");P=ca(x);var W=ca(B);switch(x=t(P),B=t(W),qc(T)){case "FeatureCollection":if(0===T.features.length)return J([P,W]);break;case "Polygon":T=K([e(Ib(T))]);break;default:throw Error("invalid obstacles");}var aa=T;aa.features.push(x);aa.features.push(B);var X=ya(kl(Ci(ya(aa)),1.15));
H||=Lb([X[0],X[1]],[X[2],X[1]],E)/100;aa.features.pop();aa.features.pop();aa=X[0];var fa=X[1],na=X[2],qa=X[3];X=H/Lb([aa,fa],[na,fa],E)*(na-aa);E=H/Lb([aa,fa],[aa,qa],E)*(qa-fa);H=na-aa;var ia=qa-fa,ra=(H-Math.floor(H/X)*X)/2,ja=[],Ma=[];H=[];var Pa=[],Sb=1/0,Qa=1/0;qa-=(ia-Math.floor(ia/E)*E)/2;for(ia=0;qa>=fa;){for(var Wc=[],fc=[],nc=aa+ra,cc=0;nc<=na;){var gc=t([nc,qa]),Gc=no(gc,T);Wc.push(Gc?0:1);fc.push(nc+"|"+qa);var Qf=Lb(gc,x);!Gc&&Qf<Sb&&(Sb=Qf,H={x:cc,y:ia});gc=Lb(gc,B);!Gc&&gc<Qa&&(Qa=
gc,Pa={x:cc,y:ia});nc+=X;cc++}Ma.push(Wc);ja.push(fc);qa-=E;ia++}x=new If(Ma,{diagonal:!0});x=Vh.search(x,x.grid[H.y][H.x],x.grid[Pa.y][Pa.x]);var Qe=[P];return x.forEach(function(kh){kh=ja[kh.x][kh.y].split("|");Qe.push([+kh[0],+kh[1]])}),Qe.push(W),hf(J(Qe))};a.simplify=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");var E=void 0!==B.tolerance?B.tolerance:1,H=B.highQuality||!1;B=B.mutate||!1;if(!x)throw Error("geojson is required");if(E&&0>E)throw Error("invalid tolerance");return!0!==
B&&(x=Dc(x)),Zb(x,function(P){!function(T,W,aa){var X=T.type;if("Point"===X||"MultiPoint"===X)return T;hf(T,!0);var fa=T.coordinates;switch(X){case "LineString":T.coordinates=ok(fa,W,aa);break;case "MultiLineString":T.coordinates=fa.map(function(na){return ok(na,W,aa)});break;case "Polygon":T.coordinates=pk(fa,W,aa);break;case "MultiPolygon":T.coordinates=fa.map(function(na){return pk(na,W,aa)})}}(P,E,H)}),x};a.square=sk;a.squareGrid=Fm;a.standardDeviationalEllipse=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");
var E=B.steps||64,H=B.weight,P=B.properties||{};if(!la(E))throw Error("steps must be a number");if(!ta(P))throw Error("properties must be a number");B=uc(x).length;var T=Zi(x,{weight:H}),W=0,aa=0,X=0;Sa(x,function(Pa){var Sb=Pa.properties[H]||1;Pa=Ll(Y(Pa),Y(T));W+=Math.pow(Pa.x,2)*Sb;aa+=Math.pow(Pa.y,2)*Sb;X+=Pa.x*Pa.y*Sb});var fa=W-aa,na=Math.atan((fa+Math.sqrt(Math.pow(fa,2)+4*Math.pow(X,2)))/(2*X));fa=180*na/Math.PI;var qa=0,ia=0,ra=0;Sa(x,function(Pa){var Sb=Pa.properties[H]||1;Pa=Ll(Y(Pa),
Y(T));qa+=Math.pow(Pa.x*Math.cos(na)-Pa.y*Math.sin(na),2)*Sb;ia+=Math.pow(Pa.x*Math.sin(na)+Pa.y*Math.cos(na),2)*Sb;ra+=Sb});var ja=Math.sqrt(2*qa/ra),Ma=Math.sqrt(2*ia/ra);E=Jl(T,ja,Ma,{units:"degrees",angle:fa,steps:E,properties:P});x=ti(x,K([E]));x={meanCenterCoordinates:Y(T),semiMajorAxis:ja,semiMinorAxis:Ma,numberOfFeatures:B,angle:fa,percentageWithinEllipse:100*uc(x).length/B};return E.properties.standardDeviationalEllipse=x,E};a.tag=function(x,B,E,H){return x=Dc(x),B=Dc(B),Sa(x,function(P){P.properties||
(P.properties={});Sa(B,function(T){void 0===P.properties[H]&&Tb(P,T)&&(P.properties[H]=T.properties[E])})}),x};a.tesselate=function(x){if(!x.geometry||"Polygon"!==x.geometry.type&&"MultiPolygon"!==x.geometry.type)throw Error("input must be a Polygon or MultiPolygon");var B={type:"FeatureCollection",features:[]};return"Polygon"===x.geometry.type?B.features=xk(x.geometry.coordinates):x.geometry.coordinates.forEach(function(E){B.features=B.features.concat(xk(E))}),B};a.tin=ek;a.toMercator=Ol;a.toWgs84=
Ql;a.transformRotate=jl;a.transformScale=kl;a.transformTranslate=function(x,B,E,H){if(!ta(H=H||{}))throw Error("options is invalid");var P=H.units,T=H.zTranslation;H=H.mutate;if(!x)throw Error("geojson is required");if(null==B||isNaN(B))throw Error("distance is required");if(T&&"number"!=typeof T&&isNaN(T))throw Error("zTranslation is not a number");if(T=void 0!==T?T:0,0===B&&0===T)return x;if(null==E||isNaN(E))throw Error("direction is required");return 0>B&&(B=-B,E+=180),!1!==H&&void 0!==H||(x=
Dc(x)),Ca(x,function(W){var aa=Y(Hf(W,B,E,{units:P}));W[0]=aa[0];W[1]=aa[1];T&&3===W.length&&(W[2]+=T)}),x};a.triangleGrid=Gm;a.truncate=Qk;a.union=function(x,B,E){void 0===E&&(E={});x=Ib(x);B=Ib(B);B=Ce.union(x.coordinates,B.coordinates);return 0===B.length?null:1===B.length?D(B[0],E.properties):Q(B,E.properties)};a.unitsFactors=Hm;a.unkinkPolygon=function(x){var B=[];return Rb(x,function(E){"Polygon"===E.geometry.type&&Sa($n(E),function(H){B.push(D(H.geometry.coordinates,E.properties))})}),K(B)};
a.validateBBox=wa;a.validateId=za;a.voronoi=function(x,B){if(!ta(B=B||{}))throw Error("options is invalid");B=B.bbox||[-180,-85,180,85];if(!x)throw Error("points is required");if(!Array.isArray(B))throw Error("bbox is invalid");return Ka(x,"Point","points"),K(function(){function E(W){return new Yi(W.map(function(aa,X){var fa=[Math.round(H(aa,X,W)/Wb)*Wb,Math.round(P(aa,X,W)/Wb)*Wb];return fa.index=X,fa.data=aa,fa}),T)}var H=oo,P=po,T=null;return E.polygons=function(W){return E(W).polygons()},E.links=
function(W){return E(W).links()},E.triangles=function(W){return E(W).triangles()},E.x=function(W){return arguments.length?(H="function"==typeof W?W:Cl(+W),E):H},E.y=function(W){return arguments.length?(P="function"==typeof W?W:Cl(+W),E):P},E.extent=function(W){return arguments.length?(T=null==W?null:[[+W[0][0],+W[0][1]],[+W[1][0],+W[1][1]]],E):T&&[[T[0][0],T[0][1]],[T[1][0],T[1][1]]]},E.size=function(W){return arguments.length?(T=null==W?null:[[0,0],[+W[0],+W[1]]],E):T&&[T[1][0]-T[0][0],T[1][1]-T[0][1]]},
E}().x(function(E){return E.geometry.coordinates[0]}).y(function(E){return E.geometry.coordinates[1]}).extent([[B[0],B[1]],[B[2],B[3]]]).polygons(x.features).map(zo))};a.within=ti;Object.defineProperty(a,"__esModule",{value:!0})});var module$libs$turf_min={};const html$$module$settlements=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);
var thickLineToPolygon$$module$settlements=function(){function a(e,n,t,z){n=(n.y-e.y)/(n.x-e.x);z=(z.y-t.y)/(z.x-t.x);if(n!==z)return e=e.y-n*e.x,t=(e-(t.y-z*t.x))/(z-n),{x:t,y:n*t+e}}return function(e,n){for(var t,z,D=[],F,J,G,K,I,L,Q,M,U,Z=0,da=e.length-1;Z<da;Z++)F=!Z,J=Z===e.length-2,t=e[Z],M=e[Z+1],Q=M.x-t.x,t=M.y-t.y,M=n/(2*Math.sqrt(Q*Q+t*t)),t*=-M,z=M*Q,Q={x:e[Z].x+t,y:e[Z].y+z},M={x:e[Z+1].x+t,y:e[Z+1].y+z},U={x:e[Z].x-t,y:e[Z].y-z},t={x:e[Z+1].x-t,y:e[Z+1].y-z},F||((I=a(G[0],G[1],Q,M))&&
D.unshift(I),(L=a(K[0],K[1],U,t))&&D.push(L)),F&&(D.unshift(Q),D.push(U)),J&&(D.unshift(M),D.push(t)),J||(G=[Q,M],K=[U,t]);return D}}();function coordsToPoints$$module$settlements(a){let e=[];for(let n=0;n<a.length;n++)e.push({x:a[n][0],y:a[n][1]});return e}function pointsToCoords$$module$settlements(a){let e=[];for(let n=0;n<a.length;n++)e.push([a[n].x,a[n].y]);return e}
function makeSmoothPolygon$$module$settlements(a){a.push(a[0]);a=turf.polygonSmooth(turf.polygon([a]),{iterations:3});let e="";turf.featureEach(a,(n,t)=>{n=turf.getCoords(turf.getGeom(n))[0];e="M "+n[0][0]+" "+n[0][1]+" ";for(t=1;t<n.length;t++)e=e+"L "+n[t][0]+" "+n[t][1]+" ";e+="Z"});return e}function makePolygon$$module$settlements(a){let e="M "+a[0][0]+" "+a[0][1]+" ";for(let n=1;n<a.length;n++)e=e+"L "+a[n][0]+" "+a[n][1]+" ";return e+"Z"}
function makePath$$module$settlements(a){let e="M "+a[0][0]+" "+a[0][1]+" ";for(let n=1;n<a.length;n++)e=e+"L "+a[n][0]+" "+a[n][1]+" ";return e}function makeCurvedPath$$module$settlements(a){let e="M "+a[0][0]+" "+a[0][1]+" ";for(let n=1;n<a.length;n++)e=e+"L "+a[n][0]+" "+a[n][1]+" ";return e}
function makePolygonFromLine$$module$settlements(a,e){a=pointsToCoords$$module$settlements(thickLineToPolygon$$module$settlements(coordsToPoints$$module$settlements(a),e));e="M "+a[0][0]+" "+a[0][1]+" ";for(let n=1;n<a.length;n++)e=e+"L "+a[n][0]+" "+a[n][1]+" ";return e+"Z"}
function makeSmoothPolygonFromLine$$module$settlements(a,e){a=a.slice();e=pointsToCoords$$module$settlements(thickLineToPolygon$$module$settlements(coordsToPoints$$module$settlements(a),e));e.push(e[0]);e=turf.polygon([e]);return makeSmoothPolygon$$module$settlements(e.geometry.coordinates[0])}
function makeMergedPolygon$$module$settlements(a,e,n){a=a.slice();e[0].push(e[0][0]);e=turf.polygon(e);const t=turf.centerOfMass(e).geometry.coordinates;a.unshift(t);n=pointsToCoords$$module$settlements(thickLineToPolygon$$module$settlements(coordsToPoints$$module$settlements(a),n));n.push(n[0]);n=turf.polygon([n]);n=turf.union(e,n);return makeSmoothPolygon$$module$settlements(n.geometry.coordinates[0])}
class Marker$$module$settlements extends k$$module$libs$preact{constructor(){super();this.setState({hover:"",radius:3})}mouseover(){this.setState({hover:"marker-label-hover",radius:7})}mouseout(){this.setState({hover:"",radius:3})}getLocationURL(){return"/sandbox/"+this.props.instance+"/location/"+this.props.uuid}render(a,e){let n=5E4>a.zoom_factor?1:Math.sqrt(5E4)/Math.sqrt(a.zoom_factor);n=.3>n?.3:n;const t=""!=e.hover?html$$module$settlements`
            <g
              id="active-poi-label"
              transform="translate( ${a.coords.x} , ${a.coords.y}) rotate(${-1*a.rotate})"
            >
              <text
                transform="translate( 0, ${-20*n}) scale(${n})"
                class="marker-label ${e.hover}"
                font-size="0.8em"
                text-anchor="middle"
              >
                ${a.title}
              </text>
            </g>
          `:html$$module$settlements``;return html$$module$settlements`
      ${t}

      <g
        transform="translate( ${a.coords.x} , ${a.coords.y}) rotate(${-1*a.rotate})"
      >
        <circle
          class="marker-circle"
          transform="scale(${n})"
          r="${e.radius}"
          fill="${a.uuid==a.location?"#00ff00":"#ff0000"}"
        >
        </circle>
        <a href="${this.getLocationURL()}">
          <circle
            transform="scale(${n})"
            opacity="0"
            cursor="pointer"
            r="${2*e.radius}"
            onmouseover="${()=>{this.mouseover()}}"
            onmouseout="${()=>{this.mouseout()}}"
          >
          </circle
        ></a>
      </g>
    `}}var module$settlements={};module$settlements.Marker=Marker$$module$settlements;module$settlements.makeCurvedPath=makeCurvedPath$$module$settlements;module$settlements.makeMergedPolygon=makeMergedPolygon$$module$settlements;module$settlements.makePath=makePath$$module$settlements;module$settlements.makePolygon=makePolygon$$module$settlements;module$settlements.makeSmoothPolygon=makeSmoothPolygon$$module$settlements;module$settlements.makeSmoothPolygonFromLine=makeSmoothPolygonFromLine$$module$settlements;const html$$module$citymap=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);function Towers$$module$citymap(a){if(!(2>a.coords.length))return html$$module$citymap`
    ${a.coords.map(e=>html$$module$citymap` <circle cx="${e[0]}" cy="${e[1]}" r=${8} fill="#292929" /> `)};
  `}class Wall$$module$citymap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$citymap`<g
      ><path
        d="${makePath$$module$settlements(a.coords)}"
        stroke="#292929"
        stroke-width="8"
        fill="none"
    /></g>`}}class Estuary$$module$citymap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$citymap`<g>
      <path
        d="${makeMergedPolygon$$module$settlements(a.river,a.water,a.river_width)}"
        fill="#1166aa"
        stroke="#1166aa"
        stroke-width="10"
        fill="#1166aa"
      />
      <path
        d="${makeMergedPolygon$$module$settlements(a.river,a.water,a.river_width)}"
        stroke="#3399cc"
        stroke-width="2"
        fill="#1166aa"
      />
    </g>`}}class River$$module$citymap extends k$$module$libs$preact{constructor(){super()}render(a){const e=a.coords.slice();return html$$module$citymap`<g>
      <path
        d="${makeSmoothPolygonFromLine$$module$settlements(e,a.width)}"
        fill="#1166aa"
        stroke="none"
      />
      <path
        d="${makeSmoothPolygonFromLine$$module$settlements(e,.8*a.width)}"
        stroke="#3399cc"
        stroke-width="1"
        fill="none"
      />
    </g>`}}function Square$$module$citymap(a){return html$$module$citymap`<g
    ><path d="${makePolygon$$module$settlements(a.coords[0])}" fill="#00000022"
  /></g>`}class Building$$module$citymap extends k$$module$libs$preact{constructor(){super()}render(a){if(!(4>a.coords[0].length))return 2==a.coords.length&&a.coords[1]?html$$module$citymap`
          <circle
            cx="${a.coords[0][0][0]}"
            cy="${a.coords[0][0][1]}"
            r="12"
            fill="#ff0000"
          />
        `:html$$module$citymap``,html$$module$citymap`<g
      ><path
        d="${makePolygon$$module$settlements(a.coords[0])}"
        stroke="#181818"
        stroke-width="1"
        fill="#444444"
    /></g>`}}class Water$$module$citymap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$citymap`<g>
      <path
        d="${makeSmoothPolygon$$module$settlements(a.coords[0])}"
        stroke="#1166aa"
        stroke-width="8"
        fill="none"
      />
      <path
        d="${makeSmoothPolygon$$module$settlements(a.coords[0])}"
        stroke="#3399cc"
        stroke-width="2"
        fill="#1166aa"
      />
    </g>`}}
class CityMap$$module$citymap extends k$$module$libs$preact{constructor(){super();this.setState({watabou:null})}fetch_map(a,e,n=!1){const t=window.app.settlements_cache[this.props.uuid];t&&!n&&this.setState({watabou:t.map_data,poi:t.poi});api_call_city$$module$api_shim(a,e).then(z=>{z.map_data.processed_walls=this.preprocess_walls(z.map_data);this.setState({watabou:z.map_data,poi:z.poi});window.app.settlements_cache[this.props.uuid]=z})}componentDidMount(a,e,n){this.fetch_map(this.props.instance,this.props.hex)}componentWillUpdate(a,
e,n){this.props.uuid==a.uuid&&this.props.location==a.location||this.fetch_map(a.instance,a.hex,!0)}preprocess_walls(a){if(!a)return[];let e=[],n=[],t=[],z=[];if("mfcg"!=a.features[0].generator)return[];0<a.features[4].geometries.length&&(t=t.concat(a.features[4].geometries[0].coordinates));a.features[13]&&(n=n.concat(a.features[13].coordinates[0][0]));0<a.features[2].geometries.length&&a.features[2].geometries.map(F=>{z=z.concat(F.coordinates)});a.features[3].geometries.map(F=>{F=F.coordinates[0];
let J=[],G=null;for(const K of F){let I=0;for(const L of n)if(K[0]==L[0]&&K[1]==L[1]&&(I++,1==I)){G=K;break}1!=I?(0==J.length&&G&&(J=[G]),J.push(K)):(J.push(K),1<J.length&&e.push(J),J=[])}J.push(F[0]);e.push(J)});let D=[];e.map(F=>{let J=[],G=F[F.length-1];for(let L=0;L<F.length;L++){const Q=F[L];var K=L==F.length-1?F[0]:F[L+1],I=!1;let M=0;for(const U of t)if(Q[0]==U[0]&&Q[1]==U[1]){I=!0;M=.2;break}for(const U of z)if(Q[0]==U[0]&&Q[1]==U[1]){M=.1;I=!0;break}I?(I=M*K[0]+(1-M)*Q[0],K=M*K[1]+(1-M)*
Q[1],J.push([M*G[0]+(1-M)*Q[0],M*G[1]+(1-M)*Q[1]]),D.push(J),J=[[I,K]]):J.push(Q);G=Q}D.push(J)});return D}render(a,e){if(!e.watabou||"mfcg"!=e.watabou.features[0].generator)return html$$module$citymap``;const n=e.watabou.features[0].coast_dir||0,t=void 0!==e.watabou.features[0].coast_dir?-900:0,z=e.watabou.features[0].riverWidth;let D=html$$module$citymap``;0<e.watabou.features[4].geometries.length&&13<e.watabou.features.length?D=html$$module$citymap` <${Estuary$$module$citymap}
        river=${e.watabou.features[4].geometries[0].coordinates}
        water=${e.watabou.features[13].coordinates[0]}
        river_width=${e.watabou.features[0].riverWidth}
      />`:0<e.watabou.features[4].geometries.length?D=html$$module$citymap`
        ${e.watabou.features[4].geometries.map(G=>html$$module$citymap` <${River$$module$citymap}
            width=${z}
            coords=${G.coordinates}
          />`)}
      `:e.watabou.features[13]&&(D=html$$module$citymap`
        ${e.watabou.features[13].coordinates.map(G=>html$$module$citymap` <${Water$$module$citymap} coords=${G} />`)}
      `);const F=e.watabou.features[0].rotate_river,J=F?F:60*n;return html$$module$citymap`
      <defs>
        <radialGradient id="${a.hex}_gradient_alpha">
          <stop
            offset=${"City"==a.feature?"30%":"20%"}
            stop-color="white"
          />
          <stop
            offset=${"City"==a.feature?"45%":"30%"}
            stop-color="black"
          />
        </radialGradient>
      </defs>
      <mask id="${a.hex}">
        <polygon
          fill="#ffffff"
          points="1000,-1800 -1000,-1800 -2000,000 -1000,1800 1000,1800 2000,0"
        />
      </mask>
      <g
        transform="scale(0.005 0.005) rotate(${J})"
        mask="url(#${a.hex})"
      >
        <mask id="${a.hex}_gradient_mask">
          <polygon
            transform="scale(${t?1.5:1}) translate(0,${.2*t})"
            fill="url('#${a.hex}_gradient_alpha')"
            points="1000,-1800 -1000,-1800 -2000,000 -1000,1800 1000,1800 2000,0"
          />
        </mask>
        <g
          transform="translate(0,${t})"
          mask="url(#${a.hex}_gradient_mask)"
        >
          ${e.watabou.features[8].coordinates.map(G=>html$$module$citymap` <${Square$$module$citymap} coords=${G} />`)}
          ${D}
          ${e.watabou.features[6].coordinates.map(G=>html$$module$citymap` <${Building$$module$citymap} coords=${G} />`)}
          <!--FIXME: This is too wasteful to loop through all the buildings.-->
          ${e.watabou.processed_walls.map(G=>html$$module$citymap` <${Wall$$module$citymap} coords=${G} />`)}
          ${e.watabou.processed_walls.map(G=>html$$module$citymap` <${Towers$$module$citymap} coords=${G} />`)}
          ${e.poi.map(G=>html$$module$citymap` <${Marker$$module$settlements}
              coords=${G.coords}
              uuid=${G.uuid}
              instance=${a.instance}
              title=${G.title}
              radius="4"
              rotate=${J}
              location=${a.location}
              zoom_factor=${a.zoom_factor/5}
            />`)}
          <use xlink:href="#active-poi-label" />
        </g>
      </g>
      <polygon
        points="5,-9 -5,-9 -10,0 -5,9 5,9 10,0"
        stroke="#333"
        stroke-width="0.3"
        fill="none"
      />
    `}}var module$citymap={};module$citymap.CityMap=CityMap$$module$citymap;const PERLIN_YWRAPB$$module$libs$perlin=4,PERLIN_YWRAP$$module$libs$perlin=1<<PERLIN_YWRAPB$$module$libs$perlin,PERLIN_ZWRAPB$$module$libs$perlin=8,PERLIN_ZWRAP$$module$libs$perlin=1<<PERLIN_ZWRAPB$$module$libs$perlin,PERLIN_SIZE$$module$libs$perlin=4095;let perlin_octaves$$module$libs$perlin=4,perlin_amp_falloff$$module$libs$perlin=.5;const scaled_cosine$$module$libs$perlin=a=>.5*(1-Math.cos(a*Math.PI));let perlin$$module$libs$perlin;
function noise$$module$libs$perlin(a,e=0,n=0){if(null==perlin$$module$libs$perlin){perlin$$module$libs$perlin=Array(PERLIN_SIZE$$module$libs$perlin+1);for(var t=0;t<PERLIN_SIZE$$module$libs$perlin+1;t++)perlin$$module$libs$perlin[t]=Math.random()}0>a&&(a=-a);0>e&&(e=-e);0>n&&(n=-n);t=Math.floor(a);let z=Math.floor(e),D=Math.floor(n);a-=t;e-=z;n-=D;let F,J,G=0,K=.5,I,L,Q;for(let M=0;M<perlin_octaves$$module$libs$perlin;M++){let U=t+(z<<PERLIN_YWRAPB$$module$libs$perlin)+(D<<PERLIN_ZWRAPB$$module$libs$perlin);
F=scaled_cosine$$module$libs$perlin(a);J=scaled_cosine$$module$libs$perlin(e);I=perlin$$module$libs$perlin[U&PERLIN_SIZE$$module$libs$perlin];I+=F*(perlin$$module$libs$perlin[U+1&PERLIN_SIZE$$module$libs$perlin]-I);L=perlin$$module$libs$perlin[U+PERLIN_YWRAP$$module$libs$perlin&PERLIN_SIZE$$module$libs$perlin];L+=F*(perlin$$module$libs$perlin[U+PERLIN_YWRAP$$module$libs$perlin+1&PERLIN_SIZE$$module$libs$perlin]-L);I+=J*(L-I);U+=PERLIN_ZWRAP$$module$libs$perlin;L=perlin$$module$libs$perlin[U&PERLIN_SIZE$$module$libs$perlin];
L+=F*(perlin$$module$libs$perlin[U+1&PERLIN_SIZE$$module$libs$perlin]-L);Q=perlin$$module$libs$perlin[U+PERLIN_YWRAP$$module$libs$perlin&PERLIN_SIZE$$module$libs$perlin];Q+=F*(perlin$$module$libs$perlin[U+PERLIN_YWRAP$$module$libs$perlin+1&PERLIN_SIZE$$module$libs$perlin]-Q);L+=J*(Q-L);I+=scaled_cosine$$module$libs$perlin(n)*(L-I);G+=I*K;K*=perlin_amp_falloff$$module$libs$perlin;t<<=1;a*=2;z<<=1;e*=2;D<<=1;n*=2;1<=a&&(t++,a--);1<=e&&(z++,e--);1<=n&&(D++,n--)}return G}
function noiseDetail$$module$libs$perlin(a,e){0<a&&(perlin_octaves$$module$libs$perlin=a);0<e&&(perlin_amp_falloff$$module$libs$perlin=e)}
function noiseSeed$$module$libs$perlin(a){const e=(()=>{let n,t;return{setSeed(z){t=n=(null==z?4294967296*Math.random():z)>>>0},getSeed(){return n},rand(){t=(1664525*t+1013904223)%4294967296;return t/4294967296}}})();e.setSeed(a);perlin$$module$libs$perlin=Array(PERLIN_SIZE$$module$libs$perlin+1);for(a=0;a<PERLIN_SIZE$$module$libs$perlin+1;a++)perlin$$module$libs$perlin[a]=e.rand()}var module$libs$perlin={};module$libs$perlin.noise=noise$$module$libs$perlin;module$libs$perlin.noiseSeed=noiseSeed$$module$libs$perlin;function metaball$$module$metaballs(a){a.forEach(t=>t.c=[t.x,t.y]);let e="";for(let t=0;t<a.length;t++){var n=a.slice(0,3);a.push(a.shift());const z=curvesBetweenCircles$$module$metaballs(n[0].r,n[1].r,n[0].c,n[1].c);n=curvesBetweenCircles$$module$metaballs(n[1].r,n[2].r,n[1].c,n[2].c);0===t&&(e+=`M ${z.p[1][0]},${z.p[1][1]} `);e+=`C ${z.h[1][0]},${z.h[1][1]} ${z.h[3][0]},${z.h[3][1]} ${z.p[3][0]},${z.p[3][1]}`;e+=`A ${n.r1}, ${n.r1}, 1, 0, 1, ${n.p[1][0]}, ${n.p[1][1]}`}return e+"Z"}
function metablob$$module$metaballs(a,e){let n=[];for(let t=0;6>t;t++){const z=getVector$$module$metaballs([a.x,a.y],Math.PI/3*t,a.r*(.5*noise$$module$libs$perlin(e)+.5));n.push({x:z[0],y:z[1],r:1.5*noise$$module$libs$perlin(e*t)+a.r/2})}return metaball$$module$metaballs(n)}
function curvesBetweenCircles$$module$metaballs(a,e,n,t,z=2.4,D=.5){var F=Math.PI/2;const J=dist$$module$metaballs(n,t);var G=0,K=0;if(0===a||0===e||J<=Math.abs(a-e))return null;J<a+e&&(G=Math.acos((a*a+J*J-e*e)/(2*a*J)),K=Math.acos((e*e+J*J-a*a)/(2*e*J)));var I=angle$$module$metaballs(t,n),L=Math.acos((a-e)/J),Q=I+G+(L-G)*D,M=I-G-(L-G)*D;G=I+Math.PI-K-(Math.PI-K-L)*D;I=I-Math.PI+K+(Math.PI-K-L)*D;K=getVector$$module$metaballs(n,Q,a);n=getVector$$module$metaballs(n,M,a);L=getVector$$module$metaballs(t,
G,e);t=getVector$$module$metaballs(t,I,e);const U=a+e;z=Math.min(D*z,dist$$module$metaballs(K,L)/U)*Math.min(1,2*J/(a+e));D=a*z;z*=e;Q=getVector$$module$metaballs(K,Q-F,D);M=getVector$$module$metaballs(n,M+F,D);G=getVector$$module$metaballs(L,G+F,z);F=getVector$$module$metaballs(t,I-F,z);return{p:[K,n,L,t],h:[Q,M,G,F],escaped:J>a,r:e,r1:a}}function dist$$module$metaballs([a,e],[n,t]){return((a-n)**2+(e-t)**2)**.5}function angle$$module$metaballs([a,e],[n,t]){return Math.atan2(e-t,a-n)}
function getVector$$module$metaballs([a,e],n,t){return[a+t*Math.cos(n),e+t*Math.sin(n)]}var module$metaballs={};module$metaballs.metaball=metaball$$module$metaballs;module$metaballs.metablob=metablob$$module$metaballs;const html$$module$villagemap=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);class Road$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$villagemap`<g>
      <path
        d="${makeCurvedPath$$module$settlements(a.coords)}"
        stroke="#333"
        stroke-width="2"
        fill="none"
    /></g>`}}class Tree$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){a=metablob$$module$metaballs({x:a.coords[0],y:a.coords[1],r:6},a.index);return html$$module$villagemap`
      <path d="${a}" stroke="#405040" fill="#475f47" stroke-width="0.75" />
    `}}class Building$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){2==a.coords.length&&a.coords[1]?html$$module$villagemap`
          <circle
            cx="${a.coords[0][0][0]}"
            cy="${a.coords[0][0][1]}"
            r="12"
            fill="#ff0000"
          />
        `:html$$module$villagemap``;return html$$module$villagemap`<g>
      <path
        d="${makePolygon$$module$settlements(a.coords[0])}"
        stroke="#222"
        stroke-width="1"
        fill="#444444"
      />
    </g>`}}
class Water$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){let e=a.coords[0];a.coast&&0==a.index&&1==a.coords.length&&15<e.length&&(e[0][0]*=2,e[0][1]-=280,e[1][0]*=1.9,e[1][1]-=160,e[2][0]*=1.8,e[2][1]-=130,e[3][0]*=1.7,e[3][1]-=120,e[4][0]*=1.6,e[4][1]-=100,e[5][0]*=1.5,e[5][1]-=80,e[6][0]*=1.3,e[6][1]-=60,e[7][0]*=1.1,e[7][1]-=30,e[e.length-3][0]*=2,e[e.length-3][1]-=100,e[e.length-1][0]*=2.1,e[e.length-1][1]-=100,e[e.length-2][0]*=2.3,e[e.length-2][1]-=100,a.coords.push([]));
return html$$module$villagemap`<g>
      <path
        d="${makeSmoothPolygon$$module$settlements(e)}"
        stroke="#1166aa"
        stroke-width="4"
        fill="#1166aa"
      >
      </path>
      <path
        d="${makeSmoothPolygon$$module$settlements(e)}"
        stroke="#3399cc"
        stroke-width="1"
        fill="#1166aa"
      >
      </path>
    </g>`}}class Square$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$villagemap`<g
      ><path
        d="${makeSmoothPolygon$$module$settlements(a.coords[0])}"
        stroke="#333"
        stroke-width="2"
        fill="#998877"
    /></g>`}}class Field$$module$villagemap extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$villagemap`<g>
      <path d="${makeSmoothPolygon$$module$settlements(a.coords[0])}" fill="#596f39" />
      <path
        d="${makeSmoothPolygon$$module$settlements(a.coords[0])}"
        stroke="#506030"
        stroke-width="1"
        fill="url(#${a.hex}_diagonalHatch)"
    /></g>`}}
class VillageMap$$module$villagemap extends k$$module$libs$preact{constructor(){super();this.setState({watabou:null})}fetch_map(a,e,n=!1){const t=window.app.settlements_cache[this.props.uuid];t&&!n&&this.setState({watabou:t.map_data,poi:t.poi});api_call_city$$module$api_shim(a,e).then(z=>{this.setState({watabou:z.map_data,poi:z.poi});window.app.settlements_cache[this.props.uuid]=z})}componentDidMount(a,e,n){this.fetch_map(this.props.instance,this.props.hex)}componentWillUpdate(a,e,n){this.props.uuid==a.uuid&&
this.props.location==a.location||this.fetch_map(a.instance,a.hex,!0)}render(a,e){if(null===e.watabou||"vg"!=e.watabou.features[0].generator)return html$$module$villagemap``;const n=void 0!==e.watabou.features[0].coast_dir,t=e.watabou.features[0].coast_dir||0,z=void 0!==e.watabou.features[0].coast_dir?-600:0;let D=html$$module$villagemap``,F=html$$module$villagemap``,J=html$$module$villagemap``,G=html$$module$villagemap``;for(const I of e.watabou.features)"squares"==I.id&&(G=html$$module$villagemap`
          ${I.coordinates.map(L=>html$$module$villagemap` <${Square$$module$villagemap} coords=${L} />`)}
        `),"water"==I.id&&(D=html$$module$villagemap`
          ${[I.coordinates.at(-1)].map((L,Q)=>html$$module$villagemap` <${Water$$module$villagemap}
              coast=${n}
              coords=${L}
              index=${Q}
            />`)}
        `),"fields"==I.id&&(F=html$$module$villagemap`
          ${I.coordinates.map(L=>html$$module$villagemap` <${Field$$module$villagemap} coords=${L} hex=${a.hex} />`)}
        `),"trees"==I.id&&(J=html$$module$villagemap`
          ${I.coordinates.map((L,Q)=>{if(0==Q%8)return html$$module$villagemap` <${Tree$$module$villagemap} coords=${L} index=${Q} />`})}
        `);const K=60*t;return html$$module$villagemap`
      <defs>
        <radialGradient id="${a.hex}_gradient_alpha">
          <stop offset="20%" stop-color="white" />
          <stop offset="23%" stop-color="black" />
        </radialGradient>
      </defs>

      <pattern
        id="${a.hex}_diagonalHatch"
        patternUnits="userSpaceOnUse"
        width="4"
        height="4"
      >
        <path
          d="M-1,1 l2,-2
           M0,4 l4,-4
           M3,5 l2,-2"
          style="stroke:#546633; stroke-width:1"
        />
      </pattern>

      <mask id="${a.hex}">
        <polygon
          fill="#ffffff"
          points="500,-900 -500,-900 -1000,000 -500,900 500,900 1000,0"
        />
      </mask>
      <g
        transform="scale(0.01 0.01) rotate(${K})"
        mask="url(#${a.hex})"
      >
        <mask id="${a.hex}_gradient_mask">
          <polygon
            transform="scale(${z?5:1})"
            fill="url('#${a.hex}_gradient_alpha')"
            points="500,-900 -500,-900 -1000,000 -500,900 500,900 1000,0"
          />
        </mask>
        <g
          transform="translate(0,${z})"
          mask="url(#${a.hex}_gradient_mask)"
        >
          ${D} ${F}
          ${e.watabou.features[5].geometries.map(I=>html$$module$villagemap` <${Road$$module$villagemap} coords=${I.coordinates} />`)}
          ${G}
          ${e.watabou.features[2].coordinates.map(I=>html$$module$villagemap` <${Building$$module$villagemap} coords=${I} />`)}
          ${J}
          <!--FIXME: This is too wasteful to loop through all the buildings.-->
          ${e.poi.map(I=>html$$module$villagemap` <${Marker$$module$settlements}
              coords=${I.coords}
              uuid=${I.uuid}
              instance=${a.instance}
              title=${I.title}
              radius="2"
              rotate=${K}
              location=${a.location}
              zoom_factor=${a.zoom_factor}
            />`)}
          <use xlink:href="#active-poi-label" />
        </g>
      </g>
      <polygon
        points="5,-9 -5,-9 -10,0 -5,9 5,9 10,0"
        stroke="#333"
        stroke-width="0.3"
        fill="none"
      />
    `}}var module$villagemap={};module$villagemap.VillageMap=VillageMap$$module$villagemap;const html$$module$dungeonmap=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact),kScale$$module$dungeonmap=.01,kScaleMultiplier$$module$dungeonmap=10*kScale$$module$dungeonmap;function getAreaMaskFillColor$$module$dungeonmap(a){return a.vtt?a.reveal?"#fff":"#000":window.app.hotkey_mode?a.reveal?"#fff":"#666":"#eee"}
class Token$$module$dungeonmap{constructor(a,e,n,t,z,D,F,J,G,K,I=!1){this.uuid=a;this.tuid=e;this.x=n;this.y=t;this.w=D;this.h=F;this.r=z;this.offset=J;this.tid=G;this.light=K;this.pc=I}pointInside(a,e){const n=this.x+this.offset.x,t=this.y+this.offset.y,z=this.w/2,D=this.h/2;return a>=n-z&&a<=n+z&&e>=t-D&&e<=t+D}}class DungeonEntrance$$module$dungeonmap extends k$$module$libs$preact{constructor(){super()}render(a,e){e=0;0==a.dir&&(e=180);3==a.dir&&(e=90);1==a.dir&&(e=270);return html$$module$dungeonmap`
      <g transform="translate(${10*a.x}, ${10*a.y})">
        <g transform="rotate(${e}, 5, 5)">
          <rect x="0" y="1" width="10" height="1" fill="#292828" />
          <rect x="1" y="3" width="8" height="1" fill="#292828" />
          <rect x="2" y="5" width="6" height="1" fill="#292828" />
          <rect x="3" y="7" width="4" height="1" fill="#292828" />
          <rect x="4" y="9" width="2" height="1" fill="#292828" />
        </g>
      </g>
    `}}class DungeonPortal$$module$dungeonmap extends k$$module$libs$preact{constructor(){super()}render(a,e){e=0;"S"==a.wall&&(e=180);"E"==a.wall&&(e=90);"W"==a.wall&&(e=270);if(0==a.type)return html$$module$dungeonmap`
        <g transform="translate(${10*a.x}, ${10*a.y})">
          <g transform="rotate(${e}, 5, 5)">
            <rect x="-1" y="5.5" width="12" height="3" fill="#292828" />
            <rect
              x="2"
              y="5"
              width="6"
              height="4"
              fill="#fff"
              stroke="#292828"
            />
            <title>${a.uuid}</title>
          </g>
        </g>
      `;if(!a.vtt)return html$$module$dungeonmap`
        <g transform="translate(${10*a.x}, ${10*a.y})">
          <g transform="rotate(${e}, 5, 5)">
            <rect x="-1" y="6.5" width="12" height="3" fill="#292828" />
            <text
              transform="translate(3, 9) rotate(90)"
              class="dcoords"
              alignment-baseline="baseline"
              text-anchor="middle"
              >S</text
            >
            <title>${a.uuid}</title>
          </g>
        </g>
      `}}
class DungeonPillars$$module$dungeonmap extends k$$module$libs$preact{constructor(){super()}render(a,e){if(50>a.w*a.h||1==a.w||1==a.h)return html$$module$dungeonmap``;e=[];if(a.w!=a.h)if(a.w<=a.h)for(var n=a.y+1;n<a.y+a.h;n++)e.push({x:10*(a.x+1),y:10*n}),e.push({x:10*(a.x+a.w-1),y:10*n});else for(n=a.x+1;n<a.x+a.w;n++)e.push({x:10*n,y:10*(a.y+1)}),e.push({x:10*n,y:10*(a.y+a.h-1)});return html$$module$dungeonmap`${e.map(t=>html$$module$dungeonmap` <circle cx="${t.x}" cy="${t.y}" r="2" fill="#212121" /> `)}`}}
class DungeonLink$$module$dungeonmap extends k$$module$libs$preact{clicked(a,e){if(window.app.inhibit_click)window.app.inhibit_click=!1;else if(a,window.app.token_hotkey_mode&&window.app.vtt_referee){let n=document.getElementById("canvas"),t=n.createSVGPoint();t.x=e.clientX;t.y=e.clientY;e=t.matrixTransform(n.getScreenCTM().inverse());this.props.onToken(a,e)}else window.app.kill_hotkey_mode||this.props.onClick(a,window.app.hotkey_mode&&window.app.vtt_referee)}}function TorchMask$$module$dungeonmap(a){return html$$module$dungeonmap` <mask id="LightMask${a.uuid}">
    <rect x="-1000" y="-1000" width="2000" height="2000" fill="#000" />
    ${Array.from(window.app.tokens[a.uuid]).map(([,e])=>e.light&&html$$module$dungeonmap` <circle
          cx=${e.x/kScale$$module$dungeonmap}
          cy=${e.y/kScale$$module$dungeonmap}
          r=${e.light}
          fill="url('#TorchGradient${a.uuid}')"
        />`)}
  </mask>`}class DungeonCavernLink$$module$dungeonmap extends DungeonLink$$module$dungeonmap{get_path(a){let e="M "+a[0].x+","+a[0].y+" ";for(let n=1;n<a.length;n++)e=e+"L "+a[n].x+","+a[n].y+" ";return e+" Z"}render(a,e){e=1==a.label_mode?html$$module$dungeonmap`
            <g transform="translate(${a.coords[0]} ${a.coords[1]})">
              <text
                transform="rotate(0)"
                class="dcoords"
                alignment-baseline="baseline"
                text-anchor="middle"
                >${a.number}</text
              >
            </g>
          `:2==a.label_mode&&a.hazard?html$$module$dungeonmap`
            <g transform="translate(${a.coords[0]} ${a.coords[1]})">
              <g>
                <path
                  fill="#333"
                  d="m-0.0171-4.27c-0.495 0.00238-0.991 0.113-1.44 0.326-0.645 0.314-1.36 0.792-1.47 1.56 5.31e-5 0.602 0.165 1.19 0.207 1.79 0.117 0.411-0.416 0.721-0.194 1.13 0.381 0.392 0.576 1.04 1.14 1.2 0.507 0.144 0.296 0.316 0.642 0.664 0.315 0.317 0.821 0.531 1.31 0.46 0.524-0.112 0.788-0.355 1.06-0.704 0.144-0.566 0.971-0.461 1.2-1.03 0.307-0.361 0.757-0.94 0.221-1.35 0.0289-0.708 0.183-1.4 0.227-2.11-0.0347-0.73-0.695-1.22-1.29-1.53-0.492-0.284-1.05-0.421-1.61-0.418zm-1.49 3.69c0.083 0.00119 0.166 0.016 0.244 0.0456 0.347 0.114 0.873 0.28 0.839 0.733-0.116 0.441-0.601 0.695-1.03 0.724-0.544 0.167-0.721-0.429-0.694-0.847-0.0783-0.411 0.282-0.662 0.642-0.657zm3.01 0.0243c0.102-0.00168 0.203 0.00525 0.299 0.0199 0.496 0.314 0.374 1.07 0.0195 1.45-0.552 0.113-1.48-0.199-1.44-0.887 0.211-0.403 0.675-0.572 1.12-0.579zm2.9 0.101c-0.277 0.00347-0.622 0.142-0.769 0.457-0.468 0.731-1.12 1.55-0.969 1.8 0.975-0.709 1.84-0.0859 2.08-0.526 0.214-0.406-0.458-0.699-0.00891-1.33 0.182-0.256-0.0355-0.406-0.33-0.402zm-8.84 0.0584c-0.281 0.00542-0.48 0.154-0.303 0.402 0.449 0.632-0.223 0.925-0.00891 1.33 0.232 0.44 1.1-0.183 2.08 0.526 0.151-0.25-0.501-1.07-0.969-1.8-0.152-0.324-0.514-0.462-0.795-0.456zm4.48 1.39c0.0676 0.00608 0.118 0.119 0.209 0.24 0.233 0.309 0.159 0.55-0.242 0.525-0.563-0.0355-0.402-0.153-0.228-0.464 0.128-0.229 0.202-0.307 0.261-0.301zm1.87 1.41c-0.582 0.0104-0.663 0.888-0.0568 1.04 0.945 0.228 0.125 0.787 0.838 0.778 0.713-0.0093 0.301-0.286 0.438-0.49 0.127-0.19 0.612-0.0972 0.454-0.517-0.159-0.42-0.564-0.158-0.943-0.322-0.319-0.0314-0.498-0.484-0.702-0.49-0.00951-3.01e-4 -0.0189-3.01e-4 -0.0281-2e-4zm-3.85 0.0584c-0.204 0.00598-0.383 0.459-0.702 0.49-0.378 0.164-0.784-0.0982-0.943 0.322-0.159 0.42 0.326 0.327 0.454 0.517 0.137 0.204-0.276 0.481 0.438 0.49 0.713 0.0093-0.107-0.55 0.838-0.778 0.616-0.157 0.523-1.06-0.0849-1.04z"
                />
              </g>
            </g>
          `:html$$module$dungeonmap``;e=html$$module$dungeonmap` <a onClick=${n=>this.clicked(a.uuid,n)}>
      <path d="${this.get_path(a.polygon)}" fill="transparent" />${e}</a
    >`;return html$$module$dungeonmap`<g>${e} </g>`}}
class DungeonCavern$$module$dungeonmap extends k$$module$libs$preact{constructor(){super()}make_line(a,e,n,t,z,D,F,J=!1,G=!1){let K=a=0,I=0;e!=t&&(a=5,K=(t-e)/5);n!=z&&(a=5,I=(z-n)/5);t="";for(J=J?0:1;J<=a-(G?0:1);J++)z=noise$$module$libs$perlin(this.inc),z*=1==J||J==a-1?.6:1.25,z*=0==J||J==a?.2:1.25,this.inc+=.2,t=t+" L "+(e+z*D+J*K)+","+(n+z*F+J*I);return t}get_path(a){if(this.cache&&a==this.cached_polygon)return this.cache;let e="M "+a[0].x+","+a[0].y+" ";for(let n=1;n<a.length;n++){const t=1<
a[n].c,z=1<a[n-1].c;if(z&&t){e=e+"L "+a[n].x+","+a[n].y+" ";continue}const D=[-1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,-1,1,-1,1,1];this.rvi=this.rvi==D.length-1?0:this.rvi+1;let F=D[this.rvi];this.rvi=this.rvi==D.length-1?0:this.rvi+1;e+=this.make_line(this.props,a[n-1].x,a[n-1].y,a[n].x,a[n].y,F,D[this.rvi],z,t)}e+=this.make_line(this.props,a[a.length-1].x,a[a.length-1].y,a[0].x,a[0].y,0,0);this.cache=e+" Z";this.cached_polygon=a;return this.cache}render(a,e){this.rvi=this.inc=0;e=getAreaMaskFillColor$$module$dungeonmap(a);
a=html$$module$dungeonmap`<path
      d="${this.get_path(a.polygon)}"
      stroke="${e}"
      stroke-width="1"
      fill="${e}"
    />`;return html$$module$dungeonmap`<g>${a} </g>`}}class DungeonArea$$module$dungeonmap extends k$$module$libs$preact{constructor(){super()}make_line(a,e,n,t,z,D,F){let J=0,G=0,K=0;e!=t&&(J=5*a.w,G=e>t?-2:2);n!=z&&(J=5*a.h,K=n>z?-2:2);a="";t=0;for(z=1;z<=J;z++){let I=noise$$module$libs$perlin(t);I*=2==z||z==J-2?1:1==z||z==J-1?.5:0==z||z==J?.3:2;t+=.3;a=a+" L "+(e+I*D+z*G)+","+(n+I*F+z*K)}return a}getPortalMask(a,e){return"E"==a.wall?html$$module$dungeonmap`<rect
        x="${10*a.x}"
        y="${10*a.y-.2}"
        width="3"
        height="10.4"
        fill="${e}"
      />`:"W"==a.wall?html$$module$dungeonmap`<rect
        x="${10*a.x+7}"
        y="${10*a.y-.2}"
        width="3"
        height="10.4"
        fill="${e}"
      />`:"N"==a.wall?html$$module$dungeonmap`<rect
        x="${10*a.x-.2}"
        y="${10*a.y+7}"
        width="10.4"
        height="3"
        fill="${e}"
      />`:"S"==a.wall?html$$module$dungeonmap`<rect
        x="${10*a.x-.2}"
        y="${10*a.y}"
        width="10.4"
        height="3"
        fill="${e}"
      />`:html$$module$dungeonmap``}get_path(a){const e=10*a.x+.25,n=e+10*a.w,t=10*a.y+.25,z=t+10*a.h;return this.cache="M "+e+","+t+this.make_line(a,e,t,n,t,0,-1)+this.make_line(a,n,t,n,z,1,0)+this.make_line(a,n,z,e,z,0,1)+this.make_line(a,e,z,e,t,-1,0)+" Z"}render(a,e){e=a.vbx-0;var n=a.vby-0,t=a.vby+a.vbh+0;if(!(a.x*kScaleMultiplier$$module$dungeonmap>a.vbx+a.vbw+0||a.y*kScaleMultiplier$$module$dungeonmap>t||a.x*kScaleMultiplier$$module$dungeonmap+a.w*kScaleMultiplier$$module$dungeonmap<e||a.y*
kScaleMultiplier$$module$dungeonmap+a.h*kScaleMultiplier$$module$dungeonmap<n)){e=getAreaMaskFillColor$$module$dungeonmap(a);n=html$$module$dungeonmap`<rect
      x="${10*a.x+.25}"
      y="${10*a.y+.25}"
      width="${10*a.w}"
      height="${10*a.h}"
      fill="${e}"
    />`;3==a.lod&&(n=html$$module$dungeonmap`<path d="${this.get_path(a)}" fill="${e}" />`);t=[];if(a.portals)for(const z of a.portals)0==z.type&&t.push(this.getPortalMask(z,e));return html$$module$dungeonmap`<g
      >${n}
      <${(a.reveal||!a.vtt)&&DungeonPillars$$module$dungeonmap}
        x=${a.x}
        y=${a.y}
        w=${a.w}
        h=${a.h}
      />
      ${t.map(z=>z)}
    </g>`}}}const vals$$module$dungeonmap=[{x:-1,y:0,r:.3},{x:-1,y:1,r:.6},{x:1,y:2,r:.2},{x:0,y:1,r:.4},{x:0,y:0,r:1},{x:1,y:2,r:.2},{x:-1,y:-1,r:.5},{x:0,y:0,r:.8},{x:2,y:1,r:.2},{x:0,y:0,r:.6},{x:0,y:0,r:1.3},{x:1,y:0,r:.9}];function DungeonCavernStains$$module$dungeonmap(a){let e=0;return html$$module$dungeonmap`
    ${a.polygon.map(n=>{let t=[];t.push(vals$$module$dungeonmap[e]);e=e==vals$$module$dungeonmap.length-1?0:e+1;t.push(vals$$module$dungeonmap[e]);e=e==vals$$module$dungeonmap.length-1?0:e+1;t.push(vals$$module$dungeonmap[e]);e=e==vals$$module$dungeonmap.length-1?0:e+1;t.push(vals$$module$dungeonmap[e]);e=e==vals$$module$dungeonmap.length-1?0:e+1;if(1==n.c&&1==Math.floor(Math.abs(n.x))%3)return html$$module$dungeonmap`${t.map(z=>html$$module$dungeonmap`<circle
            cx="${n.x+z.x}"
            cy="${n.y+z.y}"
            r="${z.r}"
            fill="#212121"
          />`)}`})}
  `}class DungeonAreaLink$$module$dungeonmap extends DungeonLink$$module$dungeonmap{render(a,e){e=a.vbx-0;const n=a.vby-0,t=a.vby+a.vbh+0;if(!(a.x*kScaleMultiplier$$module$dungeonmap>a.vbx+a.vbw+0||a.y*kScaleMultiplier$$module$dungeonmap>t||a.x*kScaleMultiplier$$module$dungeonmap+a.w*kScaleMultiplier$$module$dungeonmap<e||a.y*kScaleMultiplier$$module$dungeonmap+a.h*kScaleMultiplier$$module$dungeonmap<n))return e=html$$module$dungeonmap``,0!=a.t&&1==a.label_mode&&(e=html$$module$dungeonmap`
        <g
          transform="translate(${10*a.x+10*a.w/2} ${10*a.y+10*a.h/2+2})"
        >
          <text
            transform="rotate(0)"
            class="dcoords"
            alignment-baseline="baseline"
            text-anchor="middle"
            >${a.n}</text
          >
        </g>
      `),0!=a.t&&2==a.label_mode&&a.hazard&&(e=html$$module$dungeonmap`
        <g
          transform="translate(${10*a.x+10*a.w/2} ${10*a.y+10*a.h/2+2})"
        >
          <g>
            <path
              fill="#333"
              d="m-0.0171-4.27c-0.495 0.00238-0.991 0.113-1.44 0.326-0.645 0.314-1.36 0.792-1.47 1.56 5.31e-5 0.602 0.165 1.19 0.207 1.79 0.117 0.411-0.416 0.721-0.194 1.13 0.381 0.392 0.576 1.04 1.14 1.2 0.507 0.144 0.296 0.316 0.642 0.664 0.315 0.317 0.821 0.531 1.31 0.46 0.524-0.112 0.788-0.355 1.06-0.704 0.144-0.566 0.971-0.461 1.2-1.03 0.307-0.361 0.757-0.94 0.221-1.35 0.0289-0.708 0.183-1.4 0.227-2.11-0.0347-0.73-0.695-1.22-1.29-1.53-0.492-0.284-1.05-0.421-1.61-0.418zm-1.49 3.69c0.083 0.00119 0.166 0.016 0.244 0.0456 0.347 0.114 0.873 0.28 0.839 0.733-0.116 0.441-0.601 0.695-1.03 0.724-0.544 0.167-0.721-0.429-0.694-0.847-0.0783-0.411 0.282-0.662 0.642-0.657zm3.01 0.0243c0.102-0.00168 0.203 0.00525 0.299 0.0199 0.496 0.314 0.374 1.07 0.0195 1.45-0.552 0.113-1.48-0.199-1.44-0.887 0.211-0.403 0.675-0.572 1.12-0.579zm2.9 0.101c-0.277 0.00347-0.622 0.142-0.769 0.457-0.468 0.731-1.12 1.55-0.969 1.8 0.975-0.709 1.84-0.0859 2.08-0.526 0.214-0.406-0.458-0.699-0.00891-1.33 0.182-0.256-0.0355-0.406-0.33-0.402zm-8.84 0.0584c-0.281 0.00542-0.48 0.154-0.303 0.402 0.449 0.632-0.223 0.925-0.00891 1.33 0.232 0.44 1.1-0.183 2.08 0.526 0.151-0.25-0.501-1.07-0.969-1.8-0.152-0.324-0.514-0.462-0.795-0.456zm4.48 1.39c0.0676 0.00608 0.118 0.119 0.209 0.24 0.233 0.309 0.159 0.55-0.242 0.525-0.563-0.0355-0.402-0.153-0.228-0.464 0.128-0.229 0.202-0.307 0.261-0.301zm1.87 1.41c-0.582 0.0104-0.663 0.888-0.0568 1.04 0.945 0.228 0.125 0.787 0.838 0.778 0.713-0.0093 0.301-0.286 0.438-0.49 0.127-0.19 0.612-0.0972 0.454-0.517-0.159-0.42-0.564-0.158-0.943-0.322-0.319-0.0314-0.498-0.484-0.702-0.49-0.00951-3.01e-4 -0.0189-3.01e-4 -0.0281-2e-4zm-3.85 0.0584c-0.204 0.00598-0.383 0.459-0.702 0.49-0.378 0.164-0.784-0.0982-0.943 0.322-0.159 0.42 0.326 0.327 0.454 0.517 0.137 0.204-0.276 0.481 0.438 0.49 0.713 0.0093-0.107-0.55 0.838-0.778 0.616-0.157 0.523-1.06-0.0849-1.04z"
            />
          </g>
        </g>
      `),html$$module$dungeonmap`<a onClick=${z=>this.clicked(a.uuid,z)}
      ><rect
        x="${10*a.x}"
        y="${10*a.y}"
        width="${10*a.w}"
        height="${10*a.h}"
        fill="transparent"
      />
      ${e}
    </a>`}}function DungeonCaveMap$$module$dungeonmap(a){return html$$module$dungeonmap`
    <g transform="scale(${kScale$$module$dungeonmap}) rotate(0)">
      <g>
        <mask id="FilterMask">
          <rect
            x="-1000"
            y="-1000"
            width="2000"
            height="2000"
            filter="url(#noise)"
          />
        </mask>
        <${a.vtt&&TorchMask$$module$dungeonmap} uuid=${a.uuid} />
        <mask id="AreasMask${a.uuid}">
          <g mask="url(#LightMask${a.uuid})">
            ${a.dungeon.caverns.map(e=>html$$module$dungeonmap`<${DungeonCavern$$module$dungeonmap}
                lod="${a.lod}"
                reveal="${e.reveal}"
                polygon="${e.polygon}"
                offset=${a.offset}
                dim=${a.dim}
                vtt=${a.vtt}
              />`)}
          </g>
        </mask>
      </g>
      <!--g mask="url(#AreasMask)"-->
      <g mask="url(#AreasMask${a.uuid})">
        <rect x="-1000" y="-1000" width="2000" height="2000" fill="#d5d1ce" />
        <g>
          <rect
            class="cgrid"
            x="-1000"
            y="-1000"
            width="2000"
            height="2000"
            mask="url(#FilterMask)"
            fill="url(#grid)"
          />
        </g>
      </g>
      <g>
        ${a.dungeon.caverns.map(e=>html$$module$dungeonmap`<${DungeonCavernStains$$module$dungeonmap} polygon="${e.polygon}" />`)}
      </g>
      <g>
        ${a.vtt||a.dungeon.caverns.map(e=>html$$module$dungeonmap`<${DungeonCavernLink$$module$dungeonmap}
            onClick=${a.onClick}
            onToken=${a.onToken}
            uuid=${e.uuid}
            coords=${e.center}
            number=${e.n}
            hazard=${e.hazard}
            lod="${a.lod}"
            polygon="${e.polygon}"
            offset=${a.offset}
            dim=${a.dim}
            label_mode=${a.label_mode}
          />`)}
      </g>

      <g>
        ${a.vtt||a.dungeon.points.map(e=>html$$module$dungeonmap`<rect
            x=${e.x-3}
            y=${e.y-3}
            width="6"
            height="6"
            fill="#ff0000"
          />`)}
      </g>
    </g>
  `}function DungeonStructureMap$$module$dungeonmap(a){return html$$module$dungeonmap` <g transform="scale(${kScale$$module$dungeonmap}) rotate(0)">
    <g>
      <mask id="FilterMask">
        <rect
          x="-1000"
          y="-1000"
          width="2000"
          height="2000"
          filter="url(#noise)"
        />
      </mask>
      <${a.vtt&&TorchMask$$module$dungeonmap} uuid=${a.uuid} />
      <mask id="AreasMask${a.uuid}">
        <g mask="url(#LightMask${a.uuid})">
          ${a.dungeon.areas.map(e=>html$$module$dungeonmap`<${DungeonArea$$module$dungeonmap}
              lod="${a.lod}"
              x="${e.x}"
              y="${e.y}"
              w="${e.w}"
              h="${e.h}"
              portals="${e.portals}"
              passages="${e.passages}"
              reveal="${e.reveal}"
              vbx=${a.offset.x}
              vby=${a.offset.y}
              vbw=${a.dim.w}
              vbh=${a.dim.h}
              vtt=${a.vtt}
            />`)}
        </g>
      </mask>
    </g>
    <!--g mask="url(#AreasMask)"-->
    <g mask="url(#AreasMask${a.uuid})">
      <rect x="-1000" y="-1000" width="2000" height="2000" fill="#d5d1ce" />
      <g>
        <rect
          class="cgrid"
          x="-1000"
          y="-1000"
          width="2000"
          height="2000"
          mask="url(#FilterMask)"
          fill="url(#grid)"
        />
        ${a.details}
        ${a.dungeon.stairs.map(e=>html$$module$dungeonmap`<${DungeonEntrance$$module$dungeonmap}
            lod="${a.lod}"
            x="${e.x}"
            y="${e.y}"
            dir="${e.d}"
            vbx=${a.offset.x}
            vby=${a.offset.y}
            vbw=${a.dim.w}
            vbh=${a.dim.h}
          />`)}
      </g>
      <g>
        ${a.vtt||a.dungeon.areas.map(e=>html$$module$dungeonmap`<${DungeonAreaLink$$module$dungeonmap}
            onClick=${a.onClick}
            onToken=${a.onToken}
            lod="${a.lod}"
            x="${e.x}"
            y="${e.y}"
            w="${e.w}"
            h="${e.h}"
            t="${e.t}"
            n="${e.n}"
            hazard=${e.hazard}
            duuid="${a.uuid}"
            uuid="${e.uuid}"
            vbx=${a.offset.x}
            vby=${a.offset.y}
            vbw=${a.dim.w}
            vbh=${a.dim.h}
            label_mode=${a.label_mode}
          />`)}
      </g>
      <g>
        ${a.dungeon.portals.map(e=>html$$module$dungeonmap`<${DungeonPortal$$module$dungeonmap}
            lod="${a.lod}"
            x="${e.x}"
            y="${e.y}"
            wall="${e.wall}"
            type="${e.type}"
            uuid="${e.uuid}"
            vbx=${a.offset.x}
            vby=${a.offset.y}
            vbw=${a.dim.w}
            vbh=${a.dim.h}
            vtt=${a.vtt}
          />`)}
      </g>
    </g>
  </g>`}
class DungeonMap$$module$dungeonmap extends k$$module$libs$preact{constructor(){super();this.areaClicked=this.areaClicked.bind(this);this.cavernClicked=this.cavernClicked.bind(this);this.loaded=!1;this.setState({show:!0,dungeon:{areas:[{x:10,y:10,w:50,h:50},{x:60,y:10,w:50,h:50},{x:10,y:70,w:50,h:50},{x:10,y:100,w:50,h:50},{x:200,y:20,w:50,h:50},{x:210,y:210,w:50,h:50}],portals:[]}});this.corners=[];this.uuid_to_coords={}}componentWillUpdate(a){this.props.uuid!=a.uuid&&(window.app.tokens[a.uuid]=new Map)}componentDidUpdate(a,
e,n){this.props.uuid!=a.uuid&&this.request_map_data(this.props.hex)}setRevealByPeers(a){window.app.yarray.get(a.uuid)&&"reveal"==window.app.yarray.get(a.uuid)[0]&&(a.reveal=!0)}processStructureData(a){function e(t,z,D,F){let J=!1;for(let G of F.areas)if(G!=t&&(z>=G.x&&z<=G.x+G.w&&D==G.y||z>=G.x&&z<=G.x+G.w&&D==G.y+G.h||D>=G.y&&D<=G.y+G.h&&z==G.x||D>=G.y&&D<=G.y+G.h&&z==G.x+G.w)){J=!0;break}return!J}this.corners=[];this.uuid_to_coords={};let n=0;a.stairs=[];a.portals=[];for(let t of a.areas){t.portals&&
(a.portals=a.portals.concat(t.portals));void 0===t.uuid&&(t.uuid=n++);t.e&&a.stairs.push(t.e);this.setRevealByPeers(t);this.uuid_to_coords[t.uuid]=[10*t.x+10*t.w/2,10*t.y+10*t.h/2];if(e(t,t.x,t.y,a)){const z=t.x,D=t.y;this.corners.push({x:z,y:D,d:`M ${10*z}, ${10*D} L
              ${10*(z+1)}, ${10*D} C
              ${10*z+2},${10*D+2}
              ${10*z+2},${10*D+2} ${10*z},
              ${10*(D+1)} Z`,culler:function(F,J,G,K){return z*kScaleMultiplier$$module$dungeonmap>G||D*kScaleMultiplier$$module$dungeonmap>K||(z+1)*kScaleMultiplier$$module$dungeonmap<F||(D+1)*kScaleMultiplier$$module$dungeonmap<J}})}if(e(t,t.x+t.w,t.y,a)){const z=t.x+t.w,D=t.y;this.corners.push({x:z,y:D,d:`M ${10*z}, ${10*D} L
              ${10*(z-1)}, ${10*D} C
              ${10*z-2},${10*D+2}
              ${10*z-2},${10*D+2} ${10*z},
              ${10*(D+1)} Z`,culler:function(F,J,G,K){return(z-1)*kScaleMultiplier$$module$dungeonmap>G||D*kScaleMultiplier$$module$dungeonmap>K||z*kScaleMultiplier$$module$dungeonmap<F||(D+1)*kScaleMultiplier$$module$dungeonmap<J}})}if(e(t,t.x+t.w,t.y+t.h,a)){const z=t.x+t.w,D=t.y+t.h;this.corners.push({x:z,y:D,d:`M ${10*z}, ${10*D} L
              ${10*(z-1)}, ${10*D} C
              ${10*z-2},${10*D-2}
              ${10*z-2},${10*D-2} ${10*z},
              ${10*(D-1)} Z`,culler:function(F,J,G,K){return(z-1)*kScaleMultiplier$$module$dungeonmap>G||(D-1)*kScaleMultiplier$$module$dungeonmap>K||z*kScaleMultiplier$$module$dungeonmap<F||D*kScaleMultiplier$$module$dungeonmap<J}})}if(e(t,t.x,t.y+t.h,a)){const z=t.x,D=t.y+t.h;this.corners.push({x:z,y:D,d:`M ${10*z}, ${10*D} L
              ${10*(z+1)}, ${10*D} C
              ${10*z+2},${10*D-2}
              ${10*z+2},${10*D-2} ${10*z},
              ${10*(D-1)} Z`,culler:function(F,J,G,K){return z*kScaleMultiplier$$module$dungeonmap>G||(D-1)*kScaleMultiplier$$module$dungeonmap>K||(z+1)*kScaleMultiplier$$module$dungeonmap<F||D*kScaleMultiplier$$module$dungeonmap<J}})}}this.setState({dungeon:a});this.loaded=!0}pointsToCoords(a){let e=[];for(let n=0;n<a.length;n++)e.push([a[n].x,a[n].y]);return e}processCaveData(a){a.points=[];this.uuid_to_coords={};let e=0;for(var n of a.caverns){var t=n.polygon;t.push(t[0]);turf.polygon([this.pointsToCoords(t)]);
t=polylabel$$module$libs$polylabel([this.pointsToCoords(t)],1);n.center=t;this.uuid_to_coords[n.uuid]=t;this.setRevealByPeers(n);for(t=0;t<n.polygon.length;t++){var z=n.polygon[t];if(1<z.c)continue;let D=n.polygon[0==t?n.polygon.length-1:t-1],F=n.polygon[t==n.polygon.length-1?0:t+1];n.polygon[t]={x:(z.x+(D.x+F.x)/2)/2,y:(z.y+(D.y+F.y)/2)/2};n.polygon[t].c=z.c}}n=[-1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,-1,1,-1,-1,1,-1,1,1];t=0;for(let D of a.caverns)for(z=0;z<D.polygon.length;z++)1==D.polygon[z].c&&
(e+=.1,D.polygon[z].x+=2*noise$$module$libs$perlin(e)*n[t],t=t==n.length-1?0:t+1,e+=.1,D.polygon[z].y+=2*noise$$module$libs$perlin(e)*n[t],t=t==n.length-1?0:t+1);this.setState({dungeon:a});this.loaded=!0}async request_map_data(a){api_call_dungeon$$module$api_shim(this.props.instance,a).then(e=>{void 0!==e.caverns?this.processCaveData(e):this.processStructureData(e);api_call_hazards$$module$api_shim(this.props.instance,a).then(n=>{for(let t of n.hazards)if(void 0!==this.state.dungeon.caverns)for(let z of this.state.dungeon.caverns)t.n==
z.n&&(z.hazard=!0);else for(let z of this.state.dungeon.areas)t.n==z.n&&(z.hazard=!0)})})}endSyncWithPeers(){window.app.yarray.unobserve(this.yarr_observer);window.app.zarray.unobserve(this.zarr_observer)}setLocalToken(a,e){window.app.tokens[this.props.uuid].set(a,new Token$$module$dungeonmap(this.props.uuid,a,e.x,e.y,e.r,5*kScale$$module$dungeonmap,5*kScale$$module$dungeonmap,this.props.zoff,e.t,e.l,e.pc))}syncDungeonAreas(a,e){if(a){e.keysChanged.has("reload")&&this.request_map_data(this.props.hex);
for(let n of a)e.keysChanged.has(n.uuid)&&window.app.yarray.get(n.uuid)&&("reveal"==window.app.yarray.get(n.uuid)[0]?n.reveal=!0:n.reveal=!1)}}beginSyncWithPeers(){let a=this;window.app.zarray.observe(this.zarr_observer=e=>{for(const n of e.keysChanged)window.app.zarray.has(n)?(e=window.app.zarray.get(n),e.d==this.props.uuid&&(this.setLocalToken(n,e),a.forceUpdate())):(window.app.tokens[this.props.uuid].delete(n),window.app.selected_token&&window.app.selected_token.tuid==n&&(window.app.selected_token=
null),a.forceUpdate())});window.app.yarray.observe(this.yarr_observer=e=>{this.syncDungeonAreas(a.state.dungeon.caverns||a.state.dungeon.areas,e);a.forceUpdate()})}addToken(a,e){window.app.map.showTokenChooser(n=>{window.app.ydoc.transact(()=>{const t=uuidv4$$module$utils();window.app.zarray.set(t,{u:t,t:n.id,x:e.x-this.props.zoff.x,y:e.y-this.props.zoff.y,r:0,l:n.light,pc:n.pc,d:this.props.uuid})})})}componentDidMount(a,e,n){this.request_map_data(this.props.hex);let t=this;window.app.reroll_handlers.set("dungeon"+
this.props.hex,async function(){await t.request_map_data(t.props.hex);window.app.yarray.set("reload",[t.props.uuid])});window.app.tokens[this.props.uuid]=new Map;this.beginSyncWithPeers();for(const [z,D]of window.app.zarray)D.d==this.props.uuid&&this.setLocalToken(z,D)}componentWillUnmount(){window.app.reroll_handlers.delete("dungeon"+this.props.hex);this.endSyncWithPeers()}updatePeerOnReveal(a,e){window.app.yarray.set(a,[e?"reveal":""])}clickHandler(a,e,n){let t=this.state.dungeon;if(!window.app.vtt_referee||
n)for(let z of a)z.uuid===e&&(z.reveal=!z.reveal,this.updatePeerOnReveal(z.uuid,z.reveal));this.setState({dungeon:t});n||this.uuid_to_coords[e]&&$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/location/"+e)}areaClicked(a,e=!1){this.clickHandler(this.state.dungeon.areas,a,e)}cavernClicked(a,e=!1){this.clickHandler(this.state.dungeon.caverns,a,e)}render(a,e){if(0==this.loaded)return html$$module$dungeonmap`
        <polygon
          points="5,-9 -5,-9 -10,0 -5,9 5,9 10,0"
          stroke="#333"
          stroke-width="0"
          fill="#232121"
          style="stroke-width:0.2;"
        />
      `;let n=3;5E4>a.zoom_factor&&(n=2);let t=html$$module$dungeonmap``;const z=a.offset.x-0,D=a.offset.y-0,F=a.offset.x+a.dim.w+0,J=a.offset.y+a.dim.h+0;if(1<n){let G="";3==n&&(G="filter: url(#displacementFilter)");t=html$$module$dungeonmap`<g opacity="0.3"
        >${this.corners.map(K=>{if(!K.culler(z,D,F,J))return html$$module$dungeonmap` <path
            transform=${3==n&&"translate(-0.5, -0.5)"}
            d="${K.d}"
            fill="#444444"
            style="${G}"
          />`})}
      </g>`}noiseSeed$$module$libs$perlin(10);e=void 0!==e.dungeon.caverns?html$$module$dungeonmap`<${DungeonCaveMap$$module$dungeonmap}
            dungeon=${e.dungeon}
            onClick=${this.cavernClicked}
            onToken=${(G,K)=>this.addToken(G,K)}
            details=${t}
            uuid=${a.uuid}
            lod=${n}
            offset=${a.offset}
            dim=${a.dim}
            label_mode=${a.label_mode}
            vtt=${a.vtt}
          />`:html$$module$dungeonmap`<${DungeonStructureMap$$module$dungeonmap}
            dungeon=${e.dungeon}
            onClick=${this.areaClicked}
            onToken=${(G,K)=>this.addToken(G,K)}
            details=${t}
            uuid=${a.uuid}
            lod=${n}
            offset=${a.offset}
            dim=${a.dim}
            label_mode=${a.label_mode}
            vtt=${a.vtt}
          />`;return html$$module$dungeonmap`
      <defs>
        <defs>
          <radialGradient id="TorchGradient${a.uuid}">
            <stop offset="10%" stop-color="#ffffffff" />
            <stop offset="30%" stop-color="#ffffffff" />
            <stop offset="95%" stop-color="#ffffff00" />
          </radialGradient>
        </defs>
        <pattern
          id="smallGrid"
          width="5"
          height="5"
          patternUnits="userSpaceOnUse"
        >
          <path
            d="M 5 0 L 0 0 0 5"
            fill="none"
            stroke="#86817c"
            stroke-width="0.2"
          />
        </pattern>
        <pattern
          id="grid"
          overflow="visible"
          width="10"
          height="10"
          patternUnits="userSpaceOnUse"
        >
          <rect width="10" height="10" fill="url(#smallGrid)" />
          <path
            d="M 10 0 L 0 0 0 10"
            fill="none"
            stroke="#86817c"
            stroke-width="1"
          />
        </pattern>
      </defs>
      <style>
        .cgrid {
          //filter: contrast(2.3);
        }
        .dcoords {
          font-size: 0.3em;
          font-family: 'Lakki Reddy';
          font-weight: bolder;
          paint-order: stroke;
          pointer-events: none;
          fill: #ddd;
          stroke: #333;
          stroke-width: 3px;
          stroke-linejoin: round;
        }
      </style>
      <filter id="noise" x="0%" y="0%" width="100%" height="100%">
        <feTurbulence
          type="fractalNoise"
          baseFrequency="0.125"
          numOctaves="2"
          seed="15"
          stitchTiles="stitch"
          result="turbulence"
        ></feTurbulence>
        <feComponentTransfer>
          <feFuncR type="discrete" tableValues="0 0 1 1" />
          <feFuncG type="discrete" tableValues="2 2 0 0" />
          <feFuncB type="discrete" tableValues="0 0 1 1" />
        </feComponentTransfer>
      </filter>
      <filter id="displacementFilter">
        <feTurbulence
          type="turbulence"
          baseFrequency="0.5"
          numOctaves="2"
          result="turbulence"
        />
        <feDisplacementMap
          in2="turbulence"
          in="SourceGraphic"
          scale="3"
          xChannelSelector="R"
          yChannelSelector="G"
        />
      </filter>
      <polygon
        points="5,-9 -5,-9 -10,0 -5,9 5,9 10,0"
        stroke="#333"
        stroke-width="0.3"
        fill="#232121"
      />
      ${e}
      <g transform="scale(1.0) rotate(0)">
        ${Array.from(window.app.tokens[a.uuid]).map(([,G])=>html$$module$dungeonmap`
            <g
              onmouseenter=${()=>{if(window.app.vtt_referee||G.pc)window.app.selected_token={tuid:G.tuid,uuid:G.uuid}}}
              onmouseleave=${()=>{window.app.selected_token&&window.app.selected_token.tuid&&window.app.selected_token.tuid==G.tuid&&(window.app.selected_token=null)}}
              onclick=${()=>window.app.kill_hotkey_mode&&window.app.zarray.delete(G.tuid)}
              transform="translate(${G.x},${G.y}) scale(0.006) rotate(${G.r})"
              fill="#232121"
              stroke=${G.pc||!a.vtt?"#fff":"none"}
              stroke-width="0.1"
              stroke-linejoin="round"
            >
              <circle cx="0" cy="0" r="5" opacity="0" />
              <use xlink:href="${window.app.tokens_svg}#${G.tid}" />
            </g>
          `)}
      </g>
    `}}var module$dungeonmap={};module$dungeonmap.DungeonMap=DungeonMap$$module$dungeonmap;const html$$module$hex=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);function clamp$$module$hex(a,e,n){return Math.min(Math.max(a,e),n)}function getOffset$$module$hex(a,e,n=0,t=0){return[30*a+Math.abs(e)%2*15-n,10.4*e*Math.cos(Math.PI/6)-t]}function getHexCoords$$module$hex(a,e){e/=10.4*Math.cos(Math.PI/6);return[Math.floor(a/30+Math.abs(e)%2),Math.floor(e)]}
function intersects$$module$hex(a,e,n,t,z,D){a=Math.abs(a-(n+z/2));e=Math.abs(e-(t+D/2));return a>z/2+9||e>D/2+9?!1:a<=z/2||e<=D/2?!0:81>=(a-z/2)**2+(e-D/2)**2}class Borderline$$module$hex extends k$$module$libs$preact{constructor(a){super();this.cls="borderline_fixed"}render(a,e){"borderline"==this.cls?this.cls="borderline_fixed":"continent"==this.cls&&(this.cls="borderline");.5>a.zoom_factor&&(this.cls="continent");return html$$module$hex` <g
      ><polygon
        class="${this.cls}"
        strokeWidth="${.15*a.arm}"
        strokeLinecap="round"
        fill="transparent"
        color="#ff0000"
        stroke="${a.color}"
        points="${a.borders}"
      />
    </g>`}}function makeHex$$module$hex(a){const e=20.8*Math.cos(Math.PI/6),n=a[0]-10;a=a[1]-e/2+.16;return[[5+.1/Math.sqrt(3)+n,.1+a],[15-.1/Math.sqrt(3)+n,.1+a],[20-2/Math.sqrt(3)*.1+n,.5*e+a],[15-.1/Math.sqrt(3)+n,e-.1+a],[5+.1/Math.sqrt(3)+n,e-.1+a],[2/Math.sqrt(3)*.1+n,.5*e+a]].join()}function HexRiver$$module$hex(a){return 20<a.zoom_factor?html$$module$hex`
        <g opacity="${1-a.opacity}">
          <path
            d="${a.riverline}"
            stroke="#1166aa"
            xstroke="#333333"
            stroke-width="2.25"
            fill="none"
          />
          <path
            d="${a.riverline}"
            stroke="#3399cc"
            stroke-width="1.75"
            stroke-dasharray="4 1 2 3 1 3 2 6 4 3 5 6 7 3 2 1 7 6 4 5 6 3 5 4 1 2 3 4"
            stroke-dashoffset="3"
            fill="none"
          >
            <animate
              id="p1"
              attributeName="stroke-dashoffset"
              begin="0.1s;f1.end+0.4s"
              values="2037;0"
              dur="1015s"
              calcMode="linear"
              repeatCount="indefinite"
            />
          </path>
          <path
            d="${a.riverline}"
            stroke="#1166aa"
            xstroke="#333333"
            stroke-width="1.5"
            fill="none"
          />
        </g>
      `:html$$module$hex` <g opacity="${1-a.opacity}">
        <path
          d="${a.riverline}"
          stroke="#1166aa"
          xstroke="#333333"
          stroke-width="2.25"
          fill="none"
        />
      </g>`}function HexTrail$$module$hex(a){return html$$module$hex` <g opacity="${1-a.opacity}">
    ${a.trailslines.map(e=>html$$module$hex`
        <path
          d="${e}"
          stroke="#22222255"
          stroke-width="1"
          stroke-linecap="round"
          stroke-dasharray="0 2"
          fill="none"
        />
      `)}
  </g>`}class BaseHex$$module$hex extends k$$module$libs$preact{getOffset(a=0,e=0){return getOffset$$module$hex(this.props.nx,this.props.ny,a,e)}getTranslation(a){return"translate("+a[0].toString()+", "+a[1].toString()+")"}}
class VttHex$$module$hex extends BaseHex$$module$hex{render(a){var e=getOffset$$module$hex(a.nx,a.ny);if(!(e[0]<this.props.ox-20||e[1]<this.props.oy-20||e[0]>this.props.ox+this.props.dimw+20||e[1]>this.props.oy+this.props.dimh+20)){this.t_poly=this.getTranslation(e);var n=clamp$$module$hex(a.zoom_factor/5E3,0,1),t=clamp$$module$hex((a.zoom_factor-2500)/5E3,0,1),z="empty-"==this.props.res?html$$module$hex``:html$$module$hex` <g opacity="${1-n}"
            ><use
              xlink:href="${window.app.theme}#${this.props.res}${a.pod}"
              fill="${this.props.color}"
              transform="${this.t_poly}"
            />
          </g>`,D=1E3<a.zoom_factor?intersects$$module$hex(e[0],e[1],a.ox,a.oy,a.dimw,a.dimh):!1;e="Dungeon"==a.feature&&1E3<a.zoom_factor&&D?html$$module$hex` <g opacity="${t}" transform="${this.t_poly}">
            <${DungeonMap$$module$dungeonmap}
              instance=${a.instance}
              hex=${a.uuid}
              uuid=${a.feature_uuid}
              offset=${({x:a.ox-e[0],y:a.oy-e[1]})}
              zoff=${({x:e[0],y:e[1]})}
              dim=${({w:a.dimw,h:a.dimh})}
              zoom_factor=${a.zoom_factor}
              vtt="true"
              tokens=${a.tokens}
            />
          </g>`:html$$module$hex``;t=a.riverline&&html$$module$hex` <${HexRiver$$module$hex}
        riverline=${a.riverline}
        zoom_factor=${a.zoom_factor}
        opacity=${n}
      />`;n=a.trailslines&&html$$module$hex` <${"partial"!=a.revealed&&HexTrail$$module$hex}
        trailslines=${a.trailslines}
        opacity=${n}
      />`;return a.revealed&&""!=a.revealed?html$$module$hex` <use
            xlink:href="${window.app.theme}#empty-${a.pod}"
            fill="${this.props.color}"
            transform="${this.t_poly}"
          />
          ${t}${z}${n}${e}`:html$$module$hex``}}}
class Hex$$module$hex extends BaseHex$$module$hex{clicked(a){a.preventDefault();window.app.inhibit_click?window.app.inhibit_click=!1:(this.props.menuHandler.onHexClicked(this.props.nx,this.props.ny,this.props.uuid,this.props.type,this),this.setState({class:"selected"}),window.app.last_selected&&window.app.last_selected.setState({class:"baseout"}),window.app.last_selected=this)}render(a){var e=getOffset$$module$hex(a.nx,a.ny);if(!(.5>a.zoom_factor||e[0]<this.props.ox-20||e[1]<this.props.oy-20||e[0]>
this.props.ox+this.props.dimw+20||e[1]>this.props.oy+this.props.dimh+20)){this.t_poly=this.getTranslation(e);var n=clamp$$module$hex(a.zoom_factor/5E3,0,1),t=clamp$$module$hex((a.zoom_factor-2500)/5E3,0,1),z="empty-"==this.props.res||html$$module$hex` <g opacity="${1-n}"
        ><use
          xlink:href="${window.app.theme}#${this.props.res}${a.type}"
          fill="${this.props.color}"
          transform="${this.t_poly}"
        />
      </g>`,D=1E3<a.zoom_factor&&intersects$$module$hex(e[0],e[1],a.ox,a.oy,a.dimw,a.dimh),F=a.trailslines&&html$$module$hex` <${HexTrail$$module$hex}
        trailslines=${a.trailslines}
        opacity=${n}
      />`,J="City"!=a.feature&&"Town"!=a.feature||!D?"Village"==a.feature&&D?html$$module$hex` <g opacity="${n}" transform="${this.t_poly}">
            <${VillageMap$$module$villagemap}
              id=${a.feature_uuid}
              instance=${a.instance}
              hex=${a.uuid}
              uuid=${a.feature_uuid}
              location=${a.location_uuid}
              zoom_factor=${a.zoom_factor}
            />
          </g>`:html$$module$hex``:html$$module$hex` <g opacity="${n}" transform="${this.t_poly}">
            <${CityMap$$module$citymap}
              id=${a.feature_uuid}
              instance=${a.instance}
              hex=${a.uuid}
              feature=${a.feature}
              uuid=${a.feature_uuid}
              location=${a.location_uuid}
              zoom_factor=${a.zoom_factor}
            />
          </g>`;e="Dungeon"==a.feature&&1E3<a.zoom_factor&&D&&html$$module$hex` <g opacity="${t}" transform="${this.t_poly}">
        <${DungeonMap$$module$dungeonmap}
          instance=${a.instance}
          hex=${a.uuid}
          uuid=${a.feature_uuid}
          offset=${({x:a.ox-e[0],y:a.oy-e[1]})}
          zoff=${({x:e[0],y:e[1]})}
          dim=${({w:a.dimw,h:a.dimh})}
          zoom_factor=${a.zoom_factor}
          label_mode=${a.show_labels%3}
          tokens=${a.tokens}
        />
      </g>`;n=a.riverline&&html$$module$hex` <${HexRiver$$module$hex}
        riverline=${a.riverline}
        zoom_factor=${a.zoom_factor}
        opacity=${n}
      />`;return html$$module$hex`<a onClick=${G=>this.clicked(G)}>
        <use
          xlink:href="${window.app.theme}#empty-${a.type}"
          fill="#000"
          transform="${this.t_poly}"
        />
        ${n}${z}${F}
      </a>
      ${J}${e}`}}}
class BaseHexMask$$module$hex extends k$$module$libs$preact{getOffset(a=0,e=0){return getOffset$$module$hex(this.props.nx,this.props.ny,a,e)}getTranslation(a){return"translate("+a[0].toString()+", "+a[1].toString()+")"}clicked(a){a.preventDefault();if(window.app.inhibit_click)window.app.inhibit_click=!1;else if(a=this.props.uuid,this.props.flag_hotkey_mode)this.props.menuHandler.onHexClicked(this.props.nx,this.props.ny,this.props.uuid,this.props.type,this);else{var e=window.app.yarray.get(a)&&"partial"==
window.app.yarray.get(a)[0],n=window.app.yarray.get(a)&&"reveal"==window.app.yarray.get(a)[0];window.app.hotkey_mode&&window.app.yarray.set(a,[n?"":e?"reveal":"partial"]);this.forceUpdate()}}}
class HexMask$$module$hex extends BaseHexMask$$module$hex{render(a){var e=getOffset$$module$hex(a.nx,a.ny);if(!(.5>a.zoom_factor||e[0]<this.props.ox-20||e[1]<this.props.oy-20||e[0]>this.props.ox+this.props.dimw+20||e[1]>this.props.oy+this.props.dimh+20))return this.t_poly=this.getTranslation(e),e=window.app.yarray.get(a.uuid),html$$module$hex`
      <a
        style=${a.flag_hotkey_mode&&"pointer-events: none;"}
        id="${a.uuid}_hex_mask"
        onClick=${n=>this.clicked(n)}
      >
        <use
          xlink:href="${window.app.theme}#${e&&"partial"==e[0]?"empty-partial-mask":e&&""!=e?"empty-no-mask":"empty-mask"}"
          transform="${this.t_poly}"
        />
      </a>
    `}}class SeaHexMask$$module$hex extends BaseHexMask$$module$hex{render(a){var e=getOffset$$module$hex(a.nx,a.ny,0,0);e="translate("+e[0].toString()+", "+e[1].toString()+")";a=window.app.yarray.get(a.uuid);return html$$module$hex`
      <a style=${""} onClick=${n=>this.clicked(n)}>
        <use xlink:href="${window.app.theme}#${a&&"reveal"==a[0]?"ocean-revealed":a&&"partial"==a[0]?"ocean-masked-partial":"ocean-masked"}" transform="${e}" />
      </a>
    `}}class VttSeaHex$$module$hex extends BaseHex$$module$hex{render(a){const e=getOffset$$module$hex(a.nx,a.ny);if(!(e[0]<this.props.ox-20||e[1]<this.props.oy-20||e[0]>this.props.ox+this.props.dimw+20||e[1]>this.props.oy+this.props.dimh+20))return this.t_poly=this.getTranslation(e),(a=window.app.yarray.get(a.uuid))&&""!=a&&html$$module$hex`
        <use
          xlink:href="${window.app.theme}#ocean"
          transform="${this.t_poly}"
        />
      `}}function sea_clicked$$module$hex(a,e){a.preventDefault();if(window.app.inhibit_click)window.app.inhibit_click=!1;else e.menuHandler.onHexClicked(e.nx,e.ny,e.uuid,e.type,null)}function SeaHex$$module$hex(a){const e=getOffset$$module$hex(a.nx,a.ny,0,0);return html$$module$hex`
    <a onClick=${n=>sea_clicked$$module$hex(n,a)}>
      <polygon
        transform="${"translate("+e[0].toString()+", "+e[1].toString()+")"}"
        points="5 -9 -5 -9 -10 0 -5 9 5 9 10 0"
        fill="#049"
        stroke="#2255aa"
        stroke-width=".3"
      />
    </a>
  `}var module$hex={};module$hex.BaseHex=BaseHex$$module$hex;module$hex.Borderline=Borderline$$module$hex;module$hex.Hex=Hex$$module$hex;module$hex.HexMask=HexMask$$module$hex;module$hex.SeaHex=SeaHex$$module$hex;module$hex.SeaHexMask=SeaHexMask$$module$hex;module$hex.VttHex=VttHex$$module$hex;module$hex.VttSeaHex=VttSeaHex$$module$hex;module$hex.getHexCoords=getHexCoords$$module$hex;module$hex.getOffset=getOffset$$module$hex;module$hex.makeHex=makeHex$$module$hex;function makeRealmPolygon$$module$api(a){function e(J,G,K){z.push([{x:G[0]+J[0],y:G[1]+J[1]},{x:K[0]+J[0],y:K[1]+J[1]}])}function n(J){return Math.floor(J/3).toFixed(15)}var t=20.8*Math.cos(Math.PI/6);let z=[];for(var D of a){a=getOffset$$module$hex(D.hex_x,D.hex_y,10,7.5*1.04);for(var F of D.borders)0==F&&e(a,[5+.1/Math.sqrt(3),.1],[15-.1/Math.sqrt(3),.1]),1==F&&e(a,[15-.1/Math.sqrt(3),.1],[20-2/Math.sqrt(3)*.1,.5*t]),2==F&&e(a,[20-2/Math.sqrt(3)*.1,.5*t],[15-.1/Math.sqrt(3),t-.1]),3==F&&e(a,[15-
.1/Math.sqrt(3),t-.1],[5+.1/Math.sqrt(3),t-.1]),4==F&&e(a,[5+.1/Math.sqrt(3),t-.1],[2/Math.sqrt(3)*.1,.5*t]),5==F&&e(a,[2/Math.sqrt(3)*.1,.5*t],[5+.1/Math.sqrt(3),.1])}t=[];D=z[0][1];F=0;for(t.push({x:D.x,y:D.y});;){z.splice(F,1);if(0==z.length)break;F=0;for(a=0;a<z.length;a++){const J=z[a];if(n(J[0].x)===n(D.x)&&n(J[0].y)===n(D.y)){t.push({x:J[1].x,y:J[1].y});D=J[1];break}if(n(J[1].x)===n(D.x)&&n(J[1].y)===n(D.y)){t.push({x:J[0].x,y:J[0].y});D=J[0];break}F++}if(F==z.length)return console.log("ERROR"),
[]}return t}function makeWall$$module$api(a){let e="";a.forEach(function(n){e=e+n.x+","+(n.y-1)+" "});return e}function makeRealmLabel$$module$api(a,e,n){if(0<n.length){const t=get_polygon_area$$module$utils(n);n=polylabel$$module$libs$polylabel([make_tuple_polygon$$module$utils(n)],1);return[e.name.split(/[ ]/),{x:n[0],y:n[1]},clamp$$module$utils(1E-5*t,1,2),a]}return[[],{x:0,y:0},2,""]}
function RiverLine$$module$api(a,e,n){function t(F,J,G){D.push([{x:J[0]+F[0],y:J[1]+F[1]},{x:G[0]+F[0],y:G[1]+F[1]}])}const z=20.8*Math.cos(Math.PI/6);let D=[];a=getOffset$$module$hex(a,e,10,10.4*Math.cos(Math.PI/6));e=[10+.1/Math.sqrt(3),.5*z];for(const F of n)0==F&&t(a,[10+.1/Math.sqrt(3),.1],e),1==F&&t(a,[17.5-.1/Math.sqrt(3),.25*z],e),2==F&&t(a,[17.5-.1/Math.sqrt(3),.75*z],e),3==F&&t(a,[10+.1/Math.sqrt(3),z-.1],e),4==F&&t(a,[2.5+.1/Math.sqrt(3),.75*z],e),5==F&&t(a,[2.5+.1/Math.sqrt(3),.25*z],
e);n="";if(1==D.length)for(const F of D)n=n+"M "+F[1].x+" "+F[1].y+" L "+F[0].x+" "+F[0].y+" ";2==D.length&&(n=n+"M "+D[0][0].x+" "+D[0][0].y+" C "+D[0][1].x+" "+D[0][1].y+","+D[0][1].x+" "+D[0][1].y+","+D[1][0].x+" "+D[1][0].y+" ");return n}
function convertHexType$$module$api(a,e=!1){let n=a.type;"empty"!=a.type&&(n="DesertHex"==a.type?"desert":"PlainsHex"==a.type?"plains":"TundraHex"==a.type?"tundra":"JungleHex"==a.type?"jungle":"SwampsHex"==a.type?"swamps":"CoastHex"==a.type?"coast":"OceanHex"==a.type?"ocean":"ForestHex"==a.type?3<a.x%3+a.y%4&&void 0===a.feature?"forest-var":"forest":"mountains");const t=n;void 0===a.feature||e||(n+={Inn:"-inn",Residency:"-inn",Dungeon:"-dungeon",Village:"-village",Town:"-town",City:"-city",Other:""}[a.feature]);
return[a.type,n,t]}function setupHexProps$$module$api(a){a.rivers&&(a.riverline=RiverLine$$module$api(a.x,a.y,a.rivers));if(a.trails){let e=[];if(a.trails){let n=0;1==a.trails.length%2&&(e.push([a.trails[n]]),n++);for(;n<a.trails.length;n+=2)e.push([a.trails[n],a.trails[n+1]])}a.trailslines=[];e.map(n=>{a.trailslines.push(RiverLine$$module$api(a.x,a.y,n))})}[a.cls,a.type,a.partial_type]=convertHexType$$module$api(a)}
class MapData$$module$api{constructor(){this.reset()}reset(){this.uuid_to_coords={};this.populated_coords=new Map}neighbor(a,e){switch(e){case 1:return{x:a.x,y:a.y-2};case 2:return{x:a.x+Math.abs(a.y%2),y:a.y-1};case 3:return{x:a.x+Math.abs(a.y%2),y:a.y+1};case 4:return{x:a.x,y:a.y+2};case 5:return{x:a.x-Math.abs(a.y+1)%2,y:a.y+1};case 6:return{x:a.x-Math.abs(a.y+1)%2,y:a.y-1}}}getHexDataByUUID(a){return this.uuid_to_coords[a]}hexRegion(a){return this.uuid_to_coords[a].region}hexRealm(a){return this.uuid_to_coords[a].realm}isPopulated(a,
e){return this.populated_coords.has(canonical_coords$$module$utils(a,e))}isOccupied(a){a=this.getHexDataByUUID(a);return void 0===a?!1:void 0!==a.feature&&"Other"!=a.feature}isBorderline(a){a=this.getHexDataByUUID(a);return void 0===a?!1:a.borderline}isRiverSource(a){a=this.getHexDataByUUID(a);if(void 0===a||!a.type.includes("mountains"))return!1;for(let n=1;6>=n;n++){var e=this.neighbor({x:a.x,y:a.y},n);e=canonical_coords$$module$utils(e.x,e.y);if(this.populated_coords.has(e)&&(e=this.populated_coords.get(e),
!this.getHexDataByUUID(e).type.includes("mountains")))return!0}return!1}isCoastal(a){a=this.getHexDataByUUID(a);if(void 0===a)return!1;for(let e=1;6>=e;e++){const n=this.neighbor({x:a.x,y:a.y},e);if(!this.isPopulated(n.x,n.y))return!0}return!1}getRealmOnCoast(a,e){if(this.populated_coords.has(canonical_coords$$module$utils(a,e)))return null;let n=null;for(let z=1;6>=z;z++){var t=this.neighbor({x:a,y:e},z);t=canonical_coords$$module$utils(t.x,t.y);if(this.populated_coords.has(t)){t=this.populated_coords.get(t);
t=this.getHexDataByUUID(t);if(n&&n!=t.realm)return null;n||(n=t.realm)}}return n}getRegionOnCoast(a,e){if(this.populated_coords.has(canonical_coords$$module$utils(a,e)))return null;let n=[];for(let z=1;6>=z;z++){var t=this.neighbor({x:a,y:e},z);t=canonical_coords$$module$utils(t.x,t.y);this.populated_coords.has(t)&&(t=this.populated_coords.get(t),t=this.getHexDataByUUID(t),n.push([t.region,t.cls]))}return 0==n.length?null:n[Math.floor(Math.random()*n.length)]}addOceanHex(a,e){const n=canonical_coords$$module$utils(a,
e);this.uuid_to_coords[n]={x:a,y:e,type:"",feature:""};return n}reload(a,e){return new Promise(n=>{window.app.map_cache&&!e&&(this.hexlist=window.app.map_cache.hexlist,this.borders=window.app.map_cache.borders,this.uuid_to_coords=window.app.map_cache.uuid_to_coords,this.populated_coords=window.app.map_cache.populated_coords,this.loaded=!0,this.postMapLoadedCallback&&this.postMapLoadedCallback(),n());this.reset();api_call_map$$module$api_shim(a).then(t=>{if(t&&t.map){this.regions=t.regions;var z=[],
D=[];t.borders||(t.borders={});Object.keys(t.borders).forEach(G=>{const K=makeRealmPolygon$$module$api(t.borders[G]);z.push({uuid:G,wall:makeWall$$module$api(K),poly:K});D.push(makeRealmLabel$$module$api(G,t.realms[G],K))});t.map||(t.map=[]);var F=[];t.map.map(G=>{setupHexProps$$module$api(G);F.push({x:G.x,y:G.y});this.uuid_to_coords[G.uuid]={x:G.x,y:G.y,cls:G.cls,type:G.type,partial_type:G.partial_type,feature:G.feature,feature_uuid:G.feature_uuid,rotation:G.river_dir?G.river_dir:G.harbor?60*G.harbor:
0,harbor:G.harbor,borderline:G.borderline,region:G.region,realm:G.realm};this.populated_coords.set(canonical_coords$$module$utils(G.x,G.y),G.uuid)});var J=get_centroidic_point$$module$utils(F)||{x:0,y:0};J=getOffset$$module$hex(J.x,J.y);this.hexlist=t.map;this.borders=z;this.initial_offset={x:J[0],y:J[1]};this.realm_labels=D;this.postMapLoadedCallback&&this.postMapLoadedCallback();window.app.map_cache={hexlist:t.map,borders:z,realm_labels:D,uuid_to_coords:this.uuid_to_coords,populated_coords:this.populated_coords};
n(!0)}else n(!1)})})}}var module$api={};module$api.MapData=MapData$$module$api;module$api.RiverLine=RiverLine$$module$api;const html$$module$hexmap=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);function Underwear$$module$hexmap(a){return html$$module$hexmap` <g
    ><polygon
      class="${a.fow?"underwear-fow":"underwear"}"
      points="${a.borders}"
    />
  </g>`}
class VttHexMap$$module$hexmap extends SvgMap$$module$SvgMap{constructor(){super();this.map_data=new MapData$$module$api;this.setState({offset:{x:0,y:0},dim:{w:1500,h:1500},col1:"col1",res:"empty-",hexlist:[],sea:[],flags:[],spinner:!1});this.loaded=!1}fillOceanHexes(a,e,n,t){let z=[];const D=getHexCoords$$module$hex(a,e);a=getHexCoords$$module$hex(a+n,e+t);for(e=D[0]-2;e<a[0]+1;e++)for(n=D[1];n<a[1]+2;n++){t="ocean:"+e+","+n;const F=window.app.yarray.get(t);F&&""!=F&&z.push({x:e,y:n,type:"ocean",uuid:t})}return z}navigateToHex(a,
e){}getMatrix(a){this.props.spinner(1,!0);this.map_data.reload(this.props.instance,a).then(e=>{e?(this.updateReveals(this.map_data.hexlist),this.setState({hexlist:this.map_data.hexlist,offset:this.loaded?this.state.offset:{x:this.map_data.initial_offset.x-this.state.dim.w/2,y:this.map_data.initial_offset.y-this.state.dim.h/2}}),this.loaded=!0):this.forceUpdate();this.setState({spinner:!1});this.props.spinner(1,!1)})}onHexClicked(a,e,n,t,z){}updateReveals(a){for(let e=0;e<a.length;e++){const n=window.app.yarray.get(a[e].uuid);
a[e].pod=n&&"partial"==n[0]?a[e].partial_type:a[e].type;a[e].revealed=n&&n[0]}this.setState({hexlist:a})}postMapLoaded(a){this.loaded?a():this.postMapLoadedCallback=a}componentDidMount(a,e,n){this.postMapLoadedCallback=this.updateReveals;this.getMatrix();super.componentDidMount(a,e,n);window.app.yarray.observe(this.yarr_observer=t=>{t.keysChanged.has("flags")?(this.setState({flags:window.app.yarray.get("flags")}),this.updateReveals(this.state.hexlist)):t.keysChanged.has("map")?this.getMatrix(!0):
this.updateReveals(this.state.hexlist)})}is_within_frustrum(a,e=40){return a.x>this.state.offset.x-e||a.y>this.state.offset.y-e||a.x<this.state.offset.x+this.state.dim.w+e||a.y<this.state.offset.y+this.state.dim.h+e}hexBitmask(){return 0}render(a,e){const n=this.fillOceanHexes(e.offset.x,e.offset.y,e.dim.w,e.dim.h);return html$$module$hexmap`<div
      id="hexmap"
      class="${"col1"}"
      style="overflow:hidden;${a.visible?"":"display:none;"}"
    >
      <svg
        id="canvas"
        class="${a.desaturate_palette?"desaturated":"colorful"} vtt"
        preserveAspectRatio="xMidYMid meet"
        viewBox="${this.state.offset.x} ${this.state.offset.y} ${this.state.dim.w} ${this.state.dim.h}"
      >
        <g id="viewport">
          <g class="pod-wrap">
            ${n.map(t=>html$$module$hexmap`<${VttSeaHex$$module$hex}
                res="${e.res}"
                type="${t.type}"
                class="base"
                uuid="${t.uuid}"
                nx="${t.x}"
                ny="${t.y}"
                ox="${e.offset.x}"
                oy="${e.offset.y}"
                dimw="${e.dim.w}"
                dimh="${e.dim.h}"
                zoom_factor=${e.zoom_factor}
                menuHandler="${this}"
              />`)}
            ${e.hexlist.map(t=>html$$module$hexmap`<${VttHex$$module$hex}
                res="${e.res}"
                pod="${t.pod}"
                revealed=${t.revealed}
                feature="${t.feature}"
                feature_uuid="${t.feature_uuid}"
                class="base"
                instance="${a.instance}"
                uuid=${t.uuid}
                riverline=${t.riverline}
                trailslines=${t.trailslines}
                location_uuid=${a.hex_uuid}
                nx="${t.x}"
                ny="${t.y}"
                zoom_factor=${e.zoom_factor}
                ox="${e.offset.x}"
                oy="${e.offset.y}"
                dimw="${e.dim.w}"
                dimh="${e.dim.h}"
                menuHandler="${this}"
                tokens=${this.tokens}
              />`)}
            <g>
              ${e.flags.map(t=>html$$module$hexmap`<polygon
                  class="flagged-hex"
                  points=${makeHex$$module$hex(getOffset$$module$hex(t.x,t.y))}
                />`)}
            </g>
          </g>
        </g>
      </svg>
    </div>`}}function InMapLabel$$module$hexmap(a){let e=0,n=1;a.zoom_factor>a.zoom_threshold&&(a.label_opacity_factor=a.zoom_factor/(10*a.zoom_threshold),e=1,n=-1);return html$$module$hexmap`
    <text
      opacity="${e+n*clamp$$module$utils(a.label_opacity_factor,0,1)}"
      transform="translate( ${a.l.x} , ${a.l.y}) rotate( ${a.l.r})"
      class="${a.label_class}"
      font-size="${a.l.fontsize}em"
      text-anchor="middle"
    >
      ${a.l.name.map((t,z)=>html$$module$hexmap`<tspan
          x="0"
          y="${z-a.l.name.length/2}em"
          dy="${a.yoffset}"
          >${t}</tspan
        >`)}
    </text>
  `}
class HexMap$$module$hexmap extends SvgMap$$module$SvgMap{constructor(){super();this.map_data=new MapData$$module$api;this.setState({offset:{x:0,y:0},dim:{w:1500,h:1500},col1:"col1",res:"empty-",hexlist:[],borders:[],realm_labels:[],sea:[],flags:[],spinner:!1});this.loaded=this.selected=!1;this.region_labels=[];this.hexlabels=[];this.sea=[];this.menu_hotkey_type=0}async fillOceanHexes(a,e,n,t){if(2>this.state.zoom_factor)this.sea=[];else if(10>this.state.zoom_factor&&(this.drag||this.camera_moving))this.sea=[];
else{var z=getHexCoords$$module$hex(a,e),D=z[0]-2;z=z[1]-2;e=getHexCoords$$module$hex(a+n,e+t);a=e[0]+2;e=e[1]+2;for(n=0;D<a;D++)for(t=z;t<e;t++)if(!this.map_data.isPopulated(D,t)){if(n>=this.sea.length)this.sea.push({x:D,y:t,type:"ocean",uuid:"ocean:"+D+","+t});else{let F=this.sea[n];F.x=D;F.y=t;F.type="ocean";F.uuid="ocean:"+D+","+t}n++}this.sea.length=n}}getMatrix(a){this.props.spinner(1,!0);this.map_data.reload(this.props.instance,a).then(e=>{e&&(e=this.loaded?this.state.offset:{x:this.map_data.initial_offset.x-
this.state.dim.w/2,y:this.map_data.initial_offset.y-this.state.dim.h/2},this.state.offset=e,this.setState({hexlist:this.map_data.hexlist,borders:this.map_data.borders,offset:e,realm_labels:this.map_data.realm_labels}),this.navigateToHex(this.props.hex_uuid),this.loaded=!0,this.makeRegionLabels(),this.makeHexLabels(),this.postMapLoadedCallback&&this.postMapLoadedCallback());this.setState({spinner:!1});this.props.spinner(1,!1)});a&&window.app.yarray.set("map",!0)}onRerollHex(a){this.setState({spinner:!0});
this.props.spinner(1,!0);const e=this.map_data.getHexDataByUUID(a);fetch("/reroll/"+this.props.instance+"/"+a+"/"+e.cls,{method:"GET"}).then(n=>401===n.status?(window.app.unauth(),this.getMatrix(),Promise.reject(n)):n.json()).then(n=>{this.state.menu&&(this.state.menu.c&&this.state.menu.c.setState({uuid:n.uuid}),this.state.menu.uuid=n.uuid);delete window.app.map_cache;this.getMatrix()}).catch(n=>{console.error("Error:",n)})}onClearHexRiver(a){this.props.spinner(1,!0);fetch("/clear/"+this.props.instance+
"/"+a+"/river",{method:"GET"}).then(e=>e.json()).then(e=>{delete window.app.map_cache;this.getMatrix()}).catch(e=>{console.error("Error:",e)})}onClearHexTrails(a){this.props.spinner(1,!0);fetch("/clear/"+this.props.instance+"/"+a+"/trails",{method:"GET"}).then(e=>e.json()).then(e=>{delete window.app.map_cache;this.getMatrix()}).catch(e=>{console.error("Error:",e)})}onDrawRiver(a){fetch("/draw/"+this.props.instance+"/"+a+"/river",{method:"GET"}).then(e=>e.json()).then(e=>{delete window.app.map_cache;
this.getMatrix()}).catch(e=>{console.error("Error:",e)})}onAppendMenu(){let a=this.state.menu;a.type=1;this.setState({menu:a})}onRerollMenu(){let a=this.state.menu;a.type=2;this.setState({menu:a})}onDeleteMenu(){let a=this.state.menu;a.type=3;this.setState({menu:a})}onRollSettlementMenu(){let a=this.state.menu;a.type=4;this.setState({menu:a})}onRollRegionMenu(){let a=this.state.menu;a.type=5;this.setState({menu:a})}onRollHexMenu(){let a=this.state.menu;a.type=6;this.setState({menu:a})}onAppendRealm(){this.props.appendDialog(this.state.menu)}onAppendRegion(a){const e=
this.map_data.getRealmOnCoast(this.state.menu.nx,this.state.menu.ny);e&&fetch("/append/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:e,attribute:"regions",type:a,nx:this.state.menu.nx,ny:this.state.menu.ny})}).then(n=>n.text()).then(n=>{this.getMatrix(!0)}).catch(n=>{console.error("Error:",n)})}onAppendHex(a,e){const n=this.map_data.getRegionOnCoast(a,e);n&&fetch("/append/",{method:"POST",headers:{Accept:"application/json",
"Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:n[0],attribute:"Hexmap",type:n[1],nx:a,ny:e})}).then(t=>t.text()).then(t=>{this.getMatrix(!0);0!=this.menu_hotkey_type&&(this.state.menu=null)}).catch(t=>{console.error("Error:",t)})}onRemapEntity(a){this.props.spinner(1,!0);this.setState({spinner:!0});fetch("/remap/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:a})}).then(e=>
{401===e.status&&window.app.unauth();e.text()}).then(e=>{this.getMatrix(!0)}).catch(e=>{console.error("Error:",e)})}onAppendFeatureInner(a,e,n){fetch("/append/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:a,attribute:e,type:n})}).then(t=>t.text()).then(t=>{this.getMatrix(!0)}).catch(t=>{console.error("Error:",t)})}onAppendFeature(a,e,n){const t=this.map_data.getHexDataByUUID(a);"Other"==t.feature?this.onRemoveEntityInner(t.feature_uuid).then(()=>
{}):this.props.spinner(1,!0);this.onAppendFeatureInner(a,e,n)}makeHexLabels(){let a=[];for(const e of this.map_data.hexlist)if(e.label){const n=getOffset$$module$hex(e.x,e.y);a.push({name:capitalize$$module$utils(e.label).split(/[ ]/),x:n[0],y:n[1],r:(110-e.label.toLowerCase().charCodeAt(0))/2,fontsize:"0.15"})}this.hexlabels=a}makeRegionLabels(){this.region_polygon_data=new Map;let a=new Map;for(const z of this.map_data.hexlist)z.region&&(a.has(z.region)||a.set(z.region,{label:this.map_data.regions[z.region],
coords:[]}),a.get(z.region).coords.push([z.x,z.y]));let e=[],n=null,t=null;a.forEach((z,D)=>{var F=null,J=null;let G=null,K=null,I=0,L=[];for(const Q of z.coords){I++;const M=Q[0],U=Q[1];L.push({x:M,y:U});if(!F||M<F)F=M;if(!G||U<G)G=U;if(!J||M>J)J=M;if(!K||U>K)K=U}if(!n||I<n)n=I;if(!t||I>t)t=I;F=getOutlineFromArray$$module$hexpoly(make_tuple_polygon$$module$utils(L));J=polylabel$$module$libs$polylabel([F[0]],1);this.region_polygon_data.set(D,make_xy_polygon$$module$utils(F[0]));e.push({uuid:D,name:z.label.split(/[ ]/),
x:J[0],y:J[1],r:18-z.label.length,n_hexes:I})});for(let z of e)z.fontsize=z.n_hexes/t*.2+.2;this.region_labels=e}onHexClickedInFlagMode(a,e){if(this.state.flag_hotkey_mode){let n=this.state.flags;n.push({x:a,y:e});this.setState({flags:n});window.app.yarray.set("flags",n);return!0}return!1}onHexClickedInCrawlMode(a,e,n,t){const z=this.map_data.populated_coords.get(canonical_coords$$module$utils(a,e));return this.props.hex_uuid?("ocean"!=t||z?$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+
"/hex/"+n):(a=this.map_data.addOceanHex(a,e),$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/coords/"+a)),!0):!1}onHexClickedInLockedFullMap(a,e,n,t){const z=this.map_data.populated_coords.get(canonical_coords$$module$utils(a,e));this.selected=!0;if(window.app.locked){if("ocean"!=t||z)this.onSelectHex(n);else a=this.map_data.addOceanHex(a,e),$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/coords/"+a);return!0}return!1}onHexClickedInAddHex(a,e,n,t){return 6==
this.menu_hotkey_type?(this.onAppendHex(a,e),!0):!1}onHexClickedInRemoveHex(a,e,n,t){if(9==this.menu_hotkey_type){if("ocean"!=t)this.onRemoveHex(n);return!0}return!1}onHexClicked(a,e,n,t,z){if(!(this.state.hotkey_mode&&!this.state.flag_hotkey_mode||this.onHexClickedInFlagMode(a,e)||this.onHexClickedInCrawlMode(a,e,n,t)||this.onHexClickedInLockedFullMap(a,e,n,t)||this.onHexClickedInAddHex(a,e,n,t)||this.onHexClickedInRemoveHex(a,e,n,t))){var D=getOffset$$module$hex(a,e);this.setState({menu:{type:this.menu_hotkey_type,
c:z,uuid:n,hex_type:t,offset:{x:D[0],y:D[1]},nx:a,ny:e}})}}postMapLoaded(a){this.loaded?a():this.postMapLoadedCallback=a}onClickRealm(a){window.app.inhibit_click||$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/realm/"+a)}navigateToRegion(a){if(this.region_polygon_data&&this.region_polygon_data.has(a)){var e=this.region_polygon_data.get(a),n=get_polygon_extents$$module$utils(e);a=1.3*n.w;n=1.3*n.h;e=get_polygon_centroid$$module$utils(e);this.minimapOnLocation(e.x,e.y,a,n)}}navigateToRealm(a){for(const n of this.state.borders)if(n.uuid==
a){var e=get_polygon_extents$$module$utils(n.poly);const t=1.1*e.w;e=1.1*e.h;const z=get_polygon_centroid$$module$utils(n.poly);this.minimapOnLocation(z.x,z.y,t,e)}}navigateToHex(a,e){function n(K,I,L){L*=Math.PI/180;var Q={};Q.x=K*Math.cos(L)-I*Math.sin(L);Q.y=K*Math.sin(L)+I*Math.cos(L);return Q}if(!window.app.hotkey_mode&&(a=this.map_data.getHexDataByUUID(a),void 0!==a)){var t=0,z=0;e&&(t=e.x,z=e.y);var D=200;if("City"==a.feature||"Town"==a.feature)z=n(t,z-(void 0!==a.harbor?900:0),a.rotation),
t=z.x,z=z.y;"Village"==a.feature&&(void 0!==a.harbor&&(D=n(t,z-595,60*a.harbor),t=D.x,z=D.y),D=100);"Dungeon"==a.feature&&(D=100);var F=getOffset$$module$hex(a.x,a.y);e?(F[0]+=t/D,F[1]+=z/D,this.focused_hex=null):this.focused_hex=a;var J=e?e.zoom:100,G=e?e.zoom:100;e=window.app.zooming_into_entity?500:0;window.app.zooming_into_entity=!1;window.setTimeout(()=>{this.minimapOnLocation(F[0],F[1],J,G)},e)}}onSelectHex(a){void 0!==this.map_data.getHexDataByUUID(a)&&(this.onSelectHexInoked=!0,$$$module$libs$preact_router_module("/sandbox/"+
this.props.instance+"/hex/"+a))}onRemoveEntityInner(a){return new Promise(e=>{this.props.spinner(1,!0);this.setState({spinner:!0});fetch("/remove/"+this.props.instance+"/"+a,{method:"GET"}).then(n=>n.json()).then(n=>{e()}).catch(n=>{console.error("Error:",n)})})}onRemoveEntity(a){this.onRemoveEntityInner(a).then(()=>{delete window.app.map_cache;this.getMatrix(!0)})}onRemoveHex(a){this.onRemoveEntity(a)}onRemoveRegion(a){this.onRemoveEntity(this.map_data.hexRegion(a))}onRemoveRealm(a){this.onRemoveEntity(this.map_data.hexRealm(a))}componentDidMount(a,
e,n){this.getMatrix();super.componentDidMount(a,e,n);window.addEventListener("keydown",t=>this.onKeyDown(t));window.addEventListener("keyup",t=>this.onKeyUp(t));window.addEventListener("mouseout",t=>{t=t.relatedTarget||t.toElement;t&&"HTML"!=t.nodeName||(this.setState({hotkey_mode:!1,flag_hotkey_mode:!1}),window.app.hotkey_mode=!1,window.app.flag_hotkey_mode=!1,this.props.hotkeyMode(!1))})}onKeyUp(a){window.app.inhibit_hotkeys||this.props.editMode||is_electron$$module$api_shim||("Space"==a.code&&
window.app.hotkey_mode&&this.props.hotkeyMode(!1),"KeyF"==a.code&&window.app.flag_hotkey_mode&&(this.props.hotkeyMode(!1,{flag_hotkey_mode:!1,flags:[]}),window.app.yarray.set("flags",[]),window.app.flag_hotkey_mode=!1),"KeyT"==a.code&&(window.app.token_hotkey_mode=!1,this.props.hotkeyMode(!1)),"KeyK"==a.code&&(window.app.kill_hotkey_mode=!1,this.props.hotkeyMode(!1)),"KeyH"==a.code&&(this.menu_hotkey_type=0),"KeyC"==a.code&&(this.menu_hotkey_type=0))}onKeyDown(a){if(!window.app.inhibit_hotkeys&&!this.props.editMode&&
(is_electron$$module$api_shim||("Space"!=a.code||window.app.hotkey_mode||(this.setState({hotkey_mode:!0}),this.props.hotkeyMode(!0),window.app.hotkey_mode=!0),"KeyF"!=a.code||window.app.flag_hotkey_mode||(this.props.hotkeyMode(!0,{flag_hotkey_mode:!0}),window.app.flag_hotkey_mode=!0),"KeyT"!=a.code||window.app.token_hotkey_mode||(window.app.token_hotkey_mode=!0,this.props.hotkeyMode(!0)),"KeyK"!=a.code||window.app.kill_hotkey_mode||(window.app.kill_hotkey_mode=!0,this.props.hotkeyMode(!0))),this.focused_hex&&
this.props.hex_uuid)){var e=this.focused_hex.y,n=this.focused_hex.x;"w"==a.key&&(e-=2);"s"==a.key&&(e+=2);"e"==a.key&&(--e,0==Math.abs(e)%2&&n++);"q"==a.key&&(--e,1==Math.abs(e)%2&&n--);"a"==a.key&&(e+=1,1==Math.abs(e)%2&&n--);"d"==a.key&&(e+=1,0==Math.abs(e)%2&&n++);if(e!=this.focused_hex.y||n!=this.focused_hex.x){var t=this.map_data.populated_coords.get(canonical_coords$$module$utils(n,e)),z=t?null:this.map_data.addOceanHex(n,e);if(t||z)this.navigateToHex(t),this.on_key_down_to&&window.clearTimeout(this.on_key_down_to);
this.on_key_down_to=window.setTimeout(()=>{$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+(z?"/coords/":"/hex/")+(z?z:t))},500)}}}componentDidUpdate(a,e,n){this.show_region_label="region"===this.props.type?this.props.hex_uuid:!1;this.show_realm_label="realm"===this.props.type?this.props.hex_uuid:!1;this.onSelectHexInoked&&(this.onSelectHexInoked=!1);0==a.locked&&1==this.props.locked&&(this.selected=null)}is_within_frustrum(a,e=40){return a.x>this.state.offset.x-e||a.y>this.state.offset.y-
e||a.x<this.state.offset.x+this.state.dim.w+e||a.y<this.state.offset.y+this.state.dim.h+e}hexBitmask(){const a=this.state.menu.uuid;let e=0;"ocean"===this.state.menu.hex_type&&(e|=HexBitmask$$module$hexmenu.IS_HEX_AN_OCEAN);this.map_data.isOccupied(a)&&(e|=HexBitmask$$module$hexmenu.IS_HEX_OCCUPIED);this.map_data.isCoastal(a)&&(e|=HexBitmask$$module$hexmenu.IS_HEX_COASTAL);this.map_data.isRiverSource(a)&&(e|=HexBitmask$$module$hexmenu.IS_HEX_VALID_RIVER_SOURCE);this.map_data.isBorderline(a)&&(e|=
HexBitmask$$module$hexmenu.IS_HEX_HAS_BORDER);this.map_data.getRealmOnCoast(this.state.menu.nx,this.state.menu.ny)&&(e|=HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REALM);this.map_data.getRegionOnCoast(this.state.menu.nx,this.state.menu.ny)&&(e|=HexBitmask$$module$hexmenu.IS_HEX_EXTENDING_REGION);return e}render(a,e){var n=this.focused_hex?getOffset$$module$hex(this.focused_hex.x,this.focused_hex.y,0,0):null;n=this.focused_hex?html$$module$hexmap` <polygon class="focused-hex" points=${makeHex$$module$hex(n)} /> `:
html$$module$hexmap``;var t=1<e.zoom_factor&&1500>e.zoom_factor&&!a.locked&&!e.spinner;t||(this.selected=!1);var z=5/Math.sqrt(e.zoom_factor);t=this.state.menu?html$$module$hexmap`<${HexMenu$$module$hexmenu}
          menu=${this.state.menu}
          cond=${t}
          bitmask=${this.hexBitmask()}
          handler=${this}
          scale=${Math.min(Math.max(1.5*z,.5),3)}
        />`:html$$module$hexmap``;this.fillOceanHexes(e.offset.x,e.offset.y,e.dim.w,e.dim.h);z=this.state.col1;z=a.hex_uuid?"rect1":"col1";const D=e.hotkey_mode?SeaHexMask$$module$hex:SeaHex$$module$hex;return html$$module$hexmap`<div
      id="hexmap"
      class="${z}"
      style="overflow:hidden;${a.visible?"":"display:none;"}"
    >
      <svg
        id="canvas"
        class="${a.desaturate_palette?"desaturated":"colorful"} ${e.hotkey_mode&&"fow_mode"}"
        preserveAspectRatio="xMidYMid meet"
        viewBox="${this.state.offset.x} ${this.state.offset.y} ${this.state.dim.w} ${this.state.dim.h}"
      >
        <g id="viewport">
          <g class="pod-wrap">
            <g opacity="${this.state.zoom_factor/4}">
              ${this.sea.map(F=>html$$module$hexmap`<${D}
                  id=${F.uuid}
                  res="${e.res}"
                  type="${F.type}"
                  class="base"
                  uuid="${F.uuid}"
                  nx="${F.x}"
                  ny="${F.y}"
                  ox="${e.offset.x}"
                  oy="${e.offset.y}"
                  dimw="${e.dim.w}"
                  dimh="${e.dim.h}"
                  zoom_factor=${e.zoom_factor}
                  menuHandler="${this}"
                  flag_hotkey_mode=${e.flag_hotkey_mode}
                />`)}
            </g>
            <g>
              ${e.borders.map(F=>html$$module$hexmap` <${Underwear$$module$hexmap}
                  fow=${e.hotkey_mode}
                  borders="${F.wall}"
                />`)}
            </g>
            ${e.hexlist.map(F=>html$$module$hexmap`<${Hex$$module$hex}
                  res="${e.res}"
                  type="${F.type}"
                  feature="${F.feature}"
                  feature_uuid="${F.feature_uuid}"
                  class="base"
                  instance="${a.instance}"
                  uuid=${F.uuid}
                  riverline=${F.riverline}
                  trailslines=${F.trailslines}
                  location_uuid=${a.hex_uuid}
                  nx="${F.x}"
                  ny="${F.y}"
                  zoom_factor=${e.zoom_factor}
                  ox="${e.offset.x}"
                  oy="${e.offset.y}"
                  dimw="${e.dim.w}"
                  dimh="${e.dim.h}"
                  menuHandler="${this}"
                  tokens=${this.tokens}
                  hotkey_mode=${e.hotkey_mode}
                  show_labels=${a.show_labels}
                />`)}
            ${e.hotkey_mode&&1E3>e.zoom_factor&&e.hexlist.map(F=>html$$module$hexmap`<${HexMask$$module$hex}
                uuid=${F.uuid}
                nx="${F.x}"
                ny="${F.y}"
                zoom_factor=${e.zoom_factor}
                ox="${e.offset.x}"
                oy="${e.offset.y}"
                dimw="${e.dim.w}"
                dimh="${e.dim.h}"
                flag_hotkey_mode=${e.flag_hotkey_mode}
              />`)}
            <g>
              ${e.borders.map(F=>html$$module$hexmap`<a onClick=${()=>this.onClickRealm(F.uuid)}>
                  <${Borderline$$module$hex}
                    borders="${F.wall}"
                    arm="10"
                    color="#ffffff"
                    zoom_factor=${e.zoom_factor}
                    ox="${this.state.offset.x}"
                    oy="${this.state.offset.y}"
                    dimw="${this.state.dim.w}"
                    dimh="${this.state.dim.h}"
                /></a>`)}
            </g>
            <g>${n}</g>
            <g>
              ${e.flags.map(F=>html$$module$hexmap`<polygon
                  class="flagged-hex"
                  points=${makeHex$$module$hex(getOffset$$module$hex(F.x,F.y))}
                />`)}
            </g>
            <g>
              ${"col1"==z&&a.show_labels%2&&!e.hotkey_mode?this.hexlabels.map(F=>{if(this.is_within_frustrum(F))return html$$module$hexmap`
                        <${InMapLabel$$module$hexmap}
                          zoom_factor=${this.state.zoom_factor}
                          zoom_threshold="300"
                          label_opacity_factor=${(this.state.zoom_factor-80)/160}
                          l=${F}
                          label_class="hex-label"
                          yoffset="2.5em"
                        />
                      `}):html$$module$hexmap``}
            </g>
            <g>
              ${"col1"==z&&a.show_labels%2&&!e.hotkey_mode||this.show_region_label?this.region_labels.map(F=>{if((!this.show_region_label||this.show_region_label==F.uuid)&&this.is_within_frustrum(F))return html$$module$hexmap`
                        <${InMapLabel$$module$hexmap}
                          zoom_factor=${this.state.zoom_factor}
                          zoom_threshold="50"
                          label_opacity_factor=${this.show_region_label?1:(this.state.zoom_factor-5)/10}
                          l=${F}
                          label_class="region-label"
                          yoffset="1em"
                        />
                      `}):html$$module$hexmap``}
            </g>
            <g>
              ${"col1"==z&&a.show_labels%2&&!e.hotkey_mode&&!this.show_region_label||this.show_realm_label?this.state.realm_labels.map(F=>{if(!this.show_realm_label||this.show_realm_label==F[3])return html$$module$hexmap`
                      <text
                        opacity="${1-clamp$$module$utils((this.state.zoom_factor-3)/10,0,1)}"
                        transform="translate( ${F[1].x} , ${F[1].y})"
                        class="realm-label"
                        font-size="${F[2]}em"
                        text-anchor="middle"
                      >
                        ${F[0].map((J,G)=>html$$module$hexmap`<tspan x="0" y="${G-2}em" dy="1em"
                            >${J}</tspan
                          >`)}
                      </text>
                    `}):html$$module$hexmap``}
            </g>
          </g>
        </g>
        <g>${t}</g>
      </svg>
    </div>`}}var module$hexmap={};module$hexmap.HexMap=HexMap$$module$hexmap;module$hexmap.VttHexMap=VttHexMap$$module$hexmap;const html$$module$spinner=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);function InnerSpinner$$module$spinner(){return html$$module$spinner`
    <style>
      #eefEsROxk9w2_ts {
        animation: eefEsROxk9w2_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w2_ts__ts {
        0% {
          transform: translate(328.585373px, 76.258278px) rotate(91.041629deg)
            scale(0, 0);
        }
        34.482759% {
          transform: translate(328.585373px, 76.258278px) rotate(91.041629deg)
            scale(1, 1);
        }
        68.965517% {
          transform: translate(328.585373px, 76.258278px) rotate(91.041629deg)
            scale(0, 0);
        }
        100% {
          transform: translate(328.585373px, 76.258278px) rotate(91.041629deg)
            scale(0, 0);
        }
      }
      #eefEsROxk9w3_ts {
        animation: eefEsROxk9w3_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w3_ts__ts {
        0% {
          transform: translate(440.19521px, 139.159051px) rotate(91.041629deg)
            scale(0, 0);
        }
        13.793103% {
          transform: translate(440.19521px, 139.159051px) rotate(91.041629deg)
            scale(0, 0);
        }
        48.275862% {
          transform: translate(440.19521px, 139.159051px) rotate(91.041629deg)
            scale(1, 1);
        }
        82.758621% {
          transform: translate(440.19521px, 139.159051px) rotate(91.041629deg)
            scale(0, 0);
        }
        100% {
          transform: translate(440.19521px, 139.159051px) rotate(91.041629deg)
            scale(0, 0);
        }
      }
      #eefEsROxk9w4_ts {
        animation: eefEsROxk9w4_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w4_ts__ts {
        0% {
          transform: translate(440.19521px, 273.305491px) rotate(91.041629deg)
            scale(0, 0);
        }
        31.034483% {
          transform: translate(440.19521px, 273.305491px) rotate(91.041629deg)
            scale(0, 0);
        }
        65.517241% {
          transform: translate(440.19521px, 273.305491px) rotate(91.041629deg)
            scale(1, 1);
        }
        100% {
          transform: translate(440.19521px, 273.305491px) rotate(91.041629deg)
            scale(0, 0);
        }
      }
      #eefEsROxk9w5_ts {
        animation: eefEsROxk9w5_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w5_ts__ts {
        0% {
          transform: translate(328.747458px, 337.283861px) rotate(91.041629deg)
            scale(0.5, 0.5);
        }
        13.793103% {
          transform: translate(328.747458px, 337.283861px) rotate(91.041629deg)
            scale(0, 0);
        }
        48.275862% {
          transform: translate(328.747458px, 337.283861px) rotate(91.041629deg)
            scale(0, 0);
        }
        82.758621% {
          transform: translate(328.747458px, 337.283861px) rotate(91.041629deg)
            scale(1, 1);
        }
        100% {
          transform: translate(328.747458px, 337.283861px) rotate(91.041629deg)
            scale(0.5, 0.5);
        }
      }
      #eefEsROxk9w6_ts {
        animation: eefEsROxk9w6_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w6_ts__ts {
        0% {
          transform: translate(224.649822px, 273.703072px) rotate(91.041629deg)
            scale(1, 1);
        }
        34.482759% {
          transform: translate(224.649822px, 273.703072px) rotate(91.041629deg)
            scale(0, 0);
        }
        65.517241% {
          transform: translate(224.649822px, 273.703072px) rotate(91.041629deg)
            scale(0, 0);
        }
        100% {
          transform: translate(224.649822px, 273.703072px) rotate(91.041629deg)
            scale(1, 1);
        }
      }
      #eefEsROxk9w7_ts {
        animation: eefEsROxk9w7_ts__ts 2900ms linear infinite normal forwards;
      }
      @keyframes eefEsROxk9w7_ts__ts {
        0% {
          transform: translate(224.649822px, 143.849319px) rotate(91.041629deg)
            scale(0.5, 0.5);
        }
        17.241379% {
          transform: translate(224.649822px, 143.849319px) rotate(91.041629deg)
            scale(1, 1);
        }
        48.275862% {
          transform: translate(224.649822px, 143.849319px) rotate(91.041629deg)
            scale(0, 0);
        }
        82.758621% {
          transform: translate(224.649822px, 143.849319px) rotate(91.041629deg)
            scale(0, 0);
        }
        100% {
          transform: translate(224.649822px, 143.849319px) rotate(91.041629deg)
            scale(0.5, 0.5);
        }
      }
    </style>
    <g
      id="eefEsROxk9w2_ts"
      transform="translate(328.585373,76.258278) rotate(91.041629) scale(0,0)"
    >
      <polygon
        id="eefEsROxk9w2"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
    <g
      id="eefEsROxk9w3_ts"
      transform="translate(440.19521,139.159051) rotate(91.041629) scale(0,0)"
    >
      <polygon
        id="eefEsROxk9w3"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
    <g
      id="eefEsROxk9w4_ts"
      transform="translate(440.19521,273.305491) rotate(91.041629) scale(0,0)"
    >
      <polygon
        id="eefEsROxk9w4"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
    <g
      id="eefEsROxk9w5_ts"
      transform="translate(328.747458,337.283861) rotate(91.041629) scale(0.5,0.5)"
    >
      <polygon
        id="eefEsROxk9w5"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
    <g
      id="eefEsROxk9w6_ts"
      transform="translate(224.649822,273.703072) rotate(91.041629) scale(1,1)"
    >
      <polygon
        id="eefEsROxk9w6"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
    <g
      id="eefEsROxk9w7_ts"
      transform="translate(224.649822,143.849319) rotate(91.041629) scale(0.5,0.5)"
    >
      <polygon
        id="eefEsROxk9w7"
        points="0,-70.923853 61.421858,-35.461927 61.421858,35.461926 0,70.923853 -61.421858,35.461926 -61.421858,-35.461927 0,-70.923853"
        transform="translate(0,0)"
        fill="#df286d"
        stroke="none"
        stroke-width="12"
      />
    </g>
  `}class Spinner$$module$spinner extends k$$module$libs$preact{constructor(){super()}render(a){return html$$module$spinner`
      <div id="hexspinner" style="${a.style}">
        <svg
          width="${a.width}"
          id="eefEsROxk9w1"
          xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          viewBox="0 0 640 480"
          shape-rendering="geometricPrecision"
          text-rendering="geometricPrecision"
          style="background:transparent;"
        >
          <${InnerSpinner$$module$spinner} />
        </svg>
      </div>
    `}}var module$spinner={};module$spinner.InnerSpinner=InnerSpinner$$module$spinner;module$spinner.Spinner=Spinner$$module$spinner;const html$$module$search=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);
class SearchBar$$module$search extends k$$module$libs$preact{constructor(){super();this.setState({callInvoked:!1,results:[]});this.search=this.search.bind(this);this.delayTimer=null}search(a){const e=document.getElementById("search-input").value;""==e||void 0===e?this.setState({results:[]}):(this.setState({callInvoked:!0}),api_call_search$$module$api_shim(a,e).then(n=>{this.setState({results:n.results,callInvoked:!1})}))}delayed_search(a){this.delayTimer&&clearTimeout(this.delayTimer);let e=this;
this.delayTimer=setTimeout(function(){e.search(a)},150)}render(a,e){const n=0<e.results.length||!e.callInvoked?html$$module$search``:html$$module$search`
            <div style="width:100%;text-align:center;">
              <${Spinner$$module$spinner} style="" width="50px" />
            </div>
          `;return html$$module$search`
          <div> <input placeholder="Search" id="search-input" autocomplete="off" onkeypress="${()=>this.delayed_search(a.instance)}" onkeyup="${()=>this.delayed_search(a.instance)}"      
        onfocusin=${()=>window.app.inhibit_hotkeys=!0}
        onfocusout=${()=>window.app.inhibit_hotkeys=!1}

        > 

      </input>
      ${n}
          <ul id="search-results">
            ${e.results.map(t=>html$$module$search`<li>
                <a
                  href="/sandbox/${a.instance}/${t.type}/${t.uuid}${t.anchor?"/npc/"+t.anchor:""}"
                >
                  <div style="display:table-row;">
                    <div style="display:table-cell;">
                      <i
                        style="margin-right:0.5em;"
                        class="fa fa-solid fa-${t.icon}"
                      ></i>
                    </div>
                    <div style="display:table-cell;width:100%;">
                      ${t.value}
                    </div>
                  </div>
                  <div style="display:table-row;">
                    <div style="display:table-cell;"></div>
                    <div class="details" style="display:table-cell;width:100%;">
                      ${t.details}
                    </div>
                  </div>
                </a>
              </li>`)}
          </ul>
          </div>
      `}}var module$search={};module$search.SearchBar=SearchBar$$module$search;const html$$module$dialogs=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);
class GenerateRealmDialog$$module$dialogs extends ModalDialog$$module$utils{constructor(){super();this.state={show:!0,realm_type:"RealmTypeKingdom",minimum_number_of_regions:6,maximum_number_of_regions:12,mountains_probability:3,forest_probability:5,desert_probability:1,plains_probability:4,jungle_probability:0,swamps_probability:2,tundra_probability:0,minimum_tiles_per_mountains_region:12,maximum_tiles_per_mountains_region:32,minimum_tiles_per_forest_region:12,maximum_tiles_per_forest_region:32,
minimum_tiles_per_desert_region:12,maximum_tiles_per_desert_region:32,minimum_tiles_per_plains_region:12,maximum_tiles_per_plains_region:32,minimum_tiles_per_jungle_region:12,maximum_tiles_per_jungle_region:32,minimum_tiles_per_swamps_region:12,maximum_tiles_per_swamps_region:32,minimum_tiles_per_tundra_region:12,maximum_tiles_per_tundra_region:32,minimum_number_of_settlements:6,maximum_number_of_settlements:9,cities_probability:2,towns_probability:3,villages_probability:3,minimum_number_of_dwellings:7,
maximum_number_of_dwellings:11,house_probability:1,stronghold_probability:1,minimum_number_of_inns:3,maximum_number_of_inns:6,minimum_number_of_dungeons:6,maximum_number_of_dungeons:9,tombs_probability:1,temples_probability:1,caves_probability:1,minimum_number_of_factions:3,maximum_number_of_factions:5,cults_probability:1,militias_probability:1,syndicates_probability:1,wandering_monsters_max_hd:4,treasure_factor:1};this.onSubmit=this.onSubmit.bind(this);this.onRealmType=this.onRealmType.bind(this);
this.onRealmPopulation=this.onRealmPopulation.bind(this);this.onMinimumNumberOfRegions=this.onMinimumNumberOfRegions.bind(this);this.onMaximumNumberOfRegions=this.onMaximumNumberOfRegions.bind(this);this.onMountainsProbability=this.onMountainsProbability.bind(this);this.onMinimumTilesPerMountainsRegion=this.onMinimumTilesPerMountainsRegion.bind(this);this.onMaximumTilesPerMountainsRegion=this.onMaximumTilesPerMountainsRegion.bind(this);this.onMinimumTilesPerForestRegion=this.onMinimumTilesPerForestRegion.bind(this);
this.onMaximumTilesPerForestRegion=this.onMaximumTilesPerForestRegion.bind(this);this.onMinimumTilesPerDesertRegion=this.onMinimumTilesPerDesertRegion.bind(this);this.onMaximumTilesPerDesertRegion=this.onMaximumTilesPerDesertRegion.bind(this);this.onMinimumTilesPerPlainsRegion=this.onMinimumTilesPerPlainsRegion.bind(this);this.onMaximumTilesPerPlainsRegion=this.onMaximumTilesPerPlainsRegion.bind(this);this.onMinimumTilesPerJungleRegion=this.onMinimumTilesPerJungleRegion.bind(this);this.onMaximumTilesPerJungleRegion=
this.onMaximumTilesPerJungleRegion.bind(this);this.onMinimumTilesPerSwampsRegion=this.onMinimumTilesPerSwampsRegion.bind(this);this.onMaximumTilesPerSwampsRegion=this.onMaximumTilesPerSwampsRegion.bind(this);this.onMinimumTilesPerTundraRegion=this.onMinimumTilesPerTundraRegion.bind(this);this.onMaximumTilesPerTundraRegion=this.onMaximumTilesPerTundraRegion.bind(this);this.onForestProbability=this.onForestProbability.bind(this);this.onDesertProbability=this.onDesertProbability.bind(this);this.onPlainsProbability=
this.onPlainsProbability.bind(this);this.onJungleProbability=this.onJungleProbability.bind(this);this.onSwampsProbability=this.onSwampsProbability.bind(this);this.onTundraProbability=this.onTundraProbability.bind(this);this.onMinimumNumberOfSettlements=this.onMinimumNumberOfSettlements.bind(this);this.onMaximumNumberOfSettlements=this.onMaximumNumberOfSettlements.bind(this);this.onCitiesProbability=this.onCitiesProbability.bind(this);this.onTownsProbability=this.onTownsProbability.bind(this);this.onMinimumNumberOfDwellings=
this.onMinimumNumberOfDwellings.bind(this);this.onMaximumNumberOfDwellings=this.onMaximumNumberOfDwellings.bind(this);this.onHouseProbability=this.onHouseProbability.bind(this);this.onStrongholdProbability=this.onStrongholdProbability.bind(this);this.onVillagesProbability=this.onVillagesProbability.bind(this);this.onMinimumNumberOfInns=this.onMinimumNumberOfInns.bind(this);this.onMaximumNumberOfInns=this.onMaximumNumberOfInns.bind(this);this.onMinimumNumberOfDungeons=this.onMinimumNumberOfDungeons.bind(this);
this.onMaximumNumberOfDungeons=this.onMaximumNumberOfDungeons.bind(this);this.onTombsProbability=this.onTombsProbability.bind(this);this.onTemplesProbability=this.onTemplesProbability.bind(this);this.onCavesProbability=this.onCavesProbability.bind(this);this.onMinimumNumberOfFactions=this.onMinimumNumberOfFactions.bind(this);this.onMaximumNumberOfFactions=this.onMaximumNumberOfFactions.bind(this);this.onCultsProbability=this.onCultsProbability.bind(this);this.onMilitiasProbability=this.onMilitiasProbability.bind(this);
this.onSyndicatesProbability=this.onSyndicatesProbability.bind(this);this.onWanderingMonstersMaxHD=this.onWanderingMonstersMaxHD.bind(this);this.onTreasureFactor=this.onTreasureFactor.bind(this)}show(){this.setState({show:!0})}hide(){this.setState({show:!1})}onRealmType(a){"RealmTypeLands"==a.target.value&&this.setState({realm_type:"RealmTypeLands",minimum_number_of_regions:6,maximum_number_of_regions:12,mountains_probability:3,forest_probability:0,desert_probability:1,plains_probability:0,jungle_probability:4,
swamps_probability:1,tundra_probability:0,minimum_tiles_per_mountains_region:12,maximum_tiles_per_mountains_region:32,minimum_tiles_per_desert_region:12,maximum_tiles_per_desert_region:32,minimum_tiles_per_jungle_region:12,maximum_tiles_per_jungle_region:32,minimum_tiles_per_swamps_region:12,maximum_tiles_per_swamps_region:32});"RealmTypeKingdom"==a.target.value&&this.setState({realm_type:"RealmTypeKingdom",minimum_number_of_regions:6,maximum_number_of_regions:12,mountains_probability:3,forest_probability:5,
desert_probability:1,plains_probability:4,jungle_probability:0,swamps_probability:2,tundra_probability:0,minimum_tiles_per_mountains_region:12,maximum_tiles_per_mountains_region:32,minimum_tiles_per_forest_region:12,maximum_tiles_per_forest_region:32,minimum_tiles_per_desert_region:12,maximum_tiles_per_desert_region:32,minimum_tiles_per_plains_region:12,maximum_tiles_per_plains_region:32,minimum_tiles_per_swamps_region:12,maximum_tiles_per_swamps_region:32});"RealmTypeEmpire"==a.target.value&&this.setState({realm_type:"RealmTypeEmpire",
minimum_number_of_regions:24,maximum_number_of_regions:32,mountains_probability:3,forest_probability:5,desert_probability:1,plains_probability:4,jungle_probability:0,swamps_probability:2,tundra_probability:0,minimum_tiles_per_mountains_region:12,maximum_tiles_per_mountains_region:32,minimum_tiles_per_forest_region:12,maximum_tiles_per_forest_region:32,minimum_tiles_per_desert_region:12,maximum_tiles_per_desert_region:32,minimum_tiles_per_plains_region:12,maximum_tiles_per_plains_region:32,minimum_tiles_per_swamps_region:12,
maximum_tiles_per_swamps_region:32});"RealmTypeDuchy"==a.target.value&&this.setState({realm_type:"RealmTypeDuchy",minimum_number_of_regions:4,maximum_number_of_regions:8,mountains_probability:3,forest_probability:5,desert_probability:1,plains_probability:4,jungle_probability:0,swamps_probability:2,tundra_probability:0,minimum_tiles_per_mountains_region:12,maximum_tiles_per_mountains_region:32,minimum_tiles_per_forest_region:12,maximum_tiles_per_forest_region:32,minimum_tiles_per_desert_region:12,
maximum_tiles_per_desert_region:32,minimum_tiles_per_plains_region:12,maximum_tiles_per_plains_region:32,minimum_tiles_per_swamps_region:12,maximum_tiles_per_swamps_region:32});"RealmTypeIsland"==a.target.value&&this.setState({realm_type:"RealmTypeIsland",minimum_number_of_regions:3,maximum_number_of_regions:7,mountains_probability:3,forest_probability:0,desert_probability:1,plains_probability:0,jungle_probability:2,swamps_probability:0,tundra_probability:0,minimum_tiles_per_mountains_region:3,maximum_tiles_per_mountains_region:8,
minimum_tiles_per_forest_region:12,maximum_tiles_per_forest_region:32,minimum_tiles_per_desert_region:3,maximum_tiles_per_desert_region:8,minimum_tiles_per_jungle_region:3,maximum_tiles_per_jungle_region:8,minimum_tiles_per_plains_region:12,maximum_tiles_per_plains_region:32,minimum_tiles_per_swamps_region:12,maximum_tiles_per_swamps_region:32,minimum_number_of_dungeons:1,maximum_number_of_dungeons:3,minimum_number_of_settlements:0,maximum_number_of_settlements:1,minimum_number_of_dwellings:2,maximum_number_of_dwellings:5,
minimum_number_of_inns:0,maximum_number_of_inns:1,minimum_number_of_factions:0,maximum_number_of_factions:1,cities_probability:1,towns_probability:2,villages_probability:4})}onRealmPopulation(a){"now"==a.target.value&&this.setState({minimum_number_of_settlements:6,maximum_number_of_settlements:9,minimum_number_of_dwellings:7,maximum_number_of_dwellings:11,minimum_number_of_inns:6,maximum_number_of_inns:9,minimum_number_of_factions:3,maximum_number_of_factions:5});"later"==a.target.value&&this.setState({minimum_number_of_settlements:0,
maximum_number_of_settlements:0,minimum_number_of_dwellings:0,maximum_number_of_dwellings:0,minimum_number_of_inns:0,maximum_number_of_inns:0,minimum_number_of_factions:0,maximum_number_of_factions:0})}preventLower(a,e){return parseInt(a)>parseInt(e)?a:e}onMinimumNumberOfRegions(a){this.state.maximum_number_of_regions<parseInt(a.target.value)&&(this.state.maximum_number_of_regions=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_regions=a.target.value}onMaximumNumberOfRegions(a){this.state.maximum_number_of_regions=
this.preventLower(this.state.minimum_number_of_regions,a.target.value);this.forceUpdate()}onMountainsProbability(a){this.state.mountains_probability=a.target.value}onMinimumTilesPerMountainsRegion(a){this.state.maximum_tiles_per_mountains_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_mountains_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_mountains_region=a.target.value}onMaximumTilesPerMountainsRegion(a){this.state.maximum_tiles_per_mountains_region=
this.preventLower(this.state.minimum_tiles_per_mountains_region,a.target.value);this.forceUpdate()}onMinimumTilesPerForestRegion(a){this.state.maximum_tiles_per_forest_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_forest_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_forest_region=a.target.value}onMaximumTilesPerForestRegion(a){this.state.maximum_tiles_per_forest_region=this.preventLower(this.state.minimum_tiles_per_forest_region,a.target.value);
this.forceUpdate()}onMinimumTilesPerDesertRegion(a){this.state.maximum_tiles_per_desert_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_desert_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_desert_region=a.target.value}onMaximumTilesPerDesertRegion(a){this.state.maximum_tiles_per_desert_region=this.preventLower(this.state.minimum_tiles_per_desert_region,a.target.value);this.forceUpdate()}onMinimumTilesPerPlainsRegion(a){this.state.maximum_tiles_per_plains_region<
parseInt(a.target.value)&&(this.state.maximum_tiles_per_plains_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_plains_region=a.target.value}onMaximumTilesPerPlainsRegion(a){this.state.maximum_tiles_per_plains_region=this.preventLower(this.state.minimum_tiles_per_plains_region,a.target.value);this.forceUpdate()}onMinimumTilesPerJungleRegion(a){this.state.maximum_tiles_per_jungle_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_jungle_region=parseInt(a.target.value),
this.forceUpdate());this.state.minimum_tiles_per_jungle_region=a.target.value}onMaximumTilesPerJungleRegion(a){this.state.maximum_tiles_per_jungle_region=this.preventLower(this.state.minimum_tiles_per_jungle_region,a.target.value);this.forceUpdate()}onMinimumTilesPerSwampsRegion(a){this.state.maximum_tiles_per_swamps_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_swamps_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_swamps_region=a.target.value}onMaximumTilesPerSwampsRegion(a){this.state.maximum_tiles_per_swamps_region=
this.preventLower(this.state.minimum_tiles_per_swamps_region,a.target.value);this.forceUpdate()}onMinimumTilesPerTundraRegion(a){this.state.maximum_tiles_per_tundra_region<parseInt(a.target.value)&&(this.state.maximum_tiles_per_tundra_region=parseInt(a.target.value),this.forceUpdate());this.state.minimum_tiles_per_tundra_region=a.target.value}onMaximumTilesPerTundraRegion(a){this.state.maximum_tiles_per_tundra_region=this.preventLower(this.state.minimum_tiles_per_tundra_region,a.target.value);this.forceUpdate()}preventAllBiomesProbabilitySetToZero(){return 0==
parseInt(this.state.mountains_probability)&&0==parseInt(this.state.forest_probability)&&0==parseInt(this.state.desert_probability)&&0==parseInt(this.state.plains_probability)&&0==parseInt(this.state.jungle_probability)&&0==parseInt(this.state.swamps_probability)&&0==parseInt(this.state.tundra_probability)?!0:!1}onForestProbability(a){this.state.forest_probability=a.target.value;this.preventAllBiomesProbabilitySetToZero()&&(this.state.forest_probability=1,this.forceUpdate())}onDesertProbability(a){this.state.desert_probability=
a.target.value;this.preventAllBiomesProbabilitySetToZero()&&(this.state.desert_probability=1,this.forceUpdate())}onPlainsProbability(a){this.state.plains_probability=a.target.value;this.preventAllBiomesProbabilitySetToZero()&&(this.state.plains_probability=1,this.forceUpdate())}onJungleProbability(a){this.state.jungle_probability=a.target.value;this.preventAllBiomesProbabilitySetToZero()&&(this.state.jungle_probability=1,this.forceUpdate())}onSwampsProbability(a){this.state.swamps_probability=a.target.value;
this.preventAllBiomesProbabilitySetToZero()&&(this.state.swamps_probability=1,this.forceUpdate())}onTundraProbability(a){this.state.tundra_probability=a.target.value;this.preventAllBiomesProbabilitySetToZero()&&(this.state.tundra_probability=1,this.forceUpdate())}onMinimumNumberOfSettlements(a){this.state.maximum_number_of_settlements<parseInt(a.target.value)&&(this.state.maximum_number_of_settlements=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_settlements=a.target.value}onMaximumNumberOfSettlements(a){this.state.maximum_number_of_settlements=
this.preventLower(this.state.minimum_number_of_settlements,a.target.value);this.forceUpdate()}onCitiesProbability(a){this.state.cities_probability=a.target.value}onTownsProbability(a){this.state.towns_probability=a.target.value}onVillagesProbability(a){this.state.villages_probability=a.target.value}onMinimumNumberOfDwellings(a){this.state.maximum_number_of_dwellings<parseInt(a.target.value)&&(this.state.maximum_number_of_dwellings=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_dwellings=
a.target.value}onMaximumNumberOfDwellings(a){this.state.maximum_number_of_dwellings=this.preventLower(this.state.minimum_number_of_dwellings,a.target.value);this.forceUpdate()}onHouseProbability(a){this.state.house_probability=a.target.value}onStrongholdProbability(a){this.state.stronghold_probability=a.target.value}onMinimumNumberOfInns(a){this.state.maximum_number_of_inns<parseInt(a.target.value)&&(this.state.maximum_number_of_inns=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_inns=
a.target.value}onMaximumNumberOfInns(a){this.state.maximum_number_of_inns=this.preventLower(this.state.minimum_number_of_inns,a.target.value);this.forceUpdate()}onMinimumNumberOfDungeons(a){this.state.maximum_number_of_dungeons<parseInt(a.target.value)&&(this.state.maximum_number_of_dungeons=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_dungeons=a.target.value}onMaximumNumberOfDungeons(a){this.state.maximum_number_of_dungeons=this.preventLower(this.state.minimum_number_of_dungeons,
a.target.value);this.forceUpdate()}onTombsProbability(a){this.state.tombs_probability=a.target.value}onTemplesProbability(a){this.state.temples_probability=a.target.value}onCavesProbability(a){this.state.caves_probability=a.target.value}onMinimumNumberOfFactions(a){this.state.maximum_number_of_factions<parseInt(a.target.value)&&(this.state.maximum_number_of_factions=parseInt(a.target.value),this.forceUpdate());this.state.minimum_number_of_factions=a.target.value}onMaximumNumberOfFactions(a){this.state.maximum_number_of_factions=
this.preventLower(this.state.minimum_number_of_factions,a.target.value);this.forceUpdate()}onCultsProbability(a){this.state.cults_probability=a.target.value}onMilitiasProbability(a){this.state.militias_probability=a.target.value}onSyndicatesProbability(a){this.state.syndicates_probability=a.target.value}onWanderingMonstersMaxHD(a){this.state.wandering_monsters_max_hd=a.target.value}onTreasureFactor(a){this.state.treasure_factor=a.target.value}onSubmit(){this.props.onOkay({RealmTypeKingdom:"RuledRealm",
RealmTypeLands:"RuledRealm",RealmTypeDuchy:"RuledRealm",RealmTypeEmpire:"RuledRealm",RealmTypeIsland:"UnruledRealm"}[this.state.realm_type],{realm_type:this.state.realm_type,minimum_number_of_regions:parseInt(this.state.minimum_number_of_regions),maximum_number_of_regions:parseInt(this.state.maximum_number_of_regions),mountains_probability:parseInt(this.state.mountains_probability),forest_probability:parseInt(this.state.forest_probability),desert_probability:parseInt(this.state.desert_probability),
plains_probability:parseInt(this.state.plains_probability),jungle_probability:parseInt(this.state.jungle_probability),swamps_probability:parseInt(this.state.swamps_probability),tundra_probability:parseInt(this.state.tundra_probability),minimum_tiles_per_mountains_region:parseInt(this.state.minimum_tiles_per_mountains_region),maximum_tiles_per_mountains_region:parseInt(this.state.maximum_tiles_per_mountains_region),minimum_tiles_per_forest_region:parseInt(this.state.minimum_tiles_per_forest_region),
maximum_tiles_per_forest_region:parseInt(this.state.maximum_tiles_per_forest_region),minimum_tiles_per_desert_region:parseInt(this.state.minimum_tiles_per_desert_region),maximum_tiles_per_desert_region:parseInt(this.state.maximum_tiles_per_desert_region),minimum_tiles_per_plains_region:parseInt(this.state.minimum_tiles_per_plains_region),maximum_tiles_per_plains_region:parseInt(this.state.maximum_tiles_per_plains_region),minimum_tiles_per_jungle_region:parseInt(this.state.minimum_tiles_per_jungle_region),
maximum_tiles_per_jungle_region:parseInt(this.state.maximum_tiles_per_jungle_region),minimum_tiles_per_swamps_region:parseInt(this.state.minimum_tiles_per_swamps_region),maximum_tiles_per_swamps_region:parseInt(this.state.maximum_tiles_per_swamps_region),minimum_tiles_per_tundra_region:parseInt(this.state.minimum_tiles_per_tundra_region),maximum_tiles_per_tundra_region:parseInt(this.state.maximum_tiles_per_tundra_region),minimum_number_of_settlements:parseInt(this.state.minimum_number_of_settlements),
maximum_number_of_settlements:parseInt(this.state.maximum_number_of_settlements),cities_probability:parseInt(this.state.cities_probability),towns_probability:parseInt(this.state.towns_probability),villages_probability:parseInt(this.state.villages_probability),minimum_number_of_dwellings:parseInt(this.state.minimum_number_of_dwellings),maximum_number_of_dwellings:parseInt(this.state.maximum_number_of_dwellings),house_probability:parseInt(this.state.house_probability),stronghold_probability:parseInt(this.state.stronghold_probability),
minimum_number_of_inns:parseInt(this.state.minimum_number_of_inns),maximum_number_of_inns:parseInt(this.state.maximum_number_of_inns),minimum_number_of_dungeons:parseInt(this.state.minimum_number_of_dungeons),maximum_number_of_dungeons:parseInt(this.state.maximum_number_of_dungeons),tombs_probability:parseInt(this.state.tombs_probability),temples_probability:parseInt(this.state.temples_probability),caves_probability:parseInt(this.state.caves_probability),minimum_number_of_factions:parseInt(this.state.minimum_number_of_factions),
maximum_number_of_factions:parseInt(this.state.maximum_number_of_factions),cults_probability:parseInt(this.state.cults_probability),militias_probability:parseInt(this.state.militias_probability),syndicates_probability:parseInt(this.state.syndicates_probability),wandering_monsters_max_hd:parseInt(this.state.wandering_monsters_max_hd),treasure_factor:parseFloat(this.state.treasure_factor)});this.setState({show:!1})}okay(a){this.props.onOkay(a);this.setState({show:!1})}cancel(){$$$module$libs$preact_router_module("/sandbox/"+
this.props.instance)}render(a,e){return e.show?html$$module$dialogs` <!-- The Modal -->
      <div id="realm-generator" class="modal">
        <!-- Modal content -->
        <div class="modal-content modal-content-flex">
          <div class="modal-header">
            <span class="close">
              <a
                onClick="${n=>{this.cancel()}}"
              >
                ${"\u00d7"}
              </a>
            </span>
            <button form="generator-form" type="submit">GENERATE</button>
            <p>
              <small>
                Read more about building a sandbox in
                <a
                  style="text-decoration: underline; color: #aa5522"
                  href="https://docs.hexroll.app/building-a-sandbox/generating-a-realm/"
                  target="_blank"
                  ><strong>docs.hexroll.app</strong></a
                >
              </small>
            </p>
          </div>
          <div class="modal-body">
            <form id="generator-form" onSubmit="${this.onSubmit}">
              <h4 id="scale">Realm Template</h4>

              <p>
                <small>
                  Changing realm template options will preset the values in the
                  rest of this form for you to tweak further.
                </small>
              </p>

              <label for="realm_type">Realm Type:</label>

              <select
                name="realm_type"
                id="realm_type"
                value="${e.realm_type}"
                onInput="${this.onRealmType}"
              >
                <option value="RealmTypeEmpire">Empire</option>
                <option value="RealmTypeLands">Lands</option>
                <option value="RealmTypeKingdom" selected="selected">
                  Kingdom
                </option>
                <option value="RealmTypeDuchy">Duchy</option>
                <option value="RealmTypeIsland">Island</option>
              </select>

              <label for="realm_population">Population:</label>

              <select
                name="realm_population"
                id="realm_population"
                value="${e.realm_population}"
                onInput="${this.onRealmPopulation}"
              >
                <option value="now">Generate now</option>
                <option value="later">I'll add later</option>
              </select>

              <h4 id="terrain">Terrain</h4>
              <p>
                <small>
                  Tame the number of generated regions, biomes probabilities and
                  number of hexes per region.
                </small>
              </p>

              <h5>Number of regions</h5>
              <label for="minimum_number_of_regions">Generate between </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.minimum_number_of_regions}"
                onInput="${this.onMinimumNumberOfRegions}"
                min="1"
                max="32"
                pattern="[0-9]+"
                id="minimum_number_of_regions"
                name="minimum_number_of_regions"
              />
              <label for="maximum_number_of_regions"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.maximum_number_of_regions}"
                onChange="${this.onMaximumNumberOfRegions}"
                min="1"
                max="32"
                pattern="[0-9]+"
                id="maximum_number_of_regions"
                name="maximum_number_of_regions"
              />
              <label for="maximum_number_of_regions"> regions. </label> <br />

              <div style="display:flex;">
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Mountains</title>
                    <use
                      xlink:href="${window.app.theme}#mountains"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label
                      for="mountains_probability"
                      title="Probability Factor"
                    >
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.mountains_probability}"
                      onInput="${this.onMountainsProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="mountains_probability"
                      name="mountains_probability"
                    />
                  </div>

                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_mountains_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_mountains_region}"
                      onInput="${this.onMinimumTilesPerMountainsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_mountains_region"
                      name="minimum_tiles_per_mountains_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_mountains_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_mountains_region}"
                      onChange="${this.onMaximumTilesPerMountainsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_mountains_region"
                      name="maximum_tiles_per_mountains_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Forests</title>
                    <use
                      xlink:href="${window.app.theme}#forest"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="forest_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.forest_probability}"
                      onInput="${this.onForestProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="forest_probability"
                      name="forest_probability"
                    />
                  </div>

                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_forest_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_forest_region}"
                      onInput="${this.onMinimumTilesPerForestRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_forest_region"
                      name="minimum_tiles_per_forest_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_forest_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_forest_region}"
                      onChange="${this.onMaximumTilesPerForestRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_forest_region"
                      name="maximum_tiles_per_forest_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Plains/Grasslands</title>
                    <use
                      xlink:href="${window.app.theme}#plains"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="plains_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.plains_probability}"
                      onInput="${this.onPlainsProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="plains_probability"
                      name="plains_probability"
                    />
                  </div>

                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_plains_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_plains_region}"
                      onInput="${this.onMinimumTilesPerPlainsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_plains_region"
                      name="minimum_tiles_per_plains_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_plains_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_plains_region}"
                      onChange="${this.onMaximumTilesPerPlainsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_plains_region"
                      name="maximum_tiles_per_plains_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Deserts</title>
                    <use
                      xlink:href="${window.app.theme}#desert"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="desert_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.desert_probability}"
                      onInput="${this.onDesertProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="desert_probability"
                      name="desert_probability"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_desert_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_desert_region}"
                      onInput="${this.onMinimumTilesPerDesertRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_desert_region"
                      name="minimum_tiles_per_desert_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_desert_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_desert_region}"
                      onChange="${this.onMaximumTilesPerDesertRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_desert_region"
                      name="maximum_tiles_per_desert_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Jungles/Rainforests</title>
                    <use
                      xlink:href="${window.app.theme}#jungle"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="jungle_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.jungle_probability}"
                      onInput="${this.onJungleProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="jungle_probability"
                      name="jungle_probability"
                    />
                  </div>

                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_jungle_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_jungle_region}"
                      onInput="${this.onMinimumTilesPerJungleRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_jungle_region"
                      name="minimum_tiles_per_jungle_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_jungle_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_jungle_region}"
                      onChange="${this.onMaximumTilesPerJungleRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_jungle_region"
                      name="maximum_tiles_per_jungle_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Wetlands</title>
                    <use
                      xlink:href="${window.app.theme}#swamps"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="swamps_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.swamps_probability}"
                      onInput="${this.onSwampsProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="swamps_probability"
                      name="swamps_probability"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_swamps_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_swamps_region}"
                      onInput="${this.onMinimumTilesPerSwampsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_swamps_region"
                      name="minimum_tiles_per_swamps_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_swamps_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_swamps_region}"
                      onChange="${this.onMaximumTilesPerSwampsRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_swamps_region"
                      name="maximum_tiles_per_swamps_region"
                    />
                  </div>
                </div>
                <div style="width:110px">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    style="background:none; max-width:100px; height:100px;"
                  >
                    <title>Tundras</title>
                    <use
                      xlink:href="${window.app.theme}#tundra"
                      transform="translate(50,50) scale(5,5)"
                    />
                  </svg>
                  <div style="display:block;">
                    <label for="tundra_probability" title="Probability Factor">
                      ${"P\u00d7"}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.tundra_probability}"
                      onInput="${this.onTundraProbability}"
                      min="0"
                      max="10"
                      pattern="[0-9]+"
                      id="tundra_probability"
                      name="tundra_probability"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="minimum_tiles_per_tundra_region"
                      title="Minimum Number of Hexes Per Region"
                    >
                      ${">="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.minimum_tiles_per_tundra_region}"
                      onInput="${this.onMinimumTilesPerTundraRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="minimum_tiles_per_tundra_region"
                      name="minimum_tiles_per_tundra_region"
                    />
                  </div>
                  <div style="display:block;">
                    <label
                      for="maximum_tiles_per_tundra_region"
                      title="Maximum Number of Hexes per Region"
                    >
                      ${"<="}
                    </label>
                    <input
                      required
                      style="text-align:center"
                      size="3"
                      type="number"
                      value="${e.maximum_tiles_per_tundra_region}"
                      onChange="${this.onMaximumTilesPerTundraRegion}"
                      min="1"
                      max="50"
                      pattern="[0-9]+"
                      id="maximum_tiles_per_tundra_region"
                      name="maximum_tiles_per_tundra_region"
                    />
                  </div>
                </div>
              </div>

              <h4 id="dungeons">Dungeons</h4>
              <p>
                <small>
                  Generated dungeons will hold monsters, treasure and will open
                  up additional quest opportunities by other NPCs.
                </small>
              </p>
              <h5>Number of dungeons</h5>
              <label for="minimum_number_of_dungeons">Generate between </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.minimum_number_of_dungeons}"
                onInput="${this.onMinimumNumberOfDungeons}"
                min="0"
                max="18"
                pattern="[0-9]+"
                id="minimum_number_of_dungeons"
                name="minimum_number_of_dungeons"
              />
              <label for="maximum_number_of_dungeons"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.maximum_number_of_dungeons}"
                onChange="${this.onMaximumNumberOfDungeons}"
                min="0"
                max="18"
                pattern="[0-9]+"
                id="maximum_number_of_dungeons"
                name="maximum_number_of_dungeons"
              />
              <label for="maximum_number_of_dungeons"> dungeons. </label> <br />

              <h5>Dungeon types probability</h5>
              <label for="caves_probability" title="Probability Factor">
                Caves ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.caves_probability}"
                onInput="${this.onCavesProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="caves_probability"
                name="caves_probability"
              />

              <label for="temples_probability" title="Probability Factor">
                Temples ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.temples_probability}"
                onInput="${this.onTemplesProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="temples_probability"
                name="temples_probability"
              />

              <label for="tombs_probability" title="Probability Factor">
                Tombs ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.tombs_probability}"
                onInput="${this.onTombsProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="tombs_probability"
                name="tombs_probability"
              />

              <h5>Wandering Monsters</h5>
              <label for="highest_wandering_monster_hitdice_in_dungeons">
                Wandering monsters highest HD is
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="3"
                min="1"
                max="15"
                value="${e.wandering_monsters_max_hd}"
                onInput="${this.onWanderingMonstersMaxHD}"
                pattern="[0-9]+"
                id="highest_wandering_monster_hitdice_in_dungeons"
                name="highest_wandering_monster_hitdice_in_dungeons"
              />
              <br />

              <h4 id="settlements">Settlements</h4>
              <p>
                <small>
                  Settlements is where most NPCs, taverns, shops and services
                  reside.
                </small>
              </p>
              <h5>Number of settlements</h5>
              <label for="minimum_number_of_settlements"
                >Generate between
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="12"
                value="${e.minimum_number_of_settlements}"
                onInput="${this.onMinimumNumberOfSettlements}"
                pattern="[0-9]+"
                id="minimum_number_of_settlements"
                name="minimum_number_of_settlements"
              />
              <label for="maximum_number_of_settlements"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="12"
                pattern="[0-9]+"
                value="${e.maximum_number_of_settlements}"
                onChange="${this.onMaximumNumberOfSettlements}"
                id="maximum_number_of_settlements"
                name="maximum_number_of_settlements"
              />
              <label for="maximum_number_of_settlements"> settlements. </label>
              <br />

              <h5>Settlement types probability</h5>
              <label for="cities_probability"> Cities: </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="10"
                pattern="[0-9]+"
                value="${e.cities_probability}"
                onInput="${this.onCitiesProbability}"
                id="cities_probability"
                name="cities_probability"
              />

              <label for="towns_probability"> Towns: </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="10"
                pattern="[0-9]+"
                value="${e.towns_probability}"
                onInput="${this.onTownsProbability}"
                id="towns_probability"
                name="towns_probability"
              />

              <label for="villages_probability"> Villages: </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="10"
                pattern="[0-9]+"
                value="${e.villages_probability}"
                onInput="${this.onVillagesProbability}"
                id="villages_probability"
                name="villages_probability"
              />

              <h4 id="inns">Inns</h4>
              <h5>Number of inns (not in settlements)</h5>
              <label for="minimum_number_of_inns">Generate between </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.minimum_number_of_inns}"
                onInput="${this.onMinimumNumberOfInns}"
                min="0"
                max="9"
                pattern="[0-9]+"
                id="minimum_number_of_inns"
                name="minimum_number_of_inns"
              />
              <label for="maximum_number_of_inns"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.maximum_number_of_inns}"
                onChange="${this.onMaximumNumberOfInns}"
                min="0"
                max="9"
                pattern="[0-9]+"
                id="maximum_number_of_inns"
                name="maximum_number_of_inns"
              />
              <label for="maximum_number_of_inns"> inns. </label> <br />
              <br />

              <h4 id="dwellings">Dwellings</h4>
              <p>
                <small>
                  Dwellings are isolated places of residence that can provide
                  additional encounter opportunities.
                </small>
              </p>
              <h5>Number of dwellings</h5>
              <label for="minimum_number_of_dwellings">Generate between </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="12"
                value="${e.minimum_number_of_dwellings}"
                onInput="${this.onMinimumNumberOfDwellings}"
                pattern="[0-9]+"
                id="minimum_number_of_dwellings"
                name="minimum_number_of_dwellings"
              />
              <label for="maximum_number_of_dwellings"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="12"
                pattern="[0-9]+"
                value="${e.maximum_number_of_dwellings}"
                onChange="${this.onMaximumNumberOfDwellings}"
                id="maximum_number_of_dwellings"
                name="maximum_number_of_dwellings"
              />
              <label for="maximum_number_of_dwellings"> dwellings. </label>
              <br />

              <h5>Dwelling types probability</h5>
              <label for="house_probability"> Farms & Cabins: </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="10"
                pattern="[0-9]+"
                value="${e.house_probability}"
                onInput="${this.onHouseProbability}"
                id="house_probability"
                name="house_probability"
              />

              <label for="stronghold_probability"> Strongholds: </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                min="0"
                max="10"
                pattern="[0-9]+"
                value="${e.stronghold_probability}"
                onInput="${this.onStrongholdProbability}"
                id="stronghold_probability"
                name="stronghold_probability"
              />

              <br />

              <h4 id="factions">Factions</h4>
              <p>
                <small>
                  Factions provide more potential storylines and use NPCs
                  generated earlier as members or collaborators.
                </small>
              </p>
              <h5>Number of factions</h5>
              <label for="minimum_number_of_factions">Generate between </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.minimum_number_of_factions}"
                onInput="${this.onMinimumNumberOfFactions}"
                min="0"
                max="7"
                pattern="[0-9]+"
                id="minimum_number_of_factions"
                name="minimum_number_of_factions"
              />
              <label for="maximum_number_of_factions"> to </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.maximum_number_of_factions}"
                onChange="${this.onMaximumNumberOfFactions}"
                min="0"
                max="7"
                pattern="[0-9]+"
                id="maximum_number_of_factions"
                name="maximum_number_of_factions"
              />
              <label for="maximum_number_of_factions"> factions. </label> <br />

              <h5>Faction types probability</h5>
              <label for="cults_probability" title="Probability Factor">
                Cults ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.cults_probability}"
                onInput="${this.onCultsProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="cults_probability"
                name="cults_probability"
              />

              <label for="militias_probability" title="Probability Factor">
                Militias ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.militias_probability}"
                onInput="${this.onMilitiasProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="militias_probability"
                name="militias_probability"
              />

              <label for="syndicates_probability" title="Probability Factor">
                Syndicates ${"P\u00d7"}
              </label>
              <input
                required
                style="text-align:center"
                size="3"
                type="number"
                value="${e.syndicates_probability}"
                onInput="${this.onSyndicatesProbability}"
                min="0"
                max="10"
                pattern="[0-9]+"
                id="syndicates_probability"
                name="syndicates_probability"
              />

              <h4>Tweaks and Experiments</h4>
              <label for="treasure_factor"> Treasure Multiplier ${"T\u00d7"} </label>
              <input
                required
                style="text-align:center"
                size="5"
                type="number"
                value="${e.treasure_factor}"
                onInput="${this.onTreasureFactor}"
                min="0.01"
                max="10"
                step="0.01"
                pattern="[0-9.]+"
                id="treasure_factor"
                name="treasure_factor"
              />
              <p>
                <small>
                  Any generated treasure value will be multiplied by this value.
                </small>
              </p>
            </form>
          </div>
        </div>
      </div>`:html$$module$dialogs``}}var module$dialogs={};module$dialogs.GenerateRealmDialog=GenerateRealmDialog$$module$dialogs;const html$$module$hexview=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);
class Slider$$module$hexview extends k$$module$libs$preact{constructor(){super();this.state={transition:"hidden"}}componentDidMount(a,e,n){0==this.props.switch?this.setState({visible:!1,transition:"hidden"}):this.setState({visible:!0,transition:"visible"})}componentWillUpdate(a){if(this.props.switch!=a.switch){window.clearTimeout(this.interval);0==a.switch?this.setState({transition:"hidden"}):this.setState({transition:"visible"});var e=this;a.keep||(0==a.switch?this.interval=window.setTimeout(function(){e.setState({visible:!1})},
500):e.setState({visible:!0}))}}render(a,e){return html$$module$hexview`<div id="${a.id}" class="${e.transition}">
      ${e.visible?a.visible():html$$module$hexview``}
    </div> `}}class Toggles$$module$hexview extends k$$module$libs$preact{constructor(){super();this.setState({visible:!0})}onLock(){this.setState({visible:!this.state.visible})}render(a,e){return html$$module$hexview`
      <div>
        <div style="display:inline-block; width:1.5em;">
          <a title="Map Toggles" onClick="${()=>this.onLock()}"
            ><i class="fa fa-solid ${"fa-toggle-on"}"></i>
          </a>
        </div>
        <${Slider$$module$hexview}
          id="toggle-labels"
          switch=${!e.visible}
          visible=${()=>html$$module$hexview`
              <a title="Toggle Labels" onClick="${()=>a.onToggleLabels()}"
                ><i class="fa fa-solid fa-eye"></i>
              </a>
              <a
                title="Toggle Map Colors"
                onClick="${()=>a.onTogglePalette()}"
                ><i class="fa fa-solid fa-palette"></i>
              </a>
              ${is_electron$$module$api_shim||html$$module$hexview`<a
                title=${a.vttLive?"Switch VTT Off":"Switch VTT On"}
                onClick="${()=>a.onVtt()}"
                ><i
                  style="${a.vttLive&&"color: #df286d"}"
                  class="fa fa-solid fa-share-nodes"
                ></i>
              </a>`}
            `}
        />
      </div>
    `}}
class Toolbar$$module$hexview extends k$$module$libs$preact{constructor(){super();this.state={locked:!0}}componentWillUpdate(a){1==a.hidden&&0==this.props.hidden&&this.setState({locked:!0});this.setState({in_edit:"edit"==a.mode})}onLock(){this.setState({locked:!this.state.locked});this.state.locked?document.querySelectorAll(".btn-icon-hidden").forEach(function(a){a.classList.replace("btn-icon-hidden","btn-icon")}):document.querySelectorAll(".btn-icon").forEach(function(a){a.classList.replace("btn-icon","btn-icon-hidden")})}render(a,
e){return is_electron$$module$api_shim?html$$module$hexview``:html$$module$hexview`
      <div id="header-menu">
        <div style="float:right;display:inline-block; width:1.5em;">
          <a
            title="Edit this page"
            class="${(e.in_edit||"coords"==a.type)&&"disabled"}"
            onclick="${()=>{this.setState({in_edit:!0});a.onEdit()}}"
            ><i class="fa fa-feather"></i
          ></a>
        </div>
        <div style="display:inline-block; width:1.5em;">
          <a
            title=${e.locked?"Unlock this page":"Lock this page"}
            class="${(e.in_edit||"toc"===a.type)&&"disabled"}"
            onClick="${()=>this.onLock()}"
            ><i class="fa fa-solid ${e.locked?"fa-lock":"fa-lock-open"}"></i>
          </a>
        </div>
        <${Slider$$module$hexview}
          id="drawer-append2"
          switch=${!e.locked}
          visible=${()=>html$$module$hexview`
              <a
                title="Reroll this page"
                class="${(e.in_edit||"toc"===a.type)&&"disabled"}"
                onclick="${()=>a.onReroll()}"
                ><i class="fa fa-dice"></i
              ></a>
            `}
        />
      </div>
    `}}class Drawer$$module$hexview extends k$$module$libs$preact{constructor(){super();this.setState({locked:window.app.locked})}onLock(){window.app.locked=!window.app.locked;this.setState({locked:window.app.locked});this.props.onLock(window.app.locked)}render(a,e){return html$$module$hexview`
      <div>
        <div style="display:inline-block; width:1.5em;">
          <a title=${e.locked?"Unlock sandbox for editing":"Lock sandbox for editing"} onClick="${()=>this.onLock()}"
            ><i class="fa fa-solid ${e.locked?"fa-lock":"fa-lock-open"}"></i>
          </a>
        </div>
        <${Slider$$module$hexview}
          id="drawer-append"
          switch=${!e.locked}
          visible=${()=>html$$module$hexview` <a
              title="Roll a Realm"
              onClick="${()=>a.onAppend()}"
              ><i class="fa fa-solid fa-circle-plus"></i>
            </a>`}
        />
      </div>
    `}}
class EntityEditor$$module$hexview extends k$$module$libs$preact{constructor(){super()}componentDidMount(a,e,n){let t=this;this.editor=tinymce.init({relative_urls:!1,extended_valid_elements:"span[*]",document_base_url:window.location.hostname,content_css:"/editor.css?"+(new Date).getTime(),style_formats_merge:!0,formats:{"my-inline":{title:"checked HP",selector:"span.hp-mark",inline:"span",classes:["hp-mark-checked"]}},selector:"textarea#entity_editor",promotion:!1,menubar:!1,statusbar:!1,height:"100%",
toolbar:"undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | checkhp | outdent indent | bullist | link | image | exit | save",plugins:"advlist link image lists table fullscreen save image",save_onsavecallback:()=>this.props.onSave(!0),setup:function(z){z.ui.registry.addButton("checkhp",{text:"Toggle HP",icon:"table-delete-table",classes:"ampforwp-copy-content-button ",tooltip:"Mark lost monster hit points",onAction:function(){tinymce.activeEditor.formatter.toggle("my-inline");
tinymce.activeEditor.setDirty(!0)}});z.ui.registry.addButton("exit",{icon:"browse",classes:"ampforwp-copy-content-button ",tooltip:"Discard",onAction:function(){t.props.onSave(!1)}})}}).then(()=>{this.props.onEditorActive()})}componentWillUnmount(){tinymce.remove()}render(a){return html$$module$hexview`<textarea id="entity_editor" name="editor">
${a.initial}</textarea
    >`}}
class HexView$$module$hexview extends k$$module$libs$preact{constructor(){super();this.state={html:"",coords:{},appending:!1,waiting:!0,toggle:1,map_locked:!0,show_labels:1,desaturate_palette:!1,showReadme:!1,showTokenChooser:!1,packaging:!1,snackbar:!1,backpack_link:null,ephemeral:!1,modalOn:!1,activateEditor:!1,vtt_live:!1};this.onLock=this.onLock.bind(this);this.closeSnackbar=this.closeSnackbar.bind(this);this.appendCall=this.appendCall.bind(this);this.appendDialog=this.appendDialog.bind(this);this.onToggleLabels=
this.onToggleLabels.bind(this);this.onTogglePalette=this.onTogglePalette.bind(this);this.onEditorActive=this.onEditorActive.bind(this);this.setEditorValue=this.setEditorValue.bind(this);this.reroll=this.reroll.bind(this);this.append=this.append.bind(this);this.onReadme=this.onReadme.bind(this);this.toggleSpinner=this.toggleSpinner.bind(this);this.spinners=[!1,!1]}toggleModal(){this.setState({modalOn:!this.state.modalOn})}spinnerState(a,e){this.spinners[a]=e;return this.spinners[0]||this.spinners[1]}toggleSpinner(a,
e){this.setState({waiting:this.spinnerState(a,e)})}setEditorValue(a){this.editor_v=a}onEditorActive(){tinymce.activeEditor.undoManager.clear()}navigatedToOceanHexOnMount(){return"coords"==this.props.type?(this.get_ocean(),this.map.postMapLoaded(()=>{const a=parse_canonical_coords$$module$utils(this.props.hex_uuid);this.map.map_data.addOceanHex(a.x,a.y);this.map.navigateToHex(this.props.hex_uuid)}),!0):!1}gotEntityForEditingOnMount(){return"edit"==this.props.mode?(this.get_entity(this.props.hex_uuid,
this.setEditorValue,!0),!0):!1}patchTocProps(a){"view"==a.mode&&"root"==a.hex_uuid&&(a.hex_uuid=a.instance,a.type="toc")}componentDidMount(a,e,n){this.patchTocProps(this.props);"vtt"==this.props.mode?window.app.vtt_on(this.props.instance):window.app.vtt_referee=!0;this.props.hex_uuid&&(this.navigatedToOceanHexOnMount()||this.gotEntityForEditingOnMount()||this.get_entity(this.props.hex_uuid,this.setEditorValue));this.map&&this.map.sizeToFit();"append"==this.props.mode&&(this.toggleSpinner(0,!1),this.toggleSpinner(1,
!1));api_call_version$$module$api_shim(this.props.instance).then(t=>{this.setState({BACKEND_BUILD_ID:t.build})});is_electron$$module$api_shim||fetch("/mode/"+this.props.instance,{method:"GET"}).then(t=>t.json()).then(t=>{this.setState({ephemeral:t.ephemeral,showExpired:t.expired})}).catch(t=>{console.error("Error:",t)})}componentDidUpdate(a){void 0===a.hex_uuid&&(window.app.zooming_into_entity=!0);this.props.hex_uuid?"coords"==this.props.type?this.navigatedToOceanHexOnMount():this.props.hex_uuid!=
a.hex_uuid&&this.get_entity(this.props.hex_uuid,this.setEditorValue):this.map.sizeToFit();a.mode!=this.props.mode&&("edit"==a.mode&&this.setState({activateEditor:!1}),void 0!=this.props.hex_uuid&&this.get_entity(this.props.hex_uuid,this.setEditorValue))}componentWillUpdate(a){this.patchTocProps(a);"append"==a.mode&&(this.spinners[0]=!1,this.spinners[1]=!1)}crossDissolve(a){let e=document.getElementById("entity"+this.toggle);this.toggle=1==this.toggle?2:1;let n=document.getElementById("entity"+this.toggle);
n&&(n.innerHTML=a);n&&this.toolbar.state.locked&&n.querySelectorAll(".btn-icon").forEach(function(t){t.classList.replace("btn-icon","btn-icon-hidden")});n&&n.classList.remove("hidden");e&&e.classList.add("hidden");window.clearTimeout(this.entity_timeout);this.entity_timeout=window.setTimeout(()=>{e&&(e.innerHTML="")},1E3);return n}get_ocean(){this.crossDissolve("Reroll this hex to generate its content.");const a=`
      <span class="breadcrumbs">
        <a href="/sandbox/${this.props.instance}">SANDBOX</a>
      </span>
      <br />
      The Vast Ocean
    `;document.getElementById("hex_title").innerHTML=a;document.title="Hex "+this.props.hex_uuid}get_entity(a,e,n=!1,t=!0){t&&["entity1","entity2"].map(D=>{document.getElementById(D)&&document.getElementById(D).scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})});let z=document.implementation.createHTMLDocument();n&&api_call_html$$module$api_shim("view",this.props.instance,a).then(D=>{z.open();z.write(D);z.close();z.getElementById("title")&&(D=z.getElementById("title").innerHTML,document.getElementById("hex_title").innerHTML=
D)});api_call_html$$module$api_shim(this.props.mode,this.props.instance,a).then(D=>{var F=this.crossDissolve(D);if(document.getElementById("title")){var J=document.getElementById("title").innerHTML;document.getElementById("title").remove();document.getElementById("hex_title").innerHTML=J;J=document.getElementById("doc-title");document.title=J?J.innerHTML:"HEXROLL 2 - Roll a Sandbox";J&&document.getElementById("doc-title").remove()}this.props.npc&&(J=document.getElementById(this.props.npc))&&J.scrollIntoView(!0);
if(F||"edit"==this.props.mode)if(F="edit"==this.props.mode?z.getElementsByClassName("map-coords")[0]:F&&F.getElementsByClassName("map-coords")[0])if(F.hasAttribute("hex")){const G=F.getAttribute("hex"),K=F.getAttribute("x"),I=F.getAttribute("y"),L=F.getAttribute("zoom");this.map.postMapLoaded(()=>{this.map.navigateToHex(G,{x:K,y:I,zoom:L})})}else F.hasAttribute("region")?this.map.postMapLoaded(()=>{this.map.navigateToRegion(a)}):this.map.postMapLoaded(()=>{this.map.navigateToRealm(a)});else this.map.navigateToHex(a);
e&&"edit"==this.props.mode&&(e(D),this.setState({activateEditor:!0}))})}edit(a){$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/"+this.props.type+"/"+this.props.hex_uuid+"/edit")}onEditorClose(a){a?this.override(tinymce.activeEditor.getContent(),()=>{this.setState({activateEditor:!1});$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/"+this.props.type+"/"+this.props.hex_uuid)}):(this.setState({activateEditor:!1}),$$$module$libs$preact_router_module("/sandbox/"+
this.props.instance+"/"+this.props.type+"/"+this.props.hex_uuid))}override(a,e){fetch("/override/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:this.props.hex_uuid,content:a})}).then(n=>n.text()).then(n=>{e()}).catch(n=>{console.error("Error:",n)})}append(a,e,n){fetch("/append/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,
entity:a,attribute:e,type:n})}).then(t=>t.text()).then(t=>{this.props.hex_uuid&&("coords"==this.props.type?this.get_ocean():this.get_entity(this.props.hex_uuid,this.setEditorValue));this.map.getMatrix(!0)}).catch(t=>{console.error("Error:",t)})}reroll(a,e,n){if(!window.app.inhibit_rerolls)if("coords"==this.props.type)(e=this.map.map_data.getHexDataByUUID(this.props.hex_uuid))&&this.appendCall("OceanHex",null,"ocean",e.x,e.y);else{this.toggleSpinner(0,!0);n=document.getElementsByClassName("fa-dice");
for(let z of n)z.classList.add("rolled");window.app.inhibit_rerolls=!0;var t=this;void 0===a&&(a=this.props.hex_uuid);void 0===e&&(e="default");fetch("/reroll/"+this.props.instance+"/"+a+"/"+e,{method:"GET"}).then(z=>401===z.status?(window.app.unauth(),Promise.reject(z)):z.json()).then(z=>{let D=!1;for(const [,F]of window.app.reroll_handlers)F(),D=!0;D||this.map.getMatrix(!0);a==this.props.hex_uuid?$$$module$libs$preact_router_module("/sandbox/"+t.props.instance+"/"+t.props.type+"/"+z.uuid,!0):(this.get_entity(this.props.hex_uuid,
this.setEditorValue,!1,!1),void 0!==t.props.type&&$$$module$libs$preact_router_module("/sandbox/"+t.props.instance+"/"+t.props.type+"/"+this.props.hex_uuid,!0));window.app.inhibit_rerolls=!1;this.toggleSpinner(0,!1)}).catch(z=>{this.toggleSpinner(0,!1);window.app.inhibit_rerolls=!1;console.error("Error:",z)})}}appendCall(a,e,n="realms",t=null,z=null){this.toggleSpinner(0,!0);"realms"==n&&$$$module$libs$preact_router_module("/sandbox/"+this.props.instance);this.toggleSpinner(0,!0);fetch("/append/",
{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instance:this.props.instance,entity:this.props.instance,attribute:n,type:a,nx:this.menu?this.menu.nx:t,ny:this.menu?this.menu.ny:z,params:JSON.stringify(e)})}).then(D=>D.json()).then(D=>{this.setState({appending:!1,waiting:this.spinnerState(0,!1)});this.menu=null;this.props.hex_uuid&&this.map.postMapLoaded(()=>{$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/hex/"+D.uuid,
!0)});this.map.getMatrix(!0)}).catch(D=>{console.error("Error:",D)})}appendDialog(a){this.menu=a?a:null;$$$module$libs$preact_router_module("/sandbox/"+this.props.instance+"/append");this.setState({appending:!0,waiting:this.spinnerState(0,!1)})}onReadme(){this.setState({showReadme:!this.state.showReadme})}onHotkeyMode(a,e={}){this.setState({hotkey_mode:a});e.hotkey_mode=a;this.map.setState(e);window.app.hotkey_mode=a}clearHotkeyState(){this.onHotkeyMode(!1);window.app.token_hotkey_mode=!1;window.app.flag_hotkey_mode=
!1;window.app.kill_hotkey_mode=!1}showTokenChooser(a){this.tokens_callback=a;this.setState({showTokenChooser:!this.state.showTokenChooser});this.clearHotkeyState()}onLock(a){this.setState({map_locked:a})}onExit(){window.api.quit()}closeSnackbar(){this.setState({snackbar:!1})}onPatreon(){window.location.href="/claim/"+this.props.instance}onDownload(){this.setState({packaging:!0,snackbar:!0});fetch("/pack/"+this.props.instance,{method:"GET"}).then(a=>a.json()).then(a=>{this.setState({packaging:!1,backpack_link:a.filename,
snackbar:!0})}).catch(a=>{this.setState({packaging:!1,backpack_link:null,snackbar:!0});console.error("Error:",a)})}onToggleLabels(a){this.setState({show_labels:this.state.show_labels+1})}onTogglePalette(a){this.setState({desaturate_palette:!this.state.desaturate_palette})}onVtt(){window.app.vtt_on(this.props.instance);let a=10;const e=window.setInterval(()=>{!this.state.vtt_live&&window.app.provider&&window.app.provider.signalingConns[0].connected?(this.setState({show_vtt_message:!0,vtt_live:!this.state.vtt_live}),
window.clearInterval(e)):this.state.vtt_live&&!window.app.provider?(this.setState({show_vtt_message:!0,vtt_live:!this.state.vtt_live}),window.clearInterval(e)):0==a--&&window.clearInterval(e)},1E3)}render(a,e){const n=a.hex_uuid&&"vtt"!=a.mode?"view_visible":"view_hidden",t="append"==a.mode?html$$module$hexview`
            <${GenerateRealmDialog$$module$dialogs}
              ref=${F=>this.dialog=F}
              toggleModal=${()=>this.toggleModal()}
              instance=${a.instance}
              onOkay=${this.appendCall}
            />
          `:html$$module$hexview``,z=e.showReadme?html$$module$hexview`
          <${ReadmeDialog$$module$readme}
            toggleModal=${()=>this.toggleModal()}
            onExit=${this.onReadme}
          />
        `:html$$module$hexview``,D=e.showExpired&&"vtt"!=a.mode?html$$module$hexview`
          <${ExpiredDialog$$module$readme}
            toggleModal=${()=>this.toggleModal()}
            onExit=${()=>this.setState({showExpired:!1})}
          />
        `:html$$module$hexview``;return html$$module$hexview`
      ${t} ${z} ${D}
      <${e.show_vtt_message&&VttDialog$$module$readme}
        toggleModal=${()=>this.toggleModal()}
        instance=${a.instance}
        onExit=${()=>this.setState({show_vtt_message:!1})}
      />
      <${e.showTokenChooser&&TokenChooserDialog$$module$tokens}
        toggleModal=${()=>this.toggleModal()}
        callback=${this.tokens_callback}
        onExit=${()=>this.showTokenChooser()}
      />
      <div id="header" class="${n}">
        <h4>
          <div id="hex_title">Loading...<br /><br /></div>
          <${Toolbar$$module$hexview}
            ref=${F=>this.toolbar=F}
            onEdit=${()=>this.edit()}
            onReroll=${this.reroll}
            onLock=${this.onLock}
            mode=${a.mode}
            type=${a.type}
            hidden=${!a.hex_uuid}
          />
        </h4>
      </div>
      <div id="info-bar">
        <span class="info-bar-text">
          <a onClick=${this.onReadme}>
            <strong> HEXROLL 2nd Edition </strong> </a
          >| BETA | frontend build: ${BUILD_ID$$module$version} | backend build:
          ${e.BACKEND_BUILD_ID}</span
        >
        ${e.ephemeral&&html$$module$hexview`
          <a
            class="ephemeral-link"
            href="https://docs.hexroll.app/building-a-sandbox/ephemeral/"
            target="\u201d_blank\u201d"
          >
            <i class="fa-solid fa-warning"></i> Ephemeral Sandbox
          </a>
        `}
      </div>
      <${"vtt"==a.mode?VttHexMap$$module$hexmap:HexMap$$module$hexmap}
        visible="true"
        ref=${F=>this.map=F}
        instance="${a.instance}"
        wuuid=""
        locked=${e.map_locked}
        hex_uuid="${a.hex_uuid}"
        area_uuid="${a.area_uuid}"
        coords=${e.coords}
        show_labels=${e.show_labels}
        desaturate_palette=${e.desaturate_palette}
        appendDialog=${this.appendDialog}
        spinner=${this.toggleSpinner}
        editMode=${"edit"==a.mode}
        type=${a.type}
        hotkeyMode=${(F,J)=>{this.onHotkeyMode(F,J)}}
        vtt=${"vtt"==a.mode}
      />
      <div id="content" class="${n}">
        <${Slider$$module$hexview}
          id="search"
          switch=${!a.hex_uuid&&e.map_locked&&!e.modalOn&&"vtt"!=a.mode&&!e.hotkey_mode&&!e.waiting}
          visible=${()=>html$$module$hexview` <${SearchBar$$module$search} instance="${a.instance}" /> `}
        />
        <div id="map-toolbox">
          <${Slider$$module$hexview}
            id="download-button"
            switch=${!a.hex_uuid&&!e.packaging&&!is_electron$$module$api_shim&&!e.modalOn&&"vtt"!=a.mode&&!e.hotkey_mode&&!e.waiting}
            visible=${()=>html$$module$hexview` <a
                title="Package & Download"
                onClick="${()=>this.onDownload()}"
                ><i class="fa fa-solid fa-circle-down"></i>
              </a>`}
          />
          <${Slider$$module$hexview}
            id="toggles-menu"
            switch=${!a.hex_uuid&&!e.modalOn&&"vtt"!=a.mode&&!e.hotkey_mode&&!e.waiting}
            visible=${()=>html$$module$hexview`
                <${Toggles$$module$hexview}
                  onToggleLabels=${this.onToggleLabels}
                  onTogglePalette=${this.onTogglePalette}
                  vttLive=${e.vtt_live}
                  onVtt=${()=>{this.onVtt()}}
                />
              `}
          />
          <${Slider$$module$hexview}
            id="drawer-menu"
            switch=${!a.hex_uuid&&!is_electron$$module$api_shim&&!e.modalOn&&"vtt"!=a.mode&&!e.hotkey_mode&&!e.waiting}
            visible=${()=>html$$module$hexview`
                <${Drawer$$module$hexview}
                  onAppend=${this.appendDialog}
                  onLock=${this.onLock}
                />
              `}
          />
          <${Slider$$module$hexview}
            id="exit-button"
            switch=${!a.hex_uuid&&is_electron$$module$api_shim&&!e.modalOn&&!e.waiting}
            visible=${()=>html$$module$hexview`
                <a onClick="${()=>this.onExit()}"
                  ><i class="fa fa-solid fa-circle-xmark"></i>
                </a>
              `}
          />
        </div>
        <${Slider$$module$hexview}
          id="backpacker-snackbar"
          switch=${e.snackbar}
          visible=${()=>e.packaging?html$$module$hexview`
                  <div>
                    <i class="fa fa-solid fa-gear animated-gear"></i>
                    Hexroll is now casting a <em>Package Sandbox</em> spell.
                    <br />
                    You will find the download link here in a few moments.
                  </div>
                `:e.backpack_link?html$$module$hexview`
                  <div>
                    <div class="snackbar-close">
                      <a onClick="${this.closeSnackbar}">
                        <i class="fa fa-solid fa-xmark"></i
                      ></a>
                    </div>
                    Your Hexroll Backpack file is ready to
                    <a href="${e.backpack_link}">download now</a>
                  </div>
                `:html$$module$hexview`
                  <div>
                    We had a problem packing your sandbox. <br />This will be
                    looked into and you will be contacted soon.
                  </div>
                `}
        />
        ${e.waiting?html$$module$hexview`
              <${Spinner$$module$spinner}
                width="100px"
                style="position:fixed; z-index:101000; left:2em; bottom: 2em;"
              />
            `:html$$module$hexview``}
        <div
          style="z-index:0;"
          id="entity-container"
          class="${n} ${"edit"==a.mode&&"but_full_width"}"
        >
          ${e.activateEditor?html$$module$hexview`<${EntityEditor$$module$hexview}
                onSave=${F=>this.onEditorClose(F)}
                initial=${this.editor_v}
                onEditorActive=${this.onEditorActive}
              />`:html$$module$hexview`
                <div style="z-index:-1;position:absolute;" id="entity1"></div>
                <div
                  style="z-index:-1;position:absolute;"
                  id="entity2"
                  class="hidden"
                ></div>
              `}
        </div>
      </div>
    `}}var module$hexview={};module$hexview.HexView=HexView$$module$hexview;var t$$module$libs$history_production_min;!function(a){a.Pop="POP";a.Push="PUSH";a.Replace="REPLACE"}(t$$module$libs$history_production_min||={});
function e$$module$libs$history_production_min(a={}){function e(){let {pathname:Z,search:da,hash:R}=J.location,ba=G.state||{};return[ba.idx,{pathname:Z,search:da,hash:R,state:ba.usr||null,key:ba.key||"default"}]}function n(Z){return"string"==typeof Z?Z:c$$module$libs$history_production_min(Z)}function t(Z,da=null){return Object.assign(Object.assign({pathname:Q.pathname,hash:"",search:""},"string"==typeof Z?u$$module$libs$history_production_min(Z):Z),{state:da,key:o$$module$libs$history_production_min()})}
function z(Z,da,R){return!U.length||(U.call({action:Z,location:da,retry:R}),!1)}function D(Z){I=Z;[L,Q]=e();M.call({action:I,location:Q})}function F(Z){G.go(Z)}let {window:J=document.defaultView}=a,G=J.history,K=null;J.addEventListener("popstate",function(){if(K)U.call(K),K=null;else{let Z=t$$module$libs$history_production_min.Pop,[da,R]=e();if(U.length){if(null!=da){let ba=L-da;ba&&(K={action:Z,location:R,retry(){F(-1*ba)}},F(ba))}}else D(Z)}});let I=t$$module$libs$history_production_min.Pop,[L,
Q]=e(),M=i$$module$libs$history_production_min(),U=i$$module$libs$history_production_min();return null==L&&(L=0,G.replaceState(Object.assign(Object.assign({},G.state),{idx:L}),"")),{get action(){return I},get location(){return Q},createHref:n,push:function ba(da,R){let ha=t$$module$libs$history_production_min.Push,ma=t(da,R);if(z(ha,ma,function(){ba(da,R)})){let [ka,pa]=[{usr:ma.state,key:ma.key,idx:L+1},n(ma)];try{G.pushState(ka,"",pa)}catch(la){J.location.assign(pa)}D(ha)}},replace:function ha(R,
ba){let ma=t$$module$libs$history_production_min.Replace,ka=t(R,ba);if(z(ma,ka,function(){ha(R,ba)})){let [pa,la]=[{usr:ka.state,key:ka.key,idx:L},n(ka)];G.replaceState(pa,"",la);D(ma)}},go:F,back(){F(-1)},forward(){F(1)},listen:R=>M.push(R),block(R){let ba=U.push(R);return 1===U.length&&J.addEventListener("beforeunload",l$$module$libs$history_production_min),function(){ba();U.length||J.removeEventListener("beforeunload",l$$module$libs$history_production_min)}}}}
function n$$module$libs$history_production_min(a={}){function e(){let {pathname:da="/",search:R="",hash:ba=""}=u$$module$libs$history_production_min(G.location.hash.substr(1)),ha=K.state||{};return[ha.idx,{pathname:da,search:R,hash:ba,state:ha.usr||null,key:ha.key||"default"}]}function n(){if(I)Z.call(I),I=null;else{let da=t$$module$libs$history_production_min.Pop,[R,ba]=e();if(Z.length){if(null!=R){let ha=Q-R;ha&&(I={action:da,location:ba,retry(){J(-1*ha)}},J(ha))}}else F(da)}}function t(da){var R=
document.querySelector("base"),ba="";R&&R.getAttribute("href")&&(R=G.location.href,ba=R.indexOf("#"),ba=-1===ba?R:R.slice(0,ba));return ba+"#"+("string"==typeof da?da:c$$module$libs$history_production_min(da))}function z(da,R=null){return Object.assign(Object.assign({pathname:M.pathname,hash:"",search:""},"string"==typeof da?u$$module$libs$history_production_min(da):da),{state:R,key:o$$module$libs$history_production_min()})}function D(da,R,ba){return!Z.length||(Z.call({action:da,location:R,retry:ba}),
!1)}function F(da){L=da;[Q,M]=e();U.call({action:L,location:M})}function J(da){K.go(da)}let {window:G=document.defaultView}=a,K=G.history,I=null;G.addEventListener("popstate",n);G.addEventListener("hashchange",()=>{let [,da]=e();c$$module$libs$history_production_min(da)!==c$$module$libs$history_production_min(M)&&n()});let L=t$$module$libs$history_production_min.Pop,[Q,M]=e(),U=i$$module$libs$history_production_min(),Z=i$$module$libs$history_production_min();return null==Q&&(Q=0,K.replaceState(Object.assign(Object.assign({},
K.state),{idx:Q}),"")),{get action(){return L},get location(){return M},createHref:t,push:function ha(R,ba){let ma=t$$module$libs$history_production_min.Push,ka=z(R,ba);if(D(ma,ka,function(){ha(R,ba)})){let [pa,la]=[{usr:ka.state,key:ka.key,idx:Q+1},t(ka)];try{K.pushState(pa,"",la)}catch(ta){G.location.assign(la)}F(ma)}},replace:function ma(ba,ha){let ka=t$$module$libs$history_production_min.Replace,pa=z(ba,ha);if(D(ka,pa,function(){ma(ba,ha)})){let [la,ta]=[{usr:pa.state,key:pa.key,idx:Q},t(pa)];
K.replaceState(la,"",ta);F(ka)}},go:J,back(){J(-1)},forward(){J(1)},listen:ba=>U.push(ba),block(ba){let ha=Z.push(ba);return 1===Z.length&&G.addEventListener("beforeunload",l$$module$libs$history_production_min),function(){ha();Z.length||G.removeEventListener("beforeunload",l$$module$libs$history_production_min)}}}}
function a$$module$libs$history_production_min(a={}){function e(M,U=null){return Object.assign(Object.assign({pathname:I.pathname,search:"",hash:""},"string"==typeof M?u$$module$libs$history_production_min(M):M),{state:U,key:o$$module$libs$history_production_min()})}function n(M,U,Z){return!Q.length||(Q.call({action:M,location:U,retry:Z}),!1)}function t(M,U){K=M;I=U;L.call({action:K,location:I})}function z(M){let U=r$$module$libs$history_production_min(G+M,0,J.length-1),Z=t$$module$libs$history_production_min.Pop,
da=J[U];n(Z,da,function(){z(M)})&&(G=U,t(Z,da))}let {initialEntries:D=["/"],initialIndex:F}=a,J=D.map(M=>Object.assign({pathname:"/",search:"",hash:"",state:null,key:o$$module$libs$history_production_min()},"string"==typeof M?u$$module$libs$history_production_min(M):M)),G=r$$module$libs$history_production_min(null==F?J.length-1:F,0,J.length-1),K=t$$module$libs$history_production_min.Pop,I=J[G],L=i$$module$libs$history_production_min(),Q=i$$module$libs$history_production_min();return{get index(){return G},
get action(){return K},get location(){return I},createHref:function(M){return"string"==typeof M?M:c$$module$libs$history_production_min(M)},push:function da(U,Z){let R=t$$module$libs$history_production_min.Push,ba=e(U,Z);n(R,ba,function(){da(U,Z)})&&(G+=1,J.splice(G,J.length,ba),t(R,ba))},replace:function R(Z,da){let ba=t$$module$libs$history_production_min.Replace,ha=e(Z,da);n(ba,ha,function(){R(Z,da)})&&(J[G]=ha,t(ba,ha))},go:z,back(){z(-1)},forward(){z(1)},listen:Z=>L.push(Z),block:Z=>Q.push(Z)}}
function r$$module$libs$history_production_min(a,e,n){return Math.min(Math.max(a,e),n)}function l$$module$libs$history_production_min(a){a.preventDefault();a.returnValue=""}function i$$module$libs$history_production_min(){let a=[];return{get length(){return a.length},push:e=>(a.push(e),function(){a=a.filter(n=>n!==e)}),call(e){a.forEach(n=>n&&n(e))}}}function o$$module$libs$history_production_min(){return Math.random().toString(36).substr(2,8)}
function c$$module$libs$history_production_min({pathname:a="/",search:e="",hash:n=""}){return e&&"?"!==e&&(a+="?"===e.charAt(0)?e:"?"+e),n&&"#"!==n&&(a+="#"===n.charAt(0)?n:"#"+n),a}function u$$module$libs$history_production_min(a){let e={};if(a){var n=a.indexOf("#");0<=n&&(e.hash=a.substr(n),a=a.substr(0,n));n=a.indexOf("?");0<=n&&(e.search=a.substr(n),a=a.substr(0,n));a&&(e.pathname=a)}return e}var module$libs$history_production_min={};module$libs$history_production_min.Action=t$$module$libs$history_production_min;
module$libs$history_production_min.createBrowserHistory=e$$module$libs$history_production_min;module$libs$history_production_min.createHashHistory=n$$module$libs$history_production_min;module$libs$history_production_min.createMemoryHistory=a$$module$libs$history_production_min;module$libs$history_production_min.createPath=c$$module$libs$history_production_min;module$libs$history_production_min.parsePath=u$$module$libs$history_production_min;const html$$module$code=$jscompDefaultExport$$module$libs$htm.bind(y$$module$libs$preact);class YMock$$module$code{constructor(){this.map=new Map}observe(a){}unobserve(a){}get(a){return this.map.get(a)}set(a,e){this.map.set(a,e)}}
class App$$module$code extends k$$module$libs$preact{constructor(){super();this.state={mode:"hexmap",hexlist:[],borders:[],unauth:!1};this.theme=is_electron$$module$api_shim?"hexroll-default-theme.svg?"+BUILD_ID$$module$version:"/hexroll-default-theme.svg?"+BUILD_ID$$module$version;this.tokens_svg="/tokens.svg?"+BUILD_ID$$module$version;window.main=this;window.app=this;this.last_uuid=this.map2=null;this.inhibit_rerolls=this.inhibit_click=!1;this.settlements_cache={};this.locked=!0;this.tokens=new Map;
this.yarray=new YMock$$module$code;this.zarray=new YMock$$module$code;this.reroll_handlers=new Map;this.ydoc=new Doc$$module$libs$y_webrtc_min;this.yarray=this.ydoc.get("map",YMap$$module$libs$y_webrtc_min);this.zarray=this.ydoc.get("tokeninstances",YMap$$module$libs$y_webrtc_min)}vtt_on(a){this.provider?(this.ydoc.destroy(),this.provider.disconnect(),this.provider=null):this.provider=new WebrtcProvider$$module$libs$y_webrtc_min(a,this.ydoc,{signaling:["wss://vtt.hexroll.app:4444"]})}hideMap(){this.minimap||
(this.minimap=!0,document.getElementById("content").style.display="block",document.getElementById("entity-container").style.display="block",this.map.setState({col1:"rect1"}))}showMap(){this.setState({mode:"hexmap"});this.minimap&&(this.minimap=!1,document.getElementById("content").style.display="none",document.getElementById("entity").innerHTML="",this.map.setState({col1:"col1"}))}reroll(a){this.map.reroll(a,"default")}reroll_ex(a,e,n){this.map.reroll(a,e,n)}append(a,e,n,t){a.style["pointer-events"]=
"none";this.map.append(e,n,t)}unauth(){this.setState({unauth:!0})}onAuthAck(){this.setState({unauth:!1})}render(){const a=this.state.unauth?html$$module$code`
          <div id="myModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
              <div class="close">
                <a onClick="${()=>this.onAuthAck()}"> ${"\u00d7"} </a>
              </div>
              <h5>Hello Adventurer!</h5>
              <p>
                You are currently using an ephemeral sandbox. Ephemeral
                sandboxes have a 1,000,000 gp credit limit and are not
                guaranteed to stay online.
              </p>
              <p>
                If you are a Patreon subscriber, make sure you are logged in to
                claim this sandbox and enjoy an unlimited credit as well as
                online storage and cloud backup.
              </p>
            </div>
          </div>
        `:html$$module$code``;return html$$module$code`
      ${a}
      <${D$$module$libs$preact_router_module} history=${is_electron$$module$api_shim?n$$module$libs$history_production_min():void 0}>
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         mode="view"
         path="/"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         mode="view"
         path="/sandbox/:instance"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/sandbox/:instance/toc"
         mode="view"
         hex_uuid="root"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/vtt/:instance"
         mode="vtt"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         mode="append"
         path="/sandbox/:instance/append"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/sandbox/:instance/:type/:hex_uuid/edit"
         mode="edit"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/vtt/:instance/:type/:hex_uuid/"
         mode="vtt"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/sandbox/:instance/:type/:hex_uuid/"
         mode="view"
       />
        <${HexView$$module$hexview}
         ref=${e=>this.map=e}
         path="/sandbox/:instance/:type/:hex_uuid/npc/:npc"
         mode="view"
       />
      </${D$$module$libs$preact_router_module}>
    `}}let app$$module$code;B$$module$libs$preact(html$$module$code`<${App$$module$code} ref=${a=>app$$module$code=a} />`,document.getElementById("app"));var module$code={};
